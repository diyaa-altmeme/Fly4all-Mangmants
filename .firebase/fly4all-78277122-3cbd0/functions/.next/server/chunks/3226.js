"use strict";exports.id=3226,exports.ids=[3226],exports.modules={4174:(a,b,c)=>{c.d(b,{A:()=>Y});var d=c(21124),e=c(38301),f=c.n(e),g=c(15003),h=c(35284),i=c(40068),j=c(62186),k=c(68120),l=c(45608),m=c(1420),n=c(44943),o=c(37448),p=c(97802),q=c(25456),r=c(21853),s=c(70066),t=c(44043),u=c(49589);let v=(0,c(8808).A)("Hotel",[["path",{d:"M10 22v-6.57",key:"1wmca3"}],["path",{d:"M12 11h.01",key:"z322tv"}],["path",{d:"M12 7h.01",key:"1ivr5q"}],["path",{d:"M14 15.43V22",key:"1q2vjd"}],["path",{d:"M15 16a5 5 0 0 0-6 0",key:"o9wqvi"}],["path",{d:"M16 11h.01",key:"xkw8gn"}],["path",{d:"M16 7h.01",key:"1kdx03"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 7h.01",key:"1vti4s"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]]);var w=c(84407),x=c(27894),y=c(80623),z=c(40822),A=c(37874),B=c(49113),C=c(49566);c(25054);var D=c(63822),E=c(31980),F=c(99546),G=c(50937),H=c(5488),I=c(79202),J=c(63009),K=c(27186),L=c(42329),M=c(67094),N=c(85708);let O=(0,N.createServerReference)("40f3e2b0ca2e561c506ffb1575ff80c4dac60766e4",N.callServer,void 0,N.findSourceMapURL,"getNextVoucherNumber"),P=F.Ik({id:F.Yj(),clientId:F.Yj().min(1,{message:"اسم الشركة مطلوب."}),clientName:F.Yj().min(1),tickets:F.au.number().int().nonnegative().default(0),visas:F.au.number().int().nonnegative().default(0),hotels:F.au.number().int().nonnegative().default(0),groups:F.au.number().int().nonnegative().default(0),notes:F.Yj().optional(),ticketProfitType:F.k5(["fixed","percentage"]).default("percentage"),ticketProfitValue:F.au.number().min(0).default(50),visaProfitType:F.k5(["fixed","percentage"]).default("percentage"),visaProfitValue:F.au.number().min(0).default(100),hotelProfitType:F.k5(["fixed","percentage"]).default("percentage"),hotelProfitValue:F.au.number().min(0).default(100),groupProfitType:F.k5(["fixed","percentage"]).default("percentage"),groupProfitValue:F.au.number().min(0).default(100)}),Q=F.Ik({id:F.Yj(),partnerId:F.Yj().min(1,"اختر شريكاً."),partnerName:F.Yj(),partnerInvoiceNumber:F.Yj(),percentage:F.au.number().min(0,"النسبة يجب أن تكون موجبة.").max(100,"النسبة لا تتجاوز 100."),amount:F.au.number()}),R=F.Ik({periodInvoiceNumber:F.Yj().optional(),fromDate:F.p6({required_error:"تاريخ البدء مطلوب."}).nullable(),toDate:F.p6({required_error:"تاريخ الانتهاء مطلوب."}).nullable(),entryDate:F.p6({required_error:"تاريخ الإضافة مطلوب."}),currency:F.Yj().min(1,"اختر العملة."),hasPartner:F.zM().default(!1),alrawdatainSharePercentage:F.au.number().min(0).max(100).default(100),partners:F.YO(Q).optional(),summaryEntries:F.YO(F.bz()).min(1,"يجب إضافة شركة واحدة على الأقل.")});function S(a,b,c){return a&&c?"fixed"===b?a*c:c/100*a:0}function T(a,b){return[S(a.tickets,a.ticketProfitType||"percentage",a.ticketProfitValue||50),S(a.visas,a.visaProfitType||"percentage",a.visaProfitValue||100),S(a.hotels,a.hotelProfitType||"percentage",a.hotelProfitValue||100),S(a.groups,a.groupProfitType||"percentage",a.groupProfitValue||100)].reduce((a,b)=>a+b,0)}let U=({label:a,icon:b,color:c,countField:f,typeField:g,valueField:h})=>{let{control:i,watch:m}=(0,E.xW)(),o=m(f),p=m(g),r=m(h),s=(0,e.useMemo)(()=>S(o,p,r),[o,p,r]),t=(0,E.xW)().watch("currency");return(0,d.jsxs)(j.Zp,{className:"shadow-sm overflow-hidden",style:{borderColor:`hsl(var(--${c}))`},children:[(0,d.jsxs)(j.aR,{className:"p-2 flex flex-row items-center justify-between space-y-0 text-white",style:{backgroundColor:`hsl(var(--${c}))`},children:[(0,d.jsxs)(j.ZB,{className:"text-xs font-bold flex items-center gap-1.5",children:[(0,d.jsx)(b,{className:"h-4 w-4"}),a]}),(0,d.jsx)("div",{className:"text-xs font-bold font-mono px-1.5 py-0.5 bg-background/20 rounded-md",children:s.toFixed(2)})]}),(0,d.jsxs)(j.Wu,{className:"p-2 pt-1 space-y-1",children:[(0,d.jsx)(E.xI,{control:i,name:f,render:({field:a})=>(0,d.jsxs)("div",{children:[(0,d.jsx)(k.J,{className:"sr-only",children:"العدد"}),(0,d.jsx)(q.O,{...a,onValueChange:b=>a.onChange(b||0),placeholder:"العدد",className:"h-8 text-center font-semibold text-sm"})]})}),(0,d.jsxs)("div",{className:"flex gap-1",children:[(0,d.jsx)(E.xI,{control:i,name:g,render:({field:a})=>(0,d.jsx)(K.eI,{children:(0,d.jsxs)(l.l6,{value:a.value,onValueChange:a.onChange,children:[(0,d.jsx)(l.bq,{className:"h-7 w-16 text-xs",children:(0,d.jsx)(l.yv,{})}),(0,d.jsxs)(l.gC,{children:[(0,d.jsx)(l.eb,{value:"percentage",children:"%"}),(0,d.jsx)(l.eb,{value:"fixed",children:"$"})]})]})})}),(0,d.jsx)(E.xI,{control:i,name:h,render:({field:a})=>(0,d.jsx)(q.O,{currency:t,currencyClassName:(0,n.cn)("USD"===t?"bg-accent text-accent-foreground":"bg-primary text-primary-foreground"),...a,onValueChange:b=>a.onChange(b||0),placeholder:"القيمة",className:"h-7 text-xs"})})]})]})]})},V=(0,e.forwardRef)(({onAdd:a,allCompanyOptions:b,partnerOptions:c,editingEntry:i,onCancelEdit:l},m)=>{let{getValues:n}=(0,E.xW)(),[o,p]=(0,e.useState)("(تلقائي)"),q=(0,E.mN)({resolver:(0,G.u)(P)}),{reset:s,control:z,handleSubmit:A,watch:B,setValue:C}=q,D=(0,e.useCallback)(async()=>{p(await O("COMP"))},[]);f().useEffect(()=>{let a={id:(0,g.A)(),clientId:"",clientName:"",tickets:0,visas:0,hotels:0,groups:0,notes:"",ticketProfitType:"percentage",ticketProfitValue:50,visaProfitType:"percentage",visaProfitValue:100,hotelProfitType:"percentage",hotelProfitValue:100,groupProfitType:"percentage",groupProfitValue:100},c=i?.clientId?b.find(a=>a.value===i.clientId)?.settings:{};s({...a,...c,...i||{}}),i?p(i.companyInvoiceNumber):D()},[i,s,b,D]),(0,e.useImperativeHandle)(m,()=>({resetForm:()=>{s({id:(0,g.A)(),clientId:"",clientName:"",tickets:0,visas:0,hotels:0,groups:0,notes:""}),D()}}),[s,D]);let F=B(),H=B("clientId");(0,e.useEffect)(()=>{let a=b.find(a=>a.value===H);a&&(C("clientName",a.label),a.settings&&Object.entries(a.settings).forEach(([a,b])=>{C(a,b)}))},[H,b,C]);let I=(0,e.useMemo)(()=>T(F,b.find(a=>a.value===F.clientId)?.settings),[F,b]),J=async c=>{let{hasPartner:d,alrawdatainSharePercentage:e,partners:f}=n(),h=T(c,b.find(a=>a.value===c.clientId)?.settings),i=d?h*(100-(e||0))/100:0,j=await Promise.all((f||[]).map(async a=>{let b=await O("PARTNER");return{partnerId:a.partnerId,partnerName:a.partnerName,partnerInvoiceNumber:b,share:i*(a.percentage/100)}}));a({...c,companyInvoiceNumber:o,total:h,alrawdatainShare:h-i,partnerShare:i,partnerShares:j}),s({id:(0,g.A)(),clientId:"",clientName:"",tickets:0,visas:0,hotels:0,groups:0,notes:""}),D(),l()};return(0,d.jsx)(E.Op,{...q,children:(0,d.jsx)("div",{className:"space-y-3",children:(0,d.jsxs)(j.Zp,{className:"border rounded-lg shadow-sm border-primary/40",children:[(0,d.jsxs)(j.aR,{className:"p-2 flex flex-row items-center justify-between bg-muted/30",children:[(0,d.jsx)(j.ZB,{className:"text-base font-semibold",children:i?`تعديل - فاتورة: ${o}`:`إدخال شركة - فاتورة: ${o}`}),(0,d.jsxs)("div",{className:"font-mono text-sm text-blue-600 font-bold",children:["ربح الشركة: ",I.toFixed(2)]})]}),(0,d.jsxs)(j.Wu,{className:"space-y-3 p-3",children:[(0,d.jsx)(E.xI,{control:z,name:"clientId",render:({field:a,fieldState:c})=>(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsx)(k.J,{children:"الشركة المصدرة للسكمنت"}),(0,d.jsx)(r.j,{options:b,value:a.value,onValueChange:a.onChange,placeholder:"ابحث/اختر..."}),(0,d.jsx)("p",{className:"text-xs text-destructive h-3",children:c.error?.message})]})}),(0,d.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[(0,d.jsx)(U,{label:"تذاكر",icon:t.A,color:"primary",countField:"tickets",typeField:"ticketProfitType",valueField:"ticketProfitValue"}),(0,d.jsx)(U,{label:"فيزا",icon:u.A,color:"accent",countField:"visas",typeField:"visaProfitType",valueField:"visaProfitValue"}),(0,d.jsx)(U,{label:"فنادق",icon:v,color:"primary",countField:"hotels",typeField:"hotelProfitType",valueField:"hotelProfitValue"}),(0,d.jsx)(U,{label:"كروبات",icon:w.A,color:"accent",countField:"groups",typeField:"groupProfitType",valueField:"groupProfitValue"})]}),(0,d.jsx)("div",{className:"flex justify-center pt-2",children:(0,d.jsxs)(h.$,{type:"button",onClick:A(J),className:"w-full md:w-1/2",children:[i?(0,d.jsx)(x.A,{className:"me-2 h-4 w-4"}):(0,d.jsx)(y.A,{className:"me-2 h-4 w-4"}),i?"تحديث الشركة":"إضافة إلى الفترة"]})})]})]})})})});V.displayName="AddCompanyToSegmentForm";let W=({onRemove:a,onEdit:b})=>{let{watch:c}=(0,E.xW)(),e=c("summaryEntries"),{user:f}=(0,J.A)();return e&&0!==e.length?(0,d.jsxs)(j.Zp,{className:"border border-muted shadow-sm",children:[(0,d.jsx)(j.aR,{className:"p-3 flex items-center justify-between bg-muted/20 rounded-t-md",children:(0,d.jsxs)(j.ZB,{className:"text-base font-semibold",children:["الشركات المضافة (",e.length,")"]})}),(0,d.jsx)(j.Wu,{className:"p-0",children:(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)(I.XI,{children:[(0,d.jsx)(I.A0,{className:"bg-muted/40",children:(0,d.jsxs)(I.Hj,{children:[(0,d.jsx)(I.nd,{className:"text-center",children:"رقم فاتورة الشركة"}),(0,d.jsx)(I.nd,{children:"الشركة المصدرة للسكمنت"}),(0,d.jsx)(I.nd,{children:"الشركاء (مع أرقام فواتيرهم)"}),(0,d.jsx)(I.nd,{className:"text-center",children:"إجمالي المبلغ"}),(0,d.jsx)(I.nd,{className:"text-center",children:"حصة الروضتين"}),(0,d.jsx)(I.nd,{className:"text-center",children:"حصة الشركاء"}),(0,d.jsx)(I.nd,{className:"text-center",children:"موظف الإدخال"}),(0,d.jsx)(I.nd,{className:"text-center w-[110px]",children:"الإجراءات"})]})}),(0,d.jsx)(I.BF,{children:e.map((c,e)=>(0,d.jsxs)(I.Hj,{children:[(0,d.jsx)(I.nA,{className:"text-center font-mono",children:c.companyInvoiceNumber||"(تلقائي)"}),(0,d.jsx)(I.nA,{className:"font-semibold text-sm",children:c.clientName||"غير محدد"}),(0,d.jsx)(I.nA,{className:"text-xs text-muted-foreground",children:c.partnerShares&&c.partnerShares.length>0?c.partnerShares.map(a=>`${a.partnerName} (${a.partnerInvoiceNumber})`).join("، "):"لا يوجد شركاء"}),(0,d.jsx)(I.nA,{className:"text-center font-mono",children:Number(c.total||0).toFixed(2)}),(0,d.jsx)(I.nA,{className:"text-center font-mono text-green-600",children:Number(c.alrawdatainShare||0).toFixed(2)}),(0,d.jsx)(I.nA,{className:"text-center font-mono text-blue-600",children:Number(c.partnerShare||0).toFixed(2)}),(0,d.jsx)(I.nA,{className:"text-center text-sm",children:f?.name||"غير محدد"}),(0,d.jsxs)(I.nA,{className:"text-center space-x-1 rtl:space-x-reverse",children:[(0,d.jsx)(h.$,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-blue-600",title:"تعديل",onClick:()=>b(e),children:(0,d.jsx)(x.A,{className:"h-4 w-4"})}),(0,d.jsx)(h.$,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",title:"حذف",onClick:()=>a(e),children:(0,d.jsx)(z.A,{className:"h-4 w-4"})})]})]},c.id))})]})})})]}):(0,d.jsx)("div",{className:"text-center text-muted-foreground py-8 border-2 border-dashed rounded-lg",children:"لم يتم إضافة أي شركات إلى الفترة حتى الآن."})},X=({title:a,value:b,currency:c,className:e})=>(0,d.jsxs)("div",{className:(0,n.cn)("p-2 rounded-lg text-center border",e),children:[(0,d.jsx)("p",{className:"text-xs font-semibold text-muted-foreground",children:a}),(0,d.jsxs)("p",{className:"font-mono font-bold text-lg",children:[b.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," ",c]})]});function Y({clients:a,suppliers:b,onSuccess:c,isEditing:j=!1,existingPeriod:t,children:u}){let{toast:v}=(0,o.dj)(),[w,y]=(0,e.useState)(!1),[F,N]=(0,e.useState)(!1),P=f().useRef(null),[Q,S]=(0,e.useState)(null),{data:T,fetchData:U}=(0,p.Z)(),{user:Y}=(0,J.A)(),[Z,$]=(0,e.useState)(""),[_,aa]=(0,e.useState)(""),[ab,ac]=(0,e.useState)(null),ad=(0,E.mN)({resolver:(0,G.u)(R)}),{control:ae,handleSubmit:af,watch:ag,setValue:ah,formState:{errors:ai},trigger:aj,reset:ak,getValues:al}=ad,{fields:am,append:an,remove:ao,update:ap}=(0,E.jz)({control:ad.control,name:"summaryEntries"}),{fields:aq,append:ar,remove:as,update:at}=(0,E.jz)({control:ad.control,name:"partners"}),au=ag(),av=(0,e.useMemo)(()=>a.filter(a=>"company"===a.type).map(a=>({value:a.id,label:a.name,settings:a.segmentSettings})),[a]),aw=(0,e.useMemo)(()=>Array.from(new Map([...a,...b].map(a=>[a.id,a])).values()).map(a=>{let b="";return"client"===a.relationType?b="عميل: ":"supplier"===a.relationType?b="مورد: ":"both"===a.relationType&&(b="عميل ومورد: "),{value:a.id,label:`${b}${a.name}`}}),[a,b]),ax=(0,e.useMemo)(()=>T?.settings?.currencySettings?.currencies||[],[T]);(0,e.useMemo)(()=>Y&&"boxId"in Y&&Y.boxId&&T?.boxes?.find(a=>a.id===Y.boxId)?.name||"غير محدد",[Y,T?.boxes]);let{activeStep:ay,goToNextStep:az,goToPreviousStep:aA,resetSteps:aB,isDisabledStep:aC,isLastStep:aD}=(0,L.lE)({initialStep:0,steps:[{label:"الفترة"},{label:"الشركات"},{label:"التوزيع"},{label:"حفظ"}]}),aE=(0,e.useMemo)(()=>(am||[]).reduce((a,b)=>a+(b.total||0),0),[am]),{totalPartnerPercentage:aF,alrawdatainSharePercentage:aG,alrawdatainShareAmount:aH,amountForPartners:aI,distributedToPartners:aJ,remainderForPartners:aK}=(0,e.useMemo)(()=>{let a=au.hasPartner?Number(au.alrawdatainSharePercentage)||0:100,b=(au.partners||[]).reduce((a,b)=>a+(Number(b.percentage)||0),0),c=a/100*aE,d=aE-c,e=(au.partners||[]).reduce((a,b)=>a+d*((b.percentage||0)/100),0);return{totalPartnerPercentage:b,alrawdatainSharePercentage:a,alrawdatainShareAmount:c,amountForPartners:d,distributedToPartners:e,remainderForPartners:d-e}},[aE,au.hasPartner,au.alrawdatainSharePercentage,au.partners]),aL=(0,e.useMemo)(()=>(Number(_)||0)/100*aI,[_,aI]),aM=async a=>{if(0===am.length)return void v({title:"لا توجد سجلات للحفظ",variant:"destructive"});if(a.hasPartner&&Math.abs(aF-100)>.01)return void v({title:"خطأ في توزيع حصص الشركاء",description:`مجموع نسب الشركاء يجب أن يكون 100% تمامًا من المبلغ المتاح لهم. المجموع الحالي: ${aF.toFixed(2)}%`,variant:"destructive"});N(!0);try{let b=am.map(b=>({...b,entryDate:(0,D.GP)(a.entryDate,"yyyy-MM-dd"),fromDate:(0,D.GP)(a.fromDate,"yyyy-MM-dd"),toDate:(0,D.GP)(a.toDate,"yyyy-MM-dd"),currency:a.currency,hasPartner:a.hasPartner,alrawdatainSharePercentage:a.alrawdatainSharePercentage,partnerShares:(a.partners||[]).map(a=>({partnerId:a.partnerId,partnerName:a.partnerName,partnerInvoiceNumber:a.partnerInvoiceNumber,share:b.partnerShare*(a.percentage/100)}))})),d=await (0,s.v)(b,j?t?.periodId:void 0);if(!d.success)throw Error(d.error);v({title:"تم حفظ بيانات الفترة بنجاح"}),y(!1),await c()}catch(a){v({title:"خطأ",description:a.message||"لم يتم حفظ البيانات.",variant:"destructive"})}finally{N(!1)}},aN=async()=>{if(!Z||!_)return void v({title:"الرجاء تحديد الشريك والنسبة",variant:"destructive"});let a=Number(_);if(isNaN(a)||a<=0)return void v({title:"النسبة يجب أن تكون رقمًا موجبًا",variant:"destructive"});let b=al("partners")||[],c=null!==ab&&b[ab]?.percentage||0,d=b.reduce((a,b)=>a+b.percentage,0)-c;if(d+a>100.01)return void v({title:"لا يمكن تجاوز 100%",description:`إجمالي النسب الحالية: ${d.toFixed(2)}%`,variant:"destructive"});let e=aw.find(a=>a.value===Z);if(!e)return void v({title:"الشريك المختار غير صالح",variant:"destructive"});let f=null!==ab?aq[ab].partnerInvoiceNumber:await O("PARTNER"),g={id:null!==ab?aq[ab].id:`new-${Date.now()}`,partnerId:e.value.split("-")[1]||e.value,partnerName:e.label,partnerInvoiceNumber:f,percentage:a,amount:aI*a/100};null!==ab?(at(ab,g),ac(null)):ar(g),$(""),aa("")},aO=au.hasPartner&&Math.abs(aF-100)>.01;return(0,d.jsxs)(i.lG,{open:w,onOpenChange:y,children:[(0,d.jsx)(i.zM,{asChild:!0,children:u}),(0,d.jsxs)(i.Cf,{className:"sm:max-w-7xl max-h-[90vh] flex flex-col",children:[(0,d.jsx)(i.c7,{children:(0,d.jsx)(i.L3,{children:j?"تعديل سجل سكمنت":"إضافة سجل سكمنت جديد"})}),(0,d.jsx)(E.Op,{...ad,children:(0,d.jsxs)("form",{onSubmit:af(aM),className:"flex flex-col flex-grow overflow-hidden",children:[(0,d.jsxs)("div",{className:"flex-grow overflow-y-auto -mx-6 px-6 space-y-6 pb-4",children:[(0,d.jsxs)(M.Nt,{defaultOpen:!0,className:"p-4 border rounded-lg space-y-6 bg-background/50",children:[(0,d.jsx)(M.R6,{asChild:!0,children:(0,d.jsxs)("h3",{className:"font-semibold text-base cursor-pointer",children:["الفترة وتوزيع الحصص - فاتورة عامة: ",au.periodInvoiceNumber]})}),(0,d.jsxs)(M.Ke,{className:"space-y-6",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,d.jsx)(K.zB,{control:ad.control,name:"fromDate",render:({field:a})=>(0,d.jsxs)(K.eI,{children:[(0,d.jsx)(K.lR,{children:"من تاريخ"}),(0,d.jsx)(H.K,{date:a.value,setDate:a.onChange})]})}),(0,d.jsx)(K.zB,{control:ad.control,name:"toDate",render:({field:a})=>(0,d.jsxs)(K.eI,{children:[(0,d.jsx)(K.lR,{children:"إلى تاريخ"}),(0,d.jsx)(H.K,{date:a.value,setDate:a.onChange})]})}),(0,d.jsx)(K.zB,{control:ad.control,name:"entryDate",render:({field:a})=>(0,d.jsxs)(K.eI,{children:[(0,d.jsx)(K.lR,{children:"تاريخ الإضافة"}),(0,d.jsx)(H.K,{date:a.value,setDate:a.onChange})]})}),(0,d.jsx)(K.zB,{control:ad.control,name:"currency",render:({field:a})=>(0,d.jsxs)(K.eI,{children:[(0,d.jsx)(K.lR,{children:"العملة"}),(0,d.jsxs)(l.l6,{onValueChange:a.onChange,value:a.value,children:[(0,d.jsx)(K.MJ,{children:(0,d.jsx)(l.bq,{children:(0,d.jsx)(l.yv,{})})}),(0,d.jsx)(l.gC,{children:ax.map(a=>(0,d.jsx)(l.eb,{value:a.code,children:a.name},a.code))})]})]})})]}),(0,d.jsx)("div",{className:"pt-4 border-t mt-4",children:(0,d.jsxs)("div",{className:"space-y-5",children:[(0,d.jsx)("div",{className:"flex items-center justify-between border-b pb-2",children:(0,d.jsx)(K.zB,{control:ad.control,name:"hasPartner",render:({field:a})=>(0,d.jsxs)(K.eI,{className:"flex items-center gap-3",children:[(0,d.jsx)(K.lR,{className:"font-semibold text-base",children:"هل يوجد شركاء في الربح؟"}),(0,d.jsx)(K.MJ,{children:(0,d.jsx)(m.d,{checked:a.value,onCheckedChange:a.onChange})})]})})}),au.hasPartner&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[(0,d.jsx)(X,{title:"حصة الروضتين",value:aG,currency:"%",className:"bg-green-50 text-green-700 border-green-200"}),(0,d.jsx)(X,{title:"المتاح للشركاء",value:100-aG,currency:"%",className:"bg-blue-50 text-blue-700 border-blue-200"}),(0,d.jsx)(X,{title:"الموزع للشركاء",value:aF,currency:"%",className:"bg-amber-50 text-amber-700 border-amber-200"}),(0,d.jsx)(X,{title:"المتبقي للتوزيع",value:100-aF,currency:"%",className:(0,n.cn)("border",Math.abs(100-aF)>.01?"bg-red-50 text-red-700 border-red-300":"bg-gray-50 text-gray-600 border-gray-200")})]}),(0,d.jsxs)("div",{className:"p-3 border rounded-lg bg-muted/10 space-y-3",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-3 items-end",children:[(0,d.jsxs)("div",{className:"space-y-1.5",children:[(0,d.jsx)(k.J,{children:"نسبة الروضتين (%)"}),(0,d.jsx)(E.xI,{control:ad.control,name:"alrawdatainSharePercentage",render:({field:a})=>(0,d.jsx)(q.O,{...a,onValueChange:b=>a.onChange(b||0),className:"h-9 text-center"})})]}),(0,d.jsxs)("div",{className:"space-y-1.5",children:[(0,d.jsx)(k.J,{children:"الشريك"}),(0,d.jsx)(r.j,{options:aw,value:Z,onValueChange:$,placeholder:"اختر الشريك..."})]}),(0,d.jsxs)("div",{className:"space-y-1.5",children:[(0,d.jsx)(k.J,{children:"النسبة (%)"}),(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)(q.O,{value:_,onValueChange:aa,className:"h-9 pe-7 text-center"}),(0,d.jsx)(A.A,{className:"absolute left-2 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"})]})]}),(0,d.jsx)(h.$,{type:"button",onClick:aN,className:"h-9 w-full md:w-auto",children:null!==ab?"تحديث":"إضافة"})]}),(0,d.jsxs)("p",{className:"text-xs text-muted-foreground text-end",children:["الحصة المحسوبة: ",(0,d.jsx)("span",{className:"font-bold text-blue-600 font-mono ms-1",children:aL.toFixed(2)})]})]}),(0,d.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,d.jsxs)(I.XI,{children:[(0,d.jsx)(I.A0,{className:"bg-muted/30",children:(0,d.jsxs)(I.Hj,{children:[(0,d.jsx)(I.nd,{children:"فاتورة الشريك"}),(0,d.jsx)(I.nd,{children:"الشريك"}),(0,d.jsx)(I.nd,{className:"text-center",children:"النسبة"}),(0,d.jsx)(I.nd,{className:"w-24 text-center",children:"الإجراءات"})]})}),(0,d.jsx)(I.BF,{children:0===aq.length?(0,d.jsx)(I.Hj,{children:(0,d.jsx)(I.nA,{colSpan:4,className:"text-center text-muted-foreground py-4",children:"لا يوجد شركاء مضافون بعد"})}):aq.map((a,b)=>(0,d.jsxs)(I.Hj,{children:[(0,d.jsx)(I.nA,{className:"font-mono",children:a.partnerInvoiceNumber}),(0,d.jsx)(I.nA,{children:a.partnerName}),(0,d.jsxs)(I.nA,{className:"text-center font-mono",children:[Number(a.percentage).toFixed(2),"%"]}),(0,d.jsxs)(I.nA,{className:"text-center",children:[(0,d.jsx)(h.$,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-blue-600",onClick:()=>(a=>{let b=aq[a];ac(a),$(aw.find(a=>a.value.endsWith(b.partnerId))?.value||""),aa(b.percentage)})(b),children:(0,d.jsx)(x.A,{className:"h-4 w-4"})}),(0,d.jsx)(h.$,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",onClick:()=>as(b),children:(0,d.jsx)(z.A,{className:"h-4 w-4"})})]})]},a.id))})]})})]})]})})]})]}),(0,d.jsx)("div",{className:(0,n.cn)(aO&&"opacity-50 pointer-events-none"),children:(0,d.jsx)(V,{ref:P,onAdd:a=>{if(Q){let b=am.findIndex(a=>a.id===Q.id);b>-1&&ap(b,{...am[b],...a,id:am[b].id}),S(null)}else an({...a,id:(0,g.A)(),createdBy:Y?.name});P.current?.resetForm()},editingEntry:Q,onCancelEdit:()=>S(null),allCompanyOptions:av,partnerOptions:aw})}),(0,d.jsx)("div",{className:(0,n.cn)(aO&&"opacity-50 pointer-events-none"),children:(0,d.jsx)(W,{onRemove:a=>ao(a),onEdit:a=>S(am[a])})})]}),(0,d.jsxs)(i.Es,{className:"pt-4 border-t flex-row items-center justify-between sticky bottom-0 bg-background mt-auto",children:[(0,d.jsxs)("div",{className:"flex flex-wrap gap-x-4 gap-y-2 text-xs text-muted-foreground",children:[(0,d.jsx)(X,{title:"إجمالي الربح",value:aE,currency:au.currency}),(0,d.jsx)(X,{title:"حصة الروضتين",value:aH,currency:au.currency,className:"text-green-600"}),(0,d.jsx)(X,{title:"حصة الشركاء",value:aI,currency:au.currency,className:"text-blue-600"}),(0,d.jsx)(X,{title:"المتبقي",value:aK,currency:au.currency,className:(0,n.cn)(Math.abs(aK)>.01&&"text-destructive")})]}),(0,d.jsx)("div",{className:"flex items-center gap-2",children:(0,d.jsxs)(h.$,{type:"submit",disabled:F||0===am.length,children:[F&&(0,d.jsx)(B.A,{className:"me-2 h-4 w-4 animate-spin"}),(0,d.jsx)(C.A,{className:"me-2 h-4 w-4"}),"حفظ بيانات الفترة (",am.length," سجلات)"]})})]})]})})]})]})}},27894:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(8808).A)("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]])},44043:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(8808).A)("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]])},70066:(a,b,c)=>{c.d(b,{v:()=>e});var d=c(85708);let e=(0,d.createServerReference)("60e78d426fd8219914cf72d1a693001c780eb7a14f",d.callServer,void 0,d.findSourceMapURL,"addSegmentEntries")},78965:(a,b,c)=>{c.d(b,{O:()=>e});var d=c(85708);let e=(0,d.createServerReference)("607e850594ea411b5e11f09fc4d3f42888c31e8a99",d.callServer,void 0,d.findSourceMapURL,"deleteSegmentPeriod")},80623:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(8808).A)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]])}};