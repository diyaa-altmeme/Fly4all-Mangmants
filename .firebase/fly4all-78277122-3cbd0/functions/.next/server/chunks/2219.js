exports.id=2219,exports.ids=[2219],exports.modules={5538:(a,b,c)=>{"use strict";c.d(b,{default:()=>k});var d=c(21124),e=c(38301),f=c(42378),g=c(64772),h=c(99599),i=c(63009),j=c(22708);function k({children:a,requiredPermission:b}){let{user:c,loading:k,hasPermission:l}=(0,i.A)();(0,f.useRouter)();let[m,n]=(0,e.useState)(!1);return k||!m?k||m||!c?(0,d.jsx)(j.A,{}):(0,d.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,d.jsxs)(g.Fc,{variant:"destructive",className:"max-w-md",children:[(0,d.jsx)(h.A,{className:"h-4 w-4"}),(0,d.jsx)(g.XL,{children:"وصول مرفوض!"}),(0,d.jsx)(g.TN,{children:"ليس لديك الصلاحية المطلوبة للوصول إلى هذه الصفحة. يرجى التواصل مع مدير النظام."})]})}):(0,d.jsx)(d.Fragment,{children:a})}},10655:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>d});let d=(0,c(97954).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/user/studio/src/app/segments/layout.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/user/studio/src/app/segments/layout.tsx","default")},15003:(a,b,c)=>{"use strict";c.d(b,{A:()=>j});var d=c(55511),e=c.n(d);let f={randomUUID:e().randomUUID},g=new Uint8Array(256),h=g.length,i=[];for(let a=0;a<256;++a)i.push((a+256).toString(16).slice(1));let j=function(a,b,c){if(f.randomUUID&&!b&&!a)return f.randomUUID();let d=(a=a||{}).random||(a.rng||function(){return h>g.length-16&&(e().randomFillSync(g),h=0),g.slice(h,h+=16)})();if(d[6]=15&d[6]|64,d[8]=63&d[8]|128,b){c=c||0;for(let a=0;a<16;++a)b[c+a]=d[a];return b}return function(a,b=0){return i[a[b+0]]+i[a[b+1]]+i[a[b+2]]+i[a[b+3]]+"-"+i[a[b+4]]+i[a[b+5]]+"-"+i[a[b+6]]+i[a[b+7]]+"-"+i[a[b+8]]+i[a[b+9]]+"-"+i[a[b+10]]+i[a[b+11]]+i[a[b+12]]+i[a[b+13]]+i[a[b+14]]+i[a[b+15]]}(d)}},16293:(a,b,c)=>{Promise.resolve().then(c.bind(c,39129))},37874:(a,b,c)=>{"use strict";c.d(b,{A:()=>d});let d=(0,c(8808).A)("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]])},39129:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>f});var d=c(21124);c(38301),c(35284),c(62186),c(37448),c(97802),c(79202),c(67094),c(12439),c(27081),c(11563),c(91703),c(4174);var e=c(5538);function f({children:a}){return(0,d.jsx)(e.default,{requiredPermission:"segments:read",children:a})}c(3991)},67094:(a,b,c)=>{"use strict";c.d(b,{Ke:()=>g,Nt:()=>e,R6:()=>f});var d=c(59147);let e=d.bL,f=d.R6,g=d.Ke},79202:(a,b,c)=>{"use strict";c.d(b,{A0:()=>h,BF:()=>i,Gg:()=>j,Hj:()=>k,XI:()=>g,nA:()=>m,nd:()=>l});var d=c(21124),e=c(38301),f=c(44943);let g=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{className:"relative w-full overflow-auto",children:(0,d.jsx)("table",{ref:c,className:(0,f.cn)("w-full caption-bottom text-sm",a),...b})}));g.displayName="Table";let h=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("thead",{ref:c,className:(0,f.cn)("[&_tr]:border-b",a),...b}));h.displayName="TableHeader";let i=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("tbody",{ref:c,className:(0,f.cn)("[&_tr:last-child]:border-0",a),...b}));i.displayName="TableBody";let j=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("tfoot",{ref:c,className:(0,f.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...b}));j.displayName="TableFooter";let k=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("tr",{ref:c,className:(0,f.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...b}));k.displayName="TableRow";let l=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("th",{ref:c,className:(0,f.cn)("h-12 px-4 text-right align-middle font-bold text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...b}));l.displayName="TableHead";let m=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("td",{ref:c,className:(0,f.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...b}));m.displayName="TableCell",e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("caption",{ref:c,className:(0,f.cn)("mt-4 text-sm text-muted-foreground",a),...b})).displayName="TableCaption"},79845:(a,b,c)=>{Promise.resolve().then(c.bind(c,10655))},91703:(a,b,c)=>{"use strict";c.d(b,{A:()=>l});var d=c(21124);c(38301);var e=c(79202),f=c(35284),g=c(19335),h=c(99187),i=c(77837);let j=(a,b)=>null==a||isNaN(a)?"$0.00":`${a.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})} ${b||"USD"}`,k=({entry:a})=>(0,d.jsxs)(i.AM,{children:[(0,d.jsx)(i.Wv,{asChild:!0,children:(0,d.jsx)(f.$,{variant:"ghost",size:"icon",className:"h-7 w-7",children:(0,d.jsx)(g.A,{className:"h-4 w-4"})})}),(0,d.jsx)(i.hl,{children:(0,d.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,d.jsx)("h4",{className:"font-bold",children:"تفاصيل الحسبة"}),(0,d.jsxs)("p",{children:["التذاكر: ",a.tickets," * ","percentage"===a.ticketProfitType?`${a.ticketProfitValue}%`:j(a.ticketProfitValue,a.currency)," = ",j(a.ticketProfits,a.currency)]}),(0,d.jsxs)("p",{children:["الفيزا: ",a.visas," * ","percentage"===a.visaProfitType?`${a.visaProfitValue}%`:j(a.visaProfitValue,a.currency)," = ",j(a.visas*("percentage"===a.visaProfitType?a.visaProfitValue/100:a.visaProfitValue),a.currency)]}),(0,d.jsxs)("p",{children:["الفنادق: ",a.hotels," * ","percentage"===a.hotelProfitType?`${a.hotelProfitValue}%`:j(a.hotelProfitValue,a.currency)," = ",j(a.hotels*("percentage"===a.hotelProfitType?a.hotelProfitValue/100:a.hotelProfitValue),a.currency)]}),(0,d.jsxs)("p",{children:["الكروبات: ",a.groups," * ","percentage"===a.groupProfitType?`${a.groupProfitValue}%`:j(a.groupProfitValue,a.currency)," = ",j(a.groups*("percentage"===a.groupProfitType?a.groupProfitValue/100:a.groupProfitValue),a.currency)]}),(0,d.jsxs)("p",{className:"border-t pt-2 mt-2 font-bold",children:["حصة الروضتين: ",j(a.total,a.currency)," * ",a.alrawdatainSharePercentage,"% = ",j(a.alrawdatainShare,a.currency)]})]})})]});function l({period:a}){let b=a.entries.filter((a,b,c)=>b===c.findIndex(b=>b.id===a.id));return(0,d.jsxs)(e.XI,{children:[(0,d.jsx)(e.A0,{children:(0,d.jsxs)(e.Hj,{children:[(0,d.jsx)(e.nd,{className:"p-2",children:"رقم الفاتورة"}),(0,d.jsx)(e.nd,{className:"p-2",children:"الشركة"}),(0,d.jsx)(e.nd,{className:"p-2",children:"الشركاء"}),(0,d.jsx)(e.nd,{className:"text-center p-2",children:"أرباح التذاكر"}),(0,d.jsx)(e.nd,{className:"text-center p-2",children:"أرباح أخرى"}),(0,d.jsx)(e.nd,{className:"text-center p-2",children:"حصة الروضتين"}),(0,d.jsx)(e.nd,{className:"text-center p-2",children:"حصص الشركاء"}),(0,d.jsx)(e.nd,{className:"text-center p-2",children:"الحسبة"})]})}),(0,d.jsx)(e.BF,{children:b.map(a=>(0,d.jsxs)(e.Hj,{children:[(0,d.jsx)(e.nA,{className:"font-mono text-xs p-2",children:a.invoiceNumber}),(0,d.jsx)(e.nA,{className:"font-semibold p-2",children:a.companyName}),(0,d.jsx)(e.nA,{className:"p-2",children:(0,d.jsx)("div",{className:"flex flex-col gap-1",children:(a.partnerShares||[]).map((b,c)=>(0,d.jsxs)(h.E,{variant:"secondary",className:"justify-between text-xs",children:[(0,d.jsx)("span",{children:b.partnerName}),(0,d.jsx)("span",{className:"font-mono",children:j(b.share,a.currency)})]},c))})}),(0,d.jsx)(e.nA,{className:"font-mono text-center p-2",children:j(a.ticketProfits,a.currency)}),(0,d.jsx)(e.nA,{className:"font-mono text-center p-2",children:j(a.otherProfits,a.currency)}),(0,d.jsx)(e.nA,{className:"font-mono text-center text-green-600 p-2",children:j(a.alrawdatainShare,a.currency)}),(0,d.jsx)(e.nA,{className:"font-mono text-center text-blue-600 p-2",children:j(a.partnerShare,a.currency)}),(0,d.jsx)(e.nA,{className:"text-center p-1",children:(0,d.jsx)(k,{entry:a})})]},a.id))})]})}},95378:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{DI:()=>m,EP:()=>q,EZ:()=>o,KB:()=>t,Lf:()=>n,d5:()=>p,zO:()=>r,zZ:()=>s});var e=c(91488);c(27806);var f=c(80446),g=c(91837),h=c(62641),i=c(58749),j=c(29631),k=c(40410),l=a([f,h,i,j]);async function m(a){let{clients:b}=await n({...a,all:!0});return b.map(a=>({value:a.id,label:`${a.name} ${a.code?`(${a.code})`:""}`,relationType:a.relationType,paymentType:a.paymentType}))}async function n(a={}){let{all:b=!1,limit:c=15,page:d=1,searchTerm:e,relationType:g,paymentType:h,status:i,country:j,province:k,sortBy:l="useCount_desc"}=a,m=await (0,f.Lf)();if(!m)return{clients:[],total:0};try{let f,n=m.collection("clients");g&&"all"!==g&&(n=n.where("relationType","in","client"===g?["client","both"]:"supplier"===g?["supplier","both"]:[g])),h&&"all"!==h&&(n=n.where("paymentType","==",h)),i&&"all"!==i&&(n=n.where("status","==",i)),!0===a.includeInactive||i||(n=n.where("status","==","active")),j&&"all"!==j&&(n=n.where("country","==",j)),k&&"all"!==k&&(n=n.where("province","==",k));let o=(await n.get()).docs;if(e){let a=e.toLowerCase();o=o.filter(b=>{let c=b.data();return c.name&&c.name.toLowerCase().includes(a)||c.phone&&String(c.phone).includes(a)||c.code&&c.code.toLowerCase().includes(a)})}let p=o.length;if(l){let[a,b]=l.split("_");o.sort((c,d)=>{let e=c.data(),f=d.data(),g=e[a],h=f[a];if(null==g)return 1;if(null==h)return -1;let i=0;return"string"==typeof g&&"string"==typeof h?i=g.localeCompare(h):g>h?i=1:g<h&&(i=-1),"desc"===b?-1*i:i})}if(b)f=o;else{let a=(d-1)*c;f=o.slice(a,a+c)}if(0===f.length)return{clients:[],total:0};return{clients:f.map(a=>{let b=a.data();return{...JSON.parse(JSON.stringify(b,(a,b)=>b&&"object"==typeof b&&b.hasOwnProperty("seconds")&&b.hasOwnProperty("nanoseconds")?new Date(1e3*b.seconds).toISOString():b)),id:a.id}}),total:p}}catch(a){return console.error("Error getting clients from Firestore: ",String(a)),{clients:[],total:0}}}async function o(a){let b=await (0,f.Lf)();if(!b)return null;try{let c=await b.collection("clients").doc(a).get();if(!c.exists)return null;let d=c.data(),e=JSON.parse(JSON.stringify(d,(a,b)=>b&&"object"==typeof b&&b.hasOwnProperty("seconds")&&b.hasOwnProperty("nanoseconds")?new Date(1e3*b.seconds).toISOString():b));return{id:c.id,...e}}catch(b){return console.error(`Error getting client by ID ${a}:`,String(b)),null}}async function p(a){let b=await (0,f.Lf)();if(!b)return{success:!1,error:"Database not available."};let c=await (0,h.$T)();if(!c)return{success:!1,error:"Unauthorized"};try{let d=c.name,e=await (0,j.tu)("CL"),f={...a,code:e,createdAt:new Date().toISOString(),createdBy:d,balance:{USD:0,IQD:0},lastTransaction:null,useCount:0};f.password&&f.password.length>=6||delete f.password;let h=await b.collection("clients").add(f);await (0,i.iL)({userId:c.uid,userName:c.name,action:"CREATE",targetType:"CLIENT",description:`أنشأ علاقة جديدة باسم: ${f.name} (ID: ${h.id})`}),(0,g.revalidatePath)("/clients"),(0,g.revalidatePath)("/suppliers"),(0,g.revalidatePath)("/reports/debts");let k={...f,id:h.id};return{success:!0,client:k}}catch(a){return console.error("Error adding client:",a),{success:!1,error:a.message}}}async function q(a){let b=await (0,f.Lf)();if(!b)return{success:!1,count:0,error:"Database not available."};let c=await (0,h.$T)();if(!c)return{success:!1,count:0,error:"Unauthorized"};try{for(let d of a){let a=b.batch(),e=b.collection("clients").doc(),f=await (0,j.tu)("CL"),g={...d,code:f,createdAt:new Date().toISOString(),createdBy:`مستورد بواسطة ${c.name}`,type:d.type||"individual",relationType:d.relationType||"client",status:d.status||"active",balance:{USD:0,IQD:0},lastTransaction:null,useCount:0,avatarUrl:""};g.password||delete g.password,a.set(e,g),await a.commit()}return await (0,i.iL)({userId:c.uid,userName:c.name,action:"CREATE",targetType:"CLIENT",description:`استورد ${a.length} علاقات جديدة من ملف.`}),(0,g.revalidatePath)("/clients"),(0,g.revalidatePath)("/suppliers"),(0,g.revalidatePath)("/relations/settings"),(0,g.revalidatePath)("/reports/debts"),{success:!0,count:a.length}}catch(a){return console.error("Error adding multiple clients: ",String(a)),{success:!1,count:0,error:"Failed to add clients."}}}async function r(a,b){let c=await (0,f.Lf)();if(!c)return{success:!1,error:"Database not available."};let d=await (0,h.$T)();if(!d)return{success:!1,error:"Unauthorized"};try{let e=JSON.parse(JSON.stringify(b));(""===b.password||void 0===b.password||null===b.password)&&delete e.password,await c.collection("clients").doc(a).update(e),await (0,i.iL)({userId:d.uid,userName:d.name,action:"UPDATE",targetType:"CLIENT",description:`عدل بيانات العلاقة (ID: ${a})`});let f=await c.collection("clients").doc(a).get(),h=JSON.parse(JSON.stringify(f.data(),(a,b)=>b&&"object"==typeof b&&b.hasOwnProperty("seconds")&&b.hasOwnProperty("nanoseconds")?new Date(1e3*b.seconds).toISOString():b)),j={id:f.id,...h};return(0,g.revalidatePath)("/clients"),(0,g.revalidatePath)("/suppliers"),(0,g.revalidatePath)("/reports/debts"),{success:!0,updatedClient:j}}catch(a){return console.error("Error updating client:",a),{success:!1,error:a.message}}}async function s(a){let b=await (0,f.Lf)();if(!b)return{success:!1,error:"Database not available."};let c=await (0,h.$T)();if(!c)return{success:!1,error:"Unauthorized"};try{let d=(await b.collection("clients").doc(a).get()).data();if(d?.useCount&&d.useCount>0)return{success:!1,error:"لا يمكن حذف هذه العلاقة لوجود معاملات مالية مرتبطة بها."};let e=d?.name||"unknown";return await b.collection("clients").doc(a).delete(),await (0,i.iL)({userId:c.uid,userName:c.name,action:"DELETE",targetType:"CLIENT",description:`حذف العلاقة: ${e} (ID: ${a})`}),(0,g.revalidatePath)("/clients"),(0,g.revalidatePath)("/suppliers"),(0,g.revalidatePath)("/reports/debts"),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function t(a){let b=await (0,f.Lf)();if(!b)return{success:!1,error:"Database not available."};let c=await (0,h.$T)();if(!c)return{success:!1,error:"Unauthorized"};try{let d=b.batch();return a.forEach(a=>{let c=b.collection("clients").doc(a);d.delete(c)}),await d.commit(),await (0,i.iL)({userId:c.uid,userName:c.name,action:"DELETE",targetType:"CLIENT",description:`حذف ${a.length} علاقات بشكل جماعي.`}),(0,g.revalidatePath)("/clients"),(0,g.revalidatePath)("/suppliers"),(0,g.revalidatePath)("/reports/debts"),{success:!0}}catch(a){return{success:!1,error:a.message}}}[f,h,i,j]=l.then?(await l)():l,(0,k.D)([m,n,o,p,q,r,s,t]),(0,e.A)(m,"405872236907704344162aca1c38160d1eac727fe8",null),(0,e.A)(n,"400e621b7f78c4800cffc85d668ca10cd73eb6853c",null),(0,e.A)(o,"408c94c431661ae65070856bc4a78d84f2cbfcba1c",null),(0,e.A)(p,"403331dfc341d9a7f9cbe156b5d10cfd49a20be531",null),(0,e.A)(q,"408c54ad33973364b68d8475849f76b4a4ca590722",null),(0,e.A)(r,"6023146a7bfefc423ba02712c56694a31432de707c",null),(0,e.A)(s,"4085652545b10cc37283ef55992935bd43a8ce947e",null),(0,e.A)(t,"40f4619201eea9704cbf15357e730e9458fc66e834",null),d()}catch(a){d(a)}})}};