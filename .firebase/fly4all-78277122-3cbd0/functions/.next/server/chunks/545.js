"use strict";exports.id=545,exports.ids=[545],exports.modules={15003:(a,b,c)=>{c.d(b,{A:()=>j});var d=c(55511),e=c.n(d);let f={randomUUID:e().randomUUID},g=new Uint8Array(256),h=g.length,i=[];for(let a=0;a<256;++a)i.push((a+256).toString(16).slice(1));let j=function(a,b,c){if(f.randomUUID&&!b&&!a)return f.randomUUID();let d=(a=a||{}).random||(a.rng||function(){return h>g.length-16&&(e().randomFillSync(g),h=0),g.slice(h,h+=16)})();if(d[6]=15&d[6]|64,d[8]=63&d[8]|128,b){c=c||0;for(let a=0;a<16;++a)b[c+a]=d[a];return b}return function(a,b=0){return i[a[b+0]]+i[a[b+1]]+i[a[b+2]]+i[a[b+3]]+"-"+i[a[b+4]]+i[a[b+5]]+"-"+i[a[b+6]]+i[a[b+7]]+"-"+i[a[b+8]]+i[a[b+9]]+"-"+i[a[b+10]]+i[a[b+11]]+i[a[b+12]]+i[a[b+13]]+i[a[b+14]]+i[a[b+15]]}(d)}},44839:(a,b,c)=>{c.d(b,{A:()=>H});var d=c(21124),e=c(38301),f=c.n(e),g=c(35284),h=c(40068),i=c(10656),j=c(49113),k=c(49566),l=c(15003),m=c(37448),n=c(98341),o=c(27810),p=c(40822),q=c(79202),r=c(93758),s=c(45608),t=c(25456),u=c(85708);let v=(0,u.createServerReference)("7003bafa516cae88838b2870c227bb8f7b1ef595ec",u.callServer,void 0,u.findSourceMapURL,"savePayments");var w=c(62186),x=c(68120),y=c(99187),z=c(44943),A=c(97802),B=c(77837),C=c(27410),D=c(63822);let E="lastPaymentExchangeRate",F=(0,e.forwardRef)(({exchangeId:a,exchanges:b,onSuccess:c,isEditing:f=!1,initialData:h=[],batchId:j,onStagedEntriesChange:u,onSummaryChange:F},G)=>{let{data:H}=(0,A.Z)(),{toast:I}=(0,m.dj)(),[J,K]=(0,e.useState)([]),[L,M]=(0,e.useState)(null),[N,O]=(0,e.useState)(a),P=H?.settings?.currencySettings?.defaultCurrency||"USD",Q={paidTo:"",type:"payment",intermediary:"",originalCurrency:P,originalAmount:"",rate:H?.settings?.currencySettings?.exchangeRates.USD_IQD||1,date:new Date().toISOString().slice(0,10),note:""},[R,S]=(0,e.useState)(Q),[T,U]=(0,e.useState)(!1),[V,W]=(0,e.useState)(!1);(0,e.useEffect)(()=>{u(J.length)},[J,u]);let X=(0,e.useMemo)(()=>J.reduce((a,b)=>{let c=b.originalCurrency,d=Number(b.originalAmount)||0,e="payment"===b.type?d:-d,f="USD"===b.originalCurrency?e:e/(Number(b.rate)||1);return a[c]||(a[c]=0),a[c]+=e,a.totalUSD=(a.totalUSD||0)+f,a},{}),[J]);(0,e.useEffect)(()=>{F(X)},[X,F]),(0,e.useEffect)(()=>{let a=localStorage.getItem(E);a&&S(b=>({...b,rate:parseFloat(a)}))},[]),(0,e.useEffect)(()=>{f&&(K(h.map(a=>({id:a.id||(0,l.A)(),paidTo:a.paidTo||"",type:a.type||"payment",intermediary:a.intermediary||"",originalCurrency:a.originalCurrency||P,originalAmount:a.originalAmount||"",rate:a.rate||1,date:a.date||new Date().toISOString().slice(0,10),note:a.note||""}))),O(h[0]?.exchangeId||a))},[f,h,P,a]);let Y=(a,b)=>{S(c=>({...c,[a]:b}))},Z=async()=>{if(!N)return I({title:"اختر بورصة أولاً",variant:"destructive"}),null;if(0===J.length)return null;U(!0);try{let a=J.map(a=>({paidTo:a.paidTo,type:a.type,intermediary:a.intermediary,originalCurrency:a.originalCurrency,originalAmount:Number(a.originalAmount),rate:Number(a.rate)||1,date:a.date,note:a.note})),b=await v(N,a,j);if(!b.success||!b.batch)throw Error(b.error);return I({title:`تم ${f?"تحديث":"حفظ"} التسديدات بنجاح`}),K([]),b.batch}catch(a){return I({title:"خطأ",description:a.message,variant:"destructive"}),null}finally{U(!1)}};(0,e.useImperativeHandle)(G,()=>({handleSave:Z,isSaving:T,summary:X}));let $="USD"===R.originalCurrency?Number(R.originalAmount):Number(R.originalAmount)/(Number(R.rate)||1),_=H?.settings?.currencySettings?.currencies||[];return(0,d.jsxs)("div",{className:"h-full flex flex-col gap-4",children:[(0,d.jsxs)(w.Zp,{children:[(0,d.jsx)(w.aR,{children:(0,d.jsx)(w.ZB,{className:"text-lg",children:L?`تعديل تسديد`:"إضافة تسديد جديد للقائمة"})}),(0,d.jsxs)(w.Wu,{className:"space-y-3",children:[f&&(0,d.jsxs)("div",{className:"space-y-1.5 max-w-sm",children:[(0,d.jsx)(x.J,{children:"تغيير البورصة"}),(0,d.jsxs)(s.l6,{value:N,onValueChange:O,children:[(0,d.jsx)(s.bq,{children:(0,d.jsx)(s.yv,{placeholder:"اختر بورصة..."})}),(0,d.jsx)(s.gC,{children:b.map(a=>(0,d.jsx)(s.eb,{value:a.id,children:a.name},a.id))})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4 items-end",children:[(0,d.jsxs)("div",{className:"md:col-span-2 space-y-1.5",children:[(0,d.jsx)(x.J,{children:"نوع الدفعة"}),(0,d.jsxs)(s.l6,{value:R.type,onValueChange:a=>Y("type",a),children:[(0,d.jsx)(s.bq,{children:(0,d.jsx)(s.yv,{})}),(0,d.jsxs)(s.gC,{children:[(0,d.jsx)(s.eb,{value:"payment",children:"تسديد (لنا)"}),(0,d.jsx)(s.eb,{value:"receipt",children:"قبض (علينا)"})]})]})]}),(0,d.jsxs)("div",{className:"md:col-span-3 space-y-1.5",children:[(0,d.jsx)(x.J,{children:"payment"===R.type?"تم التسديد إلى":"تم القبض من"}),(0,d.jsx)(r.p,{placeholder:"الطرف...",value:R.paidTo,onChange:a=>Y("paidTo",a.target.value)})]}),(0,d.jsxs)("div",{className:"md:col-span-3 space-y-1.5",children:[(0,d.jsx)(x.J,{children:"الوسيط"}),(0,d.jsx)(r.p,{placeholder:"الوسيط",value:R.intermediary,onChange:a=>Y("intermediary",a.target.value)})]}),(0,d.jsxs)("div",{className:"md:col-span-2 space-y-1.5",children:[(0,d.jsx)(x.J,{children:"العملة"}),(0,d.jsxs)(s.l6,{value:R.originalCurrency,onValueChange:a=>Y("originalCurrency",a),children:[(0,d.jsx)(s.bq,{children:(0,d.jsx)(s.yv,{})}),(0,d.jsx)(s.gC,{children:_.map(a=>(0,d.jsx)(s.eb,{value:a.code,children:a.code},a.code))})]})]}),(0,d.jsxs)("div",{className:"md:col-span-2 space-y-1.5",children:[(0,d.jsx)(x.J,{children:"payment"===R.type?"المبلغ المدفوع":"المبلغ المستلم"}),(0,d.jsx)(t.O,{placeholder:"المبلغ",value:R.originalAmount,onValueChange:a=>Y("originalAmount",a||"")})]}),(0,d.jsxs)("div",{className:(0,z.cn)("md:col-span-2 space-y-1.5","USD"===R.originalCurrency&&"invisible"),children:[(0,d.jsx)(x.J,{children:"سعر الصرف"}),(0,d.jsx)(t.O,{placeholder:"سعر الصرف",value:R.rate,onValueChange:a=>Y("rate",a||"")})]}),"USD"!==R.originalCurrency&&(0,d.jsxs)("div",{className:"md:col-span-3 space-y-1.5",children:[(0,d.jsx)(x.J,{children:"المعادل بالدولار"}),(0,d.jsx)(r.p,{value:$.toFixed(2),readOnly:!0,disabled:!0,className:"font-mono text-right"})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-[2fr,1fr,100px] gap-3 items-end",children:[(0,d.jsxs)("div",{className:"space-y-1.5",children:[(0,d.jsx)(x.J,{children:"ملاحظة"}),(0,d.jsx)(r.p,{placeholder:"ملاحظة",value:R.note,onChange:a=>Y("note",a.target.value)})]}),(0,d.jsxs)("div",{className:"space-y-1.5",children:[(0,d.jsx)(x.J,{children:"التاريخ"}),(0,d.jsxs)(B.AM,{open:V,onOpenChange:W,children:[(0,d.jsx)(B.Wv,{asChild:!0,children:(0,d.jsxs)(g.$,{variant:"outline",className:(0,z.cn)("w-full justify-start text-left font-normal",!R.date&&"text-muted-foreground"),children:[R.date?(0,D.GP)(new Date(R.date),"yyyy-MM-dd"):(0,d.jsx)("span",{children:"اختر تاريخ"}),(0,d.jsx)(n.A,{className:"ms-auto h-4 w-4 opacity-50"})]})}),(0,d.jsx)(B.hl,{className:"w-auto p-0",align:"start",children:(0,d.jsx)(C.V,{mode:"single",selected:new Date(R.date),onSelect:a=>{a&&Y("date",(0,D.GP)(a,"yyyy-MM-dd")),W(!1)}})})]})]}),(0,d.jsxs)(g.$,{onClick:()=>{if(!R.paidTo||!R.originalAmount)return void I({title:"بيانات ناقصة",description:"الرجاء إدخال الطرف والمبلغ.",variant:"destructive"});L?(K(a=>a.map(a=>a.id===L?{...R,id:L}:a)),M(null),I({title:"تم تحديث التسديد"})):K(a=>[...a,{id:(0,l.A)(),...R}]),R.rate&&localStorage.setItem(E,String(R.rate)),S({...Q,rate:R.rate,date:R.date})},className:"w-full",children:[L?(0,d.jsx)(k.A,{className:"me-2 h-4 w-4"}):(0,d.jsx)(i.A,{className:"me-2 h-4 w-4"}),L?"تحديث":"إضافة"]})]})]})]}),(0,d.jsxs)(w.Zp,{className:"flex-grow flex flex-col",children:[(0,d.jsx)(w.aR,{children:(0,d.jsxs)(w.ZB,{className:"text-lg",children:["التسديدات المضافة (",J.length,")"]})}),(0,d.jsx)(w.Wu,{className:"flex-grow overflow-y-auto",children:(0,d.jsx)("div",{className:"border rounded-md",children:(0,d.jsxs)(q.XI,{children:[(0,d.jsx)(q.A0,{children:(0,d.jsxs)(q.Hj,{children:[(0,d.jsx)(q.nd,{className:"w-[80px]",children:"النوع"}),(0,d.jsx)(q.nd,{children:"الطرف"}),(0,d.jsx)(q.nd,{children:"الوسيط"}),(0,d.jsx)(q.nd,{children:"المبلغ الأصلي"}),(0,d.jsx)(q.nd,{children:"سعر الصرف"}),(0,d.jsx)(q.nd,{children:"المعادل بالدولار"}),(0,d.jsx)(q.nd,{children:"التاريخ"}),(0,d.jsx)(q.nd,{children:"ملاحظات"}),(0,d.jsx)(q.nd,{className:"w-24 text-center",children:"الإجراءات"})]})}),(0,d.jsxs)(q.BF,{children:[0===J.length&&(0,d.jsx)(q.Hj,{children:(0,d.jsx)(q.nA,{colSpan:9,className:"h-24 text-center",children:"لم تتم إضافة أي تسديدات بعد."})}),J.map(a=>{let b="USD"===a.originalCurrency?Number(a.originalAmount):Number(a.originalAmount)/(Number(a.rate)||1),c="receipt"===a.type?-b:b;return(0,d.jsxs)(q.Hj,{className:(0,z.cn)("bg-background",L===a.id&&"bg-primary/10"),children:[(0,d.jsx)(q.nA,{children:(0,d.jsx)(y.E,{variant:"receipt"===a.type?"default":"destructive",className:(0,z.cn)("payment"===a.type?"bg-blue-500":"bg-green-500"),children:"receipt"===a.type?"قبض":"دفع"})}),(0,d.jsx)(q.nA,{className:"font-semibold",children:a.paidTo}),(0,d.jsx)(q.nA,{children:a.intermediary}),(0,d.jsxs)(q.nA,{className:"font-mono text-right",children:[Number(a.originalAmount).toLocaleString()," ",a.originalCurrency]}),(0,d.jsx)(q.nA,{className:"font-mono text-right",children:"USD"!==a.originalCurrency?a.rate:"-"}),(0,d.jsxs)(q.nA,{className:"font-mono font-bold text-right",children:[c.toFixed(2)," USD"]}),(0,d.jsx)(q.nA,{children:a.date}),(0,d.jsx)(q.nA,{children:a.note}),(0,d.jsxs)(q.nA,{className:"text-center",children:[(0,d.jsx)(g.$,{variant:"ghost",size:"icon",className:"h-8 w-8 text-blue-600",onClick:()=>(a=>{M(a.id),S({paidTo:a.paidTo,type:a.type,intermediary:a.intermediary,originalCurrency:a.originalCurrency,originalAmount:a.originalAmount,rate:a.rate,date:a.date,note:a.note})})(a),children:(0,d.jsx)(o.A,{className:"h-4 w-4"})}),(0,d.jsx)(g.$,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",onClick:()=>{var b;return b=a.id,void K(a=>a.filter(a=>a.id!==b))},children:(0,d.jsx)(p.A,{className:"h-4 w-4"})})]})]},a.id)})]})]})})})]})]})});F.displayName="AddPaymentsForm";var G=c(46283);function H({exchangeId:a,exchanges:b,onSuccess:c,isEditing:l=!1,initialData:n,children:o}){let[p,q]=(0,e.useState)(!1),{themeSettings:r}=(0,G.A)(),{toast:s}=(0,m.dj)(),t=f().useRef(null),[u,v]=(0,e.useState)(0),[w,x]=(0,e.useState)({}),y=r?.light?.accent?`hsl(${r.light.accent})`:"hsl(var(--accent))",z=async()=>{if(t.current){q(!1),s({title:`جاري ${l?"تحديث":"حفظ"} التسديدات...`});let a=await t.current.handleSave();a&&c(a)}},A=t.current?.isSaving||!1;return(0,d.jsxs)(h.lG,{open:p,onOpenChange:q,children:[(0,d.jsx)(h.zM,{asChild:!0,children:o||(0,d.jsxs)(g.$,{variant:"secondary",children:[(0,d.jsx)(i.A,{className:"me-2 h-4 w-4"}),"إضافة تسديد"]})}),(0,d.jsxs)(h.Cf,{className:"max-w-6xl h-[90vh] flex flex-col p-0",children:[(0,d.jsx)(h.c7,{className:"p-4 rounded-t-lg",style:{backgroundColor:y,color:"white"},children:(0,d.jsx)(h.L3,{className:"text-white",children:l?`تعديل دفعة التسديد: ${n?.invoiceNumber}`:"إدخال تسديدات جديدة للبورصة"})}),(0,d.jsx)("div",{className:"flex-grow overflow-y-auto px-2 sm:px-6 py-2",children:(0,d.jsx)(F,{ref:t,exchangeId:a,exchanges:b,onSuccess:a=>{c(a),q(!1)},isEditing:l,initialData:n?.details||[],batchId:n?.id,onStagedEntriesChange:v,onSummaryChange:x})}),(0,d.jsxs)(h.Es,{className:"p-2 sm:p-4 border-t flex-col sm:flex-row justify-between items-center bg-background",children:[(0,d.jsx)("div",{className:"flex-grow w-full",children:u>0&&(0,d.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,d.jsx)("h4",{className:"font-semibold text-sm",children:"الملخص:"}),Object.entries(w).filter(([a])=>"totalUSD"!==a).map(([a,b])=>(0,d.jsxs)("div",{className:"p-2 bg-muted rounded-md text-center",children:[(0,d.jsxs)("p",{className:"text-xs text-muted-foreground",children:["مجموع ",a]}),(0,d.jsx)("p",{className:"font-mono font-bold text-xs",children:Number(b).toLocaleString()})]},a)),(0,d.jsxs)("div",{className:"p-2 bg-primary/10 rounded-md text-center border border-primary/50",children:[(0,d.jsx)("p",{className:"text-xs text-primary font-bold",children:"الإجمالي المعادل"}),(0,d.jsxs)("p",{className:"font-mono font-bold text-primary text-sm",children:[(w.totalUSD||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," USD"]})]})]})}),(0,d.jsxs)(g.$,{onClick:z,disabled:A||0===u,className:"w-full sm:w-auto",size:"lg",children:[A&&(0,d.jsx)(j.A,{className:"me-2 h-4 w-4 animate-spin"}),(0,d.jsx)(k.A,{className:"me-2 h-4 w-4"}),l?"حفظ كل التعديلات":`حفظ (${u}) تسديدات`]})]})]})]})}},68191:(a,b,c)=>{c.d(b,{A:()=>H});var d=c(21124),e=c(38301),f=c.n(e),g=c(35284),h=c(40068),i=c(10656),j=c(49113),k=c(49566),l=c(15003),m=c(37448),n=c(98341),o=c(27810),p=c(40822),q=c(79202),r=c(93758),s=c(45608),t=c(25456),u=c(85708);let v=(0,u.createServerReference)("704baf0749912d6e636a66524e43f80ce5c8454d38",u.callServer,void 0,u.findSourceMapURL,"saveTransactions");var w=c(62186),x=c(68120),y=c(44943),z=c(97802),A=c(77837),B=c(27410),C=c(63822);let D="lastExchangeRate",E="lastExchangeCurrency",F=(0,e.forwardRef)(({exchangeId:a,exchanges:b,onSuccess:c,isEditing:f=!1,initialData:h=[],batchId:j,onStagedEntriesChange:u,onSummaryChange:F},G)=>{let{data:H}=(0,z.Z)(),{toast:I}=(0,m.dj)(),[J,K]=(0,e.useState)([]),[L,M]=(0,e.useState)(null),[N,O]=(0,e.useState)(a),P=H?.settings?.currencySettings?.defaultCurrency||"USD",Q=()=>({partyName:"",originalCurrency:localStorage.getItem(E)||P,originalAmount:"",rate:parseFloat(localStorage.getItem(D)||String(H?.settings?.currencySettings?.exchangeRates.USD_IQD||1)),date:new Date().toISOString().slice(0,10),note:""}),[R,S]=(0,e.useState)(Q()),[T,U]=(0,e.useState)(!1),[V,W]=(0,e.useState)(!1);(0,e.useEffect)(()=>{u(J.length)},[J,u]);let X=(0,e.useMemo)(()=>J.reduce((a,b)=>{let c=b.originalCurrency,d=-(Number(b.originalAmount)||0),e="USD"===b.originalCurrency?d:d/(Number(b.rate)||1);return a[c]||(a[c]=0),a[c]+=d,a.totalUSD=(a.totalUSD||0)+e,a},{}),[J]);(0,e.useEffect)(()=>{F(X)},[X,F]),(0,e.useEffect)(()=>{f&&(K(h.map(a=>({id:a.id||(0,l.A)(),partyName:a.partyName||"",originalCurrency:a.originalCurrency||P,originalAmount:a.originalAmount||"",rate:a.rate||1,date:a.date||new Date().toISOString().slice(0,10),note:a.note||""}))),O(h[0]?.exchangeId||a))},[f,h,P,a]);let Y=(a,b)=>{S(c=>({...c,[a]:b}))},Z=async()=>{if(!N)return I({title:"اختر بورصة أولاً",variant:"destructive"}),null;if(0===J.length)return null;U(!0);try{let a=J.map(a=>({partyName:a.partyName,originalCurrency:a.originalCurrency,originalAmount:Number(a.originalAmount),rate:Number(a.rate)||1,date:a.date,note:a.note})),b=await v(N,a,j);if(!b.success||!b.batch)throw Error(b.error);return I({title:`تم ${f?"تحديث":"حفظ"} المعاملات بنجاح`}),K([]),b.batch}catch(a){return I({title:"خطأ",description:a.message,variant:"destructive"}),null}finally{U(!1)}};(0,e.useImperativeHandle)(G,()=>({handleSave:Z,isSaving:T,summary:X}));let $="USD"===R.originalCurrency?Number(R.originalAmount):Number(R.originalAmount)/(Number(R.rate)||1),_=H?.settings?.currencySettings?.currencies||[];return(0,d.jsxs)("div",{className:"h-full flex flex-col gap-4",children:[(0,d.jsxs)(w.Zp,{children:[(0,d.jsx)(w.aR,{children:(0,d.jsx)(w.ZB,{className:"text-lg",children:L?`تعديل معاملة`:"إضافة معاملة جديدة للقائمة"})}),(0,d.jsxs)(w.Wu,{className:"space-y-3",children:[f&&(0,d.jsxs)("div",{className:"space-y-1.5 max-w-sm",children:[(0,d.jsx)(x.J,{children:"تغيير البورصة"}),(0,d.jsxs)(s.l6,{value:N,onValueChange:O,children:[(0,d.jsx)(s.bq,{children:(0,d.jsx)(s.yv,{placeholder:"اختر بورصة..."})}),(0,d.jsx)(s.gC,{children:b.map(a=>(0,d.jsx)(s.eb,{value:a.id,children:a.name},a.id))})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4 items-end",children:[(0,d.jsxs)("div",{className:"md:col-span-4 space-y-1.5",children:[(0,d.jsx)(x.J,{children:"الطرف"}),(0,d.jsx)(r.p,{placeholder:"الطرف الآخر في المعاملة",value:R.partyName,onChange:a=>Y("partyName",a.target.value)})]}),(0,d.jsxs)("div",{className:"md:col-span-2 space-y-1.5",children:[(0,d.jsx)(x.J,{children:"العملة"}),(0,d.jsxs)(s.l6,{value:R.originalCurrency,onValueChange:a=>Y("originalCurrency",a),children:[(0,d.jsx)(s.bq,{children:(0,d.jsx)(s.yv,{})}),(0,d.jsx)(s.gC,{children:_.map(a=>(0,d.jsx)(s.eb,{value:a.code,children:a.code},a.code))})]})]}),(0,d.jsxs)("div",{className:"md:col-span-2 space-y-1.5",children:[(0,d.jsx)(x.J,{children:"المبلغ"}),(0,d.jsx)(t.O,{placeholder:"المبلغ",value:R.originalAmount,onValueChange:a=>Y("originalAmount",a||"")})]}),(0,d.jsxs)("div",{className:(0,y.cn)("md:col-span-2 space-y-1.5","USD"===R.originalCurrency&&"invisible"),children:[(0,d.jsx)(x.J,{children:"سعر الصرف"}),(0,d.jsx)(t.O,{placeholder:"سعر الصرف",value:R.rate,onValueChange:a=>Y("rate",a||"")})]}),"USD"!==R.originalCurrency&&(0,d.jsxs)("div",{className:"md:col-span-2 space-y-1.5",children:[(0,d.jsx)(x.J,{children:"المعادل بالدولار"}),(0,d.jsx)(r.p,{value:$.toFixed(2),readOnly:!0,disabled:!0,className:"font-mono text-right"})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-[2fr,1fr,100px] gap-3 items-end",children:[(0,d.jsxs)("div",{className:"space-y-1.5",children:[(0,d.jsx)(x.J,{children:"ملاحظة"}),(0,d.jsx)(r.p,{placeholder:"ملاحظة",value:R.note,onChange:a=>Y("note",a.target.value)})]}),(0,d.jsxs)("div",{className:"space-y-1.5",children:[(0,d.jsx)(x.J,{children:"التاريخ"}),(0,d.jsxs)(A.AM,{open:V,onOpenChange:W,children:[(0,d.jsx)(A.Wv,{asChild:!0,children:(0,d.jsxs)(g.$,{variant:"outline",className:(0,y.cn)("w-full justify-start text-left font-normal",!R.date&&"text-muted-foreground"),children:[R.date?(0,C.GP)(new Date(R.date),"yyyy-MM-dd"):(0,d.jsx)("span",{children:"اختر تاريخ"}),(0,d.jsx)(n.A,{className:"ms-auto h-4 w-4 opacity-50"})]})}),(0,d.jsx)(A.hl,{className:"w-auto p-0",align:"start",children:(0,d.jsx)(B.V,{mode:"single",selected:new Date(R.date),onSelect:a=>{a&&Y("date",(0,C.GP)(a,"yyyy-MM-dd")),W(!1)}})})]})]}),(0,d.jsxs)(g.$,{onClick:()=>{if(!R.partyName||!R.originalAmount)return void I({title:"بيانات ناقصة",description:"الرجاء إدخال اسم الطرف والمبلغ.",variant:"destructive"});L?(K(a=>a.map(a=>a.id===L?{...R,id:L}:a)),M(null),I({title:"تم تحديث المعاملة"})):K(a=>[...a,{id:(0,l.A)(),...R}]),R.rate&&localStorage.setItem(D,String(R.rate)),R.originalCurrency&&localStorage.setItem(E,R.originalCurrency),S(a=>({...Q(),rate:a.rate,date:a.date,originalCurrency:a.originalCurrency}))},className:"w-full",children:[L?(0,d.jsx)(k.A,{className:"me-2 h-4 w-4"}):(0,d.jsx)(i.A,{className:"me-2 h-4 w-4"}),L?"تحديث":"إضافة"]})]})]})]}),(0,d.jsxs)(w.Zp,{className:"flex-grow flex flex-col",children:[(0,d.jsx)(w.aR,{children:(0,d.jsxs)(w.ZB,{className:"text-lg",children:["المعاملات المضافة (",J.length,")"]})}),(0,d.jsx)(w.Wu,{className:"flex-grow overflow-y-auto",children:(0,d.jsx)("div",{className:"border rounded-md",children:(0,d.jsxs)(q.XI,{children:[(0,d.jsx)(q.A0,{children:(0,d.jsxs)(q.Hj,{children:[(0,d.jsx)(q.nd,{children:"الطرف"}),(0,d.jsx)(q.nd,{children:"المبلغ الأصلي"}),(0,d.jsx)(q.nd,{children:"سعر الصرف"}),(0,d.jsx)(q.nd,{children:"المعادل بالدولار"}),(0,d.jsx)(q.nd,{children:"التاريخ"}),(0,d.jsx)(q.nd,{children:"ملاحظات"}),(0,d.jsx)(q.nd,{className:"w-24 text-center",children:"الإجراءات"})]})}),(0,d.jsxs)(q.BF,{children:[0===J.length&&(0,d.jsx)(q.Hj,{children:(0,d.jsx)(q.nA,{colSpan:7,className:"h-24 text-center",children:"لم تتم إضافة أي معاملات بعد."})}),J.map(a=>{let b="USD"===a.originalCurrency?Number(a.originalAmount):Number(a.originalAmount)/(Number(a.rate)||1);return(0,d.jsxs)(q.Hj,{className:(0,y.cn)(L===a.id&&"bg-primary/10"),children:[(0,d.jsx)(q.nA,{className:"font-semibold",children:a.partyName}),(0,d.jsxs)(q.nA,{className:"font-mono text-right",children:[Number(a.originalAmount).toLocaleString()," ",a.originalCurrency]}),(0,d.jsx)(q.nA,{className:"font-mono text-right",children:"USD"!==a.originalCurrency?a.rate:"-"}),(0,d.jsxs)(q.nA,{className:"font-mono font-bold text-right",children:[(-b).toFixed(2)," USD"]}),(0,d.jsx)(q.nA,{children:a.date}),(0,d.jsx)(q.nA,{children:a.note}),(0,d.jsxs)(q.nA,{className:"text-center",children:[(0,d.jsx)(g.$,{variant:"ghost",size:"icon",className:"h-8 w-8 text-blue-600",onClick:()=>(a=>{M(a.id),S({partyName:a.partyName,originalCurrency:a.originalCurrency,originalAmount:a.originalAmount,rate:a.rate,date:a.date,note:a.note})})(a),children:(0,d.jsx)(o.A,{className:"h-4 w-4"})}),(0,d.jsx)(g.$,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",onClick:()=>{var b;return b=a.id,void K(a=>a.filter(a=>a.id!==b))},children:(0,d.jsx)(p.A,{className:"h-4 w-4"})})]})]},a.id)})]})]})})})]})]})});F.displayName="AddTransactionsForm";var G=c(46283);function H({exchangeId:a,exchanges:b,onSuccess:c,isEditing:l=!1,initialData:n,children:o}){let[p,q]=(0,e.useState)(!1),{themeSettings:r}=(0,G.A)(),{toast:s}=(0,m.dj)(),t=f().useRef(null),[u,v]=(0,e.useState)(0),[w,x]=(0,e.useState)({}),y=r?.light?.primary?`hsl(${r.light.primary})`:"hsl(var(--primary))",z=async()=>{if(t.current){q(!1),s({title:`جاري ${l?"تحديث":"حفظ"} المعاملات...`});let a=await t.current.handleSave();a&&c(a)}},A=t.current?.isSaving||!1;return(0,d.jsxs)(h.lG,{open:p,onOpenChange:q,children:[(0,d.jsx)(h.zM,{asChild:!0,children:o||(0,d.jsxs)(g.$,{children:[(0,d.jsx)(i.A,{className:"me-2 h-4 w-4"}),"إضافة معاملة"]})}),(0,d.jsxs)(h.Cf,{className:"max-w-6xl h-[90vh] flex flex-col p-0",children:[(0,d.jsx)(h.c7,{className:"p-4 rounded-t-lg",style:{backgroundColor:y,color:"white"},children:(0,d.jsx)(h.L3,{className:"text-white",children:l?`تعديل دفعة المعاملات: ${n?.invoiceNumber}`:"إدخال معاملات جديدة للبورصة"})}),(0,d.jsx)("div",{className:"flex-grow overflow-y-auto px-2 sm:px-6 py-2",children:(0,d.jsx)(F,{ref:t,exchangeId:a,exchanges:b,onSuccess:a=>{c(a),q(!1)},isEditing:l,initialData:n?.details||[],batchId:n?.id,onStagedEntriesChange:v,onSummaryChange:x})}),(0,d.jsxs)(h.Es,{className:"p-2 sm:p-4 border-t flex-col sm:flex-row justify-between items-center bg-background",children:[(0,d.jsx)("div",{className:"flex-grow w-full",children:u>0&&(0,d.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,d.jsx)("h4",{className:"font-semibold text-sm",children:"الملخص:"}),Object.entries(w).filter(([a])=>"totalUSD"!==a).map(([a,b])=>(0,d.jsxs)("div",{className:"p-2 bg-muted rounded-md text-center",children:[(0,d.jsxs)("p",{className:"text-xs text-muted-foreground",children:["مجموع ",a]}),(0,d.jsx)("p",{className:"font-mono font-bold text-xs",children:Number(b).toLocaleString()})]},a)),(0,d.jsxs)("div",{className:"p-2 bg-primary/10 rounded-md text-center border border-primary/50",children:[(0,d.jsx)("p",{className:"text-xs text-primary font-bold",children:"الإجمالي المعادل"}),(0,d.jsxs)("p",{className:"font-mono font-bold text-primary text-sm",children:[(w.totalUSD||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," USD"]})]})]})}),(0,d.jsxs)(g.$,{onClick:z,disabled:A||0===u,className:"w-full sm:w-auto",size:"lg",children:[A&&(0,d.jsx)(j.A,{className:"me-2 h-4 w-4 animate-spin"}),(0,d.jsx)(k.A,{className:"me-2 h-4 w-4"}),l?"حفظ كل التعديلات":`حفظ (${u}) معاملات`]})]})]})]})}}};