"use strict";exports.id=1330,exports.ids=[1330],exports.modules={5538:(a,b,c)=>{c.d(b,{default:()=>k});var d=c(21124),e=c(38301),f=c(42378),g=c(64772),h=c(99599),i=c(63009),j=c(22708);function k({children:a,requiredPermission:b}){let{user:c,loading:k,hasPermission:l}=(0,i.A)();(0,f.useRouter)();let[m,n]=(0,e.useState)(!1);return k||!m?k||m||!c?(0,d.jsx)(j.A,{}):(0,d.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,d.jsxs)(g.Fc,{variant:"destructive",className:"max-w-md",children:[(0,d.jsx)(h.A,{className:"h-4 w-4"}),(0,d.jsx)(g.XL,{children:"وصول مرفوض!"}),(0,d.jsx)(g.TN,{children:"ليس لديك الصلاحية المطلوبة للوصول إلى هذه الصفحة. يرجى التواصل مع مدير النظام."})]})}):(0,d.jsx)(d.Fragment,{children:a})}},9987:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(8808).A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},15914:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(8808).A)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]])},18373:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(87604).A)("Terminal",[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]])},26754:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(8808).A)("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12a2 2 0 0 1-2-2V7",key:"6c3vgh"}]])},29559:(a,b,c)=>{c.d(b,{R:()=>d});let d={projectId:"fly4all-78277122-3cbd0",privateKey:"-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQC62eIaOJqkBGL/\nIvxqOzN8/etbwsVKx8vNMRXVQ4RbS2/jB2JBJhonNWHf0Lll36QFnnfM0v1sGzz3\nck3eCAxT4snkbI0nb71u6tLff1YSur7p7GmCOeq1LKsc6uI5sFC3G0PJLZFYj2hG\n0djgQobNoVmLFfi9m1DhReDSFvk1PpJt1hxMhKKq11KR9ER90IUE2L6vuDR0Fa1Z\n9Y72htITxAq7Wd9zAlwlt7vcK5cQAbLBYrQVqPDrrmwNS5JPyDLhiEY6fbGeyiFE\nXdFNhktEsazoFN6w/V5NQ/aJH04fn3V36lBdc9sO7+wRufWRBaeoBs1FurPhpY1q\nxKorBLllAgMBAAECggEAFjzZrby4XNZf0NUhXOREVbcjpHVbBTIfpYFWw52oOjRR\ncd/eV/oYqTtvdVNySTdTXk7Um7YtrojUWe/K6CaljvNCC3NG3l9sWG/OnoZZYFvE\n3nLCQNszPZI+IDAtMefzx0MRr3cCohtZMfqGGPSZ9g2iqky4YJqERvdJ0T8mNCmU\n8GB6+qoKUGMt2O5DzVO250CGgIcgfqFd1dqvC+8PD3S2FL1dqwEgxpHeXhg+7NUU\n78+SmNRxcCTdqlgx5V9ihqgGaajVHWmGEMfDS+XatG+BAoc+Fi/ubOHPXH9Iniwd\njJcJ9CaSyZPFz0N+sY5uFB/wk2cYIKCdjzHTrJPzmQKBgQDgm8UI7Q3GScdbv29p\nQX++BOzqJKMiO7d0nOsW/7AobFVsSpXTsU0RovAkCtYY+P67qxQDwK3RSDs36YQE\nUyRwJhHnzJOKf5zj2nVFKgHgSSJdZEolMTM1KVicESDer6knsT7EN8M+iVGXl0JO\nz277bJ5hhNMkPnB1e7dOh6zq+QKBgQDU9zLg30dvNXNwSHv0QDZqADomi9U9nkZ+\nJhgJDmi+VMUxWfb61U0W/azewShL7YIsOHdTLensrAPBj5xzuB2OftKnEuaO3Nsv\nzJeQ3jOM5wXnqHpl9EXYVvlJTzM7tCyRJuiDFyhBmezCxikLjsjxWjwlcEGhc84Z\n+7E1IAUQzQKBgBVL78TG5VV1zWdPoXqzcS9NPEF/M9CdJOnzrv7BQ6yxiO/5qncm\nCo6vimGAfYhko5KbyAwLCvAbDzJf+9qFH6FamrwF07+AFhosro3eS8s+Y/nC9pzM\nK3TQ9Mvne9xhf4J59d+ZAfQ+BPSArRLX7Ef+po3MkFCRcwxQrLLPfn/RAoGBAL1f\nuBF42sfMSwOsoPTYaMqnuw3tyEhLxzmD3FmpQ4EEVnmFG3d/V1a7aw6FyrSB1gBG\nke0YZew8JfboImJQdY/xvJYu23Bsekgt8RU0UbjY8kpGadjhd35iELicwd00YXEN\nnTJ81CJJotysY3FQneTorZVJFkNgfARk6PZpq7d9AoGBAJVxFwblg6SQ+QZMUqaU\n5dXAESNOHv08DkYd0o/LmwfX1/odY9VwkR0unwMY3NncAWVSNh7u/C3DjLciaHzJ\nJr2o/GSZ2p1HxUsUa0aqN/q4BFTkO7ryFeCFcN3AO6hfgzKnoFUFYBD4iSHPkgX/\nfrErRvbecpYKP5V4y0awUggt\n-----END PRIVATE KEY-----\n".replace(/\\n/g,"\n"),clientEmail:"firebase-adminsdk-fbsvc@fly4all-78277122-3cbd0.iam.gserviceaccount.com"}},36480:(a,b,c)=>{c.d(b,{default:()=>d});let d=(0,c(97954).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/user/studio/src/components/auth/protected-page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/user/studio/src/components/auth/protected-page.tsx","default")},43513:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{$E:()=>q,Lf:()=>o,iS:()=>p});var e=c(75879);c(68633);var f=c(9801),g=c(14276),h=c(7879),i=c(24803),j=c(29559),k=c(51669),l=a([f,g,h,i]);[f,g,h,i]=l.then?(await l)():l;let r=null,s=null;async function m(){if((0,f.getApps)().length>0)return r=(0,f.getApp)();if(!j.R||!j.R.projectId||!j.R.privateKey||!j.R.clientEmail)throw console.error("Firebase Admin SDK Service Account object is not valid."),s=Error("Default Firebase service account is not valid in firebase-service-account.ts.");try{console.log("Initializing Firebase Admin SDK...");let a=(0,f.initializeApp)({credential:(0,f.cert)(j.R),storageBucket:`${j.R.projectId}.appspot.com`});return r=a,console.log("Firebase Admin SDK initialized successfully."),a}catch(a){throw console.error("Failed to initialize Firebase Admin SDK:",String(a)),s=a instanceof Error?a:Error(String(a))}}async function n(){if(r)return r;if(s)throw s;return await m()}async function o(){let a=await n();return(0,h.getFirestore)(a)}async function p(){let a=await n();return(0,g.getAuth)(a)}async function q(){let a=await n();return(0,i.getStorage)(a)}(0,k.D)([o,p,q]),(0,e.A)(o,"009e84f93947e0a432e28675ea07a71949bfe66943",null),(0,e.A)(p,"0084d26686615403d39adac4c095e2f442ed3af27d",null),(0,e.A)(q,"0079928ff14026085419c5483c28b98ee3311389f6",null),d()}catch(a){d(a)}})},62159:(a,b,c)=>{c.d(b,{E:()=>f});var d=c(75338),e=c(70673);function f({className:a,...b}){return(0,d.jsx)("div",{className:(0,e.cn)("animate-pulse rounded-md bg-muted",a),...b})}},67094:(a,b,c)=>{c.d(b,{Ke:()=>g,Nt:()=>e,R6:()=>f});var d=c(59147);let e=d.bL,f=d.R6,g=d.Ke},68162:(a,b,c)=>{c.d(b,{Fc:()=>i,TN:()=>k,XL:()=>j});var d=c(75338),e=c(74515),f=c(86281),g=c(70673);let h=(0,f.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),i=e.forwardRef(({className:a,variant:b,...c},e)=>(0,d.jsx)("div",{ref:e,role:"alert",className:(0,g.cn)(h({variant:b}),a),...c}));i.displayName="Alert";let j=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("h5",{ref:c,className:(0,g.cn)("mb-1 font-medium leading-none tracking-tight",a),...b}));j.displayName="AlertTitle";let k=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,g.cn)("text-sm [&_p]:leading-relaxed",a),...b}));k.displayName="AlertDescription"},70673:(a,b,c)=>{c.d(b,{cn:()=>f});var d=c(81171),e=c(11167);function f(...a){return(0,e.QP)((0,d.$)(a))}},86011:(a,b,c)=>{c.d(b,{default:()=>$});var d=c(21124),e=c(38301),f=c(62186),g=c(27081),h=c(37448),i=c(35284),j=c(10656),k=c(9987),l=c(5239),m=c(15914),n=c(90743),o=c(38692),p=c(26754),q=c(34118),r=c(43215),s=c(77503),t=c(44943),u=c(11563),v=c(90023),w=c(27810),x=c(40822),y=c(85708);let z=(0,y.createServerReference)("40242c751622e84910e790a1742420d90078e94a9c",y.callServer,void 0,y.findSourceMapURL,"deleteAccount");var A=c(12439),B=c(40068),C=c(49113),D=c(49566),E=c(31980),F=c(99546),G=c(50937),H=c(27186),I=c(93758);let J=(0,y.createServerReference)("406fd1b263f26f83be7d1611e64b70584dc60ef87e",y.callServer,void 0,y.findSourceMapURL,"generateAccountCode"),K=(0,y.createServerReference)("601ddb4a17d4e0bdb19f2a232ffc3a6c9ea6194cac",y.callServer,void 0,y.findSourceMapURL,"updateAccount"),L=(0,y.createServerReference)("4018add885423f0f5eb9894fc318abfad4e8b1fada",y.callServer,void 0,y.findSourceMapURL,"createAccount");var M=c(45608),N=c(68254);let O=F.Ik({name:F.Yj().min(2,"اسم الحساب مطلوب."),type:F.Yj().min(1,"نوع الحساب مطلوب."),parentId:F.Yj().nullable(),code:F.Yj().min(1,"الكود مطلوب."),description:F.Yj().optional()});function P({allAccounts:a,onAccountAdded:b,children:c,isEditing:f=!1,account:g,parentId:j}){let[k,l]=(0,e.useState)(!1),[m,n]=(0,e.useState)(!1),{toast:o}=(0,h.dj)(),p=(0,E.mN)({resolver:(0,G.u)(O)});p.watch("parentId");let q=(a,b=0)=>{let c=[];return a.forEach(a=>{let d="—".repeat(b);c.push({label:`${d} ${a.code} - ${a.name}`,value:a.id}),a.children&&(c=c.concat(q(a.children,b+1)))}),c},r=[{label:"رئيسي (بدون أب)",value:"root"},...q(a)],s=async()=>{n(!0);try{let a=p.getValues("parentId"),b=await J("root"===a?null:a);p.setValue("code",b)}catch(a){o({title:"خطأ",description:`فشل إنشاء الكود: ${a.message}`,variant:"destructive"})}finally{n(!1)}},t=async a=>{try{f&&g?await K(g.id,a):await L(a),o({title:`تم ${f?"تحديث":"إضافة"} الحساب بنجاح`}),b(),l(!1)}catch(a){o({title:"خطأ",description:a.message,variant:"destructive"})}};return(0,d.jsxs)(B.lG,{open:k,onOpenChange:l,children:[(0,d.jsx)(B.zM,{asChild:!0,children:c}),(0,d.jsx)(B.Cf,{className:"sm:max-w-md",children:(0,d.jsx)(H.lV,{...p,children:(0,d.jsxs)("form",{onSubmit:p.handleSubmit(t),children:[(0,d.jsxs)(B.c7,{children:[(0,d.jsx)(B.L3,{children:f?`تعديل حساب: ${g?.name}`:"إضافة حساب جديد"}),(0,d.jsx)(B.rr,{children:"أدخل تفاصيل الحساب الجديد في شجرة الحسابات."})]}),(0,d.jsxs)("div",{className:"py-4 grid gap-4",children:[(0,d.jsx)(H.zB,{control:p.control,name:"parentId",render:({field:a})=>(0,d.jsxs)(H.eI,{children:[(0,d.jsx)(H.lR,{children:"الحساب الأب"}),(0,d.jsxs)(M.l6,{onValueChange:b=>a.onChange("root"===b?null:b),value:a.value||void 0,children:[(0,d.jsx)(H.MJ,{children:(0,d.jsx)(M.bq,{children:(0,d.jsx)(M.yv,{placeholder:"اختر الحساب الأب..."})})}),(0,d.jsxs)(M.gC,{children:[(0,d.jsx)(M.eb,{value:"root",children:"رئيسي (بدون أب)"}),r.map(a=>(0,d.jsx)(M.eb,{value:a.value,children:a.label},a.value))]})]}),(0,d.jsx)(H.C5,{})]})}),(0,d.jsxs)("div",{className:"grid grid-cols-[1fr,auto] gap-2",children:[(0,d.jsx)(H.zB,{control:p.control,name:"code",render:({field:a})=>(0,d.jsxs)(H.eI,{children:[(0,d.jsx)(H.lR,{children:"كود الحساب"}),(0,d.jsx)(H.MJ,{children:(0,d.jsx)(I.p,{...a})}),(0,d.jsx)(H.C5,{})]})}),(0,d.jsx)(i.$,{type:"button",onClick:s,className:"self-end",variant:"outline",disabled:m,children:m?(0,d.jsx)(C.A,{className:"animate-spin h-4 w-4"}):"توليد"})]}),(0,d.jsx)(H.zB,{control:p.control,name:"name",render:({field:a})=>(0,d.jsxs)(H.eI,{children:[(0,d.jsx)(H.lR,{children:"اسم الحساب"}),(0,d.jsx)(H.MJ,{children:(0,d.jsx)(I.p,{...a})}),(0,d.jsx)(H.C5,{})]})}),(0,d.jsx)(H.zB,{control:p.control,name:"type",render:({field:a})=>(0,d.jsxs)(H.eI,{children:[(0,d.jsx)(H.lR,{children:"نوع الحساب"}),(0,d.jsxs)(M.l6,{onValueChange:a.onChange,value:a.value,children:[(0,d.jsx)(H.MJ,{children:(0,d.jsx)(M.bq,{children:(0,d.jsx)(M.yv,{})})}),(0,d.jsxs)(M.gC,{children:[(0,d.jsx)(M.eb,{value:"asset",children:"أصول"}),(0,d.jsx)(M.eb,{value:"liability",children:"التزامات"}),(0,d.jsx)(M.eb,{value:"equity",children:"حقوق الملكية"}),(0,d.jsx)(M.eb,{value:"revenue",children:"إيرادات"}),(0,d.jsx)(M.eb,{value:"expense",children:"مصروفات"})]})]}),(0,d.jsx)(H.C5,{})]})}),(0,d.jsx)(H.zB,{control:p.control,name:"description",render:({field:a})=>(0,d.jsxs)(H.eI,{children:[(0,d.jsx)(H.lR,{children:"الوصف (اختياري)"}),(0,d.jsx)(H.MJ,{children:(0,d.jsx)(N.T,{...a})}),(0,d.jsx)(H.C5,{})]})})]}),(0,d.jsx)(B.Es,{children:(0,d.jsxs)(i.$,{type:"submit",disabled:p.formState.isSubmitting,children:[p.formState.isSubmitting&&(0,d.jsx)(C.A,{className:"me-2 h-4 w-4 animate-spin"}),(0,d.jsx)(D.A,{className:"me-2 h-4 w-4"})," ",f?"حفظ التعديلات":"إضافة الحساب"]})})]})})})]})}function Q({node:a,onActionSuccess:b,allAccounts:c}){let{toast:e}=(0,h.dj)(),f=async()=>{try{await z(a.id),e({title:"تم حذف الحساب بنجاح"}),b()}catch(a){e({title:"خطأ",description:a.message,variant:"destructive"})}};return(0,d.jsxs)(u.rI,{children:[(0,d.jsx)(u.ty,{asChild:!0,children:(0,d.jsx)(i.$,{variant:"ghost",size:"icon",className:"h-7 w-7 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,d.jsx)(v.A,{className:"h-4 w-4"})})}),(0,d.jsxs)(u.SQ,{align:"end",children:[(0,d.jsx)(P,{allAccounts:c,parentId:a.id,onAccountAdded:b,children:(0,d.jsxs)(u._2,{onSelect:a=>a.preventDefault(),className:"flex justify-between",children:[(0,d.jsx)("span",{children:"إضافة فرع"}),(0,d.jsx)(j.A,{className:"h-4 w-4"})]})}),(0,d.jsx)(P,{allAccounts:c,isEditing:!0,account:a,onAccountAdded:b,children:(0,d.jsxs)(u._2,{onSelect:a=>a.preventDefault(),className:"flex justify-between",children:[(0,d.jsx)("span",{children:"تعديل"}),(0,d.jsx)(w.A,{className:"h-4 w-4"})]})}),(0,d.jsx)(u.mB,{}),(0,d.jsxs)(A.Lt,{children:[(0,d.jsx)(A.tv,{asChild:!0,children:(0,d.jsxs)(u._2,{onSelect:a=>a.preventDefault(),className:"text-destructive focus:text-destructive flex justify-between",children:[(0,d.jsx)("span",{children:"حذف"}),(0,d.jsx)(x.A,{className:"h-4 w-4"})]})}),(0,d.jsxs)(A.EO,{children:[(0,d.jsxs)(A.wd,{children:[(0,d.jsx)(A.r7,{children:"هل أنت متأكد؟"}),(0,d.jsxs)(A.$v,{children:['سيتم حذف الحساب "',a.name,'" بشكل نهائي. لا يمكن حذف حساب رئيسي يحتوي على حسابات فرعية.']})]}),(0,d.jsxs)(A.ck,{children:[(0,d.jsx)(A.Zr,{children:"إلغاء"}),(0,d.jsx)(A.Rx,{onClick:f,variant:"destructive",children:"نعم، قم بالحذف"})]})]})]})]})]})}var R=c(67094),S=c(99187);let T={asset:{label:"أصل",icon:l.A,color:"text-green-600"},liability:{label:"التزام",icon:l.A,color:"text-red-600"},equity:{label:"حقوق ملكية",icon:l.A,color:"text-blue-600"},revenue:{label:"إيراد",icon:m.A,color:"text-emerald-600"},expense:{label:"مصروف",icon:n.A,color:"text-purple-600"},client:{label:"عميل",icon:o.A,color:"text-green-600"},supplier:{label:"مورد",icon:p.A,color:"text-red-600"},box:{label:"صندوق",icon:q.A,color:"text-green-600"},exchange:{label:"بورصة",icon:r.A,color:"text-green-600"}};function U({node:a,depth:b,onActionSuccess:c,allAccounts:f}){let[g,h]=(0,e.useState)(b<2),i=a.children&&a.children.length>0;a.debit,a.credit;let j=a.type?T[a.type]:null;return(0,d.jsxs)(R.Nt,{open:g,onOpenChange:h,className:"w-full",children:[(0,d.jsxs)("div",{className:"flex items-center group/node hover:bg-muted/50 rounded-md",children:[(0,d.jsx)(R.R6,{asChild:!0,children:(0,d.jsxs)("div",{className:"flex items-center gap-1 cursor-pointer select-none py-1.5 flex-grow",style:{paddingRight:`${1.25*b}rem`},children:[i?(0,d.jsx)(s.A,{className:(0,t.cn)("h-4 w-4 transition-transform",g&&"rotate-90")}):(0,d.jsx)("div",{className:"w-4"}),(0,d.jsx)("span",{className:"font-mono text-xs text-muted-foreground w-28 text-right truncate",children:a.code}),(0,d.jsx)("span",{className:"font-semibold",children:a.name}),j&&(0,d.jsxs)(S.E,{variant:"outline",className:"text-xs",children:[(0,d.jsx)(j.icon,{className:(0,t.cn)("h-3 w-3 me-1",j.color)}),j.label]})]})}),(0,d.jsx)("div",{className:"pe-2",children:(0,d.jsx)(Q,{node:a,onActionSuccess:c,allAccounts:f})})]}),i&&(0,d.jsx)(R.Ke,{children:(0,d.jsx)("div",{className:"pr-4 border-r-2 border-primary/10 mr-5 space-y-1",children:a.children.map(a=>(0,d.jsx)(U,{node:a,depth:b+1,onActionSuccess:c,allAccounts:f},a.id))})})]})}var V=c(9683),W=c(90377);let X=(a,b)=>{if(!b)return a;let c=b.toLowerCase();return a.reduce((a,d)=>{let e=d.children?X(d.children,b):[];return(d.name.toLowerCase().includes(c)||d.code.includes(c)||e.length>0)&&a.push({...d,children:e}),a},[])};function Y({accounts:a,onActionSuccess:b}){let[c,f]=(0,e.useState)(""),g=(0,e.useMemo)(()=>(0,W.H)(a),[a]),h=(0,e.useMemo)(()=>X(g,c),[g,c]);return(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsxs)("div",{className:"relative flex-grow",children:[(0,d.jsx)(V.A,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,d.jsx)(I.p,{placeholder:"بحث عن حساب بالاسم أو الكود...",value:c,onChange:a=>f(a.target.value),className:"w-full pr-10"})]}),(0,d.jsx)(P,{allAccounts:a,onAccountAdded:b,children:(0,d.jsxs)(i.$,{children:[(0,d.jsx)(j.A,{className:"w-4 h-4 ml-2"}),"إضافة حساب رئيسي"]})})]}),(0,d.jsx)("div",{className:"border rounded-md p-3 bg-card min-h-[400px]",children:0===h.length?(0,d.jsx)("div",{className:"text-center text-muted-foreground p-8",children:"لا توجد حسابات تطابق البحث."}):h.map(c=>(0,d.jsx)(U,{node:c,depth:0,onActionSuccess:b,allAccounts:a},c.id))})]})}var Z=c(86871);function $({initialAccounts:a,onAccountsUpdated:b}){let[c,l]=(0,e.useState)(a),[m,n]=(0,e.useState)(!1),{toast:o}=(0,h.dj)(),p=(0,e.useCallback)(async()=>{n(!0);try{let a=await (0,Z.S)();l(a),b?.(a),o({title:"تم تحديث شجرة الحسابات"})}catch(a){o({title:"خطأ",description:a.message,variant:"destructive"})}finally{n(!1)}},[o,b]);return(0,d.jsxs)(f.Zp,{children:[(0,d.jsxs)(f.aR,{className:"flex flex-row items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)(f.ZB,{children:"الدليل المحاسبي"}),(0,d.jsx)(f.BT,{children:"عرض وتعديل هيكل الدليل المحاسبي."})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(P,{allAccounts:c,onAccountAdded:p,children:(0,d.jsxs)(i.$,{variant:"outline",size:"sm",disabled:m,children:[(0,d.jsx)(j.A,{className:"me-2 h-4 w-4"}),"إضافة حساب"]})}),(0,d.jsxs)(i.$,{variant:"outline",size:"sm",onClick:p,disabled:m,children:[(0,d.jsx)(k.A,{className:"me-2 h-4 w-4"}),"تحديث"]})]})]}),(0,d.jsx)(f.Wu,{children:m?(0,d.jsx)(g.E,{className:"h-[400px]"}):(0,d.jsx)(Y,{accounts:c,onActionSuccess:p})})]})}},86281:(a,b,c)=>{c.d(b,{F:()=>g});var d=c(81171);let e=a=>"boolean"==typeof a?`${a}`:0===a?"0":a,f=d.$,g=(a,b)=>c=>{var d;if((null==b?void 0:b.variants)==null)return f(a,null==c?void 0:c.class,null==c?void 0:c.className);let{variants:g,defaultVariants:h}=b,i=Object.keys(g).map(a=>{let b=null==c?void 0:c[a],d=null==h?void 0:h[a];if(null===b)return null;let f=e(b)||e(d);return g[a][f]}),j=c&&Object.entries(c).reduce((a,b)=>{let[c,d]=b;return void 0===d||(a[c]=d),a},{});return f(a,i,null==b||null==(d=b.compoundVariants)?void 0:d.reduce((a,b)=>{let{class:c,className:d,...e}=b;return Object.entries(e).every(a=>{let[b,c]=a;return Array.isArray(c)?c.includes({...h,...j}[b]):({...h,...j})[b]===c})?[...a,c,d]:a},[]),null==c?void 0:c.class,null==c?void 0:c.className)}},86871:(a,b,c)=>{c.d(b,{S:()=>e});var d=c(85708);let e=(0,d.createServerReference)("7f4587568c1e868c07486b8dc08163d3dd703caa89",d.callServer,void 0,d.findSourceMapURL,"getChartOfAccounts")},87604:(a,b,c)=>{c.d(b,{A:()=>h});var d=c(74515);let e=(...a)=>a.filter((a,b,c)=>!!a&&""!==a.trim()&&c.indexOf(a)===b).join(" ").trim();var f={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let g=(0,d.forwardRef)(({color:a="currentColor",size:b=24,strokeWidth:c=2,absoluteStrokeWidth:g,className:h="",children:i,iconNode:j,...k},l)=>(0,d.createElement)("svg",{ref:l,...f,width:b,height:b,stroke:a,strokeWidth:g?24*Number(c)/Number(b):c,className:e("lucide",h),...k},[...j.map(([a,b])=>(0,d.createElement)(a,b)),...Array.isArray(i)?i:[i]])),h=(a,b)=>{let c=(0,d.forwardRef)(({className:c,...f},h)=>(0,d.createElement)(g,{ref:h,iconNode:b,className:e(`lucide-${a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,c),...f}));return c.displayName=`${a}`,c}},90023:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(8808).A)("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]])},90377:(a,b,c)=>{c.d(b,{H:()=>d});function d(a){if(!a||0===a.length)return[];let b={},c=[];a.forEach(a=>{b[a.id]={...a,children:[]}}),a.forEach(a=>{a.parentId&&b[a.parentId]?b[a.parentId].children.some(b=>b.id===a.id)||b[a.parentId].children.push(b[a.id]):c.some(b=>b.id===a.id)||c.push(b[a.id])});let d=a=>{a.forEach(a=>{a.children&&a.children.length>0&&(a.children.sort((a,b)=>a.code.localeCompare(b.code,void 0,{numeric:!0})),d(a.children))})};return c.sort((a,b)=>a.code.localeCompare(b.code,void 0,{numeric:!0})),d(c),c}},90743:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(8808).A)("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]])},93201:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{IZ:()=>n,SQ:()=>p,_m:()=>k,lw:()=>m,z0:()=>l});var e=c(75879);c(68633);var f=c(43513),g=c(74515),h=c(16780),i=c(51669),j=a([f]);f=(j.then?(await j)():j)[0];let o="chart_of_accounts",p=(0,g.cache)(async()=>{let a=await (0,f.Lf)();if(!a)return[];try{let[b,c,d,e,f,g]=await Promise.all([a.collection("chart_of_accounts").orderBy("code").get(),a.collection("clients").where("relationType","in",["client","both"]).get(),a.collection("clients").where("relationType","in",["supplier","both"]).get(),a.collection("boxes").get(),a.collection("exchanges").get(),a.collection("journal-vouchers").get()]),h={};g.forEach(a=>{let b=a.data();if(b.isDeleted)return;let c=(a,b)=>{a&&a.forEach(a=>{a.accountId&&(h[a.accountId]||(h[a.accountId]={debit:0,credit:0}),h[a.accountId][b]+=a.amount||0)})};c(b.debitEntries,"debit"),c(b.creditEntries,"credit")});let i=b.docs.map(a=>({id:a.id,...a.data(),debit:0,credit:0,children:[]})),j=[],k=(a,b,c)=>{let d=a.data(),e=h[a.id]||{debit:0,credit:0},f=i.find(a=>a.code===c);return f||console.warn(`Parent with code ${c} not found for ${d.name}.`),{id:a.id,name:d.name,code:d.code||a.id.substring(0,6),type:b,parentId:f?f.id:null,debit:e.debit,credit:e.credit,children:[],isLeaf:!0}};c.forEach(a=>j.push(k(a,"client","1-1-2-1"))),d.forEach(a=>j.push(k(a,"supplier","2-1-1-1"))),e.forEach(a=>j.push(k(a,"box","1-1-1"))),f.forEach(a=>j.push(k(a,"exchange","1-1-2-2")));let l=[...i,...j];return JSON.parse(JSON.stringify(l))}catch(a){return console.error("Error getting chart of accounts:",a),[]}});async function k(a){let b=await (0,f.Lf)();if(!b)throw Error("Database not available.");let c=b.collection(o).doc(),d={id:c.id,name:a.name,code:a.code,type:a.type,parentId:a.parentId??null,isLeaf:!0,description:a.description??"",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await c.set(d),a.parentId&&await b.collection(o).doc(a.parentId).update({isLeaf:!1,updatedAt:new Date().toISOString()}),(0,h.revalidatePath)("/settings/accounting/chart-of-accounts"),{...d,children:[]}}async function l(a,b){let c=await (0,f.Lf)();if(!c)throw Error("Database not available.");let{children:d,debit:e,credit:g,...i}=b;return await c.collection(o).doc(a).update({...i,updatedAt:new Date().toISOString()}),(0,h.revalidatePath)("/settings/accounting/chart-of-accounts"),{success:!0}}async function m(a){let b=await (0,f.Lf)();if(!b)throw Error("Database not available.");if(!(await b.collection(o).where("parentId","==",a).get()).empty)throw Error("لا يمكن حذف حساب رئيسي يحتوي على حسابات فرعية.");return await b.collection(o).doc(a).delete(),(0,h.revalidatePath)("/settings/accounting/chart-of-accounts"),{success:!0}}async function n(a){let b=await (0,f.Lf)();if(!b)throw Error("Database not available.");if(a&&"root"!==a){let c=await b.collection(o).doc(a).get();if(!c.exists)throw Error("Parent account not found.");let d=c.data()?.code,e=await b.collection(o).where("parentId","==",a).get();if(e.empty)return`${d}-1`;let f=e.docs.map(a=>a.data().code).map(a=>{let b=a.split("-");return b.length>1?parseInt(b.pop()||"0",10):0}).filter(a=>!isNaN(a)),g=f.length>0?Math.max(...f):0;return`${d}-${g+1}`}{let a=await b.collection(o).where("parentId","==",null).get();if(a.empty)return"1";let c=a.docs.map(a=>parseInt(a.data().code,10)).filter(a=>!isNaN(a)),d=c.length>0?Math.max(...c):0;return String(d+1)}}(0,i.D)([p,k,l,m,n]),(0,e.A)(p,"7f4587568c1e868c07486b8dc08163d3dd703caa89",null),(0,e.A)(k,"4018add885423f0f5eb9894fc318abfad4e8b1fada",null),(0,e.A)(l,"601ddb4a17d4e0bdb19f2a232ffc3a6c9ea6194cac",null),(0,e.A)(m,"40242c751622e84910e790a1742420d90078e94a9c",null),(0,e.A)(n,"406fd1b263f26f83be7d1611e64b70584dc60ef87e",null),d()}catch(a){d(a)}})}};