"use strict";exports.id=1842,exports.ids=[1842],exports.modules={25307:(a,b,c)=>{c.d(b,{B:()=>e});var d=c(85708);let e=(0,d.createServerReference)("40ca4bf9958b6d1d26e411af5f72ad73b881d7ffc2",d.callServer,void 0,d.findSourceMapURL,"addBooking")},52588:(a,b,c)=>{c.d(b,{t:()=>d});let d=[{code:"JFK",name:"John F. Kennedy International Airport",city:"New York",country:"USA",arabicName:"نيويورك",arabicCountry:"الولايات المتحدة",useCount:10},{code:"LAX",name:"Los Angeles International Airport",city:"Los Angeles",country:"USA",arabicName:"لوس أنجلوس",arabicCountry:"الولايات المتحدة",useCount:5},{code:"LHR",name:"Heathrow Airport",city:"London",country:"United Kingdom",arabicName:"لندن",arabicCountry:"المملكة المتحدة",useCount:15},{code:"CDG",name:"Charles de Gaulle Airport",city:"Paris",country:"France",arabicName:"باريس",arabicCountry:"فرنسا",useCount:8},{code:"HND",name:"Haneda Airport",city:"Tokyo",country:"Japan",arabicName:"طوكيو",arabicCountry:"اليابان"},{code:"DXB",name:"Dubai International Airport",city:"Dubai",country:"UAE",arabicName:"دبي",arabicCountry:"الإمارات",useCount:30},{code:"AMS",name:"Amsterdam Airport Schiphol",city:"Amsterdam",country:"Netherlands",arabicName:"أمستردام",arabicCountry:"هولندا"},{code:"FRA",name:"Frankfurt Airport",city:"Frankfurt",country:"Germany",arabicName:"فرانكفورت",arabicCountry:"ألمانيا"},{code:"IST",name:"Istanbul Airport",city:"Istanbul",country:"Turkey",arabicName:"اسطنبول",arabicCountry:"تركيا",useCount:25},{code:"SAW",name:"Sabiha Gokcen International Airport",city:"Istanbul",country:"Turkey",arabicName:"اسطنبول - صبيحة",arabicCountry:"تركيا",useCount:20},{code:"ESB",name:"Esenboğa International Airport",city:"Ankara",country:"Turkey",arabicName:"أنقرة",arabicCountry:"تركيا"},{code:"BGW",name:"Baghdad International Airport",city:"Baghdad",country:"Iraq",arabicName:"بغداد",arabicCountry:"العراق",useCount:50},{code:"NJF",name:"Al Najaf International Airport",city:"Najaf",country:"Iraq",arabicName:"النجف",arabicCountry:"العراق",useCount:45},{code:"EBL",name:"Erbil International Airport",city:"Erbil",country:"Iraq",arabicName:"أربيل",arabicCountry:"العراق",useCount:20},{code:"BSR",name:"Basra International Airport",city:"Basra",country:"Iraq",arabicName:"البصرة",arabicCountry:"العراق",useCount:18},{code:"ISU",name:"Sulaimaniyah International Airport",city:"Sulaimaniyah",country:"Iraq",arabicName:"السليمانية",arabicCountry:"العراق",useCount:15},{code:"CAI",name:"Cairo International Airport",city:"Cairo",country:"Egypt",arabicName:"القاهرة",arabicCountry:"مصر",useCount:12},{code:"BEY",name:"Beirut-Rafic Hariri International Airport",city:"Beirut",country:"Lebanon",arabicName:"بيروت",arabicCountry:"لبنان",useCount:18},{code:"AMM",name:"Queen Alia International Airport",city:"Amman",country:"Jordan",arabicName:"عمان",arabicCountry:"الأردن",useCount:9},{code:"RUH",name:"King Khalid International Airport",city:"Riyadh",country:"Saudi Arabia",arabicName:"الرياض",arabicCountry:"السعودية"},{code:"JED",name:"King Abdulaziz International Airport",city:"Jeddah",country:"Saudi Arabia",arabicName:"جدة",arabicCountry:"السعودية"},{code:"KWI",name:"Kuwait International Airport",city:"Kuwait City",country:"Kuwait",arabicName:"الكويت",arabicCountry:"الكويت"},{code:"DOH",name:"Hamad International Airport",city:"Doha",country:"Qatar",arabicName:"الدوحة",arabicCountry:"قطر"},{code:"DAM",name:"Damascus International Airport",city:"Damascus",country:"Syria",arabicName:"دمشق",arabicCountry:"سوريا"},{code:"ALP",name:"Aleppo International Airport",city:"Aleppo",country:"Syria",arabicName:"حلب",arabicCountry:"سوريا"},{code:"THR",name:"Mehrabad International Airport",city:"Tehran",country:"Iran",arabicName:"طهران",arabicCountry:"إيران",useCount:22},{code:"IKA",name:"Imam Khomeini International Airport",city:"Tehran",country:"Iran",arabicName:"طهران - الإمام الخميني",arabicCountry:"إيران",useCount:19},{code:"MHD",name:"Mashhad International Airport",city:"Mashhad",country:"Iran",arabicName:"مشهد",arabicCountry:"إيران",useCount:16},{code:"SYZ",name:"Shiraz International Airport",city:"Shiraz",country:"Iran",arabicName:"شيراز",arabicCountry:"إيران"},{code:"KUL",name:"Kuala Lumpur International Airport",city:"Kuala Lumpur",country:"Malaysia",arabicName:"كوالالمبور",arabicCountry:"ماليزيا"},{code:"BKK",name:"Suvarnabhumi Airport",city:"Bangkok",country:"Thailand",arabicName:"بانكوك",arabicCountry:"تايلاند"},{code:"SIN",name:"Singapore Changi Airport",city:"Singapore",country:"Singapore",arabicName:"سنغافورة",arabicCountry:"سنغافورة"},{code:"DEL",name:"Indira Gandhi International Airport",city:"Delhi",country:"India",arabicName:"دلهي",arabicCountry:"الهند"},{code:"BOM",name:"Chhatrapati Shivaji Maharaj International Airport",city:"Mumbai",country:"India",arabicName:"مومباي",arabicCountry:"الهند"},{code:"AUH",name:"Abu Dhabi International Airport",city:"Abu Dhabi",country:"UAE",arabicName:"أبو ظبي",arabicCountry:"الإمارات"},{code:"SHJ",name:"Sharjah International Airport",city:"Sharjah",country:"UAE",arabicName:"الشارقة",arabicCountry:"الإمارات"},{code:"MCT",name:"Muscat International Airport",city:"Muscat",country:"Oman",arabicName:"مسقط",arabicCountry:"عمان"},{code:"BAH",name:"Bahrain International Airport",city:"Manama",country:"Bahrain",arabicName:"البحرين",arabicCountry:"البحرين"},{code:"PEK",name:"Beijing Capital International Airport",city:"Beijing",country:"China",arabicName:"بكين",arabicCountry:"الصين"},{code:"PVG",name:"Shanghai Pudong International Airport",city:"Shanghai",country:"China",arabicName:"شنغهاي",arabicCountry:"الصين"},{code:"CAN",name:"Guangzhou Baiyun International Airport",city:"Guangzhou",country:"China",arabicName:"قوانغتشو",arabicCountry:"الصين"},{code:"SYD",name:"Sydney Kingsford Smith Airport",city:"Sydney",country:"Australia",arabicName:"سيدني",arabicCountry:"أستراليا"},{code:"MEL",name:"Melbourne Airport",city:"Melbourne",country:"Australia",arabicName:"ملبورن",arabicCountry:"أستراليا"},{code:"YYZ",name:"Toronto Pearson International Airport",city:"Toronto",country:"Canada",arabicName:"تورونتو",arabicCountry:"كندا"},{code:"YVR",name:"Vancouver International Airport",city:"Vancouver",country:"Canada",arabicName:"فانكوفر",arabicCountry:"كندا"},{code:"GRU",name:"S\xe3o Paulo/Guarulhos International Airport",city:"S\xe3o Paulo",country:"Brazil",arabicName:"ساو باولو",arabicCountry:"البرازيل"},{code:"MEX",name:"Mexico City International Airport",city:"Mexico City",country:"Mexico",arabicName:"مكسيكو سيتي",arabicCountry:"المكسيك"},{code:"SVO",name:"Sheremetyevo International Airport",city:"Moscow",country:"Russia",arabicName:"موسكو - شيريميتييفو",arabicCountry:"روسيا"},{code:"DME",name:"Domodedovo International Airport",city:"Moscow",country:"Russia",arabicName:"موسكو - دوموديدوفو",arabicCountry:"روسيا"},{code:"BCN",name:"Barcelona–El Prat Airport",city:"Barcelona",country:"Spain",arabicName:"برشلونة",arabicCountry:"إسبانيا"},{code:"MAD",name:"Adolfo Su\xe1rez Madrid–Barajas Airport",city:"Madrid",country:"Spain",arabicName:"مدريد",arabicCountry:"إسبانيا"},{code:"FCO",name:"Leonardo da Vinci–Fiumicino Airport",city:"Rome",country:"Italy",arabicName:"روما",arabicCountry:"إيطاليا"},{code:"MXP",name:"Milan Malpensa Airport",city:"Milan",country:"Italy",arabicName:"ميلانو",arabicCountry:"إيطاليا"},{code:"ATH",name:"Athens International Airport",city:"Athens",country:"Greece",arabicName:"أثينا",arabicCountry:"اليونان"},{code:"LIS",name:"Lisbon Airport",city:"Lisbon",country:"Portugal",arabicName:"لشبونة",arabicCountry:"البرتغال"},{code:"CPH",name:"Copenhagen Airport",city:"Copenhagen",country:"Denmark",arabicName:"كوبنهاغن",arabicCountry:"الدنمارك"},{code:"OSL",name:"Oslo Airport, Gardermoen",city:"Oslo",country:"Norway",arabicName:"أوسلو",arabicCountry:"النرويج"},{code:"ARN",name:"Stockholm Arlanda Airport",city:"Stockholm",country:"Sweden",arabicName:"ستوكهولم",arabicCountry:"السويد"},{code:"HEL",name:"Helsinki-Vantaa Airport",city:"Helsinki",country:"Finland",arabicName:"هلسنكي",arabicCountry:"فنلندا"},{code:"VIE",name:"Vienna International Airport",city:"Vienna",country:"Austria",arabicName:"فيينا",arabicCountry:"النمسا"},{code:"ZRH",name:"Zurich Airport",city:"Zurich",country:"Switzerland",arabicName:"زيورخ",arabicCountry:"سويسرا"},{code:"GVA",name:"Geneva Airport",city:"Geneva",country:"Switzerland",arabicName:"جنيف",arabicCountry:"سويسرا"},{code:"BRU",name:"Brussels Airport",city:"Brussels",country:"Belgium",arabicName:"بروكسل",arabicCountry:"بلجيكا"},{code:"DUB",name:"Dublin Airport",city:"Dublin",country:"Ireland",arabicName:"دبلن",arabicCountry:"أيرلندا"},{code:"PRG",name:"V\xe1clav Havel Airport Prague",city:"Prague",country:"Czech Republic",arabicName:"براغ",arabicCountry:"جمهورية التشيك"},{code:"BUD",name:"Budapest Ferenc Liszt International Airport",city:"Budapest",country:"Hungary",arabicName:"بودابست",arabicCountry:"المجر"},{code:"WAW",name:"Warsaw Chopin Airport",city:"Warsaw",country:"Poland",arabicName:"وارسو",arabicCountry:"بولندا"},{code:"KBP",name:"Boryspil International Airport",city:"Kyiv",country:"Ukraine",arabicName:"كييف",arabicCountry:"أوكرانيا"},{code:"OTP",name:"Henri Coandă International Airport",city:"Bucharest",country:"Romania",arabicName:"بوخارست",arabicCountry:"رومانيا"}]},71195:(a,b,c)=>{c.d(b,{x:()=>e});var d=c(85708);let e=(0,d.createServerReference)("40d0a9025cfae5e19ff9bfb1d8c43204722c4febb5",d.callServer,void 0,d.findSourceMapURL,"findBookingByRef")},91842:(a,b,c)=>{c.d(b,{A:()=>ad});var d=c(21124),e=c(38301),f=c.n(e),g=c(35284),h=c(40068),i=c(90447),j=c(22741),k=c(22874),l=c(49113),m=c(31980),n=c(50937),o=c(99546),p=c(93758),q=c(45608),r=c(79202),s=c(64698),t=c(62777),u=c(92283),v=c(92080),w=c(81166),x=c(66782),y=c(10656),z=c(49566),A=c(27810),B=c(40822),C=c(54163),D=c(9683),E=c(85708);let F=(0,E.createServerReference)("60186e37473393f3008b2a76484829f65c2825bc22",E.callServer,void 0,E.findSourceMapURL,"updateBooking");var G=c(25307),H=c(71195),I=c(44943),J=c(63822),K=c(37448),L=c(21853),M=c(5488),N=c(25456),O=c(97802),P=c(63009),Q=c(27186),R=c(12439),S=c(52588),T=c(68254),U=c(74053),V=c(68120);let W=({title:a,children:b,className:c})=>(0,d.jsxs)("div",{className:(0,I.cn)("relative p-4 border rounded-lg mt-6",c),children:[(0,d.jsx)("h3",{className:"absolute -top-3 right-4 bg-background px-2 text-base font-bold text-primary",children:a}),b]}),X=o.Ik({id:o.Yj().optional(),name:o.Yj().min(1,"الاسم مطلوب"),passportNumber:o.Yj().optional(),ticketNumber:o.Yj().min(1,"رقم التذكرة مطلوب"),purchasePrice:o.au.number().min(0,"سعر الشراء يجب أن يكون 0 أو أكثر.").default(0),clientStatement:o.Yj().optional(),salePrice:o.au.number().min(0,"سعر البيع يجب أن يكون 0 أو أكثر.").default(0),passengerType:o.k5(["Adult","Child","Infant"]),ticketType:o.k5(["Issue","Change","Refund","Void"]).default("Issue")}),Y=o.Ik({pnr:o.Yj().min(1,"PNR مطلوب"),vl:o.Yj().optional(),supplierId:o.Yj().min(1,"المورد مطلوب"),clientId:o.Yj().min(1,"العميل مطلوب"),travelDate:o.p6({required_error:"تاريخ السفر مطلوب"}),issueDate:o.p6({required_error:"تاريخ الإصدار مطلوب"}),boxId:o.Yj().optional(),currency:o.k5(["USD","IQD"]),passengers:o.YO(X).min(1,"يجب إضافة مسافر واحد على الأقل"),route1:o.Yj().optional(),route2:o.Yj().optional(),route3:o.Yj().optional(),route4:o.Yj().optional(),carrier:o.Yj().optional(),discountType:o.k5(["percentage","fixed"]).optional(),discountValue:o.au.number().optional(),notes:o.Yj().optional()}),Z=[{value:"Adult",label:"بالغ",icon:s.A},{value:"Child",label:"طفل",icon:t.A},{value:"Infant",label:"رضيع",icon:u.A}],$=S.t.map(a=>({value:a.code,label:`${a.arabicName} (${a.code})`}));function _({onBookingAdded:a,isEditing:b,initialData:c,onBookingUpdated:h}){let[i,j]=(0,e.useState)(2),{toast:k}=(0,K.dj)(),{data:o,loaded:s}=(0,O.Z)(),{user:t}=(0,P.A)(),[u,E]=(0,e.useState)(null),[I,S]=(0,e.useState)([]),X=(0,m.mN)({resolver:(0,n.u)(Y),defaultValues:b?c:{pnr:"",supplierId:"",clientId:"",currency:"USD",issueDate:new Date,travelDate:new Date,passengers:[{name:"",passportNumber:"",ticketNumber:"",purchasePrice:0,clientStatement:"",salePrice:0,passengerType:"Adult",ticketType:"Issue"}]}}),{control:_,handleSubmit:aa,formState:{errors:ab,isSubmitting:ac},setValue:ad,watch:ae,getValues:af,register:ag}=X,{fields:ah,append:ai,remove:aj}=(0,m.jz)({control:_,name:"passengers"});f().useMemo(()=>{let a=ae("boxId");return o?.boxes?.find(b=>b.id===a)?.name||"غير محدد"},[ae,o?.boxes]);let ak=ae("passengers").reduce((a,b)=>a+(Number(b.purchasePrice)||0),0),al=ae("passengers").reduce((a,b)=>a+(Number(b.salePrice)||0),0),am=al-ak,an=async d=>{let e=k({title:"جاري إضافة الحجز..."});try{let f=[d.route1,d.route2,d.route3,d.route4].filter(Boolean).join(" - "),g={...d,route:f,travelDate:d.travelDate.toISOString(),issueDate:d.issueDate.toISOString()},i=b?await F(c.id,g):await (0,G.B)(g);if(i.success&&(i.newBooking||i.updatedBooking))e.update({id:e.id,title:`تم ${b?"تحديث":"إضافة"} الحجز بنجاح`}),a&&i.newBooking&&a(i.newBooking),h&&i.updatedBooking&&h(i.updatedBooking),X.reset();else throw Error(i.error)}catch(a){e.update({id:e.id,title:"خطأ",description:a.message,variant:"destructive"})}},ao=async a=>{if(!b){let b=await (0,H.x)(a.pnr);if(b&&b.length>0)return void E(b[0])}await an(a)},ap=(a,b,c)=>{let d=[...I];d[a][b]=c,S(d)};return s?(0,d.jsxs)(Q.lV,{...X,children:[(0,d.jsx)(R.Lt,{open:!!u,onOpenChange:a=>!a&&E(null),children:(0,d.jsxs)(R.EO,{children:[(0,d.jsxs)(R.wd,{children:[(0,d.jsxs)(R.r7,{className:"flex items-center gap-2",children:[(0,d.jsx)(v.A,{className:"h-6 w-6 text-yellow-500"})," تنبيه: PNR مكرر"]}),(0,d.jsx)(R.$v,{children:"رقم الحجز (PNR) الذي أدخلته موجود بالفعل في النظام. هل أنت متأكد أنك تريد المتابعة وإنشاء حجز جديد بنفس الرقم؟"})]}),(0,d.jsxs)("div",{className:"p-4 bg-muted/50 rounded-lg text-sm",children:[(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"PNR:"})," ",u?.pnr]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"تاريخ الإصدار الأصلي:"})," ",u?.issueDate?(0,J.GP)(new Date(u.issueDate),"yyyy-MM-dd"):"N/A"]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"أدخل بواسطة:"})," ",u?.enteredBy]})]}),(0,d.jsxs)(R.ck,{children:[(0,d.jsx)(R.Zr,{onClick:()=>E(null),children:"لا، إلغاء"}),(0,d.jsx)(R.Rx,{onClick:()=>{E(null),an(af())},children:"نعم، متابعة على أي حال"})]})]})}),(0,d.jsxs)("form",{onSubmit:X.handleSubmit(ao),className:"h-full flex flex-row-reverse bg-background text-sm",children:[(0,d.jsxs)("main",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,d.jsxs)("div",{className:"flex-grow p-2 space-y-4 overflow-y-auto",children:[(0,d.jsxs)("div",{className:"grid grid-cols-12 gap-4",children:[(0,d.jsxs)("div",{className:"col-span-6 space-y-4",children:[(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(V.J,{children:"تاريخ الاصدار"}),(0,d.jsx)(M.K,{date:ae("issueDate"),setDate:a=>ad("issueDate",a)})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(V.J,{children:"تاريخ السفر"}),(0,d.jsx)(M.K,{date:ae("travelDate"),setDate:a=>ad("travelDate",a)})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,d.jsx)(W,{title:"المورد",children:(0,d.jsxs)("div",{className:"space-y-2 text-right",children:[(0,d.jsxs)("div",{className:"grid grid-cols-[80px,1fr] items-center gap-2",children:[(0,d.jsx)(V.J,{children:"حساب المورد"}),(0,d.jsx)(m.xI,{name:"supplierId",control:_,render:({field:a})=>(0,d.jsx)(L.j,{searchAction:"suppliers",value:a.value,onValueChange:a.onChange,placeholder:"ابحث عن مورد..."})})]}),(0,d.jsxs)("div",{className:"grid grid-cols-[80px,1fr] items-center gap-2",children:[(0,d.jsx)(V.J,{children:"الدفع"}),(0,d.jsxs)(q.l6,{children:[(0,d.jsx)(q.bq,{className:"h-7",children:(0,d.jsx)(q.yv,{placeholder:"آجل"})}),(0,d.jsxs)(q.gC,{children:[(0,d.jsx)(q.eb,{value:"Debit",children:"آجل"}),(0,d.jsx)(q.eb,{value:"Cash",children:"نقدي"})]})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-[80px,1fr] items-center gap-2",children:[(0,d.jsx)(V.J,{children:"العملة"}),(0,d.jsx)(m.xI,{name:"currency",control:_,render:({field:a})=>(0,d.jsxs)(q.l6,{onValueChange:a.onChange,value:a.value,children:[(0,d.jsx)(q.bq,{className:"h-7",children:(0,d.jsx)(q.yv,{})}),(0,d.jsxs)(q.gC,{children:[(0,d.jsx)(q.eb,{value:"USD",children:"USD"}),(0,d.jsx)(q.eb,{value:"IQD",children:"IQD"})]})]})})]})]})}),(0,d.jsx)(W,{title:"العميل",children:(0,d.jsxs)("div",{className:"space-y-2 text-right",children:[(0,d.jsxs)("div",{className:"grid grid-cols-[80px,1fr] items-center gap-2",children:[(0,d.jsx)(V.J,{children:"العميل"}),(0,d.jsx)(m.xI,{name:"clientId",control:_,render:({field:a})=>(0,d.jsx)(L.j,{searchAction:"clients",value:a.value,onValueChange:a.onChange,placeholder:"ابحث عن عميل..."})})]}),(0,d.jsxs)("div",{className:"grid grid-cols-[80px,1fr] items-center gap-2",children:[(0,d.jsx)(V.J,{children:"الدفع"}),(0,d.jsxs)(q.l6,{children:[(0,d.jsx)(q.bq,{className:"h-7",children:(0,d.jsx)(q.yv,{placeholder:"نقدي"})}),(0,d.jsxs)(q.gC,{children:[(0,d.jsx)(q.eb,{value:"Cash",children:"نقدي"}),(0,d.jsx)(q.eb,{value:"Debit",children:"آجل"})]})]})]})]})})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,d.jsx)(W,{title:"الخصم والناقل",children:(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsx)(Q.zB,{control:_,name:"discountValue",render:({field:a})=>(0,d.jsxs)(Q.eI,{children:[(0,d.jsx)(Q.lR,{children:"قيمة الخصم"}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(Q.MJ,{children:(0,d.jsx)(p.p,{className:"h-8",type:"number",placeholder:"قيمة الخصم",...a})}),(0,d.jsx)(m.xI,{name:"discountType",control:_,render:({field:a})=>(0,d.jsxs)(U.z,{value:a.value,onValueChange:a.onChange,className:"flex items-center border rounded-md p-1",children:[(0,d.jsxs)(Q.eI,{className:"flex items-center space-x-2 space-x-reverse",children:[(0,d.jsx)(Q.MJ,{children:(0,d.jsx)(U.C,{value:"percentage",id:"r-percent"})}),(0,d.jsx)(V.J,{htmlFor:"r-percent",children:"نسبة %"})]}),(0,d.jsxs)(Q.eI,{className:"flex items-center space-x-2 space-x-reverse",children:[(0,d.jsx)(Q.MJ,{children:(0,d.jsx)(U.C,{value:"fixed",id:"r-fixed"})}),(0,d.jsx)(V.J,{htmlFor:"r-fixed",children:"مبلغ $"})]})]})})]}),(0,d.jsx)(Q.C5,{})]})}),(0,d.jsx)(Q.zB,{control:_,name:"carrier",render:({field:a})=>(0,d.jsxs)(Q.eI,{children:[(0,d.jsx)(Q.lR,{children:"الناقل"}),(0,d.jsx)(Q.MJ,{children:(0,d.jsx)(L.j,{options:$,placeholder:"اختر الناقل...",...a})})]})})]})}),(0,d.jsxs)(W,{title:"بيانات الحجز",children:[(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4 p-2",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(V.J,{children:"PNR"}),(0,d.jsx)(p.p,{className:"h-7",placeholder:"***",...ag("pnr")})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(V.J,{children:"V.L"}),(0,d.jsx)(p.p,{className:"h-7",placeholder:"***",...ag("vl")})]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-1 mt-2 p-2",children:[(0,d.jsx)(w.A,{className:"h-5 w-5 text-muted-foreground"}),Array.from({length:i}).map((a,b)=>(0,d.jsxs)(f().Fragment,{children:[b>0&&(0,d.jsx)(x.A,{className:"h-5 w-5 text-muted-foreground shrink-0"}),(0,d.jsx)(m.xI,{name:`route${b+1}`,control:_,render:({field:a})=>(0,d.jsx)(L.j,{options:$,...a,placeholder:"..."})})]},b)),i<4&&(0,d.jsx)(g.$,{type:"button",variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>j(a=>a+1),children:(0,d.jsx)(y.A,{className:"h-4 w-4"})})]})]})]})]}),(0,d.jsxs)("div",{className:"col-span-6 space-y-4",children:[(0,d.jsx)(W,{title:"الأسماء",children:(0,d.jsx)("div",{className:"p-2",children:(0,d.jsxs)(r.XI,{children:[(0,d.jsx)(r.A0,{children:(0,d.jsxs)(r.Hj,{className:"bg-primary/10 hover:bg-primary/20",children:[(0,d.jsx)(r.nd,{className:"p-1 text-xs font-semibold text-right",children:"المسافر"}),(0,d.jsx)(r.nd,{className:"p-1 text-xs font-semibold text-right",children:"التذكرة"}),(0,d.jsx)(r.nd,{className:"p-1 text-xs font-semibold text-right",children:"النوع"}),(0,d.jsx)(r.nd,{className:"p-1 text-xs font-semibold text-right",children:"شراء"}),(0,d.jsx)(r.nd,{className:"p-1 text-xs font-semibold text-right",children:"بيع"})]})}),(0,d.jsx)(r.BF,{children:ah.map((a,b)=>(0,d.jsxs)(r.Hj,{children:[(0,d.jsx)(r.nA,{className:"p-0",children:(0,d.jsx)(p.p,{className:"border-0 rounded-none h-7",placeholder:"اسم المسافر",...ag(`passengers.${b}.name`)})}),(0,d.jsx)(r.nA,{className:"p-0",children:(0,d.jsx)(p.p,{className:"border-0 rounded-none h-7",placeholder:"رقم التذكرة",...ag(`passengers.${b}.ticketNumber`)})}),(0,d.jsx)(r.nA,{className:"p-0",children:(0,d.jsx)(m.xI,{control:_,name:`passengers.${b}.passengerType`,render:({field:a})=>(0,d.jsxs)(q.l6,{onValueChange:a.onChange,value:a.value,children:[(0,d.jsx)(q.bq,{className:"border-0 rounded-none h-7",children:(0,d.jsx)(q.yv,{})}),(0,d.jsx)(q.gC,{children:Z.map(a=>{let b=a.icon;return(0,d.jsx)(q.eb,{value:a.value,children:(0,d.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,d.jsx)("span",{children:a.label}),(0,d.jsx)(b,{className:"h-4 w-4"})]})},a.value)})})]})})}),(0,d.jsx)(r.nA,{className:"p-0",children:(0,d.jsx)(N.O,{className:"border-0 rounded-none h-7",placeholder:"شراء",...ag(`passengers.${b}.purchasePrice`)})}),(0,d.jsx)(r.nA,{className:"p-0",children:(0,d.jsx)(N.O,{className:"border-0 rounded-none h-7",placeholder:"بيع",...ag(`passengers.${b}.salePrice`)})})]},a.id))})]})})}),(0,d.jsx)(W,{title:"الملاحظات",children:(0,d.jsx)(m.xI,{name:"notes",control:_,render:({field:a})=>(0,d.jsx)(T.T,{...a})})})]})]}),(0,d.jsxs)(W,{title:"تسعير أنواع التذاكر",children:[(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)(r.XI,{children:[(0,d.jsx)(r.A0,{children:(0,d.jsxs)(r.Hj,{children:[(0,d.jsx)(r.nd,{children:"النوع"}),(0,d.jsx)(r.nd,{children:"Fare"}),(0,d.jsx)(r.nd,{children:"%"}),(0,d.jsx)(r.nd,{children:"Tax1"}),(0,d.jsx)(r.nd,{children:"Tax2"}),(0,d.jsx)(r.nd,{children:"Sale"}),(0,d.jsx)(r.nd,{children:"Charge"}),(0,d.jsx)(r.nd,{children:"Total"}),(0,d.jsx)(r.nd,{children:"ADD TK"})]})}),(0,d.jsx)(r.BF,{children:I.map((a,b)=>(0,d.jsxs)(r.Hj,{children:[(0,d.jsx)(r.nA,{className:"p-1",children:(0,d.jsxs)(q.l6,{value:a.ticketType,onValueChange:a=>ap(b,"ticketType",a),children:[(0,d.jsx)(q.bq,{className:"h-8",children:(0,d.jsx)(q.yv,{})}),(0,d.jsxs)(q.gC,{children:[(0,d.jsx)(q.eb,{value:"Adult",children:"Adult"}),(0,d.jsx)(q.eb,{value:"Child",children:"Child"}),(0,d.jsx)(q.eb,{value:"Infant",children:"Infant"})]})]})}),(0,d.jsx)(r.nA,{className:"p-1",children:(0,d.jsx)(N.O,{className:"h-8",value:a.fareBuy,onValueChange:a=>ap(b,"fareBuy",a)})}),(0,d.jsx)(r.nA,{className:"p-1",children:(0,d.jsx)(N.O,{className:"h-8",value:a.percentage,onValueChange:a=>ap(b,"percentage",a)})}),(0,d.jsx)(r.nA,{className:"p-1",children:(0,d.jsx)(N.O,{className:"h-8",value:a.tax1,onValueChange:a=>ap(b,"tax1",a)})}),(0,d.jsx)(r.nA,{className:"p-1",children:(0,d.jsx)(N.O,{className:"h-8",value:a.tax2,onValueChange:a=>ap(b,"tax2",a)})}),(0,d.jsx)(r.nA,{className:"p-1",children:(0,d.jsx)(N.O,{className:"h-8",value:a.sale,onValueChange:a=>ap(b,"sale",a)})}),(0,d.jsx)(r.nA,{className:"p-1",children:(0,d.jsx)(N.O,{className:"h-8",value:a.charge,onValueChange:a=>ap(b,"charge",a)})}),(0,d.jsx)(r.nA,{className:"p-1",children:(0,d.jsx)(N.O,{className:"h-8",value:a.total,onValueChange:a=>ap(b,"total",a)})}),(0,d.jsx)(r.nA,{className:"p-1",children:(0,d.jsx)(g.$,{size:"sm",onClick:()=>(a=>{let b=af("passengers"),c=a.fareBuy+a.tax1+a.tax2+a.charge,d=a.sale;ad("passengers",b.map(b=>b.passengerType===a.ticketType?{...b,purchasePrice:c,salePrice:d}:b),{shouldValidate:!0,shouldDirty:!0}),k({title:`تم تطبيق تسعيرة ${a.ticketType}`})})(a),children:"ADD"})})]},a.id))})]})}),(0,d.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,d.jsxs)("div",{className:"p-4 border rounded-lg bg-background shadow-sm",children:[(0,d.jsx)("h4",{className:"font-bold text-lg",children:"ملخص التسعير"}),(0,d.jsxs)("div",{className:"flex gap-4 font-bold text-center mt-2",children:[(0,d.jsxs)("div",{className:"p-2 rounded-md",children:["إجمالي الشراء: ",(0,d.jsx)("span",{className:"text-red-600",children:ak.toFixed(2)})]}),(0,d.jsxs)("div",{className:"p-2 rounded-md",children:["إجمالي البيع: ",(0,d.jsx)("span",{className:"text-green-600",children:al.toFixed(2)})]}),(0,d.jsxs)("div",{className:"p-2 rounded-md",children:["الربح: ",(0,d.jsx)("span",{className:"text-blue-600",children:am.toFixed(2)})]})]})]}),(0,d.jsx)(g.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{S(a=>[...a,{id:Date.now(),ticketType:"Adult",fareBuy:0,tax1:0,tax2:0,sale:0,charge:0,percentage:0,total:0}])},children:"إضافة نوع تسعير"})]})]})]}),(0,d.jsxs)("footer",{className:"p-2 border-t flex items-center justify-between bg-gray-100 dark:bg-gray-800 text-xs mt-auto",children:[(0,d.jsxs)("div",{className:"flex items-center gap-4",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(V.J,{children:"الصندوق"}),(0,d.jsxs)(q.l6,{children:[(0,d.jsx)(q.bq,{className:"h-7 w-32",children:(0,d.jsx)(q.yv,{placeholder:"اختر صندوق..."})}),(0,d.jsx)(q.gC,{children:o?.boxes?.map(a=>(0,d.jsx)(q.eb,{value:a.id,children:a.name},a.id))})]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(V.J,{children:"موظف الاصدار"}),(0,d.jsxs)(q.l6,{children:[(0,d.jsx)(q.bq,{className:"h-7 w-32",children:(0,d.jsx)(q.yv,{placeholder:"اختر موظف..."})}),(0,d.jsx)(q.gC,{children:o?.users?.map(a=>(0,d.jsx)(q.eb,{value:a.uid,children:a.name},a.uid))})]})]})]}),(0,d.jsx)("div",{className:"flex-grow"}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsxs)("p",{children:["المستخدم الحالي (",t?.name,")"]}),(0,d.jsxs)("p",{children:["الرقم العام: ",(0,d.jsx)("span",{className:"font-bold",children:"(تلقائي)"})]})]})]})]}),(0,d.jsxs)("aside",{dir:"ltr",className:"w-16 bg-muted/50 border-r flex flex-col items-center py-3 gap-2",children:[(0,d.jsx)(g.$,{type:"button",variant:"ghost",size:"icon",className:"h-10 w-10 text-primary hover:bg-primary/10",onClick:()=>ai({name:"",ticketNumber:"",passengerType:"Adult",purchasePrice:0,salePrice:0,clientStatement:""}),children:(0,d.jsx)(y.A,{className:"h-5 w-5"})}),(0,d.jsx)(g.$,{type:"submit",variant:"ghost",size:"icon",className:"h-10 w-10 text-primary hover:bg-primary/10",disabled:ac,children:ac?(0,d.jsx)(l.A,{className:"h-5 w-5 animate-spin"}):(0,d.jsx)(z.A,{className:"h-5 w-5"})}),(0,d.jsx)(g.$,{type:"button",variant:"ghost",size:"icon",className:"h-10 w-10",children:(0,d.jsx)(A.A,{className:"h-5 w-5"})}),(0,d.jsx)(g.$,{type:"button",variant:"ghost",size:"icon",className:"h-10 w-10 text-destructive hover:bg-destructive/10",onClick:()=>ah.length>1&&aj(ah.length-1),children:(0,d.jsx)(B.A,{className:"h-5 w-5"})}),(0,d.jsx)(g.$,{type:"button",variant:"ghost",size:"icon",className:"h-10 w-10",children:(0,d.jsx)(C.A,{className:"h-5 w-5"})}),(0,d.jsx)(g.$,{type:"button",variant:"ghost",size:"icon",className:"h-10 w-10",children:(0,d.jsx)(D.A,{className:"h-5 w-5"})})]})]})]}):(0,d.jsx)("div",{className:"relative pt-4",children:(0,d.jsx)("div",{className:"pt-6 flex justify-center items-center h-48",children:(0,d.jsx)(l.A,{className:"h-8 w-8 animate-spin"})})})}var aa=c(77837),ab=c(29303),ac=c(25054);function ad({onBookingAdded:a,onBookingUpdated:b,isEditing:c=!1,booking:f,children:m}){let[n,o]=(0,e.useState)(!1),{data:p,loaded:q}=(0,O.Z)(),{user:r}=(0,P.A)(),{toast:s}=(0,K.dj)(),[t,u]=(0,e.useState)(!1),v={width:"1400px",height:"90vh"},[w,x]=(0,e.useState)(v),[y,z]=(0,e.useState)("USD"),A=async()=>{if(!r||!("role"in r))return;let a={...r.preferences?.dialogSettings,bookingDialog:{step1:w,step2:w}};(await (0,ab.T)(r.uid,{preferences:{...r.preferences,dialogSettings:a}})).success?(s({title:"تم حفظ أبعاد النافذة"}),u(!1)):s({title:"خطأ",description:"لم يتم حفظ الإعدادات",variant:"destructive"})},B=d=>{c&&b?b(d):!c&&a&&a(d),o(!1)},C=a=>parseInt(a.replace(/px|vw|vh/g,""),10)||0,D=c&&f?{...f,travelDate:f.travelDate?(0,ac.H)(f.travelDate):new Date,issueDate:f.issueDate?(0,ac.H)(f.issueDate):new Date,passengers:f.passengers.map(a=>({...a,ticketType:a.ticketType||"Issue"}))}:void 0;return(0,d.jsxs)(h.lG,{open:n,onOpenChange:o,children:[(0,d.jsx)(h.zM,{asChild:!0,children:m}),(0,d.jsxs)(h.Cf,{showCloseButton:!1,className:"p-0 flex flex-col",style:{maxWidth:w.width,width:"95vw",height:w.height,maxHeight:"95vh",resize:"both",overflow:"hidden"},children:[(0,d.jsxs)(h.c7,{className:"p-3 rounded-t-lg flex flex-row items-center justify-between sticky top-0 z-10 border-b",style:{backgroundColor:"USD"===y?"hsl(var(--accent))":"hsl(var(--primary))",color:"white"},children:[(0,d.jsx)(h.HM,{asChild:!0,children:(0,d.jsx)(g.$,{variant:"ghost",size:"icon",className:"text-primary-foreground hover:bg-white/20 h-7 w-7 rounded-full",children:(0,d.jsx)(i.A,{className:"h-4 w-4"})})}),(0,d.jsx)("div",{className:"text-right",children:(0,d.jsx)(h.L3,{className:"text-white",children:c?`تعديل الحجز (PNR: ${f?.pnr})`:"إضافة حجز جديد (PNR)"})}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(g.$,{type:"button",onClick:()=>z("USD"),className:(0,I.cn)("text-white h-8","USD"===y?"bg-white/30":"bg-transparent border border-white/50"),children:"USD"}),(0,d.jsx)(g.$,{type:"button",onClick:()=>z("IQD"),className:(0,I.cn)("text-white h-8","IQD"===y?"bg-white/30":"bg-transparent border border-white/50"),children:"IQD"}),(0,d.jsxs)(aa.AM,{open:t,onOpenChange:u,children:[(0,d.jsx)(aa.Wv,{asChild:!0,children:(0,d.jsx)(g.$,{variant:"ghost",size:"icon",className:"text-white hover:bg-white/20 h-8 w-8",children:(0,d.jsx)(j.A,{className:"h-5 w-5"})})}),(0,d.jsx)(aa.hl,{className:"w-96",align:"end",children:(0,d.jsxs)("div",{className:"grid gap-4",children:[(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("h4",{className:"font-medium leading-none",children:"أبعاد النافذة"}),(0,d.jsxs)(R.Lt,{children:[(0,d.jsx)(R.tv,{asChild:!0,children:(0,d.jsxs)(g.$,{type:"button",variant:"ghost",size:"sm",className:"h-auto px-2 py-1 text-xs",children:[(0,d.jsx)(k.A,{className:"me-1 h-3 w-3"})," إعادة للوضع الافتراضي"]})}),(0,d.jsxs)(R.EO,{children:[(0,d.jsxs)(R.wd,{children:[(0,d.jsx)(R.r7,{children:"هل أنت متأكد؟"}),(0,d.jsx)(R.$v,{children:"سيتم إعادة أبعاد النافذة إلى الحجم الافتراضي."})]}),(0,d.jsxs)(R.ck,{children:[(0,d.jsx)(R.Zr,{children:"إلغاء"}),(0,d.jsx)(R.Rx,{onClick:()=>{x(v),s({title:"تمت إعادة تعيين الأبعاد (سيتم الحفظ مع الإعدادات الأخرى)"})},className:(0,I.cn)((0,g.r)({variant:"destructive"})),children:"نعم، قم بالإعادة"})]})]})]})]}),(0,d.jsx)("p",{className:"text-sm text-muted-foreground",children:"تحكم في حجم النافذة لتناسب شاشتك."})]}),(0,d.jsx)("div",{className:"grid gap-4 p-2 border rounded-lg",children:(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,d.jsxs)("div",{className:"grid grid-cols-3 items-center gap-4",children:[(0,d.jsx)(V.J,{htmlFor:"width1",children:"العرض (px)"}),(0,d.jsx)(N.O,{id:"width1",value:C(w.width),onValueChange:a=>x(b=>({...b,width:`${a||0}px`})),className:"col-span-2 h-8"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-3 items-center gap-4",children:[(0,d.jsx)(V.J,{htmlFor:"height1",children:"الارتفاع (vh)"}),(0,d.jsx)(N.O,{id:"height1",value:C(w.height),onValueChange:a=>x(b=>({...b,height:`${a||0}vh`})),className:"col-span-2 h-8"})]})]})}),(0,d.jsx)(g.$,{onClick:A,size:"sm",className:"mt-2 w-full",children:"حفظ الأبعاد"})]})})]})]})]}),(0,d.jsx)("div",{className:"flex-grow overflow-y-auto p-6",children:q&&p?(0,d.jsx)(_,{isEditing:c,initialData:D,onBookingAdded:B,onBookingUpdated:B}):(0,d.jsx)("div",{className:"flex justify-center items-center h-48",children:(0,d.jsx)(l.A,{className:"animate-spin h-8 w-8"})})})]})]})}}};