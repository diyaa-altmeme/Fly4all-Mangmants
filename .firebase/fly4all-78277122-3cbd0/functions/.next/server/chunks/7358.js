"use strict";exports.id=7358,exports.ids=[7358],exports.modules={8079:(a,b,c)=>{c.d(b,{I2:()=>h,Um:()=>f,aV:()=>g,yZ:()=>j});let d=(a,b)=>{if(!a||!b)return!1;let c=a.trim(),d=b.trim();return!!c&&!!d&&(c===d||c.startsWith(`${d}-`)||c.startsWith(`${d}.`)||c.startsWith(`${d}/`)||c.startsWith(d))},e=(a,b)=>{for(let c of b)if(d(a,c))return!0;return!1};function f(a,b){if(!a||!b)return"other";let{defaultCashId:c,defaultBankId:f,receivableAccountId:g,arAccountId:h,payableAccountId:i,apAccountId:j,hybridRelationAccountId:k,clearingAccountId:l,revenueMap:m,expenseMap:n,generalRevenueId:o,generalExpenseId:p}=b;return d(a,c)?"cash":d(a,f)?"bank":d(a,k)?"hybrid":d(a,g)||d(a,h)?"client":d(a,i)||d(a,j)?"supplier":d(a,l)?"clearing":e(a,[o,...Object.values(m||{})])?"revenue":e(a,[p,...Object.values(n||{})])?"expense":"other"}function g(a,b){return"revenue"===f(a,b)}function h(a,b){return"expense"===f(a,b)}let i=a=>{if("number"==typeof a&&!Number.isNaN(a))return a;if("string"==typeof a&&""!==a.trim()){let b=Number(a);return Number.isFinite(b)?b:0}return 0};function j(a,b){if(Array.isArray(a.entries)&&a.entries.length>0)return a.entries.map(a=>{let c=i(a.debit??("debit"===a.type?a.amount:0)),d=i(a.credit??("credit"===a.type?a.amount:0)),e=a.accountType||f(a.accountId,b);return{accountId:a.accountId,debit:c,credit:d,amount:c>0?c:d,description:a.description??a.note,currency:a.currency,relationId:a.relationId,companyId:a.companyId,accountType:e,type:c>0?"debit":"credit"}});let c=[];if(Array.isArray(a.debitEntries))for(let d of a.debitEntries){let a=i(d.amount??d.debit);c.push({accountId:d.accountId,debit:a,credit:0,amount:a,description:d.description,currency:d.currency,relationId:d.relationId,companyId:d.companyId,accountType:f(d.accountId,b),type:"debit"})}if(Array.isArray(a.creditEntries))for(let d of a.creditEntries){let a=i(d.amount??d.credit);c.push({accountId:d.accountId,debit:0,credit:a,amount:a,description:d.description,currency:d.currency,relationId:d.relationId,companyId:d.companyId,accountType:f(d.accountId,b),type:"credit"})}return c}},68162:(a,b,c)=>{c.d(b,{Fc:()=>i,TN:()=>k,XL:()=>j});var d=c(75338),e=c(74515),f=c(86281),g=c(70673);let h=(0,f.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),i=e.forwardRef(({className:a,variant:b,...c},e)=>(0,d.jsx)("div",{ref:e,role:"alert",className:(0,g.cn)(h({variant:b}),a),...c}));i.displayName="Alert";let j=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("h5",{ref:c,className:(0,g.cn)("mb-1 font-medium leading-none tracking-tight",a),...b}));j.displayName="AlertTitle";let k=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,g.cn)("text-sm [&_p]:leading-relaxed",a),...b}));k.displayName="AlertDescription"},70673:(a,b,c)=>{c.d(b,{cn:()=>f});var d=c(81171),e=c(11167);function f(...a){return(0,e.QP)((0,d.$)(a))}},79202:(a,b,c)=>{c.d(b,{A0:()=>h,BF:()=>i,Gg:()=>j,Hj:()=>k,XI:()=>g,nA:()=>m,nd:()=>l});var d=c(21124),e=c(38301),f=c(44943);let g=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{className:"relative w-full overflow-auto",children:(0,d.jsx)("table",{ref:c,className:(0,f.cn)("w-full caption-bottom text-sm",a),...b})}));g.displayName="Table";let h=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("thead",{ref:c,className:(0,f.cn)("[&_tr]:border-b",a),...b}));h.displayName="TableHeader";let i=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("tbody",{ref:c,className:(0,f.cn)("[&_tr:last-child]:border-0",a),...b}));i.displayName="TableBody";let j=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("tfoot",{ref:c,className:(0,f.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...b}));j.displayName="TableFooter";let k=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("tr",{ref:c,className:(0,f.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...b}));k.displayName="TableRow";let l=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("th",{ref:c,className:(0,f.cn)("h-12 px-4 text-right align-middle font-bold text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...b}));l.displayName="TableHead";let m=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("td",{ref:c,className:(0,f.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...b}));m.displayName="TableCell",e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("caption",{ref:c,className:(0,f.cn)("mt-4 text-sm text-muted-foreground",a),...b})).displayName="TableCaption"},83479:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{C:()=>s,T:()=>r,getFinanceMap:()=>q,postJournalEntries:()=>p});var e=c(75879);c(68633);var f=c(43513),g=c(33152),h=c(97092),i=c(7879),j=c(97842),k=c(8079),l=c(51669),m=a([f,g,i,j]);async function n(a,b){let c=Array.from(new Set(b.map(a=>a.accountId).filter(Boolean)));if(0===c.length)return;let d=c.map(b=>a.collection("chart_of_accounts").doc(b)),e=(await Promise.all(d.map(a=>a.get()))).map((a,b)=>a.exists?null:c[b]).filter(Boolean);if(e.length)throw Error("Accounts not found: "+e.join(", "))}function o(a){let b=a.find(a=>!!a.currency);return b?.currency||"USD"}async function p(a,b){let c=await (0,f.Lf)();if(!a.entries||!Array.isArray(a.entries)||0===a.entries.length)throw Error("No entries provided");let d=null;if(!a.meta||!a.meta.system){let a=await (0,g.$T)();if(!a)throw Error("Authentication required to post journal entries");if("isClient"in a&&a.isClient)throw Error("Insufficient permissions");if(!("admin"===a.role||a.permissions&&a.permissions.includes("vouchers:create")))throw Error("User lacks vouchers:create permission");d={uid:a.uid,name:a.name}}if(!function(a){let b=a.reduce((a,b)=>a+(b.debit||0),0),c=a.reduce((a,b)=>a+(b.credit||0),0);return 1e-4>Math.abs(b-c)}(a.entries))throw Error("Entries are not balanced (debit != credit)");if(await n(c,a.entries),!b)try{b=await q()}catch(a){}let e=b;if(e?.preventDirectCashRevenue){let b=e.defaultCashId;if(b){for(let c of a.entries)if(c.accountId===b)throw Error("Direct cash posting is disabled by finance settings")}}let h=i.Timestamp.now(),l=c.collection("journal-vouchers").doc(),m=await (0,j.tu)(a.sourceType.toUpperCase()),p=o(a.entries),r=a.entries.map(a=>{let b=Number(a.debit)||0,c=Number(a.credit)||0,d=a.note??a.description,f=(0,k.Um)(a.accountId,e||null);return{...a,debit:b,credit:c,amount:b>0?b:c,currency:a.currency||p,description:d,accountType:f}}),{debitEntries:s,creditEntries:t}=function(a){let b=[],c=[];for(let d of a)d.debit>0&&b.push({accountId:d.accountId,amount:d.debit,description:d.description??d.note,currency:d.currency,relationId:d.relationId,companyId:d.companyId,accountType:d.accountType}),d.credit>0&&c.push({accountId:d.accountId,amount:d.credit,description:d.description??d.note,currency:d.currency,relationId:d.relationId,companyId:d.companyId,accountType:d.accountType});return{debitEntries:b,creditEntries:c}}(r),u=a.date instanceof Date?a.date.toISOString():a.date?new Date(a.date).toISOString():new Date().toISOString(),v=a.meta?.createdBy||d?.uid||"system",w=a.meta?.officer||d?.name||"system";return await l.set({id:l.id,invoiceNumber:m,date:u,currency:o(a.entries),notes:a.description||"",createdBy:v,officer:w,createdAt:h,updatedAt:h,voucherType:`journal_from_${a.sourceType}`,sourceType:a.sourceType,sourceId:a.sourceId,debitEntries:s,creditEntries:t,isAudited:!1,isConfirmed:!0,meta:a.meta||null,entries:r.map(a=>({accountId:a.accountId,debit:a.debit,credit:a.credit,amount:a.amount,description:a.description??a.note,currency:a.currency,relationId:a.relationId,companyId:a.companyId,accountType:a.accountType,type:a.debit>0?"debit":"credit"})),originalData:{sourceType:a.sourceType,sourceId:a.sourceId,meta:a.meta||null}}),l.id}[f,g,i,j]=m.then?(await m)():m;let t={at:0,map:null};async function q(){let a=Date.now();if(t.map&&a-t.at<15e3)return t.map;let b=(await (0,f.Lf)()).collection("settings").doc("app_settings"),c=await b.get(),d=c.data()?.financeAccounts||{},e=(0,h.uJ)(d);return t={at:a,map:e},e}async function r({sourceType:a,sourceId:b,date:c,currency:d,amount:e,clientId:f}){if(e<=0)return;let g=await q(),h=g.revenueMap?.[a]||g.generalRevenueId,i=g.receivableAccountId;if(!h||!i)throw Error(`Missing mapping: revenue=${h} or AR=${i}`);let j=g.preventDirectCashRevenue&&g.defaultCashId,k=[{accountId:j?i:g.defaultCashId||i,debit:e,credit:0,currency:d,note:j?"إثبات إيراد آجل":"إثبات إيراد نقدي",relationId:f},{accountId:h,debit:0,credit:e,currency:d,note:"قيد الإيراد",relationId:f}];return p({sourceType:a,sourceId:b,date:"string"==typeof c?Date.parse(c):c.getTime(),entries:k,meta:{clientId:f,directCash:!j},description:j?"قيد إيراد آجل":"قيد إيراد نقدي"},g)}async function s({costKey:a,sourceType:b,sourceId:c,date:d,currency:e,amount:f,supplierId:g}){if(f<=0)return;let h=await q(),i=h.expenseMap?.[a]||h.generalExpenseId,j=h.payableAccountId;if(!i||!j)throw Error(`Missing mapping: expense=${i} or AP=${j}`);let k=[{accountId:i,debit:f,credit:0,currency:e,note:"تسجيل مصروف",relationId:g},{accountId:j,debit:0,credit:f,currency:e,note:"تسجيل ذمم دائنة للمورد",relationId:g}];return p({sourceType:b,sourceId:c,date:"string"==typeof d?Date.parse(d):d.getTime(),entries:k,meta:{supplierId:g},description:"قيد مصروف"},h)}(0,l.D)([p,q,r,s]),(0,e.A)(p,"60f0caf2093b9fcfdd71247bdb544c4372ceacd6c0",null),(0,e.A)(q,"00e358f3436e9739dfe740f6be22aedc1117f6422a",null),(0,e.A)(r,"409c8a7c4192cd1e36809ce6ea14b1b4ba417e8767",null),(0,e.A)(s,"4012e9d0afaf5977818266842659883d1e03e6c32f",null),d()}catch(a){d(a)}})},95378:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{DI:()=>m,EP:()=>q,EZ:()=>o,KB:()=>t,Lf:()=>n,d5:()=>p,zO:()=>r,zZ:()=>s});var e=c(91488);c(27806);var f=c(80446),g=c(91837),h=c(62641),i=c(58749),j=c(29631),k=c(40410),l=a([f,h,i,j]);async function m(a){let{clients:b}=await n({...a,all:!0});return b.map(a=>({value:a.id,label:`${a.name} ${a.code?`(${a.code})`:""}`,relationType:a.relationType,paymentType:a.paymentType}))}async function n(a={}){let{all:b=!1,limit:c=15,page:d=1,searchTerm:e,relationType:g,paymentType:h,status:i,country:j,province:k,sortBy:l="useCount_desc"}=a,m=await (0,f.Lf)();if(!m)return{clients:[],total:0};try{let f,n=m.collection("clients");g&&"all"!==g&&(n=n.where("relationType","in","client"===g?["client","both"]:"supplier"===g?["supplier","both"]:[g])),h&&"all"!==h&&(n=n.where("paymentType","==",h)),i&&"all"!==i&&(n=n.where("status","==",i)),!0===a.includeInactive||i||(n=n.where("status","==","active")),j&&"all"!==j&&(n=n.where("country","==",j)),k&&"all"!==k&&(n=n.where("province","==",k));let o=(await n.get()).docs;if(e){let a=e.toLowerCase();o=o.filter(b=>{let c=b.data();return c.name&&c.name.toLowerCase().includes(a)||c.phone&&String(c.phone).includes(a)||c.code&&c.code.toLowerCase().includes(a)})}let p=o.length;if(l){let[a,b]=l.split("_");o.sort((c,d)=>{let e=c.data(),f=d.data(),g=e[a],h=f[a];if(null==g)return 1;if(null==h)return -1;let i=0;return"string"==typeof g&&"string"==typeof h?i=g.localeCompare(h):g>h?i=1:g<h&&(i=-1),"desc"===b?-1*i:i})}if(b)f=o;else{let a=(d-1)*c;f=o.slice(a,a+c)}if(0===f.length)return{clients:[],total:0};return{clients:f.map(a=>{let b=a.data();return{...JSON.parse(JSON.stringify(b,(a,b)=>b&&"object"==typeof b&&b.hasOwnProperty("seconds")&&b.hasOwnProperty("nanoseconds")?new Date(1e3*b.seconds).toISOString():b)),id:a.id}}),total:p}}catch(a){return console.error("Error getting clients from Firestore: ",String(a)),{clients:[],total:0}}}async function o(a){let b=await (0,f.Lf)();if(!b)return null;try{let c=await b.collection("clients").doc(a).get();if(!c.exists)return null;let d=c.data(),e=JSON.parse(JSON.stringify(d,(a,b)=>b&&"object"==typeof b&&b.hasOwnProperty("seconds")&&b.hasOwnProperty("nanoseconds")?new Date(1e3*b.seconds).toISOString():b));return{id:c.id,...e}}catch(b){return console.error(`Error getting client by ID ${a}:`,String(b)),null}}async function p(a){let b=await (0,f.Lf)();if(!b)return{success:!1,error:"Database not available."};let c=await (0,h.$T)();if(!c)return{success:!1,error:"Unauthorized"};try{let d=c.name,e=await (0,j.tu)("CL"),f={...a,code:e,createdAt:new Date().toISOString(),createdBy:d,balance:{USD:0,IQD:0},lastTransaction:null,useCount:0};f.password&&f.password.length>=6||delete f.password;let h=await b.collection("clients").add(f);await (0,i.iL)({userId:c.uid,userName:c.name,action:"CREATE",targetType:"CLIENT",description:`أنشأ علاقة جديدة باسم: ${f.name} (ID: ${h.id})`}),(0,g.revalidatePath)("/clients"),(0,g.revalidatePath)("/suppliers"),(0,g.revalidatePath)("/reports/debts");let k={...f,id:h.id};return{success:!0,client:k}}catch(a){return console.error("Error adding client:",a),{success:!1,error:a.message}}}async function q(a){let b=await (0,f.Lf)();if(!b)return{success:!1,count:0,error:"Database not available."};let c=await (0,h.$T)();if(!c)return{success:!1,count:0,error:"Unauthorized"};try{for(let d of a){let a=b.batch(),e=b.collection("clients").doc(),f=await (0,j.tu)("CL"),g={...d,code:f,createdAt:new Date().toISOString(),createdBy:`مستورد بواسطة ${c.name}`,type:d.type||"individual",relationType:d.relationType||"client",status:d.status||"active",balance:{USD:0,IQD:0},lastTransaction:null,useCount:0,avatarUrl:""};g.password||delete g.password,a.set(e,g),await a.commit()}return await (0,i.iL)({userId:c.uid,userName:c.name,action:"CREATE",targetType:"CLIENT",description:`استورد ${a.length} علاقات جديدة من ملف.`}),(0,g.revalidatePath)("/clients"),(0,g.revalidatePath)("/suppliers"),(0,g.revalidatePath)("/relations/settings"),(0,g.revalidatePath)("/reports/debts"),{success:!0,count:a.length}}catch(a){return console.error("Error adding multiple clients: ",String(a)),{success:!1,count:0,error:"Failed to add clients."}}}async function r(a,b){let c=await (0,f.Lf)();if(!c)return{success:!1,error:"Database not available."};let d=await (0,h.$T)();if(!d)return{success:!1,error:"Unauthorized"};try{let e=JSON.parse(JSON.stringify(b));(""===b.password||void 0===b.password||null===b.password)&&delete e.password,await c.collection("clients").doc(a).update(e),await (0,i.iL)({userId:d.uid,userName:d.name,action:"UPDATE",targetType:"CLIENT",description:`عدل بيانات العلاقة (ID: ${a})`});let f=await c.collection("clients").doc(a).get(),h=JSON.parse(JSON.stringify(f.data(),(a,b)=>b&&"object"==typeof b&&b.hasOwnProperty("seconds")&&b.hasOwnProperty("nanoseconds")?new Date(1e3*b.seconds).toISOString():b)),j={id:f.id,...h};return(0,g.revalidatePath)("/clients"),(0,g.revalidatePath)("/suppliers"),(0,g.revalidatePath)("/reports/debts"),{success:!0,updatedClient:j}}catch(a){return console.error("Error updating client:",a),{success:!1,error:a.message}}}async function s(a){let b=await (0,f.Lf)();if(!b)return{success:!1,error:"Database not available."};let c=await (0,h.$T)();if(!c)return{success:!1,error:"Unauthorized"};try{let d=(await b.collection("clients").doc(a).get()).data();if(d?.useCount&&d.useCount>0)return{success:!1,error:"لا يمكن حذف هذه العلاقة لوجود معاملات مالية مرتبطة بها."};let e=d?.name||"unknown";return await b.collection("clients").doc(a).delete(),await (0,i.iL)({userId:c.uid,userName:c.name,action:"DELETE",targetType:"CLIENT",description:`حذف العلاقة: ${e} (ID: ${a})`}),(0,g.revalidatePath)("/clients"),(0,g.revalidatePath)("/suppliers"),(0,g.revalidatePath)("/reports/debts"),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function t(a){let b=await (0,f.Lf)();if(!b)return{success:!1,error:"Database not available."};let c=await (0,h.$T)();if(!c)return{success:!1,error:"Unauthorized"};try{let d=b.batch();return a.forEach(a=>{let c=b.collection("clients").doc(a);d.delete(c)}),await d.commit(),await (0,i.iL)({userId:c.uid,userName:c.name,action:"DELETE",targetType:"CLIENT",description:`حذف ${a.length} علاقات بشكل جماعي.`}),(0,g.revalidatePath)("/clients"),(0,g.revalidatePath)("/suppliers"),(0,g.revalidatePath)("/reports/debts"),{success:!0}}catch(a){return{success:!1,error:a.message}}}[f,h,i,j]=l.then?(await l)():l,(0,k.D)([m,n,o,p,q,r,s,t]),(0,e.A)(m,"405872236907704344162aca1c38160d1eac727fe8",null),(0,e.A)(n,"400e621b7f78c4800cffc85d668ca10cd73eb6853c",null),(0,e.A)(o,"408c94c431661ae65070856bc4a78d84f2cbfcba1c",null),(0,e.A)(p,"403331dfc341d9a7f9cbe156b5d10cfd49a20be531",null),(0,e.A)(q,"408c54ad33973364b68d8475849f76b4a4ca590722",null),(0,e.A)(r,"6023146a7bfefc423ba02712c56694a31432de707c",null),(0,e.A)(s,"4085652545b10cc37283ef55992935bd43a8ce947e",null),(0,e.A)(t,"40f4619201eea9704cbf15357e730e9458fc66e834",null),d()}catch(a){d(a)}})},97092:(a,b,c)=>{c.d(b,{rN:()=>j,uJ:()=>i});let d=a=>(a??"").trim(),e=(a,b)=>Array.from(new Set([...b,...Object.keys(a||{})])).reduce((b,c)=>(b[c]=d(a?.[c]),b),{}),f=a=>Object.values(a).find(a=>a.length>0)||"",g=["tickets","visas","subscriptions","segments","profit_distribution","other"],h=["tickets","visas","subscriptions","partners","operating","cost_tickets","cost_visas","operating_salaries","operating_rent","operating_utilities","marketing"];function i(a){let b={...a?.revenueMap||{},...a?.customRevenues||{}},c={...a?.expenseMap||{},...a?.customExpenses||{}},i=e(b,g),j=e(c,h),k=d(a?.receivableAccountId||a?.arAccountId),l=d(a?.payableAccountId||a?.apAccountId),m=d(a?.generalRevenueId)||f(i),n=d(a?.generalExpenseId)||f(j);return{receivableAccountId:k,payableAccountId:l,hybridRelationAccountId:d(a?.hybridRelationAccountId),clearingAccountId:d(a?.clearingAccountId),defaultCashId:d(a?.defaultCashId),defaultBankId:d(a?.defaultBankId),arAccountId:k,apAccountId:l,generalRevenueId:m,generalExpenseId:n,preventDirectCashRevenue:!!a?.preventDirectCashRevenue,revenueMap:i,expenseMap:j}}function j(a){let b=e(a.revenueMap||{},g),c=e(a.expenseMap||{},h),i=d(a.receivableAccountId),j=d(a.payableAccountId),k=d(a.generalRevenueId)||f(b),l=d(a.generalExpenseId)||f(c);return{receivableAccountId:i,payableAccountId:j,hybridRelationAccountId:d(a.hybridRelationAccountId),clearingAccountId:d(a.clearingAccountId),defaultCashId:d(a.defaultCashId),defaultBankId:d(a.defaultBankId),preventDirectCashRevenue:!!a.preventDirectCashRevenue,generalRevenueId:k,generalExpenseId:l,arAccountId:i,apAccountId:j,revenueMap:b,customRevenues:b,expenseMap:c,customExpenses:c}}},97842:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{PR:()=>j,fO:()=>i,tu:()=>k});var e=c(75879);c(68633);var f=c(43513),g=c(51669),h=a([f]);f=(h.then?(await h)():h)[0];let l="sequences",m=[{id:"RC",label:"سند قبض",prefix:"RC"},{id:"PV",label:"سند دفع",prefix:"PV"},{id:"EX",label:"سند مصاريف",prefix:"EX"},{id:"TR",label:"سند حوالة",prefix:"TR"},{id:"DS",label:"سند قبض مخصص",prefix:"DS"},{id:"JE",label:"سند قيد محاسبي",prefix:"JE"},{id:"BK",label:"إدخال حجز",prefix:"BK"},{id:"PR",label:"ربح شهري",prefix:"PR"},{id:"VS",label:"إدخال فيزا",prefix:"VS"},{id:"SUB",label:"إنشاء اشتراك",prefix:"SUB"},{id:"SUBP",label:"دفعة قسط اشتراك",prefix:"SUBP"},{id:"RF",label:"استرجاع تذكرة",prefix:"RF"},{id:"EXC",label:"تغيير تذكرة",prefix:"EXC"},{id:"VOID",label:"إلغاء (فويد)",prefix:"VOID"},{id:"EXT",label:"معاملة بورصة",prefix:"EXT"},{id:"EXP",label:"تسديد بورصة",prefix:"EXP"},{id:"SEG",label:"سكمنت",prefix:"SEG"},{id:"CL",label:"علاقة (عميل/مورد)",prefix:"CL"}];async function i(){let a=await (0,f.Lf)();if(!a)throw Error("Database not available.");let b=await a.collection(l).get();if(b.empty){let b=a.batch(),c=m.map(a=>({...a,value:0}));return c.forEach(c=>{b.set(a.collection(l).doc(c.id),c)}),await b.commit(),c}let c=b.docs.map(a=>a.data()),d=m.filter(a=>!c.some(b=>b.id===a.id));if(d.length>0){let b=a.batch();return d.forEach(c=>{b.set(a.collection(l).doc(c.id),{...c,value:0})}),await b.commit(),i()}return c}async function j(a,b){let c=await (0,f.Lf)();if(!c)return{success:!1,error:"Database not available"};try{return await c.collection(l).doc(a).update(b),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function k(a){let b=await (0,f.Lf)();if(!b)throw Error("Database not available.");let c=b.collection(l).doc(a);try{let d=await b.runTransaction(async b=>{let d=await b.get(c),e=1,f=a,g=`سند ${a}`;if(d.exists){let b=d.data();e=(b.value||0)+1,f=b.prefix||a,g=b.label||g}return b.set(c,{value:e,prefix:f,label:g},{merge:!0}),{number:e,prefix:f}}),e=String(d.number).padStart(6,"0");return`${d.prefix}-${e}`}catch(b){return console.error(`Error getting next voucher number for prefix ${a}:`,b),`${a}-${Date.now().toString().slice(-6)}`}}(0,g.D)([i,j,k]),(0,e.A)(i,"00f8105cf2df698dda196c821059bffd2c12bb65d6",null),(0,e.A)(j,"60bfff327e3bf73dac5fa7bb6d2690e1fed6e5cf56",null),(0,e.A)(k,"40f3e2b0ca2e561c506ffb1575ff80c4dac60766e4",null),d()}catch(a){d(a)}})}};