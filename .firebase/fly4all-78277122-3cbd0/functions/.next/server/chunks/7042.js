"use strict";exports.id=7042,exports.ids=[7042],exports.modules={32842:(a,b,c)=>{c.d(b,{tU:()=>D,av:()=>G,j7:()=>E,Xi:()=>F});var d=c(21124),e=c(38301),f=c(87868),g=c(2332),h=c(88617),i=c(29988),j=c(6406),k=c(10498),l=c(11720),m=c(75656),n="Tabs",[o,p]=(0,g.A)(n,[h.RG]),q=(0,h.RG)(),[r,s]=o(n),t=e.forwardRef((a,b)=>{let{__scopeTabs:c,value:e,onValueChange:f,defaultValue:g,orientation:h="horizontal",dir:i,activationMode:o="automatic",...p}=a,q=(0,k.jH)(i),[s,t]=(0,l.i)({prop:e,onChange:f,defaultProp:g??"",caller:n});return(0,d.jsx)(r,{scope:c,baseId:(0,m.B)(),value:s,onValueChange:t,orientation:h,dir:q,activationMode:o,children:(0,d.jsx)(j.sG.div,{dir:q,"data-orientation":h,...p,ref:b})})});t.displayName=n;var u="TabsList",v=e.forwardRef((a,b)=>{let{__scopeTabs:c,loop:e=!0,...f}=a,g=s(u,c),i=q(c);return(0,d.jsx)(h.bL,{asChild:!0,...i,orientation:g.orientation,dir:g.dir,loop:e,children:(0,d.jsx)(j.sG.div,{role:"tablist","aria-orientation":g.orientation,...f,ref:b})})});v.displayName=u;var w="TabsTrigger",x=e.forwardRef((a,b)=>{let{__scopeTabs:c,value:e,disabled:g=!1,...i}=a,k=s(w,c),l=q(c),m=A(k.baseId,e),n=B(k.baseId,e),o=e===k.value;return(0,d.jsx)(h.q7,{asChild:!0,...l,focusable:!g,active:o,children:(0,d.jsx)(j.sG.button,{type:"button",role:"tab","aria-selected":o,"aria-controls":n,"data-state":o?"active":"inactive","data-disabled":g?"":void 0,disabled:g,id:m,...i,ref:b,onMouseDown:(0,f.mK)(a.onMouseDown,a=>{g||0!==a.button||!1!==a.ctrlKey?a.preventDefault():k.onValueChange(e)}),onKeyDown:(0,f.mK)(a.onKeyDown,a=>{[" ","Enter"].includes(a.key)&&k.onValueChange(e)}),onFocus:(0,f.mK)(a.onFocus,()=>{let a="manual"!==k.activationMode;o||g||!a||k.onValueChange(e)})})})});x.displayName=w;var y="TabsContent",z=e.forwardRef((a,b)=>{let{__scopeTabs:c,value:f,forceMount:g,children:h,...k}=a,l=s(y,c),m=A(l.baseId,f),n=B(l.baseId,f),o=f===l.value,p=e.useRef(o);return e.useEffect(()=>{let a=requestAnimationFrame(()=>p.current=!1);return()=>cancelAnimationFrame(a)},[]),(0,d.jsx)(i.C,{present:g||o,children:({present:c})=>(0,d.jsx)(j.sG.div,{"data-state":o?"active":"inactive","data-orientation":l.orientation,role:"tabpanel","aria-labelledby":m,hidden:!c,id:n,tabIndex:0,...k,ref:b,style:{...a.style,animationDuration:p.current?"0s":void 0},children:c&&h})})});function A(a,b){return`${a}-trigger-${b}`}function B(a,b){return`${a}-content-${b}`}z.displayName=y;var C=c(44943);let D=t,E=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(v,{ref:c,className:(0,C.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...b}));E.displayName=v.displayName;let F=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(x,{ref:c,className:(0,C.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...b}));F.displayName=x.displayName;let G=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(z,{ref:c,className:(0,C.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...b}));G.displayName=z.displayName},40651:(a,b,c)=>{c.d(b,{f:()=>e});var d=c(85708);let e=(0,d.createServerReference)("009987d8158f99de874014e543c2eb4bd257578535",d.callServer,void 0,d.findSourceMapURL,"getWhatsappAccounts")},53608:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{$N:()=>l,NK:()=>p,_3:()=>s,e8:()=>w,fn:()=>k,iX:()=>q,jj:()=>m,lF:()=>n,rx:()=>o,uL:()=>r});var e=c(91488);c(27806);var f=c(80446),g=c(91837),h=c(46204),i=c(40410),j=a([f]);f=(j.then?(await j)():j)[0];let t="whatsapp_accounts",u="https://api.ultramsg.com",v="https://api.green-api.com";async function k(){let a=await (0,f.Lf)();if(!a)return{success:!1,error:"Database not available."};try{let b=(await a.collection(t).orderBy("name").get()).docs.map(a=>({id:a.id,...a.data()}));return{success:!0,accounts:b}}catch(a){return{success:!1,error:a.message}}}async function l(a){let b=await (0,f.Lf)();if(!b)return{success:!1,error:"Database not available."};try{return await b.collection(t).add(a),(0,g.revalidatePath)("/campaigns"),(0,g.revalidatePath)("/settings"),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function m(a,b){let c=await (0,f.Lf)();if(!c)return{success:!1,error:"Database not available."};try{return await c.collection(t).doc(a).update(b),(0,g.revalidatePath)("/campaigns"),(0,g.revalidatePath)("/settings"),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function n(a){let b=await (0,f.Lf)();if(!b)return{success:!1,error:"Database not available."};try{return await b.collection(t).doc(a).delete(),(0,g.revalidatePath)("/campaigns"),(0,g.revalidatePath)("/settings"),{success:!0}}catch(a){return{success:!1,error:a.message}}}let w=(0,h.cache)(async a=>{let b=await (0,f.Lf)();if(!b)return null;let c=await b.collection(t).doc(a).get();return c.exists?c.data():null});async function o(a){let b=await w(a);if(!b||!b.idInstance||!b.apiTokenInstance)throw Error("Account credentials not found or incomplete.");try{let a=new URL(`${u}/${b.idInstance}/groups`);a.searchParams.append("token",b.apiTokenInstance);let c=await fetch(a.toString()),d=await c.json();if(!c.ok)throw Error(d.error||"Failed to fetch WhatsApp groups from ultramsg.");if(d&&Array.isArray(d))return d.map(a=>({id:a.id,name:a.name,participantsCount:a.groupMetadata?.participants?.length||0,iAmAdmin:a.i_am_admin||!1}));return[]}catch(a){throw console.error("Error fetching WhatsApp groups from ultramsg:",a.message),Error(a.message||"Failed to fetch WhatsApp groups.")}}async function p(a){let b=await w(a);if(!b||!b.idInstance||!b.apiTokenInstance)throw Error("Account credentials not found or incomplete.");if("green-api"===b.provider){let a=`${v}/waInstance${b.idInstance}/getContacts/${b.apiTokenInstance}`,c=await fetch(a);if(!c.ok){let a=await c.text();throw Error(`Failed to fetch Green-API contacts: ${a}`)}return(await c.json()||[]).map(a=>({id:a.id,name:a.name}))}try{let a=new URL(`${u}/${b.idInstance}/contacts`);a.searchParams.append("token",b.apiTokenInstance);let c=await fetch(a.toString()),d=await c.json();if(!c.ok)throw Error(d.error||"Failed to fetch WhatsApp contacts.");if(d&&Array.isArray(d))return d.map(a=>({id:a.id,name:a.name}));return[]}catch(a){throw console.error("Error fetching WhatsApp contacts:",a.message),Error(a.message||"Failed to fetch WhatsApp contacts.")}}async function q(a,b){let c=await w(a);if(!c||!c.idInstance||!c.apiTokenInstance)throw Error("Account credentials not found or incomplete.");if("green-api"===c.provider){let a=`${v}/waInstance${c.idInstance}/getGroupParticipants/${c.apiTokenInstance}`,d=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({groupId:b})});if(!d.ok){let a=await d.text();throw Error(`Failed to fetch Green-API group participants: ${a}`)}let e=await d.json();return(e?.participants||[]).map(a=>({id:a.id,name:a.name||a.id.split("@")[0]}))}try{let a=new URL(`${u}/${c.idInstance}/groups/participants`);a.searchParams.append("token",c.apiTokenInstance),a.searchParams.append("groupId",b);let d=await fetch(a.toString()),e=await d.json();if(!d.ok)throw Error(e.error||"Failed to fetch group participants.");if(e&&Array.isArray(e))return e.map(a=>({id:a.id,name:a.name}));return[]}catch(a){throw console.error(`Error fetching participants for group ${b}:`,a.message),Error(a.message||"Failed to fetch group participants.")}}async function r(a,b,c){let d=await w(a);if(!d||!d.idInstance||!d.apiTokenInstance||"green-api"!==d.provider)return{success:!1,error:"This function is only for Green-API accounts and requires full credentials."};try{let a=`${v}/waInstance${d.idInstance}/addGroupParticipant/${d.apiTokenInstance}`,e=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({groupId:b,participantChatId:c})}),f=await e.json();if(e.ok&&f.add)return{success:!0,message:"Successfully added participant to group."};return{success:!1,error:f.message||"Failed to add participant."}}catch(a){return console.error("Error adding participant to group:",a.message),{success:!1,error:a.message||"An unknown error occurred."}}}async function s(a){let b=await w(a);if(!b||!b.idInstance||!b.apiTokenInstance)return{status:"error",message:"Incomplete credentials."};if("green-api"===b.provider)try{let a=`${v}/waInstance${b.idInstance}/getStateInstance/${b.apiTokenInstance}`,c=await fetch(a);if(!c.ok)try{let a=await c.json();return{status:"error",message:a.message||"Failed to fetch Green-API status"}}catch(a){return{status:"error",message:await c.text()||"Failed to fetch Green-API status"}}let d=await c.json(),e={status:d.stateInstance,message:"authorized"===d.stateInstance?"متصل":"غير متصل"};if("notAuthorized"===d.stateInstance)try{let a=`${v}/waInstance${b.idInstance}/qr/${b.apiTokenInstance}`,c=await fetch(a);if(c.ok){let a=await c.json();"qrCode"===a.type&&(e.status="got qr code",e.qrCode=a.message)}}catch(a){console.warn("Could not fetch QR code for Green-API, continuing without it.",a)}if("authorized"===d.stateInstance)try{let a=`${v}/waInstance${b.idInstance}/getWaSettings/${b.apiTokenInstance}`,c=await fetch(a);if(c.ok){let a=await c.json(),d=a.wid;if(d){e.name=a.pushname||d.split("@")[0];let c=`${v}/waInstance${b.idInstance}/getAvatar/${b.apiTokenInstance}`,f=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatId:d})});if(f.ok){let a=await f.json();a.existsAvatar&&(e.profile_picture=a.urlAvatar)}}}}catch(a){console.warn("Could not fetch avatar/settings for Green-API, continuing without it.",a)}return e}catch(a){return{status:"error",message:a.message||"Failed to fetch Green-API status."}}try{let a=new URL(`${u}/${b.idInstance}/instance/me`);a.searchParams.append("token",b.apiTokenInstance);let c=await fetch(a.toString());if(!c.ok){let a=await c.json();return{status:"error",message:a.error||"Failed to fetch account details."}}let d=await c.json(),e=await fetch(`${u}/${b.idInstance}/instance/status?token=${b.apiTokenInstance}`),f=await e.json();if(f?.status?.account_status?.status==="got qr code"&&f.status.qrCode)return{...f.status.account_status,status:"got qr code",qrCode:f.status.qrCode};return{status:"connected",message:"متصل",name:d.name,profile_picture:d.image}}catch(b){return console.error(`Error fetching status for account ${a}:`,b.message),{status:"error",message:b.message||"Unknown error."}}}(0,i.D)([k,l,m,n,w,o,p,q,r,s]),(0,e.A)(k,"009987d8158f99de874014e543c2eb4bd257578535",null),(0,e.A)(l,"40084f2c4ea3e6de914d9ccec37e1cc9e6c948440a",null),(0,e.A)(m,"60ab3d606e7fd8fc4042d526bde8444e0d642058ea",null),(0,e.A)(n,"40bebf67ac032a6829a4f046709f724a00a4f8d315",null),(0,e.A)(w,"7fba2ac2c1a9f8739234413dfc6c7ce7ecc022ad39",null),(0,e.A)(o,"40168ae185353c0a082b43ec98457e95202a0a0e4f",null),(0,e.A)(p,"406f8f90a318c63d61893a0c788be56cb2f100177a",null),(0,e.A)(q,"6061cd2d52d140d7a5c191088a23243c3222ad0e9f",null),(0,e.A)(r,"702eed442f1ccbf88d7ae7afd57e907c5a530ad2ed",null),(0,e.A)(s,"406c682028bb61084120ebd0c90b571b5064b14b7b",null),d()}catch(a){d(a)}})},97230:(a,b,c)=>{c.d(b,{A:()=>J});var d=c(21124),e=c(38301),f=c(35284),g=c(40068),h=c(51886),i=c(62186),j=c(10656),k=c(49113),l=c(90023),m=c(27810),n=c(40822),o=c(37448),p=c(49566),q=c(31980),r=c(99546),s=c(50937),t=c(27186),u=c(93758),v=c(1420),w=c(85708);let x=(0,w.createServerReference)("60ab3d606e7fd8fc4042d526bde8444e0d642058ea",w.callServer,void 0,w.findSourceMapURL,"updateWhatsappAccount"),y=(0,w.createServerReference)("40084f2c4ea3e6de914d9ccec37e1cc9e6c948440a",w.callServer,void 0,w.findSourceMapURL,"addWhatsappAccount");var z=c(45608);let A=r.Ik({name:r.Yj().min(2,"اسم الحساب مطلوب."),provider:r.k5(["ultramsg","green-api"]).default("ultramsg"),idInstance:r.Yj().min(5,"معرف النسخة مطلوب."),apiTokenInstance:r.Yj().min(10,"التوكن مطلوب."),isDefault:r.zM().default(!1)});function B({isEditing:a=!1,account:b,onSaveSuccess:c,children:h}){let[i,j]=(0,e.useState)(!1),{toast:l}=(0,o.dj)(),m=(0,q.mN)({resolver:(0,s.u)(A),defaultValues:a&&b?b:{name:"",provider:"ultramsg",idInstance:"",apiTokenInstance:"",isDefault:!1}}),{isSubmitting:n}=m.formState,r=async d=>{try{let e;if((e=a&&b?await x(b.id,d):await y(d)).success)l({title:`تم ${a?"تحديث":"إضافة"} الحساب بنجاح`}),c(),j(!1);else throw Error(e.error)}catch(a){l({title:"خطأ",description:a.message,variant:"destructive"})}};return(0,d.jsxs)(g.lG,{open:i,onOpenChange:j,children:[(0,d.jsx)(g.zM,{asChild:!0,children:h}),(0,d.jsx)(g.Cf,{className:"sm:max-w-md",children:(0,d.jsx)(t.lV,{...m,children:(0,d.jsxs)("form",{onSubmit:m.handleSubmit(r),children:[(0,d.jsxs)(g.c7,{children:[(0,d.jsx)(g.L3,{children:a?"تعديل حساب":"إضافة حساب جديد"}),(0,d.jsx)(g.rr,{children:"أدخل بيانات حساب WhatsApp الخاص بك."})]}),(0,d.jsxs)("div",{className:"py-4 grid gap-4",children:[(0,d.jsx)(t.zB,{control:m.control,name:"provider",render:({field:a})=>(0,d.jsxs)(t.eI,{children:[(0,d.jsx)(t.lR,{children:"مزود الخدمة"}),(0,d.jsxs)(z.l6,{onValueChange:a.onChange,value:a.value,children:[(0,d.jsx)(t.MJ,{children:(0,d.jsx)(z.bq,{children:(0,d.jsx)(z.yv,{})})}),(0,d.jsxs)(z.gC,{children:[(0,d.jsx)(z.eb,{value:"ultramsg",children:"ultramsg.com"}),(0,d.jsx)(z.eb,{value:"green-api",children:"green-api.com"})]})]}),(0,d.jsx)(t.C5,{})]})}),(0,d.jsx)(t.zB,{control:m.control,name:"name",render:({field:a})=>(0,d.jsxs)(t.eI,{children:[(0,d.jsx)(t.lR,{children:"الاسم المميز للحساب"}),(0,d.jsx)(t.MJ,{children:(0,d.jsx)(u.p,{...a,placeholder:"مثال: حساب الشركة الرئيسي"})}),(0,d.jsx)(t.C5,{})]})}),(0,d.jsx)(t.zB,{control:m.control,name:"idInstance",render:({field:a})=>(0,d.jsxs)(t.eI,{children:[(0,d.jsx)(t.lR,{children:"Instance ID"}),(0,d.jsx)(t.MJ,{children:(0,d.jsx)(u.p,{...a})}),(0,d.jsx)(t.C5,{})]})}),(0,d.jsx)(t.zB,{control:m.control,name:"apiTokenInstance",render:({field:a})=>(0,d.jsxs)(t.eI,{children:[(0,d.jsx)(t.lR,{children:"Token"}),(0,d.jsx)(t.MJ,{children:(0,d.jsx)(u.p,{type:"password",...a})}),(0,d.jsx)(t.C5,{})]})}),(0,d.jsx)(t.zB,{control:m.control,name:"isDefault",render:({field:a})=>(0,d.jsxs)(t.eI,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[(0,d.jsx)(t.lR,{children:"تعيين كافتراضي"}),(0,d.jsx)(t.MJ,{children:(0,d.jsx)(v.d,{checked:a.value,onCheckedChange:a.onChange})})]})})]}),(0,d.jsx)(g.Es,{children:(0,d.jsxs)(f.$,{type:"submit",disabled:n,children:[n?(0,d.jsx)(k.A,{className:"me-2 h-4 w-4 animate-spin"}):(0,d.jsx)(p.A,{className:"me-2 h-4 w-4"}),a?"حفظ التعديلات":"إضافة الحساب"]})})]})})})]})}var C=c(40651);let D=(0,w.createServerReference)("40bebf67ac032a6829a4f046709f724a00a4f8d315",w.callServer,void 0,w.findSourceMapURL,"deleteWhatsappAccount");var E=c(11563),F=c(12439),G=c(44943),H=c(99187);function I({onSaveSuccess:a}){let[b,c]=(0,e.useState)([]),[g,h]=(0,e.useState)(!0),{toast:p}=(0,o.dj)(),q=(0,e.useCallback)(async()=>{h(!0);let a=await (0,C.f)();a.success&&a.accounts?c(a.accounts):p({title:"خطأ",description:a.error,variant:"destructive"}),h(!1)},[p]),r=()=>{q(),a()},s=async a=>{let b=await D(a);b.success?(p({title:"تم حذف الحساب بنجاح"}),r()):p({title:"خطأ",description:b.error,variant:"destructive"})};return(0,d.jsxs)(i.Zp,{className:"border-none shadow-none",children:[(0,d.jsxs)(i.aR,{className:"flex flex-row justify-between items-start px-0",children:[(0,d.jsx)("div",{children:(0,d.jsx)(i.ZB,{className:"text-lg",children:"حسابات WhatsApp"})}),(0,d.jsx)(B,{onSaveSuccess:r,children:(0,d.jsxs)(f.$,{size:"sm",children:[(0,d.jsx)(j.A,{className:"me-2 h-4 w-4"}),"إضافة حساب"]})})]}),(0,d.jsx)(i.Wu,{className:"p-0",children:g?(0,d.jsx)("div",{className:"flex justify-center p-8",children:(0,d.jsx)(k.A,{className:"animate-spin"})}):0===b.length?(0,d.jsx)("p",{className:"text-muted-foreground text-center p-8",children:"لا توجد حسابات مضافة."}):(0,d.jsx)("div",{className:"space-y-3",children:b.map(a=>(0,d.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-muted/50",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("p",{className:"font-semibold",children:a.name}),(0,d.jsx)(H.E,{variant:"outline",children:a.provider||"ultramsg"})]}),(0,d.jsx)("p",{className:"text-sm text-muted-foreground font-mono",children:a.idInstance})]}),(0,d.jsxs)(E.rI,{children:[(0,d.jsx)(E.ty,{asChild:!0,children:(0,d.jsx)(f.$,{variant:"ghost",size:"icon",children:(0,d.jsx)(l.A,{className:"h-4 w-4"})})}),(0,d.jsxs)(E.SQ,{children:[(0,d.jsx)(B,{isEditing:!0,account:a,onSaveSuccess:r,children:(0,d.jsxs)(E._2,{onSelect:a=>a.preventDefault(),children:[(0,d.jsx)(m.A,{className:"me-2 h-4 w-4"}),"تعديل"]})}),(0,d.jsxs)(F.Lt,{children:[(0,d.jsx)(F.tv,{asChild:!0,children:(0,d.jsxs)(E._2,{onSelect:a=>a.preventDefault(),className:"text-destructive focus:text-destructive",children:[(0,d.jsx)(n.A,{className:"me-2 h-4 w-4"}),"حذف"]})}),(0,d.jsxs)(F.EO,{children:[(0,d.jsxs)(F.wd,{children:[(0,d.jsx)(F.r7,{children:"هل أنت متأكد؟"}),(0,d.jsx)(F.$v,{children:"سيتم حذف الحساب بشكل دائم ولا يمكن التراجع عن هذا الإجراء."})]}),(0,d.jsxs)(F.ck,{children:[(0,d.jsx)(F.Zr,{children:"إلغاء"}),(0,d.jsx)(F.Rx,{onClick:()=>s(a.id),className:(0,G.cn)((0,f.r)({variant:"destructive"})),children:"نعم، احذف"})]})]})]})]})]})]},a.id))})})]})}function J({onSaveSuccess:a}){let[b,c]=(0,e.useState)(!1);return(0,d.jsxs)(g.lG,{open:b,onOpenChange:c,children:[(0,d.jsx)(g.zM,{asChild:!0,children:(0,d.jsxs)(f.$,{variant:"outline",children:[(0,d.jsx)(h.A,{className:"me-2 h-4 w-4"}),"الإعدادات"]})}),(0,d.jsxs)(g.Cf,{className:"max-w-2xl",children:[(0,d.jsxs)(g.c7,{children:[(0,d.jsx)(g.L3,{children:"إعدادات الحملات"}),(0,d.jsx)(g.rr,{children:"إدارة حسابات WhatsApp المتصلة بالنظام."})]}),(0,d.jsx)("div",{className:"py-4",children:(0,d.jsx)(I,{onSaveSuccess:()=>{a()}})})]})]})}}};