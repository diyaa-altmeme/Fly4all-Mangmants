"use strict";exports.id=3152,exports.ids=[3152],exports.modules={13991:(a,b,c)=>{c.d(b,{Jj:()=>d});let d={"dashboard:read":"عرض لوحة التحكم","bookings:read":"عرض حجوزات الطيران","bookings:create":"إنشاء حجوزات الطيران","bookings:update":"تعديل حجوزات الطيران","bookings:delete":"حذف حجوزات الطيران","bookings:operations":"إجراء عمليات (استرجاع، تغيير)","visas:read":"عرض طلبات الفيزا","visas:create":"إنشاء طلبات فيزا","visas:update":"تعديل طلبات الفيزا","visas:delete":"حذف طلبات الفيزا","subscriptions:read":"عرض الاشتراكات","subscriptions:create":"إنشاء الاشتراكات","subscriptions:update":"تعديل الاشتراكات","subscriptions:delete":"حذف الاشتراكات","subscriptions:payments":"إدارة دفعات الأقساط","vouchers:read":"عرض السندات","vouchers:create":"إنشاء السندات","vouchers:update":"تعديل السندات","vouchers:delete":"حذف السندات","remittances:read":"عرض الحوالات","remittances:create":"إنشاء الحوالات","remittances:audit":"تدقيق الحوالات","remittances:receive":"استلام الحوالات",segment_access:"الوصول إلى ميزة السكمنت","segments:read":"عرض السكمنت","segments:create":"إنشاء سجلات سكمنت","segments:update":"تعديل سجلات سكمنت","segments:delete":"حذف سجلات سكمنت","relations:read":"عرض العملاء والموردين","relations:create":"إنشاء العملاء والموردين","relations:update":"تعديل العملاء والموردين","relations:delete":"حذف العملاء والموردين","relations:credentials":"إدارة بيانات الدخول للعملاء","users:read":"عرض المستخدمين والأدوار","users:create":"إنشاء المستخدمين والأدوار","users:update":"تعديل المستخدمين والأدوار","users:delete":"حذف المستخدمين والأدوار","users:permissions":"إدارة صلاحيات الأدوار","hr:read":"عرض بيانات الموارد البشرية","hr:update":"تعديل بيانات الرواتب والأرباح","reports:read:all":"عرض جميع التقارير","reports:account_statement":"عرض كشف الحساب","reports:debts":"عرض تقرير الأرصدة","reports:profits":"عرض تقارير الأرباح","reports:flight_analysis":"عرض تحليل الرحلات","settings:read":"عرض الإعدادات","settings:update":"تعديل الإعدادات","settings:finance:manage":"إدارة مركز التحكم المالي","system:audit_log:read":"عرض سجل النشاطات","system:error_log:read":"عرض سجل الأخطاء","system:data_audit:run":"تشغيل فحص البيانات",public:"صلاحية عامة"}},29559:(a,b,c)=>{c.d(b,{R:()=>d});let d={projectId:"fly4all-78277122-3cbd0",privateKey:"-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQC62eIaOJqkBGL/\nIvxqOzN8/etbwsVKx8vNMRXVQ4RbS2/jB2JBJhonNWHf0Lll36QFnnfM0v1sGzz3\nck3eCAxT4snkbI0nb71u6tLff1YSur7p7GmCOeq1LKsc6uI5sFC3G0PJLZFYj2hG\n0djgQobNoVmLFfi9m1DhReDSFvk1PpJt1hxMhKKq11KR9ER90IUE2L6vuDR0Fa1Z\n9Y72htITxAq7Wd9zAlwlt7vcK5cQAbLBYrQVqPDrrmwNS5JPyDLhiEY6fbGeyiFE\nXdFNhktEsazoFN6w/V5NQ/aJH04fn3V36lBdc9sO7+wRufWRBaeoBs1FurPhpY1q\nxKorBLllAgMBAAECggEAFjzZrby4XNZf0NUhXOREVbcjpHVbBTIfpYFWw52oOjRR\ncd/eV/oYqTtvdVNySTdTXk7Um7YtrojUWe/K6CaljvNCC3NG3l9sWG/OnoZZYFvE\n3nLCQNszPZI+IDAtMefzx0MRr3cCohtZMfqGGPSZ9g2iqky4YJqERvdJ0T8mNCmU\n8GB6+qoKUGMt2O5DzVO250CGgIcgfqFd1dqvC+8PD3S2FL1dqwEgxpHeXhg+7NUU\n78+SmNRxcCTdqlgx5V9ihqgGaajVHWmGEMfDS+XatG+BAoc+Fi/ubOHPXH9Iniwd\njJcJ9CaSyZPFz0N+sY5uFB/wk2cYIKCdjzHTrJPzmQKBgQDgm8UI7Q3GScdbv29p\nQX++BOzqJKMiO7d0nOsW/7AobFVsSpXTsU0RovAkCtYY+P67qxQDwK3RSDs36YQE\nUyRwJhHnzJOKf5zj2nVFKgHgSSJdZEolMTM1KVicESDer6knsT7EN8M+iVGXl0JO\nz277bJ5hhNMkPnB1e7dOh6zq+QKBgQDU9zLg30dvNXNwSHv0QDZqADomi9U9nkZ+\nJhgJDmi+VMUxWfb61U0W/azewShL7YIsOHdTLensrAPBj5xzuB2OftKnEuaO3Nsv\nzJeQ3jOM5wXnqHpl9EXYVvlJTzM7tCyRJuiDFyhBmezCxikLjsjxWjwlcEGhc84Z\n+7E1IAUQzQKBgBVL78TG5VV1zWdPoXqzcS9NPEF/M9CdJOnzrv7BQ6yxiO/5qncm\nCo6vimGAfYhko5KbyAwLCvAbDzJf+9qFH6FamrwF07+AFhosro3eS8s+Y/nC9pzM\nK3TQ9Mvne9xhf4J59d+ZAfQ+BPSArRLX7Ef+po3MkFCRcwxQrLLPfn/RAoGBAL1f\nuBF42sfMSwOsoPTYaMqnuw3tyEhLxzmD3FmpQ4EEVnmFG3d/V1a7aw6FyrSB1gBG\nke0YZew8JfboImJQdY/xvJYu23Bsekgt8RU0UbjY8kpGadjhd35iELicwd00YXEN\nnTJ81CJJotysY3FQneTorZVJFkNgfARk6PZpq7d9AoGBAJVxFwblg6SQ+QZMUqaU\n5dXAESNOHv08DkYd0o/LmwfX1/odY9VwkR0unwMY3NncAWVSNh7u/C3DjLciaHzJ\nJr2o/GSZ2p1HxUsUa0aqN/q4BFTkO7ryFeCFcN3AO6hfgzKnoFUFYBD4iSHPkgX/\nfrErRvbecpYKP5V4y0awUggt\n-----END PRIVATE KEY-----\n".replace(/\\n/g,"\n"),clientEmail:"firebase-adminsdk-fbsvc@fly4all-78277122-3cbd0.iam.gserviceaccount.com"}},33152:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{$T:()=>t,EZ:()=>s,HW:()=>l,Lx:()=>o,S:()=>p,Sm:()=>n,X7:()=>m,ht:()=>u,kl:()=>r,y4:()=>q});var e=c(75879);c(68633);var f=c(43513),g=c(86802),h=c(40776),i=c(13991),j=c(51669),k=a([f,h]);async function l(){let a=await t();return!a||"isClient"in a?{user:null,hasPermission:()=>!1}:{user:a,hasPermission:b=>"admin"===a.role||(a.permissions?.includes(b)??!1)}}[f,h]=k.then?(await k)():k;let r=async a=>{let b=await (0,f.Lf)();if(!b)return null;try{let c=await b.collection("users").doc(a).get();if(!c.exists)return null;let d=c.data(),e=await (0,h.O0)(),f=[];if(d.role)if("admin"===d.role)f=Object.keys(i.Jj);else{let a=e.find(a=>a.id===d.role);a&&(f=a.permissions||[])}return{...d,uid:a,permissions:[...new Set(f)]}}catch(a){return console.error("Error fetching user by ID:",String(a)),null}},s=async a=>{let b=await (0,f.Lf)();if(!b)return null;try{let c=await b.collection("clients").doc(a).get();if(!c.exists)return null;let d=c.data(),e=JSON.parse(JSON.stringify(d,(a,b)=>b&&"object"==typeof b&&b.hasOwnProperty("seconds")&&b.hasOwnProperty("nanoseconds")?new Date(1e3*b.seconds).toISOString():b));return{id:c.id,...e}}catch(b){return console.error(`Error getting client by ID ${a}:`,String(b)),null}},t=async()=>{let a=(0,g.UL)().get("session");if(!a?.value)return null;try{let b=await (0,f.iS)(),c=await b.verifySessionCookie(a.value,!0),d=await r(c.uid);if(d)return d;if(c.isClient){let a=await s(c.uid);if(a)return{...a,isClient:!0}}return console.warn(`Session cookie for UID ${c.uid} is valid, but user not found in Firestore. Logging out.`),(0,g.UL)().delete("session"),null}catch(a){return console.warn("Session verification failed, session is likely invalid. Clearing cookie.",String(a)),(0,g.UL)().delete("session"),null}};async function m(a){let b=await (0,f.iS)();try{let c=await b.verifyIdToken(a,!0),d=await r(c.uid);if(!d)throw Error("User not found in database.");c.role!==d?.role&&await b.setCustomUserClaims(c.uid,{role:d?.role||"viewer"});let e=await b.createSessionCookie(a,{expiresIn:6048e5});return(0,g.UL)().set("session",e,{maxAge:604800,httpOnly:!0,secure:!0,path:"/",sameSite:"none"}),{success:!0,user:d}}catch(a){return console.error("Error creating session cookie:",String(a)),{success:!1,error:a.message}}}async function n(a){(await (0,g.UL)()).set("session",JSON.stringify(a),{httpOnly:!0,secure:!0,maxAge:604800,path:"/",sameSite:"lax"})}let u=async a=>{let b=await (0,f.Lf)();if(!b)return null;try{let c=b.collection("users"),d=await c.where("email","==",a).limit(1).get();if(d.empty)return null;let e=d.docs[0];return{...e.data(),uid:e.id}}catch(a){return console.error("Error getting user by email:",String(a)),null}};async function o(a){return await m(a)}async function p(a){let b=await (0,f.iS)();try{let c=await b.createCustomToken(a);return{success:!0,customToken:c}}catch(a){return console.error("Error creating custom token for user:",String(a)),{success:!1,error:a.message}}}async function q(){(await (0,g.UL)()).delete("session")}(0,j.D)([l,r,s,t,m,n,u,o,p,q]),(0,e.A)(l,"00d790a9c67325f46e1dda5ba33e59ecfd95062466",null),(0,e.A)(r,"7f33ef79ae72de1c2db1340cf81f1c0a0a525a8033",null),(0,e.A)(s,"7f7cc5ac28f76953e580388c96325185bdb57f592c",null),(0,e.A)(t,"7faf63d9d8686c0ff053833c82fd60b3e9c6fa0bff",null),(0,e.A)(m,"408d4523c5fa8dbd353900a15d896d0ebee083358b",null),(0,e.A)(n,"40213622e57351942781ff52345df063ded4056884",null),(0,e.A)(u,"7f33fcd02c8b1dfc136d21fd7035ce40fe2d48b135",null),(0,e.A)(o,"40fc6757a7ed8ba6cf86a7bf30e6bf0934f153f439",null),(0,e.A)(p,"4085aac590f12a4a641b5bc7fff47d5353af49510e",null),(0,e.A)(q,"00454095f373f8afcf3cd8b88a3e9643ba6181edb6",null),d()}catch(a){d(a)}})},40776:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{Cm:()=>u,O0:()=>t,TK:()=>r,hG:()=>s,ht:()=>o,lo:()=>p,nu:()=>q,qV:()=>w,v_:()=>v});var e=c(75879);c(68633);var f=c(14276),g=c(43513),h=c(16780),i=c(12019),j=c(70598),k=c(30984),l=c(55511),m=c(51669),n=a([f,g]);[f,g]=n.then?(await n)():n;let x=a=>{if(!a)return null;let b=JSON.parse(JSON.stringify(a));for(let a in b)b[a]&&(b[a].hasOwnProperty("_seconds")||"function"==typeof b[a].toDate)&&(b[a]=new Date(1e3*b[a]._seconds||b[a].toDate()).toISOString());return b};async function o(a){let b=await (0,g.Lf)();if(!b)return null;try{let c=b.collection("users"),d=await c.where("email","==",a).limit(1).get();if(d.empty)return null;let e=d.docs[0];return{...x(e.data()),uid:e.id}}catch(a){return console.error("Error getting user by email:",String(a)),null}}async function p({includeHrData:a=!1,all:b=!1,from:c,to:d}={}){try{let b=await (0,g.Lf)(),e=(0,f.getAuth)(),[h,l]=await Promise.all([e.listUsers(),b.collection("users").get()]),m=new Map(l.docs.map(a=>[a.id,x(a.data())])),n=h.users.map(a=>{let b=m.get(a.uid)||{};return{uid:a.uid,name:a.displayName||b.name||"No Name",username:b.username||"",email:a.email||b.email||"",phone:a.phoneNumber||b.phone||"",avatarUrl:a.photoURL||b.avatarUrl,status:b.status||(a.disabled?"blocked":"pending"),role:b.role||"viewer",department:b.department,position:b.position,boxId:b.boxId,baseSalary:b.baseSalary||0,bonuses:b.bonuses||0,deductions:b.deductions||0,notes:b.notes,attendance:b.attendance||[],ticketProfit:b.ticketProfit,visaProfit:b.visaProfit,groupProfit:b.groupProfit,changeProfit:b.changeProfit,segmentProfit:b.segmentProfit,preferences:b.preferences||{},calculatedTotalProfit:0,calculatedNetSalary:0}});if(a){let a=c?(0,i.o)(c):void 0,e=d?(0,j.D)(d):void 0,f=await b.collection("journal-vouchers").get(),g={};f.forEach(b=>{let c=b.data(),d=c.officer,f=(0,k.H)(c.date);if(d&&(!a||!e||f>=a&&f<=e)){g[d]||(g[d]=0);let a=c.originalData?.salePrice||(c.originalData?.passengers||[]).reduce((a,b)=>a+(b.salePrice||0),0),b=c.originalData?.purchasePrice||(c.originalData?.passengers||[]).reduce((a,b)=>a+(b.purchasePrice||0),0);g[d]+=a-b}}),n.forEach(a=>{a.calculatedTotalProfit=g[a.name]||0,a.calculatedNetSalary=(a.baseSalary||0)+(a.bonuses||0)-(a.deductions||0)+a.calculatedTotalProfit})}return n}catch(a){return console.error("Error fetching users:",String(a)),[]}}async function q(a){let b=await (0,f.getAuth)(),c=await (0,g.Lf)(),{email:d,password:e,name:i,phone:j,...k}=a,m=e&&e.length>=6?e:(0,l.randomBytes)(16).toString("hex"),n=j;n&&!n.startsWith("+")&&(n=n.startsWith("0")?`+964${j.substring(1)}`:`+964${j}`);let o=await b.createUser({email:d,password:m,displayName:i,phoneNumber:n,disabled:"blocked"===a.status});return await c.collection("users").doc(o.uid).set({...k,name:i,email:d,phone:n}),(0,h.revalidatePath)("/users"),{success:!0,newUser:{uid:o.uid,...a}}}async function r(a,b){let c=await (0,f.getAuth)(),d=await (0,g.Lf)(),{email:e,name:i,phone:j,password:k,status:l,avatarUrl:m,...n}=b,o={};e&&(o.email=e),i&&(o.displayName=i),j&&(o.phoneNumber=j),m&&(o.photoURL=m),k&&k.length>=6&&(o.password=k),l&&(o.disabled="blocked"===l),Object.keys(o).length>0&&await c.updateUser(a,o);let p={...n,email:e,name:i,phone:j,status:l,avatarUrl:m};Object.keys(p).forEach(a=>void 0===p[a]&&delete p[a]),Object.keys(p).length>0&&await d.collection("users").doc(a).set(p,{merge:!0}),(0,h.revalidatePath)("/users");let q=await d.collection("users").doc(a).get(),r=x(q.data());return{success:!0,updatedUser:{...r,uid:a}}}async function s(a){let b=await (0,f.getAuth)(),c=await (0,g.Lf)();return await b.deleteUser(a),await c.collection("users").doc(a).delete(),(0,h.revalidatePath)("/users"),{success:!0}}async function t(){let a=await (0,g.Lf)();return(await a.collection("roles").get()).docs.map(a=>({id:a.id,...a.data()}))}async function u(a){let b=await (0,g.Lf)(),c=a.name.toLowerCase().replace(/\s+/g,"_");return await b.collection("roles").doc(c).set(a),(0,h.revalidatePath)("/users"),{success:!0,newRole:{id:c,...a}}}async function v(a,b){let c=await (0,g.Lf)();return await c.collection("roles").doc(a).update(b),(0,h.revalidatePath)("/users"),{success:!0}}async function w(){try{let a=await (0,f.getAuth)(),b=(await a.listUsers()).users.map(a=>({uid:a.uid,email:a.email,displayName:a.displayName,creationTime:new Date(a.metadata.creationTime).toLocaleDateString()}));return{success:!0,users:b}}catch(a){return console.error("Error listing all auth users:",String(a)),{success:!1,error:a.message}}}(0,m.D)([o,p,q,r,s,t,u,v,w]),(0,e.A)(o,"406818275705b776627a9e14558eaa7857fbec9b73",null),(0,e.A)(p,"40290c8e8678ea3c7dc08bc14a2b21bf84ced558a3",null),(0,e.A)(q,"40d4790cf5bfe15d462399ad8c52d1baec8babf86f",null),(0,e.A)(r,"601532f3b7a46dae258a5ff32f14fb4b3e2e141e9f",null),(0,e.A)(s,"40ef77a697a84cf599002575e6afc4c1de58c3cdab",null),(0,e.A)(t,"005773e734ccf3535fa61ed9b34042d47625b1ede6",null),(0,e.A)(u,"40e13d085ff779b8dfbb82e790ebb21702ce079192",null),(0,e.A)(v,"601838acb9f969bfd30fa9f583c86dd453b19524dd",null),(0,e.A)(w,"00afcee30c25fc6521aeaf596fabd0fef5e0ca707f",null),d()}catch(a){d(a)}})},43513:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{$E:()=>q,Lf:()=>o,iS:()=>p});var e=c(75879);c(68633);var f=c(9801),g=c(14276),h=c(7879),i=c(24803),j=c(29559),k=c(51669),l=a([f,g,h,i]);[f,g,h,i]=l.then?(await l)():l;let r=null,s=null;async function m(){if((0,f.getApps)().length>0)return r=(0,f.getApp)();if(!j.R||!j.R.projectId||!j.R.privateKey||!j.R.clientEmail)throw console.error("Firebase Admin SDK Service Account object is not valid."),s=Error("Default Firebase service account is not valid in firebase-service-account.ts.");try{console.log("Initializing Firebase Admin SDK...");let a=(0,f.initializeApp)({credential:(0,f.cert)(j.R),storageBucket:`${j.R.projectId}.appspot.com`});return r=a,console.log("Firebase Admin SDK initialized successfully."),a}catch(a){throw console.error("Failed to initialize Firebase Admin SDK:",String(a)),s=a instanceof Error?a:Error(String(a))}}async function n(){if(r)return r;if(s)throw s;return await m()}async function o(){let a=await n();return(0,h.getFirestore)(a)}async function p(){let a=await n();return(0,g.getAuth)(a)}async function q(){let a=await n();return(0,i.getStorage)(a)}(0,k.D)([o,p,q]),(0,e.A)(o,"009e84f93947e0a432e28675ea07a71949bfe66943",null),(0,e.A)(p,"0084d26686615403d39adac4c095e2f442ed3af27d",null),(0,e.A)(q,"0079928ff14026085419c5483c28b98ee3311389f6",null),d()}catch(a){d(a)}})}};