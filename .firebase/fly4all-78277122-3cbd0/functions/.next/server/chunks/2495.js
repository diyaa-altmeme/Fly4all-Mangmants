"use strict";exports.id=2495,exports.ids=[2495],exports.modules={12495:(a,b,c)=>{c.d(b,{A:()=>G});var d=c(21124),e=c(38301),f=c(40068),g=c(31980),h=c(50937),i=c(99546),j=c(35284),k=c(68120),l=c(68254),m=c(45608),n=c(49113),o=c(38692),p=c(34118),q=c(11943),r=c(49566),s=c(37448),t=c(21853),u=c(85708);let v=(0,u.createServerReference)("60c7862a4ca16493782c4d556b1c72f9ee8d90ed17",u.callServer,void 0,u.findSourceMapURL,"updateRemittance");var w=c(88580),x=c(27186),y=c(25456),z=c(44943),A=c(97802),B=c(63009);let C=i.Ik({companyName:i.Yj().min(1,"اسم الشركة مطلوب"),officeName:i.Yj().min(1,"اسم المكتب مطلوب"),method:i.Yj().min(1,"طريقة التحويل مطلوبة"),assignedToUid:i.Yj().min(1,"المخول بالاستلام مطلوب"),boxId:i.Yj().min(1,"الصندوق المستلم مطلوب"),totalAmountUsd:i.au.number().min(0).default(0),totalAmountIqd:i.au.number().min(0).default(0),distributions:i.g1(i.au.number().min(0)),notes:i.Yj().optional()}).refine(a=>a.totalAmountUsd>0||a.totalAmountIqd>0,{message:"يجب إدخال مبلغ للحوالة إما بالدولار أو بالدينار.",path:["totalAmountUsd"]}),D=({currency:a,className:b,...c})=>(0,d.jsx)(y.O,{currency:a,className:(0,z.cn)("text-right",b),currencyClassName:(0,z.cn)("USD"===a?"bg-accent text-accent-foreground":"bg-primary text-primary-foreground"),...c});function E({settings:a,onSaveSuccess:b,isEditing:c=!1,initialData:i}){let{toast:u}=(0,s.dj)(),{data:y,loaded:z}=(0,A.Z)(),{user:E}=(0,B.A)(),F=(0,g.mN)({resolver:(0,h.u)(C),defaultValues:c&&i?{...i,distributions:i.distribution||{}}:{totalAmountUsd:0,totalAmountIqd:0,distributions:{},boxId:E&&"role"in E?E.boxId:""}}),{register:G,formState:{errors:H,isSubmitting:I},setValue:J}=F,K=(0,e.useMemo)(()=>(y?.users||[]).map(a=>({value:a.uid,label:a.name})),[y?.users]),L=(0,e.useMemo)(()=>{let a=F.watch("boxId");return y?.boxes?.find(b=>b.id===a)?.name||"غير محدد"},[F,y?.boxes]),M=async a=>{let d={companyName:a.companyName,officeName:a.officeName,method:a.method,assignedToUid:a.assignedToUid,boxId:a.boxId,totalAmountUsd:a.totalAmountUsd||0,totalAmountIqd:a.totalAmountIqd||0,distribution:a.distributions,notes:a.notes||""};if(c&&i){let a=await v(i.id,d);a.success?(u({title:"تم تحديث الحوالة بنجاح"}),b({...i,...d})):u({title:"خطأ",description:a.error,variant:"destructive"})}else{let a=await (0,w.Q)(d);a.success&&a.newRemittance?(u({title:"تمت إضافة الحوالة بنجاح"}),b(a.newRemittance),F.reset()):u({title:"خطأ",description:a.error,variant:"destructive"})}};return z&&y?(0,d.jsx)(x.lV,{...F,children:(0,d.jsxs)("form",{onSubmit:F.handleSubmit(M),className:"space-y-6",children:[(0,d.jsxs)("div",{className:"grid md:grid-cols-2 gap-x-6 gap-y-4",children:[(0,d.jsx)(x.zB,{control:F.control,name:"companyName",render:({field:a})=>(0,d.jsxs)(x.eI,{className:"space-y-1.5",children:[(0,d.jsx)(k.J,{children:"الشركة المرسلة"}),(0,d.jsx)(x.MJ,{children:(0,d.jsx)(t.j,{searchAction:"all",value:a.value,onValueChange:a.onChange,placeholder:"ابحث عن شركة..."})}),(0,d.jsx)(x.C5,{})]})}),(0,d.jsx)(x.zB,{control:F.control,name:"officeName",render:({field:b})=>(0,d.jsxs)(x.eI,{className:"space-y-1.5",children:[(0,d.jsx)(k.J,{children:"المكتب"}),(0,d.jsxs)(m.l6,{onValueChange:b.onChange,value:b.value,children:[(0,d.jsx)(x.MJ,{children:(0,d.jsx)(m.bq,{children:(0,d.jsx)(m.yv,{placeholder:"اختر المكتب..."})})}),(0,d.jsx)(m.gC,{children:a.offices.map(a=>(0,d.jsx)(m.eb,{value:a,children:a},a))})]}),(0,d.jsx)(x.C5,{})]})}),(0,d.jsx)(x.zB,{control:F.control,name:"method",render:({field:b})=>(0,d.jsxs)(x.eI,{className:"space-y-1.5",children:[(0,d.jsx)(k.J,{children:"طريقة التحويل"}),(0,d.jsxs)(m.l6,{onValueChange:b.onChange,value:b.value,children:[(0,d.jsx)(x.MJ,{children:(0,d.jsx)(m.bq,{children:(0,d.jsx)(m.yv,{placeholder:"اختر الطريقة..."})})}),(0,d.jsx)(m.gC,{children:a.methods.map(a=>(0,d.jsx)(m.eb,{value:a,children:a},a))})]}),(0,d.jsx)(x.C5,{})]})}),(0,d.jsx)(x.zB,{control:F.control,name:"assignedToUid",render:({field:a})=>(0,d.jsxs)(x.eI,{className:"space-y-1.5",children:[(0,d.jsx)(k.J,{children:"المخول بالاستلام"}),(0,d.jsxs)(m.l6,{onValueChange:a.onChange,value:a.value,children:[(0,d.jsx)(x.MJ,{children:(0,d.jsx)(m.bq,{children:(0,d.jsx)(m.yv,{placeholder:"اختر موظفًا..."})})}),(0,d.jsx)(m.gC,{children:K.map(a=>(0,d.jsx)(m.eb,{value:a.value,children:a.label},a.value))})]}),(0,d.jsx)(x.C5,{})]})})]}),(0,d.jsxs)("div",{className:"space-y-4 bg-muted/50 p-4 rounded-lg border",children:[(0,d.jsx)("h4",{className:"font-semibold",children:"توزيع مبالغ الحوالة"}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{className:"space-y-1.5",children:[(0,d.jsx)(k.J,{children:"الإجمالي (USD)"}),(0,d.jsx)(g.xI,{control:F.control,name:"totalAmountUsd",render:({field:a})=>(0,d.jsx)(D,{currency:"USD",...a,onValueChange:a.onChange})}),(0,d.jsx)(x.C5,{children:H.totalAmountUsd?.message})]}),(0,d.jsxs)("div",{className:"space-y-1.5",children:[(0,d.jsx)(k.J,{children:"الإجمالي (IQD)"}),(0,d.jsx)(g.xI,{control:F.control,name:"totalAmountIqd",render:({field:a})=>(0,d.jsx)(D,{currency:"IQD",...a,onValueChange:a.onChange})})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[a.distributionColumnsUsd?.map(a=>(0,d.jsxs)("div",{className:"space-y-1.5",children:[(0,d.jsxs)(k.J,{children:[a.label," (USD)"]}),(0,d.jsx)(g.xI,{control:F.control,name:`distributions.${a.id}_usd`,render:({field:a})=>(0,d.jsx)(D,{currency:"USD",...a,onValueChange:a.onChange})})]},a.id)),a.distributionColumnsIqd?.map(a=>(0,d.jsxs)("div",{className:"space-y-1.5",children:[(0,d.jsxs)(k.J,{children:[a.label," (IQD)"]}),(0,d.jsx)(g.xI,{control:F.control,name:`distributions.${a.id}_iqd`,render:({field:a})=>(0,d.jsx)(D,{currency:"IQD",...a,onValueChange:a.onChange})})]},a.id))]})]}),(0,d.jsxs)("div",{className:"space-y-1.5",children:[(0,d.jsx)(k.J,{children:"ملاحظات"}),(0,d.jsx)(l.T,{...G("notes")})]}),(0,d.jsxs)(f.Es,{className:"pt-4 flex-col sm:flex-row gap-2 justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[(0,d.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,d.jsx)(o.A,{className:"h-4 w-4"})," ",(0,d.jsxs)("span",{children:["المستخدم: ",E?.name||"..."]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,d.jsx)(p.A,{className:"h-4 w-4"})," ",(0,d.jsxs)("span",{children:["الصندوق: ",L]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,d.jsx)(q.A,{className:"h-4 w-4"})," ",(0,d.jsx)("span",{children:"رقم الفاتورة: (تلقائي)"})]})]}),(0,d.jsxs)(j.$,{type:"submit",disabled:I,children:[I&&(0,d.jsx)(n.A,{className:"me-2 h-4 w-4 animate-spin"}),(0,d.jsx)(r.A,{className:"me-2 h-4 w-4"}),c?"حفظ التعديلات":"حفظ الحوالة"]})]})]})}):(0,d.jsx)("div",{className:"flex justify-center items-center h-48",children:(0,d.jsx)(n.A,{className:"h-8 w-8 animate-spin"})})}var F=c(25054);function G({onSaveSuccess:a,children:b,isEditing:c=!1,initialData:g}){let[h,i]=(0,e.useState)(!1),{data:j,loaded:k,fetchData:l}=(0,A.Z)(),m=j?.settings?.remittanceSettings,o=(0,e.useMemo)(()=>{if(g)return{...g,createdAt:g.createdAt?(0,F.H)(g.createdAt):new Date,updatedAt:g.updatedAt?(0,F.H)(g.updatedAt):new Date,auditedAt:g.auditedAt?(0,F.H)(g.auditedAt):void 0,receivedAt:g.receivedAt?(0,F.H)(g.receivedAt):void 0}},[g]);return(0,d.jsxs)(f.lG,{open:h,onOpenChange:i,children:[(0,d.jsx)(f.zM,{asChild:!0,children:b}),(0,d.jsxs)(f.Cf,{className:"sm:max-w-4xl p-0",children:[(0,d.jsxs)(f.c7,{className:"bg-primary text-primary-foreground p-4 rounded-t-lg",children:[(0,d.jsx)(f.L3,{children:c?"تعديل بيانات الحوالة":"إضافة حوالة جديدة"}),(0,d.jsx)(f.rr,{className:"text-primary-foreground/80",children:c?"قم بتحديث تفاصيل الحوالة.":"أدخل جميع تفاصيل الحوالة هنا. سيتم حفظها وانتظار التدقيق."})]}),(0,d.jsx)("div",{className:"max-h-[80vh] overflow-y-auto p-6",children:k&&m?(0,d.jsx)(E,{settings:m,onSaveSuccess:b=>{a(b),i(!1)},isEditing:c,initialData:o}):(0,d.jsx)("div",{className:"flex justify-center items-center h-48",children:(0,d.jsx)(n.A,{className:"h-8 w-8 animate-spin"})})})]})]})}},88580:(a,b,c)=>{c.d(b,{Q:()=>e});var d=c(85708);let e=(0,d.createServerReference)("408c79ddd0d0a9122724301d14534a0975eed69018",d.callServer,void 0,d.findSourceMapURL,"addRemittance")}};