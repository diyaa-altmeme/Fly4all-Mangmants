(()=>{var a={};a.id=8407,a.ids=[8407],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},643:a=>{"use strict";a.exports=require("node:perf_hooks")},1708:a=>{"use strict";a.exports=require("node:process")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3315:(a,b,c)=>{"use strict";c.d(b,{G:()=>k});var d=c(91488);c(27806);var e=c(38710),f=c(79592),g=c(40410);let h=f.Ik({name:f.Yj().describe("Full name of the passenger."),ticketNumber:f.Yj().describe("The ticket number for the passenger."),passportNumber:f.Yj().optional().describe("The passport number of the passenger."),passengerType:f.k5(["Adult","Child","Infant"]).describe("Type of passenger (Adult, Child, or Infant)."),ticketType:f.k5(["Issue","Change","Refund"]).default("Issue").describe("The type of ticket transaction.")}),i=f.Ik({fileDataUri:f.Yj().describe("A PDF file of a flight ticket, as a data URI that must include a MIME type and use Base64 encoding. Expected format: 'data:application/pdf;base64,<encoded_data>'.")}),j=f.Ik({pnr:f.Yj().describe("The PNR (Passenger Name Record) or booking reference of the ticket."),route:f.Yj().describe('The flight route, like "BGW-DXB".'),airline:f.Yj().describe("The airline operating the flight."),airlineIataCode:f.Yj().length(2).optional().describe('The two-letter IATA code for the airline (e.g., "FZ" for Fly Dubai). Only return if a valid 2-letter code is found.'),airlineLogoUrl:f.Yj().optional().describe("The URL for the airline logo, constructed from its IATA code. Only return if a valid IATA code is found."),issueDate:f.Yj().describe("The issue date of the ticket in YYYY-MM-DD format."),travelDate:f.Yj().describe("The travel date of the first flight segment in YYYY-MM-DD format."),passengers:f.YO(h).describe("An array of all passengers on this ticket.")});async function k(a){return m(a)}let l=e.ai.definePrompt({name:"extractTicketDataPrompt",input:{schema:i},output:{schema:j},prompt:`You are an expert travel agent assistant. Your task is to extract structured data from a flight ticket PDF.

    Analyze the provided flight ticket file and extract the following information:
    - PNR (Passenger Name Record) or Booking Reference. This is a crucial 6-character alphanumeric code. Look for labels like "Booking Reference", "PNR", "الحجز", or "مرجع الحجز". Be very precise and extract only the single, correct PNR.
    - The flight route, formatted as "FROM-TO" (e.g., "BGW-DXB").
    - The name of the airline.
    - The two-letter IATA code for the airline (e.g., "EK" for Emirates, "FZ" for Fly Dubai, "QR" for Qatar Airways). If you cannot determine the IATA code, do not include the 'airlineIataCode' or 'airlineLogoUrl' fields in the output.
    - The issue date of the ticket in YYYY-MM-DD format.
    - The travel date of the first flight segment in YYYY-MM-DD format.
    - A list of all passengers, including their full name, ticket number, passport number (if available), and passenger type (Adult, Child, or Infant).

    If, and only if, you extract a valid two-letter IATA code, you MUST construct the airlineLogoUrl using this exact format: \`https://assets.duffel.com/img/airlines/for-light-background/full-color-logo/IATA_CODE.svg\`, replacing IATA_CODE with the extracted two-letter code.

    Return the data in the specified JSON format.

    Ticket File: {{media url=fileDataUri}}
    `}),m=e.ai.defineFlow({name:"extractTicketDataFlow",inputSchema:i,outputSchema:j},async a=>{let{output:b}=await l(a);if(!b)throw Error("Failed to extract data from ticket.");return b});(0,g.D)([k]),(0,d.A)(k,"402b41f05271dbe007d0f9816bed0bf5ec263bba15",null)},3613:(a,b,c)=>{"use strict";c.d(b,{A:()=>d});let d=(0,c(8808).A)("ChevronsLeft",[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]])},4573:a=>{"use strict";a.exports=require("node:buffer")},7252:a=>{"use strict";a.exports=require("express")},7879:a=>{"use strict";a.exports=import("firebase-admin/firestore")},9801:a=>{"use strict";a.exports=import("firebase-admin/app")},9987:(a,b,c)=>{"use strict";c.d(b,{A:()=>d});let d=(0,c(8808).A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11423:(a,b,c)=>{"use strict";c.d(b,{A:()=>d});let d=(0,c(8808).A)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},12412:a=>{"use strict";a.exports=require("assert")},13406:(a,b,c)=>{"use strict";c.d(b,{default:()=>a_});var d=c(21124),e=c(38301),f=c.n(e),g=c(79202),h=c(44043),i=c(9987),j=c(90447),k=c(8929),l=c(64698),m=c(62777),n=c(92283),o=c(57105),p=c(80623),q=c(25730),r=c(11423),s=c(90023),t=c(27810),u=c(40822),v=c(92080),w=c(99187),x=c(35284),y=c(11563),z=c(85708);let A=(0,z.createServerReference)("40dc0f099e7b5a731a230c5f6ba0d64c59c23245aa",z.callServer,void 0,z.findSourceMapURL,"softDeleteBooking");var B=c(37448),C=c(12439),D=c(91842),E=c(44943),F=c(24515),G=c(63822),H=c(25054),I=c(97802),J=c(86851),K=c(67094),L=c(62186),M=c(90114),N=c(48777),O=c(31773);let P=(a,b)=>"number"!=typeof a||isNaN(a)?"-":new Intl.NumberFormat("en-US").format(a)+` ${b}`,Q=({amount:a,currency:b,icon:c,colorClass:e,title:f})=>null!==a&&"number"==typeof a&&isFinite(a)?(0,d.jsxs)("div",{className:"flex items-center gap-2 justify-center",title:f,children:[(0,d.jsx)(c,{className:(0,E.cn)("h-4 w-4",e)}),(0,d.jsx)("span",{className:(0,E.cn)("font-mono font-semibold",e),children:a.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})})]}):(0,d.jsx)("span",{className:"text-muted-foreground",children:"-"}),R=({type:a})=>{let b={booking:{label:"إصدار",icon:h.A,className:"bg-blue-100 text-blue-800"},exchange:{label:"تغيير",icon:i.A,className:"bg-yellow-100 text-yellow-800"},refund:{label:"استرجاع",icon:j.A,className:"bg-red-100 text-red-800"},void:{label:"فويد",icon:j.A,className:"bg-gray-100 text-gray-800"},Multiple:{label:"عمليات متعددة",icon:k.A,className:"bg-purple-100 text-purple-800"}}[a];if(!b)return(0,d.jsx)(w.E,{variant:"secondary",children:a});let c=b.icon;return(0,d.jsxs)(w.E,{variant:"outline",className:(0,E.cn)("gap-1.5",b.className),children:[(0,d.jsx)(c,{className:"h-3 w-3"}),b.label]})},S=({type:a,className:b})=>{let c={Adult:{icon:l.A},Child:{icon:m.A},Infant:{icon:n.A}}[a];if(!c)return null;let e=c.icon;return(0,d.jsx)(e,{className:(0,E.cn)("h-4 w-4",b)})},T=({booking:a,onBookingUpdated:b,onBookingDeleted:c,clients:h,suppliers:i})=>{let{toast:j}=(0,B.dj)();if(!a)return(0,d.jsx)(g.Hj,{children:(0,d.jsx)(g.nA,{colSpan:10,className:"text-center text-destructive",children:"بيانات الحجز الأصلية مفقودة لهذا السجل."})});let k=async()=>{let b=await A(a.id);b.success?(j({title:"تم نقل الحجز إلى سجل المحذوفات"}),c(a.id)):j({title:"خطأ",description:b.error,variant:"destructive"})},l=a.currency||"USD",{totalSale:m,totalPurchase:n,totalProfit:w,supplierId:z,clientId:I,pnr:M,route:N,passengers:O}=(0,e.useMemo)(()=>{let b=(a.passengers||[]).reduce((a,b)=>a+(b.salePrice||0),0),c=(a.passengers||[]).reduce((a,b)=>a+(b.purchasePrice||0),0);return{totalSale:b,totalPurchase:c,totalProfit:b-c,supplierId:a.supplierId,clientId:a.clientId,pnr:a.pnr||a.id.slice(-6),route:a.route,passengers:a.passengers||[]}},[a]),T=i.find(a=>a.id===z)?.name||z,U=h.find(a=>a.id===I)?.name||I,V=(0,e.useMemo)(()=>"booking",[]);return(0,d.jsxs)(f().Fragment,{children:[(0,d.jsxs)(g.Hj,{className:"font-bold text-center",children:[(0,d.jsx)(g.nA,{className:"border p-2 align-middle",children:(0,d.jsx)(K.R6,{asChild:!0,children:(0,d.jsx)(x.$,{variant:"ghost",size:"icon",className:"h-8 w-8 data-[state=open]:rotate-180",children:(0,d.jsx)(o.A,{className:"h-4 w-4"})})})}),(0,d.jsxs)(g.nA,{className:"border p-2 align-middle",children:[(0,d.jsx)("div",{className:"font-mono text-xs",children:a.invoiceNumber}),(0,d.jsx)("div",{className:"text-xs text-muted-foreground",children:a.issueDate?(0,G.GP)((0,H.H)(a.issueDate),"yyyy-MM-dd"):"-"})]}),(0,d.jsxs)(g.nA,{className:"border p-2 align-middle",children:[(0,d.jsx)("div",{className:"font-mono font-semibold",children:M}),(0,d.jsx)("div",{className:"text-xs text-muted-foreground",children:N})]}),(0,d.jsx)(g.nA,{className:"border p-2 align-middle",children:(0,d.jsxs)(J.cj,{children:[(0,d.jsx)(J.CG,{asChild:!0,children:(0,d.jsx)(x.$,{variant:"link",className:"p-0 h-auto font-bold",children:(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[a.airlineLogoUrl&&(0,d.jsx)(F.default,{src:a.airlineLogoUrl,alt:"",width:24,height:24,className:"rounded-full"}),(0,d.jsxs)("div",{className:"font-semibold",children:[(O||[]).length," مسافر"]})]})})}),(0,d.jsxs)(J.h,{children:[(0,d.jsxs)(J.Fm,{children:[(0,d.jsxs)(J.qp,{children:["المسافرون في حجز: ",M]}),(0,d.jsx)(J.Qs,{children:"تفاصيل المسافرين والبيانات المالية لكل منهم."})]}),(0,d.jsx)("div",{className:"space-y-3 mt-4",children:(O||[]).map((a,b)=>(0,d.jsxs)(L.Zp,{children:[(0,d.jsxs)(L.aR,{className:"p-3",children:[(0,d.jsx)(L.ZB,{className:"text-base",children:a.name}),(0,d.jsxs)(L.BT,{children:["تذكرة: ",a.ticketNumber," | جواز: ",a.passportNumber||"N/A"]})]}),(0,d.jsxs)(L.Wu,{className:"p-3 grid grid-cols-3 gap-2 text-center text-sm",children:[(0,d.jsxs)("div",{className:"bg-red-50 p-2 rounded-md",children:[(0,d.jsx)("p",{className:"text-xs text-muted-foreground",children:"الشراء"}),(0,d.jsx)("p",{className:"font-bold font-mono",children:P(a.purchasePrice,l)})]}),(0,d.jsxs)("div",{className:"bg-green-50 p-2 rounded-md",children:[(0,d.jsx)("p",{className:"text-xs text-muted-foreground",children:"البيع"}),(0,d.jsx)("p",{className:"font-bold font-mono",children:P(a.salePrice,l)})]}),(0,d.jsxs)("div",{className:"bg-blue-50 p-2 rounded-md",children:[(0,d.jsx)("p",{className:"text-xs text-muted-foreground",children:"الربح"}),(0,d.jsx)("p",{className:(0,E.cn)("font-bold font-mono",a.salePrice-a.purchasePrice<0?"text-destructive":""),children:P(a.salePrice-a.purchasePrice,l)})]})]})]},a.id||b))})]})]})}),(0,d.jsx)(g.nA,{className:"border p-2 align-middle",children:(0,d.jsx)(R,{type:V})}),(0,d.jsxs)(g.nA,{className:"border p-2 align-middle",children:[(0,d.jsx)("div",{className:"font-semibold",children:T}),(0,d.jsx)(Q,{title:`إجمالي التكلفة (${l})`,amount:n,currency:l,icon:p.A,colorClass:"text-red-500"})]}),(0,d.jsxs)(g.nA,{className:"border p-2 align-middle",children:[(0,d.jsx)("div",{className:"font-semibold",children:U}),(0,d.jsx)(Q,{title:`إجمالي المبيع (${l})`,amount:m,currency:l,icon:q.A,colorClass:"text-green-600"})]}),(0,d.jsx)(g.nA,{className:"border p-2 align-middle",children:(0,d.jsx)(Q,{title:"الربح",amount:w,currency:l,icon:r.A,colorClass:"text-blue-600 font-bold"})}),(0,d.jsxs)(g.nA,{className:"border p-2 align-middle",children:[(0,d.jsx)("div",{className:"text-xs",children:a.enteredBy}),a.enteredAt&&(0,d.jsx)("div",{className:"text-xs text-muted-foreground",children:(0,G.GP)((0,H.H)(a.enteredAt),"yyyy-MM-dd")})]}),(0,d.jsx)(g.nA,{className:"border p-2 align-middle",children:(0,d.jsxs)(y.rI,{children:[(0,d.jsx)(y.ty,{asChild:!0,children:(0,d.jsx)(x.$,{variant:"ghost",size:"icon",children:(0,d.jsx)(s.A,{className:"h-4 w-4"})})}),(0,d.jsxs)(y.SQ,{children:[(0,d.jsx)(D.A,{isEditing:!0,booking:a,onBookingUpdated:b,children:(0,d.jsxs)(y._2,{onSelect:a=>a.preventDefault(),disabled:"booking"!==V,children:[(0,d.jsx)(t.A,{className:"me-2 h-4 w-4"})," تعديل"]})}),(0,d.jsxs)(C.Lt,{children:[(0,d.jsx)(C.tv,{asChild:!0,children:(0,d.jsxs)(y._2,{onSelect:a=>a.preventDefault(),className:"text-destructive focus:text-destructive",children:[(0,d.jsx)(u.A,{className:"me-2 h-4 w-4"})," حذف"]})}),(0,d.jsxs)(C.EO,{children:[(0,d.jsxs)(C.wd,{className:"items-center text-center",children:[(0,d.jsx)("div",{className:"p-3 bg-destructive/10 rounded-full w-fit",children:(0,d.jsx)(v.A,{className:"h-8 w-8 text-destructive"})}),(0,d.jsx)(C.r7,{children:"هل أنت متأكد من الحذف؟"}),(0,d.jsx)(C.$v,{children:"هذا الإجراء سينقل الحجز إلى سجل المحذوفات. يمكنك استعادته لاحقًا."})]}),(0,d.jsxs)(C.ck,{className:"flex-row gap-2 justify-end",children:[(0,d.jsx)(C.Zr,{children:"إلغاء"}),(0,d.jsx)(C.Rx,{onClick:k,className:(0,E.cn)((0,x.r)({variant:"destructive"})),children:"نعم، قم بالحذف"})]})]})]})]})]})})]}),(0,d.jsx)(K.Ke,{asChild:!0,children:(0,d.jsx)(g.Hj,{children:(0,d.jsx)(g.nA,{colSpan:10,className:"p-0",children:(0,d.jsxs)("div",{className:"p-4 bg-muted/50",children:[(0,d.jsx)("h4",{className:"font-bold mb-2",children:"تفاصيل المسافرين:"}),(0,d.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,d.jsxs)(g.XI,{children:[(0,d.jsx)(g.A0,{children:(0,d.jsxs)(g.Hj,{className:"bg-background",children:[(0,d.jsx)(g.nd,{className:"font-semibold",children:"اسم المسافر"}),(0,d.jsx)(g.nd,{className:"font-semibold",children:"رقم الجواز"}),(0,d.jsx)(g.nd,{className:"font-semibold",children:"رقم التذكرة"}),(0,d.jsx)(g.nd,{className:"font-semibold",children:"نوع المسافر"}),(0,d.jsx)(g.nd,{className:"font-semibold",children:"نوع التذكرة"}),(0,d.jsx)(g.nd,{className:"text-center font-semibold",children:"شراء"}),(0,d.jsx)(g.nd,{className:"text-center font-semibold",children:"بيع"}),(0,d.jsx)(g.nd,{className:"text-center font-semibold",children:"ربح"})]})}),(0,d.jsx)(g.BF,{children:(O||[]).map((a,b)=>{let c=a.salePrice-a.purchasePrice;return(0,d.jsxs)(g.Hj,{children:[(0,d.jsx)(g.nA,{className:"font-medium",children:a.name}),(0,d.jsx)(g.nA,{className:"font-mono",children:a.passportNumber||"-"}),(0,d.jsx)(g.nA,{className:"font-mono",children:a.ticketNumber}),(0,d.jsx)(g.nA,{children:(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(S,{type:a.passengerType})," ",a.passengerType]})}),(0,d.jsx)(g.nA,{children:(0,d.jsx)(R,{type:a.ticketType||"Issue"})}),(0,d.jsx)(g.nA,{className:"text-center font-mono",children:P(a.purchasePrice,l)}),(0,d.jsx)(g.nA,{className:"text-center font-mono",children:P(a.salePrice,l)}),(0,d.jsx)(g.nA,{className:(0,E.cn)("text-center font-mono font-bold",c>=0?"text-green-600":"text-destructive"),children:P(c,l)})]},a.id||b)})})]})})]})})})})]})};function U({bookings:a,totalBookings:b,onBookingUpdated:c,onBookingDeleted:e}){let{data:h,loaded:i}=(0,I.Z)();if(!i)return(0,d.jsx)("div",{className:"text-center p-8",children:"جاري تحميل البيانات..."});let j=f().useMemo(()=>[],[]),k=(0,N.N4)({data:a,columns:j,manualPagination:!0,pageCount:Math.ceil(b/15),getCoreRowModel:(0,O.HT)(),getPaginationRowModel:(0,O.kW)()});return(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsx)("div",{className:"border rounded-lg overflow-x-auto",children:(0,d.jsxs)(g.XI,{className:"border-collapse",children:[(0,d.jsx)(g.A0,{children:(0,d.jsxs)(g.Hj,{children:[(0,d.jsx)(g.nd,{className:"w-[50px] border p-2"}),(0,d.jsx)(g.nd,{className:"border p-2 text-center font-bold",children:"الفاتورة / التاريخ"}),(0,d.jsx)(g.nd,{className:"border p-2 text-center font-bold",children:"PNR / المسار"}),(0,d.jsx)(g.nd,{className:"border p-2 text-center font-bold",children:"المسافرون"}),(0,d.jsx)(g.nd,{className:"border p-2 text-center font-bold",children:"نوع العملية"}),(0,d.jsx)(g.nd,{className:"border p-2 text-center font-bold",children:"المصدر / التكلفة"}),(0,d.jsx)(g.nd,{className:"border p-2 text-center font-bold",children:"المستفيد / المبيع"}),(0,d.jsx)(g.nd,{className:"border p-2 text-center font-bold",children:"الربح"}),(0,d.jsx)(g.nd,{className:"border p-2 text-center font-bold",children:"مدخل البيانات/التاريخ"}),(0,d.jsx)(g.nd,{className:"text-center font-bold border p-2",children:"الإجراءات"})]})}),(0,d.jsx)(g.BF,{children:0===a.length?(0,d.jsx)(g.Hj,{children:(0,d.jsx)(g.nA,{colSpan:10,className:"h-24 text-center border p-2",children:"لا توجد حجوزات لعرضها."})}):a.map((a,b)=>(0,d.jsx)(K.Nt,{asChild:!0,children:(0,d.jsx)(T,{booking:a,onBookingUpdated:c,onBookingDeleted:e,clients:h.clients||[],suppliers:h.suppliers||[]})},a.id||b))})]})}),(0,d.jsx)(M.T,{table:k,totalRows:b})]})}var V=c(49113),W=c(10656),X=c(14270),Y=c(59901),Z=c(90097),$=c(72001),_=c(93758),aa=c(45608),ab=c(9683),ac=c(31980),ad=c(50937),ae=c(99546),af=c(68120),ag=c(55322),ah=c(81166),ai=c(66782),aj=c(49566),ak=c(25307),al=c(71195),am=c(21853),an=c(5488),ao=c(25456),ap=c(63009),aq=c(27186),ar=c(52588);let as=ae.Ik({name:ae.Yj().min(1,"الاسم مطلوب"),passportNumber:ae.Yj().optional(),ticketNumber:ae.Yj().min(1,"رقم التذكرة مطلوب"),purchasePrice:ae.au.number().min(0,"سعر الشراء يجب أن يكون 0 أو أكثر.").default(0),clientStatement:ae.Yj().optional(),salePrice:ae.au.number().min(0,"سعر البيع يجب أن يكون 0 أو أكثر.").default(0),passengerType:ae.k5(["Adult","Child","Infant"]),ticketType:ae.k5(["Issue","Change","Refund","Void"]).default("Issue")}),at=ae.Ik({pnr:ae.Yj().min(1,"PNR مطلوب"),supplierId:ae.Yj().min(1,"المورد مطلوب"),clientId:ae.Yj().min(1,"العميل مطلوب"),travelDate:ae.p6({required_error:"تاريخ السفر مطلوب"}),issueDate:ae.p6({required_error:"تاريخ الإصدار مطلوب"}),boxId:ae.Yj().optional(),currency:ae.k5(["USD","IQD"]),passengers:ae.YO(as).min(1,"يجب إضافة مسافر واحد على الأقل"),route1:ae.Yj().optional(),route2:ae.Yj().optional(),route3:ae.Yj().optional(),route4:ae.Yj().optional()}),au=[{value:"Adult",label:"بالغ",icon:l.A},{value:"Child",label:"طفل",icon:m.A},{value:"Infant",label:"رضيع",icon:n.A}];function av({onBookingAdded:a,onCancel:b}){let{toast:c}=(0,B.dj)(),{data:h,loaded:i}=(0,I.Z)(),{user:j}=(0,ap.A)(),[k,l]=(0,e.useState)(null),m=f().useMemo(()=>ar.t.map(a=>({value:a.code,label:`${a.arabicName} (${a.code})`,arabicName:a.arabicName,city:a.city,country:a.country,arabicCountry:a.arabicCountry,useCount:a.useCount||0})).sort((a,b)=>b.useCount-a.useCount),[]),n=(0,ac.mN)({resolver:(0,ad.u)(at),defaultValues:{pnr:"",supplierId:"",clientId:"",currency:"USD",passengers:[{name:"",passportNumber:"",ticketNumber:"",purchasePrice:0,clientStatement:"",salePrice:0,passengerType:"Adult",ticketType:"Issue"}]}}),{control:o,handleSubmit:p,formState:{errors:q,isSubmitting:r},setValue:s,watch:t,getValues:w}=n,{fields:y,append:z,remove:A}=(0,ac.jz)({control:o,name:"passengers"}),D=f().useMemo(()=>(h?.suppliers||[]).map(a=>({value:a.id,label:a.name})),[h?.suppliers]),F=f().useMemo(()=>(h?.clients||[]).map(a=>({value:a.id,label:`${a.name} ${a.code?`(${a.code})`:""}`})),[h?.clients]),H=async b=>{let d=c({title:"جاري إضافة الحجز..."});try{let c=[b.route1,b.route2,b.route3,b.route4].filter(Boolean).join(" - "),e={pnr:b.pnr,supplierId:b.supplierId,clientId:b.clientId,boxId:b.boxId||"",currency:b.currency,travelDate:b.travelDate.toISOString(),issueDate:b.issueDate.toISOString(),route:c,notes:"",passengers:b.passengers.map(a=>({id:`temp-${Math.random()}`,name:a.name,passportNumber:a.passportNumber||"",ticketNumber:a.ticketNumber||"",purchasePrice:a.purchasePrice,salePrice:a.salePrice,passengerType:a.passengerType,ticketType:"Issue",clientStatement:a.clientStatement||"",currency:b.currency}))},f=await (0,ak.B)(e);if(f.success&&f.newBooking)d.update({id:d.id,title:"تمت الإضافة بنجاح"}),a(f.newBooking),n.reset();else throw Error(f.error)}catch(a){d.update({id:d.id,title:"خطأ",description:a.message,variant:"destructive"})}},J=async a=>{let b=await (0,al.x)(a.pnr);if(b&&b.length>0)return void l(b[0]);await H(a)};return i&&h?(0,d.jsxs)("div",{className:"relative pt-4",children:[(0,d.jsx)(x.$,{variant:"ghost",size:"icon",onClick:b,className:"absolute top-0 left-0 z-10",children:(0,d.jsx)(ag.A,{className:"h-5 w-5"})}),(0,d.jsx)(C.Lt,{open:!!k,onOpenChange:a=>!a&&l(null),children:(0,d.jsxs)(C.EO,{children:[(0,d.jsxs)(C.wd,{children:[(0,d.jsxs)(C.r7,{className:"flex items-center gap-2",children:[(0,d.jsx)(v.A,{className:"h-6 w-6 text-yellow-500"})," تنبيه: PNR مكرر"]}),(0,d.jsx)(C.$v,{children:"رقم الحجز (PNR) الذي أدخلته موجود بالفعل في النظام. هل أنت متأكد أنك تريد المتابعة وإنشاء حجز جديد بنفس الرقم؟"})]}),(0,d.jsxs)("div",{className:"p-4 bg-muted/50 rounded-lg text-sm",children:[(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"PNR:"})," ",k?.pnr]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"تاريخ الإصدار الأصلي:"})," ",k?.issueDate?(0,G.GP)(new Date(k.issueDate),"yyyy-MM-dd"):"N/A"]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"أدخل بواسطة:"})," ",k?.enteredBy]})]}),(0,d.jsxs)(C.ck,{children:[(0,d.jsx)(C.Zr,{onClick:()=>l(null),children:"لا، إلغاء"}),(0,d.jsx)(C.Rx,{onClick:()=>{l(null),H(w())},children:"نعم، متابعة على أي حال"})]})]})}),(0,d.jsx)(L.Zp,{children:(0,d.jsx)(L.Wu,{className:"pt-6",children:(0,d.jsx)(aq.lV,{...n,children:(0,d.jsxs)("form",{onSubmit:p(J),className:"space-y-4",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 items-start p-4 border rounded-lg bg-muted/30",children:[(0,d.jsx)(aq.zB,{name:"pnr",control:o,render:({field:a})=>(0,d.jsxs)(aq.eI,{children:[(0,d.jsx)(af.J,{children:"رقم PNR"}),(0,d.jsx)(aq.MJ,{children:(0,d.jsx)(_.p,{...a})}),(0,d.jsx)(aq.C5,{})]})}),(0,d.jsx)(aq.zB,{name:"supplierId",control:o,render:({field:a})=>(0,d.jsxs)(aq.eI,{children:[(0,d.jsx)(af.J,{children:"المورد"}),(0,d.jsx)(aq.MJ,{children:(0,d.jsx)(am.j,{options:D,value:a.value,onValueChange:a.onChange,placeholder:"ابحث عن مورد..."})}),(0,d.jsx)(aq.C5,{})]})}),(0,d.jsx)(aq.zB,{name:"clientId",control:o,render:({field:a})=>(0,d.jsxs)(aq.eI,{children:[(0,d.jsx)(af.J,{children:"العميل"}),(0,d.jsx)(aq.MJ,{children:(0,d.jsx)(am.j,{options:F,value:a.value,onValueChange:a.onChange,placeholder:"ابحث عن عميل..."})}),(0,d.jsx)(aq.C5,{})]})}),(0,d.jsx)(aq.zB,{name:"currency",control:o,render:({field:a})=>(0,d.jsxs)(aq.eI,{children:[(0,d.jsx)(af.J,{children:"العملة"}),(0,d.jsxs)(aa.l6,{onValueChange:a.onChange,value:a.value,children:[(0,d.jsx)(aq.MJ,{children:(0,d.jsx)(aa.bq,{children:(0,d.jsx)(aa.yv,{})})}),(0,d.jsxs)(aa.gC,{children:[(0,d.jsx)(aa.eb,{value:"USD",children:"USD"}),(0,d.jsx)(aa.eb,{value:"IQD",children:"IQD"})]})]}),(0,d.jsx)(aq.C5,{})]})}),(0,d.jsx)(aq.zB,{name:"travelDate",control:o,render:({field:a})=>(0,d.jsxs)(aq.eI,{children:[(0,d.jsx)(af.J,{children:"تاريخ السفر"}),(0,d.jsx)(aq.MJ,{children:(0,d.jsx)(an.K,{date:a.value,setDate:a.onChange})}),(0,d.jsx)(aq.C5,{})]})}),(0,d.jsx)(aq.zB,{name:"issueDate",control:o,render:({field:a})=>(0,d.jsxs)(aq.eI,{children:[(0,d.jsx)(af.J,{children:"تاريخ الإصدار"}),(0,d.jsx)(aq.MJ,{children:(0,d.jsx)(an.K,{date:a.value,setDate:a.onChange})}),(0,d.jsx)(aq.C5,{})]})})]}),(0,d.jsxs)("div",{className:"space-y-1 p-4 border rounded-lg bg-muted/30",children:[(0,d.jsx)(af.J,{children:"الروت (خط الرحلة)"}),(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsx)(ah.A,{className:"h-5 w-5 text-muted-foreground"}),(0,d.jsx)(ac.xI,{name:"route1",control:o,render:({field:a})=>(0,d.jsx)(am.j,{options:m,value:a.value,onValueChange:a.onChange,placeholder:"BGW"})}),(0,d.jsx)(ai.A,{className:"h-5 w-5 text-muted-foreground"}),(0,d.jsx)(ac.xI,{name:"route2",control:o,render:({field:a})=>(0,d.jsx)(am.j,{options:m,value:a.value,onValueChange:a.onChange,placeholder:"DXB"})}),(0,d.jsx)(ai.A,{className:"h-5 w-5 text-muted-foreground"}),(0,d.jsx)(ac.xI,{name:"route3",control:o,render:({field:a})=>(0,d.jsx)(am.j,{options:m,value:a.value,onValueChange:a.onChange,placeholder:"BKK"})}),(0,d.jsx)(ai.A,{className:"h-5 w-5 text-muted-foreground"}),(0,d.jsx)(ac.xI,{name:"route4",control:o,render:({field:a})=>(0,d.jsx)(am.j,{options:m,value:a.value,onValueChange:a.onChange,placeholder:"..."})})]})]}),(0,d.jsxs)("div",{className:"overflow-x-auto border rounded-lg",children:[(0,d.jsxs)(g.XI,{children:[(0,d.jsx)(g.A0,{children:(0,d.jsxs)(g.Hj,{className:"bg-muted/50",children:[(0,d.jsx)(g.nd,{className:"p-2 text-right",children:"اسم المسافر"}),(0,d.jsx)(g.nd,{className:"p-2 text-right",children:"رقم الجواز"}),(0,d.jsx)(g.nd,{className:"p-2 text-right",children:"رقم التذكرة"}),(0,d.jsx)(g.nd,{className:"p-2 text-right",children:"سعر الشراء"}),(0,d.jsx)(g.nd,{className:"p-2 text-right",children:"سعر البيع"}),(0,d.jsx)(g.nd,{className:"p-2 text-right",children:"نوع المسافر"}),(0,d.jsx)(g.nd,{className:"p-2 w-[50px]"})]})}),(0,d.jsx)(g.BF,{children:y.map((a,b)=>{let c=t("currency");return(0,d.jsxs)(g.Hj,{children:[(0,d.jsx)(g.nA,{className:"p-1",children:(0,d.jsx)(aq.zB,{name:`passengers.${b}.name`,control:o,render:({field:a})=>(0,d.jsxs)(aq.eI,{children:[(0,d.jsx)(aq.MJ,{children:(0,d.jsx)(_.p,{...a,placeholder:"الاسم الكامل"})}),(0,d.jsx)(aq.C5,{})]})})}),(0,d.jsx)(g.nA,{className:"p-1",children:(0,d.jsx)(aq.zB,{name:`passengers.${b}.passportNumber`,control:o,render:({field:a})=>(0,d.jsxs)(aq.eI,{children:[(0,d.jsx)(aq.MJ,{children:(0,d.jsx)(_.p,{...a,placeholder:"رقم الجواز"})}),(0,d.jsx)(aq.C5,{})]})})}),(0,d.jsx)(g.nA,{className:"p-1",children:(0,d.jsx)(aq.zB,{name:`passengers.${b}.ticketNumber`,control:o,render:({field:a})=>(0,d.jsxs)(aq.eI,{children:[(0,d.jsx)(aq.MJ,{children:(0,d.jsx)(_.p,{...a,placeholder:"رقم التذكرة"})}),(0,d.jsx)(aq.C5,{})]})})}),(0,d.jsx)(g.nA,{className:"p-1",children:(0,d.jsx)(aq.zB,{name:`passengers.${b}.purchasePrice`,control:o,render:({field:a})=>(0,d.jsxs)(aq.eI,{children:[(0,d.jsx)(aq.MJ,{children:(0,d.jsx)(ao.O,{currency:c,currencyClassName:(0,E.cn)("USD"===c?"bg-accent text-accent-foreground":"bg-primary text-primary-foreground"),...a,onValueChange:a.onChange})}),(0,d.jsx)(aq.C5,{})]})})}),(0,d.jsx)(g.nA,{className:"p-1",children:(0,d.jsx)(aq.zB,{name:`passengers.${b}.salePrice`,control:o,render:({field:a})=>(0,d.jsxs)(aq.eI,{children:[(0,d.jsx)(aq.MJ,{children:(0,d.jsx)(ao.O,{currency:c,currencyClassName:(0,E.cn)("USD"===c?"bg-accent text-accent-foreground":"bg-primary text-primary-foreground"),...a,onValueChange:a.onChange})}),(0,d.jsx)(aq.C5,{})]})})}),(0,d.jsx)(g.nA,{className:"p-1",children:(0,d.jsx)(aq.zB,{name:`passengers.${b}.passengerType`,control:o,render:({field:a})=>(0,d.jsxs)(aq.eI,{children:[(0,d.jsx)(aq.MJ,{children:(0,d.jsxs)(aa.l6,{onValueChange:a.onChange,value:a.value,children:[(0,d.jsx)(aa.bq,{children:(0,d.jsx)(aa.yv,{})}),(0,d.jsx)(aa.gC,{children:au.map(a=>{let b=a.icon;return(0,d.jsx)(aa.eb,{value:a.value,children:(0,d.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,d.jsx)("span",{children:a.label}),(0,d.jsx)(b,{className:"h-4 w-4"})]})},a.value)})})]})}),(0,d.jsx)(aq.C5,{})]})})}),(0,d.jsx)(g.nA,{className:"p-1",children:(0,d.jsx)(x.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>A(b),disabled:y.length<=1,children:(0,d.jsx)(u.A,{className:"h-4 w-4 text-destructive"})})})]},a.id)})})]}),q.passengers&&"object"==typeof q.passengers&&"message"in q.passengers&&(0,d.jsx)("p",{className:"text-sm text-destructive mt-2 p-2",children:q.passengers.message})]}),(0,d.jsxs)("div",{className:"flex justify-between items-center mt-4",children:[(0,d.jsxs)(x.$,{type:"button",variant:"outline",onClick:()=>z({name:"",passportNumber:"",ticketNumber:"",purchasePrice:0,clientStatement:"",salePrice:0,passengerType:"Adult",ticketType:"Issue"}),children:[(0,d.jsx)(W.A,{className:"me-2 h-4 w-4"})," إضافة مسافر"]}),(0,d.jsx)("div",{className:"flex gap-2",children:(0,d.jsxs)(x.$,{type:"submit",disabled:r,children:[r&&(0,d.jsx)(V.A,{className:"me-2 h-4 w-4 animate-spin"}),(0,d.jsx)(aj.A,{className:"me-2 h-4 w-4"}),"حفظ الحجز والمسافرين"]})})]})]})})})})]}):(0,d.jsx)("div",{className:"relative pt-4",children:(0,d.jsx)(L.Zp,{children:(0,d.jsx)(L.Wu,{className:"pt-6 flex justify-center items-center h-48",children:(0,d.jsx)(V.A,{className:"h-8 w-8 animate-spin"})})})})}var aw=c(27184),ax=c(40068),ay=c(22741),az=c(22874),aA=c(85846),aB=c(19335),aC=c(62257),aD=c(98341),aE=c(38692),aF=c(34118),aG=c(11134);let aH=(0,z.createServerReference)("40894ff0ee9a14922c13beed18ea3d0c678338253d",z.callServer,void 0,z.findSourceMapURL,"addMultipleBookings"),aI=(0,z.createServerReference)("402b41f05271dbe007d0f9816bed0bf5ec263bba15",z.callServer,void 0,z.findSourceMapURL,"extractTicketData");var aJ=c(80665),aK=c(78473),aL=c(77837);let aM="smartTicketDialogSettings",aN=[{value:"Adult",label:"بالغ",icon:l.A},{value:"Child",label:"طفل",icon:m.A},{value:"Infant",label:"رضيع",icon:n.A}];function aO({onMultipleBookingsAdded:a,children:b}){let[c,f]=(0,e.useState)(!1),[h,i]=(0,e.useState)(!1),[k,l]=(0,e.useState)(!1),[m,n]=(0,e.useState)(0),[o,p]=(0,e.useState)([]),[q,r]=(0,e.useState)(new Set),{toast:s}=(0,B.dj)(),{data:t,loaded:v}=(0,I.Z)(),{user:y}=(0,ap.A)(),[z,A]=(0,e.useState)({supplierId:"",clientId:"",currency:"USD"}),[D,G]=(0,e.useState)({width:"1400px",height:"90vh"}),[H,J]=(0,e.useState)(!1),K=(0,e.useCallback)(async a=>{let b=a.filter(a=>!q.has(a.name));if(0===b.length)return void s({title:"لا توجد ملفات جديدة",description:"تم بالفعل معالجة جميع الملفات المحددة."});i(!0),n(0);let c=b.length,d=0,e=a=>new Promise((b,e)=>{let f=new FileReader;f.readAsDataURL(a),f.onload=async()=>{try{let c=f.result,d=await aI({fileDataUri:c});p(b=>[...b,{...d,id:`ticket-${Date.now()}-${Math.random()}`,financialData:{supplierId:z.supplierId||"",clientId:z.clientId||"",currency:z.currency||"USD"},passengers:d.passengers.map(a=>({...a,purchasePrice:0,salePrice:0,passportNumber:a.passportNumber||"",ticketType:"Issue"})),file:a}]),r(b=>new Set(b).add(a.name)),b()}catch(b){console.error(`Error processing file ${a.name}:`,b),s({title:`خطأ في تحليل ملف: ${a.name}`,description:b.message||"لم يتمكن الذكاء الاصطناعي من قراءة هذا الملف.",variant:"destructive"}),e(b)}finally{n(++d/c*100)}},f.onerror=b=>{s({title:`خطأ في قراءة ملف: ${a.name}`,variant:"destructive"}),n(++d/c*100),e(b)}});for(let a of b)await e(a);i(!1),s({title:"اكتمل التحليل",description:`تمت معالجة ${c} تذكرة.`})},[s,q,z]),{getRootProps:M,getInputProps:N,isDragActive:O}=(0,aG.VB)({onDrop:K,accept:{"application/pdf":[".pdf"]},multiple:!0,disabled:h}),P=(a,b,c,d)=>{p((0,$.jM)(e=>{let f=e.find(b=>b.id===a);f&&(f.passengers[b][c]=d)}))},Q=(a,b,c)=>{p((0,$.jM)(d=>{let e=d.find(b=>b.id===a);e&&(e.financialData[b]=c)}))},R=async()=>{if(0===o.length)return void s({title:"لا توجد حجوزات للحفظ",variant:"destructive"});if(!y||!("boxId"in y)||!y.boxId)return void s({title:"صندوق غير محدد",description:`لا يوجد صندوق مرتبط بحسابك. يرجى مراجعة المدير.`,variant:"destructive"});for(let a of o)if(!a.financialData.supplierId||!a.financialData.clientId)return void s({title:"بيانات غير مكتملة",description:`الرجاء تعبئة بيانات المورد والعميل للحجز ${a.pnr}.`,variant:"destructive"});l(!0),f(!1);let b=o.map(a=>({pnr:a.pnr,route:a.route,issueDate:a.issueDate,travelDate:a.travelDate,supplierId:a.financialData.supplierId,clientId:a.financialData.clientId,boxId:y.boxId||"",notes:`تمت الإضافة عبر الإدخال الذكي من ملف: ${a.file.name}`,currency:a.financialData.currency,passengers:a.passengers.map(a=>({...a,id:`temp-${Math.random()}`,clientStatement:"",ticketType:a.ticketType||"Issue"}))})),c=await aH(b);c.success&&c.newBookings?(s({title:"تم حفظ الحجوزات بنجاح",description:`تم حفظ ${c.count} حجز جديد.`}),a(c.newBookings),p([]),r(new Set)):s({title:"خطأ",description:c.error,variant:"destructive"}),l(!1)},S=a=>parseInt(a.replace(/px|vw|vh/g,""),10)||0;return(t?.suppliers||[]).map(a=>({value:a.id,label:a.name})),(t?.clients||[]).map(a=>({value:a.id,label:a.name})),(0,d.jsxs)(ax.lG,{open:c,onOpenChange:f,children:[(0,d.jsx)(ax.zM,{asChild:!0,children:b}),(0,d.jsxs)(ax.Cf,{showCloseButton:!1,className:"p-0 flex flex-col",style:{maxWidth:D.width,width:"95vw",height:D.height,resize:"both",overflow:"auto"},children:[(0,d.jsxs)(ax.c7,{className:"bg-primary text-primary-foreground p-3 rounded-t-lg flex flex-row items-center justify-between sticky top-0 z-10 border-b",children:[(0,d.jsx)(ax.HM,{asChild:!0,children:(0,d.jsx)(x.$,{variant:"ghost",size:"icon",className:"text-primary-foreground hover:bg-white/20 h-7 w-7 rounded-full",children:(0,d.jsx)(j.A,{className:"h-4 w-4"})})}),(0,d.jsx)("div",{className:"text-right",children:(0,d.jsxs)(ax.L3,{className:"flex items-center gap-2",children:[(0,d.jsx)(Y.A,{}),"أداة الإدخال الذكي للتذاكر"]})}),(0,d.jsxs)(aL.AM,{open:H,onOpenChange:J,children:[(0,d.jsx)(aL.Wv,{asChild:!0,children:(0,d.jsx)(x.$,{variant:"ghost",size:"icon",className:"text-white hover:bg-white/20 h-8 w-8",children:(0,d.jsx)(ay.A,{className:"h-5 w-5"})})}),(0,d.jsx)(aL.hl,{className:"w-80",align:"end",children:(0,d.jsxs)("div",{className:"grid gap-4",children:[(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("h4",{className:"font-medium leading-none",children:"أبعاد النافذة"}),(0,d.jsxs)(C.Lt,{children:[(0,d.jsx)(C.tv,{asChild:!0,children:(0,d.jsxs)(x.$,{type:"button",variant:"ghost",size:"sm",className:"h-auto px-2 py-1 text-xs",children:[(0,d.jsx)(az.A,{className:"me-1 h-3 w-3"})," إعادة للوضع الافتراضي"]})}),(0,d.jsxs)(C.EO,{children:[(0,d.jsxs)(C.wd,{children:[(0,d.jsx)(C.r7,{children:"هل أنت متأكد؟"}),(0,d.jsx)(C.$v,{children:"سيتم إعادة أبعاد النافذة إلى الحجم الافتراضي."})]}),(0,d.jsxs)(C.ck,{children:[(0,d.jsx)(C.Zr,{children:"إلغاء"}),(0,d.jsx)(C.Rx,{onClick:()=>{let a={width:"1400px",height:"90vh"};G(a),localStorage.setItem(aM,JSON.stringify(a)),s({title:"تمت إعادة تعيين الأبعاد"})},className:(0,E.cn)((0,x.r)({variant:"destructive"})),children:"نعم، قم بالإعادة"})]})]})]})]}),(0,d.jsx)("p",{className:"text-sm text-muted-foreground",children:"تحكم في حجم النافذة لتناسب شاشتك."})]}),(0,d.jsxs)("div",{className:"grid gap-2",children:[(0,d.jsxs)("div",{className:"grid grid-cols-3 items-center gap-4",children:[(0,d.jsx)(af.J,{htmlFor:"width",children:"العرض (px)"}),(0,d.jsx)(ao.O,{id:"width",value:S(D.width),onValueChange:a=>G(b=>({...b,width:`${a||0}px`})),className:"col-span-2 h-8"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-3 items-center gap-4",children:[(0,d.jsx)(af.J,{htmlFor:"height",children:"الارتفاع (vh)"}),(0,d.jsx)(ao.O,{id:"height",value:S(D.height),onValueChange:a=>G(b=>({...b,height:`${a||0}vh`})),className:"col-span-2 h-8"})]}),(0,d.jsx)(x.$,{onClick:()=>{try{localStorage.setItem(aM,JSON.stringify(D)),s({title:"تم حفظ أبعاد النافذة"}),J(!1)}catch(a){s({title:"خطأ",description:"لم يتم حفظ الإعدادات",variant:"destructive"})}},size:"sm",className:"mt-2",children:"حفظ الأبعاد"})]})]})})]})]}),(0,d.jsx)("div",{className:"flex-grow overflow-y-auto px-6 py-4 space-y-4",children:v&&t?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4 items-end px-4 py-3 border rounded-lg bg-muted/30",children:[(0,d.jsxs)("div",{className:"space-y-1.5",children:[(0,d.jsx)(af.J,{className:"font-bold",children:"المورد"}),(0,d.jsx)(am.j,{searchAction:"suppliers",placeholder:"المورد الافتراضي...",value:z.supplierId,onValueChange:a=>A(b=>({...b,supplierId:a}))})]}),(0,d.jsxs)("div",{className:"space-y-1.5",children:[(0,d.jsx)(af.J,{className:"font-bold",children:"العميل"}),(0,d.jsx)(am.j,{searchAction:"clients",placeholder:"العميل الافتراضي...",value:z.clientId,onValueChange:a=>A(b=>({...b,clientId:a}))})]}),(0,d.jsxs)("div",{className:"space-y-1.5",children:[(0,d.jsx)(af.J,{className:"font-bold",children:"العملة"}),(0,d.jsxs)(aa.l6,{value:z.currency,onValueChange:a=>A(b=>({...b,currency:a})),children:[(0,d.jsx)(aa.bq,{className:"font-bold",children:(0,d.jsx)(aa.yv,{})}),(0,d.jsxs)(aa.gC,{children:[(0,d.jsx)(aa.eb,{className:"font-bold",value:"USD",children:"USD"}),(0,d.jsx)(aa.eb,{className:"font-bold",value:"IQD",children:"IQD"})]})]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(x.$,{className:"w-full font-bold bg-[#5b21b6] hover:bg-[#5b21b6]/90",onClick:()=>{if(!z.supplierId&&!z.clientId)return void s({title:"لا توجد بيانات للتطبيق",description:"الرجاء اختيار مورد وعميل.",variant:"destructive"});p(a=>a.map(a=>{let b={supplierId:z.supplierId||a.financialData.supplierId,clientId:z.clientId||a.financialData.clientId,currency:z.currency||a.financialData.currency};return{...a,financialData:b}})),s({title:"تم تطبيق البيانات الموحدة",description:`تم تحديث ${o.length} تذكرة.`})},children:"تطبيق على الكل"}),(0,d.jsxs)("div",{...M(),className:"cursor-pointer",children:[(0,d.jsx)("input",{...N()}),(0,d.jsx)(x.$,{variant:"outline",size:"icon",disabled:h,children:(0,d.jsx)(aA.A,{className:"h-5 w-5"})})]})]})]}),(0,d.jsx)("div",{className:"flex-grow overflow-hidden",children:(0,d.jsx)(aJ.F,{className:"h-[calc(100vh-450px)]",children:(0,d.jsxs)("div",{className:"space-y-4 min-h-full",children:[0===o.length&&!h&&(0,d.jsx)("div",{className:"flex items-center justify-center h-full text-muted-foreground pt-10",children:(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)(aB.A,{className:"mx-auto h-24 w-24"}),(0,d.jsx)("p",{className:"mt-4 text-lg font-bold",children:"قائمة انتظار الحجوزات"}),(0,d.jsx)("p",{className:"text-sm",children:"ابدأ برفع ملفات التذاكر من الأيقونة في الأعلى."})]})}),h&&(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsxs)("p",{className:"text-sm text-center font-bold text-muted-foreground mb-1",children:["جاري التحليل... (",Math.round(m),"%)"]}),(0,d.jsx)(aK.k,{value:m,className:"h-2 rounded-full"})]}),o.map(a=>(0,d.jsxs)(L.Zp,{className:"relative group shadow-sm hover:shadow-md transition-shadow",children:[(0,d.jsx)(L.aR,{className:"p-3 bg-muted/30",children:(0,d.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[a.airlineLogoUrl?(0,d.jsx)(F.default,{src:a.airlineLogoUrl,alt:a.airline,width:32,height:32,className:"size-8 shrink-0 object-contain"}):(0,d.jsx)("div",{className:"flex items-center justify-center size-8 bg-background rounded-md shrink-0",children:(0,d.jsx)(aC.A,{className:"size-5 text-muted-foreground"})}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(w.E,{variant:"secondary",className:"font-mono text-base",children:a.pnr}),(0,d.jsx)("span",{className:"font-bold",children:a.airline})]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-x-4 text-xs font-bold text-muted-foreground",children:[(0,d.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,d.jsx)(aD.A,{className:"h-3 w-3"}),"إصدار: ",a.issueDate]}),(0,d.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,d.jsx)(aC.A,{className:"h-3 w-3"}),"سفر: ",a.travelDate]})]}),(0,d.jsx)(x.$,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",onClick:()=>(a=>{let b=o.find(b=>b.id===a);b&&(r(a=>{let c=new Set(a);return c.delete(b.file.name),c}),p(b=>b.filter(b=>b.id!==a)))})(a.id),children:(0,d.jsx)(u.A,{className:"h-4 w-4"})})]})}),(0,d.jsx)(L.Wu,{className:"p-0",children:(0,d.jsxs)(g.XI,{dir:"rtl",children:[(0,d.jsx)(g.A0,{children:(0,d.jsxs)(g.Hj,{children:[(0,d.jsx)(g.nd,{className:"font-bold text-right",children:"المسافر"}),(0,d.jsx)(g.nd,{className:"font-bold text-right",children:"رقم الجواز"}),(0,d.jsx)(g.nd,{className:"font-bold text-right",children:"رقم التذكرة"}),(0,d.jsx)(g.nd,{className:"font-bold text-right",children:"شراء"}),(0,d.jsx)(g.nd,{className:"font-bold text-right",children:"بيع"}),(0,d.jsx)(g.nd,{className:"font-bold text-right",children:"الربح"}),(0,d.jsx)(g.nd,{className:"font-bold text-right",children:"نوع المسافر"})]})}),(0,d.jsx)(g.BF,{children:a.passengers.map((b,c)=>{let e=(b.salePrice||0)-(b.purchasePrice||0);return(0,d.jsxs)(g.Hj,{children:[(0,d.jsx)(g.nA,{className:"p-2",children:(0,d.jsx)(_.p,{value:b.name,onChange:b=>P(a.id,c,"name",b.target.value),className:"h-8"})}),(0,d.jsx)(g.nA,{className:"p-2",children:(0,d.jsx)(_.p,{value:b.passportNumber,onChange:b=>P(a.id,c,"passportNumber",b.target.value),className:"h-8"})}),(0,d.jsx)(g.nA,{className:"p-2",children:(0,d.jsx)(_.p,{value:b.ticketNumber,onChange:b=>P(a.id,c,"ticketNumber",b.target.value),className:"h-8"})}),(0,d.jsx)(g.nA,{className:"p-2",children:(0,d.jsx)(ao.O,{currency:a.financialData.currency,currencyClassName:(0,E.cn)("USD"===a.financialData.currency?"bg-accent text-accent-foreground":"bg-primary text-primary-foreground"),value:b.purchasePrice,onValueChange:b=>P(a.id,c,"purchasePrice",b||0),className:"h-8"})}),(0,d.jsx)(g.nA,{className:"p-2",children:(0,d.jsx)(ao.O,{currency:a.financialData.currency,currencyClassName:(0,E.cn)("USD"===a.financialData.currency?"bg-accent text-accent-foreground":"bg-primary text-primary-foreground"),value:b.salePrice,onValueChange:b=>P(a.id,c,"salePrice",b||0),className:"h-8"})}),(0,d.jsx)(g.nA,{className:"p-2",children:(0,d.jsx)("div",{className:(0,E.cn)("font-mono text-center font-bold",e>=0?"text-green-600":"text-destructive"),children:e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})}),(0,d.jsx)(g.nA,{className:"p-2",children:(0,d.jsxs)(aa.l6,{value:b.passengerType,onValueChange:b=>P(a.id,c,"passengerType",b),children:[(0,d.jsx)(aa.bq,{className:"h-8 text-xs px-2 font-bold justify-end gap-2",children:(0,d.jsx)(aa.yv,{})}),(0,d.jsx)(aa.gC,{children:aN.map(a=>{let b=a.icon;return(0,d.jsx)(aa.eb,{value:a.value,className:"font-bold justify-end",children:(0,d.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,d.jsx)("span",{children:a.label}),(0,d.jsx)(b,{className:"h-4 w-4"})]})},a.value)})})]})})]},`${a.id}-${c}`)})})]})}),(0,d.jsx)(L.wL,{className:"p-3 bg-muted/30 border-t",children:(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 w-full",children:[(0,d.jsx)(am.j,{searchAction:"suppliers",placeholder:"المورد...",value:a.financialData.supplierId,onValueChange:b=>Q(a.id,"supplierId",b)}),(0,d.jsx)(am.j,{searchAction:"clients",placeholder:"العميل...",value:a.financialData.clientId,onValueChange:b=>Q(a.id,"clientId",b)}),(0,d.jsxs)(aa.l6,{value:a.financialData.currency,onValueChange:b=>Q(a.id,"currency",b),children:[(0,d.jsx)(aa.bq,{className:"h-9 text-xs px-2 font-bold",children:(0,d.jsx)(aa.yv,{})}),(0,d.jsxs)(aa.gC,{children:[(0,d.jsx)(aa.eb,{value:"USD",className:"font-bold",children:"USD"}),(0,d.jsx)(aa.eb,{value:"IQD",className:"font-bold",children:"IQD"})]})]})]})})]},a.id))]})})})]}):(0,d.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,d.jsx)(V.A,{className:"h-8 w-8 animate-spin"})})}),(0,d.jsxs)(ax.Es,{className:"border-t p-2 bg-background shrink-0 flex-row items-center justify-between",children:[(0,d.jsx)("div",{className:"flex-1"}),(0,d.jsxs)("div",{className:"flex-1 flex items-center justify-center gap-4 text-xs text-muted-foreground",children:[(0,d.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,d.jsx)(aE.A,{className:"h-4 w-4 text-primary"})," ",(0,d.jsxs)("span",{children:["المستخدم: ",y?.name||"..."]})]}),y?.boxId&&(0,d.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,d.jsx)(aF.A,{className:"h-4 w-4 text-primary"})," ",(0,d.jsxs)("span",{children:["الصندوق: ",t?.boxes?.find(a=>a.id===y.boxId)?.name||"غير محدد"]})]})]}),(0,d.jsx)("div",{className:"flex-1 flex justify-end",children:o.length>0&&(0,d.jsxs)(x.$,{size:"lg",disabled:k||h,onClick:R,className:"w-full sm:w-auto font-bold bg-accent text-accent-foreground hover:bg-accent/90",children:[k?(0,d.jsx)(V.A,{className:"me-2 h-4 w-4 animate-spin"}):(0,d.jsx)(aj.A,{className:"me-2 h-4 w-4"}),"حفظ كل الحجوزات المعلقة (",o.length,")"]})})]})]})]})}var aP=c(42378);let aQ=(0,c(8808).A)("TicketCheck",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var aR=c(83557);let aS=(0,z.createServerReference)("70278708d5cbbc8d6310dcac5ed55f18c8eab7bbdd",z.callServer,void 0,z.findSourceMapURL,"voidBooking"),aT=(0,z.createServerReference)("70cfe727250a23b23d98bdaa484b32a157baabef97",z.callServer,void 0,z.findSourceMapURL,"refundBooking"),aU=(0,z.createServerReference)("7057bd85393d69e4688037e9bf4c49ca196efecf46",z.callServer,void 0,z.findSourceMapURL,"exchangeBooking");var aV=c(39043),aW=c(6471);let aX=({passengers:a,selectedPassengers:b,onPassengerSelect:c,currency:e})=>{let f=a.length>0&&b.size===a.length,h=b.size>0&&b.size<a.length;return(0,d.jsxs)(L.Zp,{className:"col-span-full",children:[(0,d.jsxs)(L.aR,{className:"pb-3 pt-4",children:[(0,d.jsx)(L.ZB,{className:"text-base",children:"الخطوة 2: تحديد المسافرين"}),(0,d.jsx)(L.BT,{children:"اختر المسافرين الذين تريد تطبيق العملية عليهم."})]}),(0,d.jsx)(L.Wu,{className:"p-0",children:(0,d.jsx)("div",{className:"overflow-auto max-h-60 rounded-md border",children:(0,d.jsxs)(g.XI,{children:[(0,d.jsx)(g.A0,{children:(0,d.jsxs)(g.Hj,{children:[(0,d.jsx)(g.nd,{className:"w-[50px]",children:(0,d.jsx)(aV.S,{checked:f||h,onCheckedChange:b=>{a.forEach(a=>c(a.ticketNumber,b))},"aria-label":"Select all"})}),(0,d.jsx)(g.nd,{children:"الاسم"}),(0,d.jsx)(g.nd,{children:"رقم التذكرة"}),(0,d.jsx)(g.nd,{className:"text-right",children:"سعر الشراء الأصلي"}),(0,d.jsx)(g.nd,{className:"text-right",children:"سعر البيع الأصلي"})]})}),(0,d.jsx)(g.BF,{children:a.map(a=>(0,d.jsxs)(g.Hj,{children:[(0,d.jsx)(g.nA,{children:(0,d.jsx)(aV.S,{checked:b.has(a.ticketNumber),onCheckedChange:b=>c(a.ticketNumber,!!b)})}),(0,d.jsx)(g.nA,{className:"font-semibold",children:a.name}),(0,d.jsx)(g.nA,{className:"font-mono",children:a.ticketNumber}),(0,d.jsxs)(g.nA,{className:"text-right font-mono",children:[a.purchasePrice.toLocaleString()," ",e]}),(0,d.jsxs)(g.nA,{className:"text-right font-mono",children:[a.salePrice.toLocaleString()," ",e]})]},a.id))})]})})})]})},aY=ae.Ik({opType:ae.k5(["REFUND","REISSUE","VOID"]),pnr:ae.Yj().optional(),ticketNumber:ae.Yj().min(1,"رقم التذكرة مطلوب"),passengerName:ae.Yj().min(1,"اسم المسافر مطلوب"),supplierId:ae.Yj().min(1,"المورد مطلوب"),clientId:ae.Yj().min(1,"العميل مطلوب"),currency:ae.k5(["USD","IQD"]),notes:ae.Yj().optional(),airlineFee:ae.au.number().default(0),officeFee:ae.au.number().default(0),newPnr:ae.Yj().optional(),priceDifference:ae.au.number().default(0),supplierVoidPenalty:ae.au.number().default(0),clientVoidPenalty:ae.au.number().default(0)}),aZ=({onSave:a,isSaving:b})=>{let{data:c}=(0,I.Z)(),e=(0,ac.mN)({resolver:(0,ad.u)(aY),defaultValues:{opType:"REFUND",currency:"USD"}}),f=e.watch("opType"),g=e.watch("currency");return(0,d.jsx)(aq.lV,{...e,children:(0,d.jsxs)("form",{onSubmit:e.handleSubmit(a),className:"space-y-4",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,d.jsx)(aq.zB,{control:e.control,name:"opType",render:({field:a})=>(0,d.jsxs)(aq.eI,{children:[(0,d.jsx)(af.J,{children:"نوع العملية"}),(0,d.jsxs)(aa.l6,{onValueChange:a.onChange,value:a.value,children:[(0,d.jsx)(aa.bq,{children:(0,d.jsx)(aa.yv,{})}),(0,d.jsxs)(aa.gC,{children:[(0,d.jsx)(aa.eb,{value:"REFUND",children:"استرجاع"}),(0,d.jsx)(aa.eb,{value:"REISSUE",children:"تغيير / إعادة إصدار"}),(0,d.jsx)(aa.eb,{value:"VOID",children:"فويد / إلغاء"})]})]}),(0,d.jsx)(aq.C5,{})]})}),(0,d.jsx)(aq.zB,{control:e.control,name:"pnr",render:({field:a})=>(0,d.jsxs)(aq.eI,{children:[(0,d.jsx)(af.J,{children:"رقم الحجز (PNR)"}),(0,d.jsx)(aq.MJ,{children:(0,d.jsx)(_.p,{...a})}),(0,d.jsx)(aq.C5,{})]})}),(0,d.jsx)(aq.zB,{control:e.control,name:"ticketNumber",render:({field:a})=>(0,d.jsxs)(aq.eI,{children:[(0,d.jsx)(af.J,{children:"رقم التذكرة"}),(0,d.jsx)(aq.MJ,{children:(0,d.jsx)(_.p,{...a})}),(0,d.jsx)(aq.C5,{})]})}),(0,d.jsx)(aq.zB,{control:e.control,name:"passengerName",render:({field:a})=>(0,d.jsxs)(aq.eI,{children:[(0,d.jsx)(af.J,{children:"اسم المسافر"}),(0,d.jsx)(aq.MJ,{children:(0,d.jsx)(_.p,{...a})}),(0,d.jsx)(aq.C5,{})]})}),(0,d.jsx)(aq.zB,{control:e.control,name:"supplierId",render:({field:a})=>(0,d.jsxs)(aq.eI,{children:[(0,d.jsx)(af.J,{children:"المورد"}),(0,d.jsx)(aq.MJ,{children:(0,d.jsx)(am.j,{searchAction:"suppliers",value:a.value,onValueChange:a.onChange,placeholder:"اختر مورد..."})}),(0,d.jsx)(aq.C5,{})]})}),(0,d.jsx)(aq.zB,{control:e.control,name:"clientId",render:({field:a})=>(0,d.jsxs)(aq.eI,{children:[(0,d.jsx)(af.J,{children:"العميل"}),(0,d.jsx)(aq.MJ,{children:(0,d.jsx)(am.j,{searchAction:"clients",value:a.value,onValueChange:a.onChange,placeholder:"اختر عميل..."})}),(0,d.jsx)(aq.C5,{})]})}),(0,d.jsx)(aq.zB,{control:e.control,name:"currency",render:({field:a})=>(0,d.jsxs)(aq.eI,{children:[(0,d.jsx)(af.J,{children:"العملة"}),(0,d.jsxs)(aa.l6,{onValueChange:a.onChange,value:a.value,children:[(0,d.jsx)(aq.MJ,{children:(0,d.jsx)(aa.bq,{children:(0,d.jsx)(aa.yv,{})})}),(0,d.jsxs)(aa.gC,{children:[(0,d.jsx)(aa.eb,{value:"USD",children:"USD"}),(0,d.jsx)(aa.eb,{value:"IQD",children:"IQD"})]})]}),(0,d.jsx)(aq.C5,{})]})})]}),"VOID"!==f&&(0,d.jsxs)("div",{className:"p-4 border rounded-lg grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsx)("h3",{className:"md:col-span-2 font-semibold",children:"التفاصيل المالية"}),(0,d.jsx)(aq.zB,{control:e.control,name:"airlineFee",render:({field:a})=>(0,d.jsxs)(aq.eI,{children:[(0,d.jsx)(af.J,{children:"غرامة شركة الطيران"}),(0,d.jsx)(aq.MJ,{children:(0,d.jsx)(ao.O,{currency:g,...a,onValueChange:b=>a.onChange(b||0)})}),(0,d.jsx)(aq.C5,{})]})}),(0,d.jsx)(aq.zB,{control:e.control,name:"officeFee",render:({field:a})=>(0,d.jsxs)(aq.eI,{children:[(0,d.jsx)(af.J,{children:"رسوم المكتب"}),(0,d.jsx)(aq.MJ,{children:(0,d.jsx)(ao.O,{currency:g,...a,onValueChange:b=>a.onChange(b||0)})}),(0,d.jsx)(aq.C5,{})]})}),"REISSUE"===f&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(aq.zB,{control:e.control,name:"priceDifference",render:({field:a})=>(0,d.jsxs)(aq.eI,{children:[(0,d.jsx)(af.J,{children:"فرق السعر (ADC)"}),(0,d.jsx)(aq.MJ,{children:(0,d.jsx)(ao.O,{currency:g,...a,onValueChange:b=>a.onChange(b||0)})}),(0,d.jsx)(aq.C5,{})]})}),(0,d.jsx)(aq.zB,{control:e.control,name:"newPnr",render:({field:a})=>(0,d.jsxs)(aq.eI,{children:[(0,d.jsx)(af.J,{children:"PNR الجديد"}),(0,d.jsx)(aq.MJ,{children:(0,d.jsx)(_.p,{...a})}),(0,d.jsx)(aq.C5,{})]})})]})]}),"VOID"===f&&(0,d.jsxs)("div",{className:"p-4 border rounded-lg grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsx)("h3",{className:"md:col-span-2 font-semibold",children:"غرامات الفويد"}),(0,d.jsx)(aq.zB,{control:e.control,name:"supplierVoidPenalty",render:({field:a})=>(0,d.jsxs)(aq.eI,{children:[(0,d.jsx)(af.J,{children:"غرامة فويد (للمورد)"}),(0,d.jsx)(aq.MJ,{children:(0,d.jsx)(ao.O,{currency:g,...a,onValueChange:b=>a.onChange(b||0)})}),(0,d.jsx)(aq.C5,{})]})}),(0,d.jsx)(aq.zB,{control:e.control,name:"clientVoidPenalty",render:({field:a})=>(0,d.jsxs)(aq.eI,{children:[(0,d.jsx)(af.J,{children:"غرامة فويد (للعميل)"}),(0,d.jsx)(aq.MJ,{children:(0,d.jsx)(ao.O,{currency:g,...a,onValueChange:b=>a.onChange(b||0)})}),(0,d.jsx)(aq.C5,{})]})})]}),(0,d.jsxs)(x.$,{type:"submit",disabled:b,className:"w-full",children:[b?(0,d.jsx)(V.A,{className:"animate-spin me-2"}):(0,d.jsx)(aj.A,{className:"me-2 h-4 w-4"}),"حفظ العملية"]})]})})};function a$({onDataChanged:a}){let{toast:b}=(0,B.dj)(),[c,f]=(0,e.useState)(!1),[g,h]=(0,e.useState)(""),[k,l]=(0,e.useState)([]),[m,n]=(0,e.useState)(null),[o,p]=(0,e.useState)(new Set),[q,r]=(0,e.useState)("REFUND"),[s,t]=(0,e.useState)(""),[u,v]=(0,e.useState)(!1),[y,z]=(0,e.useState)(!1),[A,C]=(0,e.useState)(""),[D,E]=(0,e.useState)({base:0,tax:0,penalty:0,fees:0,adc:0,residualEmd:0}),[F,G]=(0,e.useState)({supplierPenalty:0,clientPenalty:0}),[H,J]=(0,e.useState)(null),{data:K}=(0,I.Z)(),M=async()=>{if(!g.trim())return;v(!0),l([]),n(null),p(new Set);let a=await (0,al.x)(g.trim());a&&a.length>0?(l(a),1===a.length&&n(a[0])):b({title:"لم يتم العثور على أي حجز مطابق",variant:"destructive"}),v(!1)},N=async()=>{if(!m)return void b({title:"الرجاء اختيار حجز أولاً",variant:"destructive"});let c=m.currency||"USD",d=m.passengers.filter(a=>o.has(a.ticketNumber));z(!0);try{let e;if("VOID"===q){if(0===o.size)throw Error("الرجاء اختيار مسافر واحد على الأقل.");e=await aS(m,{passengers:d,...F,notes:s,currency:c},!1)}else{if(0===o.size)throw Error("الرجاء اختيار مسافر واحد على الأقل.");if("REFUND"===q)e=await aT(m,{passengers:d,airlineFee:D.penalty,officeFee:D.fees,notes:s,currency:c},!1);else if("REISSUE"===q)e=await aU(m,{passengers:d,newPnr:A,airlineFee:D.penalty,officeFee:D.fees,priceDifference:D.adc,notes:s,currency:c},!1);else throw Error("نوع عملية غير معروف.")}if(e.success)b({title:`تم تسجيل عملية ${q} بنجاح`}),f(!1),a();else throw Error(e.error)}catch(a){b({title:"خطأ",description:a.message,variant:"destructive"})}z(!1)},O=async c=>{z(!0);try{let d,e={id:`new-${Date.now()}`,pnr:c.pnr||"",clientId:c.clientId,supplierId:c.supplierId,passengers:[{id:"new-passenger",name:c.passengerName,ticketNumber:c.ticketNumber,purchasePrice:0,salePrice:0,passengerType:"Adult",ticketType:"Issue",passportNumber:""}]},g=e.passengers;if("VOID"===c.opType)d=await aS(e,{passengers:g,supplierPenalty:c.supplierVoidPenalty,clientPenalty:c.clientVoidPenalty,notes:c.notes||"",currency:c.currency},!0);else if("REFUND"===c.opType)d=await aT(e,{passengers:g,airlineFee:c.airlineFee,officeFee:c.officeFee,notes:c.notes||"",currency:c.currency},!0);else if("REISSUE"===c.opType)d=await aU(e,{passengers:g,newPnr:c.newPnr||"",airlineFee:c.airlineFee,officeFee:c.officeFee,priceDifference:c.priceDifference,notes:c.notes||"",currency:c.currency},!0);else throw Error("نوع عملية غير معروف.");if(d.success)b({title:`تم تسجيل عملية ${c.opType} الخارجية بنجاح`}),f(!1),a();else throw Error(d.error)}catch(a){b({title:"خطأ",description:a.message,variant:"destructive"})}z(!1)},P=m?.currency||"USD",Q=(0,e.useMemo)(()=>{if(!m||0===o.size)return{totalSale:0,totalPurchase:0,totalFees:0,amountToClient:0,amountFromSupplier:0,netClientDebt:0,netSupplierCredit:0};let a=m.passengers.filter(a=>o.has(a.ticketNumber)),b=a.reduce((a,b)=>a+b.salePrice,0),c=a.reduce((a,b)=>a+b.purchasePrice,0);if("VOID"===q){let a=F.clientPenalty-b,d=c-F.supplierPenalty;return{totalSale:b,totalPurchase:c,totalFees:0,amountToClient:0,amountFromSupplier:0,netClientDebt:a,netSupplierCredit:d}}let d=D.penalty+D.fees,e="REFUND"===q?b-d:d+D.adc,f="REFUND"===q?c-D.penalty:0;return{totalSale:b,totalPurchase:c,totalFees:d,amountToClient:e,amountFromSupplier:f,netClientDebt:0,netSupplierCredit:0}},[m,o,D,q,F]);return(0,d.jsxs)(ax.lG,{open:c,onOpenChange:f,children:[(0,d.jsx)(ax.zM,{asChild:!0,children:(0,d.jsxs)(x.$,{variant:"outline",children:[(0,d.jsx)(i.A,{className:"me-2 h-4 w-4"}),"عمليات التذاكر"]})}),(0,d.jsxs)(ax.Cf,{className:"max-w-[1200px] p-0",dir:"rtl",children:[(0,d.jsxs)(ax.c7,{className:"px-4 py-3 bg-primary text-primary-foreground rounded-t-lg flex flex-row items-center justify-between sticky top-0 z-10 border-b",children:[(0,d.jsx)(ax.HM,{asChild:!0,children:(0,d.jsx)(x.$,{variant:"ghost",size:"icon",className:"text-primary-foreground hover:bg-white/20 h-7 w-7 rounded-full",children:(0,d.jsx)(j.A,{className:"h-4 w-4"})})}),(0,d.jsx)(ax.L3,{className:"text-xl font-semibold",children:H?"عمليات التذكرة - Ticket Operations":"اختر نوع العملية"}),(0,d.jsx)("div",{children:H&&(0,d.jsxs)(x.$,{variant:"ghost",size:"sm",onClick:()=>J(null),children:[(0,d.jsx)(aR.A,{className:"me-2 h-4 w-4"}),"العودة"]})})]}),(0,d.jsx)("div",{className:"p-4 space-y-4",children:H?"new"===H?(0,d.jsx)(aZ,{onSave:O,isSaving:y}):(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 items-end",children:[(0,d.jsxs)("div",{className:"md:col-span-3",children:[(0,d.jsx)(af.J,{children:"رقم التذكرة أو PNR"}),(0,d.jsx)(_.p,{value:g,onChange:a=>h(a.target.value),onKeyDown:a=>"Enter"===a.key&&M()})]}),(0,d.jsxs)(x.$,{onClick:M,className:"w-full",variant:"secondary",disabled:u,children:[u?(0,d.jsx)(V.A,{className:"w-4 h-4 animate-spin"}):(0,d.jsx)(ab.A,{className:"w-4 h-4 ml-1"}),"بحث"]})]}),k.length>1&&!m&&(0,d.jsxs)(L.Zp,{children:[(0,d.jsxs)(L.aR,{children:[(0,d.jsx)(L.ZB,{className:"text-base",children:"تم العثور على حجوزات متعددة"}),(0,d.jsx)(L.BT,{children:"الرجاء اختيار الحجز الصحيح للمتابعة."})]}),(0,d.jsx)(L.Wu,{className:"space-y-2",children:k.map(a=>(0,d.jsxs)("div",{className:"p-2 border rounded-md cursor-pointer hover:bg-muted",onClick:()=>n(a),children:[(0,d.jsxs)("p",{className:"font-bold",children:["PNR: ",a.pnr," - Invoice: ",a.invoiceNumber]}),(0,d.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Client: ",K?.clients.find(b=>b.id===a.clientId)?.name," | Supplier: ",K?.suppliers.find(b=>b.id===a.supplierId)?.name]})]},a.id))})]}),m&&(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsx)(aX,{passengers:m.passengers,selectedPassengers:o,onPassengerSelect:(a,b)=>{p(c=>{let d=new Set(c);return b?d.add(a):d.delete(a),d})},currency:P}),(0,d.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 items-start",children:[(0,d.jsxs)(L.Zp,{children:[(0,d.jsx)(L.aR,{className:"pb-3 pt-4",children:(0,d.jsx)(L.ZB,{className:"text-base",children:"الخطوة 3: تفاصيل العملية"})}),(0,d.jsxs)(L.Wu,{className:"space-y-3",children:[(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,d.jsxs)("div",{className:"space-y-1.5",children:[(0,d.jsx)(af.J,{children:"نوع العملية"}),(0,d.jsxs)(aa.l6,{value:q,onValueChange:a=>r(a),children:[(0,d.jsx)(aa.bq,{children:(0,d.jsx)(aa.yv,{})}),(0,d.jsxs)(aa.gC,{children:[(0,d.jsx)(aa.eb,{value:"REFUND",children:"استرجاع"}),(0,d.jsx)(aa.eb,{value:"REISSUE",children:"تغيير / إعادة إصدار"}),(0,d.jsx)(aa.eb,{value:"VOID",children:"فويد / إلغاء"})]})]})]}),(0,d.jsxs)("div",{className:"space-y-1.5",children:[(0,d.jsx)(af.J,{children:"العملة"}),(0,d.jsx)(_.p,{value:P,readOnly:!0,disabled:!0})]})]}),"VOID"===q?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"space-y-1.5",children:[(0,d.jsx)(af.J,{children:"غرامة فويد (للمورد)"}),(0,d.jsx)(ao.O,{currency:P,value:F.supplierPenalty,onValueChange:a=>G(b=>({...b,supplierPenalty:a||0}))})]}),(0,d.jsxs)("div",{className:"space-y-1.5",children:[(0,d.jsx)(af.J,{children:"غرامة فويد (للعميل)"}),(0,d.jsx)(ao.O,{currency:P,value:F.clientPenalty,onValueChange:a=>G(b=>({...b,clientPenalty:a||0}))})]})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"space-y-1.5",children:[(0,d.jsx)(af.J,{children:"غرامة شركة الطيران"}),(0,d.jsx)(ao.O,{currency:P,value:D.penalty,onValueChange:a=>E({...D,penalty:a||0})})]}),(0,d.jsxs)("div",{className:"space-y-1.5",children:[(0,d.jsx)(af.J,{children:"رسوم المكتب"}),(0,d.jsx)(ao.O,{currency:P,value:D.fees,onValueChange:a=>E({...D,fees:a||0})})]})]}),"REISSUE"===q&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"space-y-1.5",children:[(0,d.jsx)(af.J,{children:"فرق السعر (ADC)"}),(0,d.jsx)(ao.O,{currency:P,value:D.adc,onValueChange:a=>E({...D,adc:a||0})})]}),(0,d.jsxs)("div",{className:"space-y-1.5",children:[(0,d.jsx)(af.J,{children:"PNR الجديد"}),(0,d.jsx)(_.p,{value:A,onChange:a=>C(a.target.value)})]})]})]})]}),(0,d.jsxs)(L.Zp,{children:[(0,d.jsx)(L.aR,{className:"pb-3 pt-4",children:(0,d.jsx)(L.ZB,{className:"text-base",children:"ملخص العملية"})}),(0,d.jsxs)(L.Wu,{className:"space-y-3 text-sm",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("span",{className:"text-muted-foreground",children:"الحجز المحدد:"}),(0,d.jsx)(w.E,{variant:"secondary",children:m.pnr})]}),(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("span",{className:"text-muted-foreground",children:"المسافرون المختارون:"}),(0,d.jsx)(w.E,{children:o.size})]}),(0,d.jsx)(aW.Separator,{}),"VOID"===q?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"flex justify-between items-center font-semibold",children:[(0,d.jsx)("span",{className:"text-muted-foreground",children:"إجمالي مبيع التذكرة:"}),(0,d.jsxs)("span",{className:"font-mono",children:[Q.totalSale.toLocaleString()," ",P]})]}),(0,d.jsxs)("div",{className:"flex justify-between items-center font-semibold text-red-600",children:[(0,d.jsx)("span",{children:"غرامة العميل:"}),(0,d.jsxs)("span",{className:"font-mono",children:[F.clientPenalty.toLocaleString()," ",P]})]}),(0,d.jsx)(aW.Separator,{}),(0,d.jsxs)("div",{className:"flex justify-between items-center font-bold text-lg text-blue-600",children:[(0,d.jsx)("span",{children:"صافي الدين على العميل:"}),(0,d.jsxs)("span",{className:"font-mono",children:[Q.netClientDebt.toLocaleString()," ",P]})]}),(0,d.jsx)(aW.Separator,{}),(0,d.jsxs)("div",{className:"flex justify-between items-center font-semibold",children:[(0,d.jsx)("span",{className:"text-muted-foreground",children:"إجمالي شراء التذكرة:"}),(0,d.jsxs)("span",{className:"font-mono",children:[Q.totalPurchase.toLocaleString()," ",P]})]}),(0,d.jsxs)("div",{className:"flex justify-between items-center font-semibold text-red-600",children:[(0,d.jsx)("span",{children:"غرامة المورد:"}),(0,d.jsxs)("span",{className:"font-mono",children:[F.supplierPenalty.toLocaleString()," ",P]})]}),(0,d.jsx)(aW.Separator,{}),(0,d.jsxs)("div",{className:"flex justify-between items-center font-bold text-lg text-green-600",children:[(0,d.jsx)("span",{children:"المستحق من المورد:"}),(0,d.jsxs)("span",{className:"font-mono",children:[Q.netSupplierCredit.toLocaleString()," ",P]})]})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"flex justify-between items-center font-semibold",children:[(0,d.jsx)("span",{className:"text-muted-foreground",children:"إجمالي مبيع التذاكر المختارة:"}),(0,d.jsxs)("span",{className:"font-mono",children:[Q.totalSale.toLocaleString()," ",P]})]}),(0,d.jsxs)("div",{className:"flex justify-between items-center font-semibold",children:[(0,d.jsx)("span",{className:"text-muted-foreground",children:"إجمالي رسوم الإلغاء/التغيير:"}),(0,d.jsxs)("span",{className:"font-mono",children:[Q.totalFees.toLocaleString()," ",P]})]}),"REISSUE"===q&&(0,d.jsxs)("div",{className:"flex justify-between items-center font-semibold",children:[(0,d.jsx)("span",{className:"text-muted-foreground",children:"فرق السعر (ADC):"}),(0,d.jsxs)("span",{className:"font-mono",children:[D.adc.toLocaleString()," ",P]})]}),(0,d.jsx)(aW.Separator,{}),(0,d.jsxs)("div",{className:"flex justify-between items-center font-bold text-lg text-blue-600",children:[(0,d.jsx)("span",{children:"المبلغ المستحق للعميل:"}),(0,d.jsxs)("span",{className:"font-mono",children:[Q.amountToClient.toLocaleString()," ",P]})]}),"REFUND"===q&&(0,d.jsxs)("div",{className:"flex justify-between items-center font-bold text-lg text-green-600",children:[(0,d.jsx)("span",{children:"المبلغ المستحق من المورد:"}),(0,d.jsxs)("span",{className:"font-mono",children:[Q.amountFromSupplier.toLocaleString()," ",P]})]})]})]}),(0,d.jsx)(L.wL,{children:(0,d.jsxs)(x.$,{onClick:N,disabled:y||0===o.size,className:"w-full h-12 text-md",children:[y?(0,d.jsx)(V.A,{className:"animate-spin"}):(0,d.jsx)(aj.A,{className:"ml-2"}),"حفظ العملية"]})})]})]})]})]}):(0,d.jsxs)("div",{className:"text-center p-8 space-y-4",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold",children:"هل العملية لتذكرة موجودة مسبقًا في النظام أم عملية خارجية؟"}),(0,d.jsxs)("div",{className:"flex justify-center gap-4",children:[(0,d.jsxs)(x.$,{size:"lg",onClick:()=>J("existing"),className:"gap-2",children:[(0,d.jsx)(aQ,{className:"h-5 w-5"}),"تذكرة موجودة"]}),(0,d.jsxs)(x.$,{size:"lg",onClick:()=>J("new"),variant:"secondary",className:"gap-2",children:[(0,d.jsx)(W.A,{className:"h-5 w-5"}),"عملية خارجية جديدة"]})]})]})})]})]})}function a_({initialData:a,totalBookings:b}){let c=(0,aP.useRouter)(),[f,g]=e.useState(a),[h,i]=e.useState(!1),{data:j,loaded:k}=(0,I.Z)(),[l,m]=e.useState(""),n=(0,aw.d)(l,300),[o,p]=e.useState({searchField:"all",currencyFilter:"all"}),[q,r]=e.useState(o),s=a=>{g((0,$.jM)(b=>{b.unshift(a)}))};e.useEffect(()=>{g(a)},[a]);let t=e.useMemo(()=>j?f.filter(a=>{if("all"!==q.currencyFilter&&a.currency!==q.currencyFilter)return!1;let b=j.suppliers.find(b=>b.id===a.supplierId)?.name||"",c=j.clients.find(b=>b.id===a.clientId)?.name||"";if("all"!==q.searchField){let d=n.toLowerCase();if(!d)return!0;switch(q.searchField){case"pnr":return(a.pnr||"").toLowerCase().includes(d);case"passenger":return a.passengers.some(a=>(a.name||"").toLowerCase().includes(d));case"ticket":return a.passengers.some(a=>(a.ticketNumber||"").toLowerCase().includes(d));case"supplier":return b.toLowerCase().includes(d);case"client":return c.toLowerCase().includes(d)}}if(n&&"all"===q.searchField){let d=n.toLowerCase();return(a.pnr||"").toLowerCase().includes(d)||(a.route||"").toLowerCase().includes(d)||b.toLowerCase().includes(d)||c.toLowerCase().includes(d)||a.passengers.some(a=>(a.name||"").toLowerCase().includes(d)||(a.ticketNumber||"").toLowerCase().includes(d))}return!0}):[],[n,f,j,q]);return k&&j?(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[(0,d.jsxs)("div",{className:"flex w-full sm:w-auto items-center gap-2",children:[(0,d.jsx)(D.A,{onBookingAdded:s,children:(0,d.jsxs)(x.$,{children:[(0,d.jsx)(W.A,{className:"me-2 h-4 w-4"})," إضافة حجز جديد"]})}),(0,d.jsx)(a$,{onDataChanged:()=>{c.refresh()}}),(0,d.jsxs)(y.rI,{children:[(0,d.jsx)(y.ty,{asChild:!0,children:(0,d.jsxs)(x.$,{variant:"outline",children:["إضافة سريعة ",(0,d.jsx)(X.A,{className:"ms-2 h-4 w-4"})]})}),(0,d.jsxs)(y.SQ,{children:[(0,d.jsx)(y._2,{onSelect:()=>i(a=>!a),children:"إدخال يدوي سريع"}),(0,d.jsx)(aO,{onMultipleBookingsAdded:a=>{c.refresh()},children:(0,d.jsxs)(y._2,{onSelect:a=>a.preventDefault(),children:[(0,d.jsx)(Y.A,{className:"me-2 h-4 w-4"}),"الإدخال الذكي (PDF)"]})})]})]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2 w-full flex-wrap sm:w-auto sm:flex-nowrap justify-end",children:[(0,d.jsxs)("div",{className:"relative w-full sm:w-64",children:[(0,d.jsx)(ab.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,d.jsx)(_.p,{placeholder:"بحث...",className:"ps-10",value:l,onChange:a=>m(a.target.value)})]}),(0,d.jsxs)(aa.l6,{value:o.searchField,onValueChange:a=>p(b=>({...b,searchField:a})),children:[(0,d.jsx)(aa.bq,{className:"w-full sm:w-[140px]",children:(0,d.jsx)(aa.yv,{})}),(0,d.jsxs)(aa.gC,{children:[(0,d.jsx)(aa.eb,{value:"all",children:"بحث عام"}),(0,d.jsx)(aa.eb,{value:"pnr",children:"PNR"}),(0,d.jsx)(aa.eb,{value:"passenger",children:"اسم المسافر"}),(0,d.jsx)(aa.eb,{value:"ticket",children:"رقم التذكرة"}),(0,d.jsx)(aa.eb,{value:"supplier",children:"المورد"}),(0,d.jsx)(aa.eb,{value:"client",children:"العميل"})]})]}),(0,d.jsxs)(aa.l6,{value:o.currencyFilter,onValueChange:a=>p(b=>({...b,currencyFilter:a})),children:[(0,d.jsx)(aa.bq,{className:"w-full sm:w-[120px]",children:(0,d.jsx)(aa.yv,{})}),(0,d.jsxs)(aa.gC,{children:[(0,d.jsx)(aa.eb,{value:"all",children:"كل العملات"}),(0,d.jsx)(aa.eb,{value:"USD",children:"USD"}),(0,d.jsx)(aa.eb,{value:"IQD",children:"IQD"})]})]}),(0,d.jsxs)(x.$,{onClick:()=>{r(o)},className:"w-full sm:w-auto",children:[(0,d.jsx)(Z.A,{className:"me-2 h-4 w-4"}),"تطبيق"]})]})]}),h&&(0,d.jsx)(av,{onBookingAdded:a=>{s(a),i(!1)},onCancel:()=>i(!1)}),(0,d.jsx)(L.Zp,{children:(0,d.jsx)(L.Wu,{className:"p-0",children:(0,d.jsx)(U,{bookings:t,totalBookings:b,onBookingUpdated:a=>{g((0,$.jM)(b=>{let c=b.findIndex(b=>b.id===a.id);-1!==c&&(b[c]=a)}))},onBookingDeleted:a=>{g((0,$.jM)(b=>b.filter(b=>b.id!==a)))}})})})]}):(0,d.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,d.jsx)(V.A,{className:"h-8 w-8 animate-spin"})})}},14276:a=>{"use strict";a.exports=import("firebase-admin/auth")},14985:a=>{"use strict";a.exports=require("dns")},16698:a=>{"use strict";a.exports=require("node:async_hooks")},18373:(a,b,c)=>{"use strict";c.d(b,{A:()=>d});let d=(0,c(87604).A)("Terminal",[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]])},19063:a=>{"use strict";a.exports=require("require-in-the-middle")},19121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},19185:a=>{"use strict";a.exports=require("dgram")},19771:a=>{"use strict";a.exports=require("process")},21820:a=>{"use strict";a.exports=require("os")},24803:a=>{"use strict";a.exports=import("firebase-admin/storage")},25730:(a,b,c)=>{"use strict";c.d(b,{A:()=>d});let d=(0,c(8808).A)("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]])},26713:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/is-bot")},27066:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{Bx:()=>l,N2:()=>u,T2:()=>p,Uo:()=>q,dJ:()=>v,eA:()=>r,li:()=>s,sN:()=>t,vq:()=>n,xu:()=>m,yF:()=>o});var e=c(75879);c(68633);var f=c(43513),g=c(16780),h=c(83479),i=c(33152),j=c(51669),k=a([f,h,i]);[f,h,i]=k.then?(await k)():k;let v=(0,g.unstable_cache)(async(a={})=>{let{page:b=1,limit:c=10,all:d=!1,includeDeleted:e=!1}=a,g=await (0,f.Lf)();if(!g)return console.error("Database not available"),{bookings:[],total:0};try{let a=g.collection("bookings");e||(a=a.where("isDeleted","==",!1));let f=(await a.get()).size,h=a.orderBy("enteredAt","desc");return d||(h=h.limit(c).offset((b-1)*c)),{bookings:(await h.get()).docs.map(a=>({id:a.id,...a.data()})),total:f}}catch(a){throw console.error("Error getting bookings: ",String(a)),Error(`Firestore query failed. A composite index is likely required. Original error: ${String(a)}`)}},["get-bookings"]);async function l(a){let b=await (0,i.$T)();if(!b)throw Error("User not authenticated.");let c=a.passengers.reduce((a,b)=>a+(Number(b.salePrice)||0),0),d=a.passengers.reduce((a,b)=>a+(Number(b.purchasePrice)||0),0),e=(await (0,f.Lf)()).collection("bookings").doc();return await e.set({...a,id:e.id,enteredBy:b.name,enteredAt:new Date().toISOString()}),await (0,h.T)({sourceType:"tickets",sourceId:e.id,date:a.issueDate,currency:a.currency,amount:c-d,clientId:a.clientId}),d>0&&await (0,h.C)({costKey:"cost_tickets",sourceType:"tickets",sourceId:e.id,date:a.issueDate,currency:a.currency,amount:d,supplierId:a.supplierId}),{success:!0,newBooking:{id:e.id,...a}}}async function m(a){return[]}async function n(a,b){return{success:!1,error:"Not implemented"}}async function o(a,b,c){return{success:!1,error:"Not implemented"}}async function p(a,b,c){return{success:!1,error:"Not implemented"}}async function q(a,b,c){return{success:!1,error:"Not implemented"}}async function r(a){return{success:!1,count:0,error:"Not implemented"}}async function s(a){return{success:!1,error:"Not implemented"}}async function t(a){return{success:!1,error:"Not implemented"}}async function u(a){return{success:!1,error:"Not implemented"}}(0,j.D)([v,l,m,n,o,p,q,r,s,t,u]),(0,e.A)(v,"7ffb585af41918dddb19e9e747514fc75eda9f07ca",null),(0,e.A)(l,"40ca4bf9958b6d1d26e411af5f72ad73b881d7ffc2",null),(0,e.A)(m,"40d0a9025cfae5e19ff9bfb1d8c43204722c4febb5",null),(0,e.A)(n,"60186e37473393f3008b2a76484829f65c2825bc22",null),(0,e.A)(o,"70cfe727250a23b23d98bdaa484b32a157baabef97",null),(0,e.A)(p,"7057bd85393d69e4688037e9bf4c49ca196efecf46",null),(0,e.A)(q,"70278708d5cbbc8d6310dcac5ed55f18c8eab7bbdd",null),(0,e.A)(r,"40894ff0ee9a14922c13beed18ea3d0c678338253d",null),(0,e.A)(s,"40dc0f099e7b5a731a230c5f6ba0d64c59c23245aa",null),(0,e.A)(t,"40cf063cd0996b5720c994376cff75a5921b27cb15",null),(0,e.A)(u,"40c0dccd0c2a8e67f36983065fa5432d130bc97c65",null),d()}catch(a){d(a)}})},27910:a=>{"use strict";a.exports=require("stream")},28270:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{"0004c295195cb02aa74b7e03b9ab47835262f651f3":()=>g._u,"006a7d18b222ac9fd27f636e3f60be09c88c550762":()=>j.ib,"400c0115434cd29d4eca4428f9840cb7a074049ed1":()=>l.EZ,"400c84b00cbc18181ec896b17d3329ab44688122ee":()=>o.q,"400e621b7f78c4800cffc85d668ca10cd73eb6853c":()=>e.Lf,"4013135d45b93942093eced825516b1e20941831b7":()=>n.d,"401b140032a44590c12253e287a8d7d0383408525e":()=>f.lc,"40211bb4321aca8530a09b81e44f46cc59da30c2c4":()=>l.KB,"402b41f05271dbe007d0f9816bed0bf5ec263bba15":()=>p.G,"403331dfc341d9a7f9cbe156b5d10cfd49a20be531":()=>e.d5,"40341251e8d632597ecf83a7ab87f3793a83f06b51":()=>m.r,"403c01bdb267219d16430eb023611daabec8b63ec8":()=>h.nX,"405181b3416ca6fb6435ab9096a0a68342e5255501":()=>i.u,"405872236907704344162aca1c38160d1eac727fe8":()=>e.DI,"405ce651eeff5dd6c93f3965b62049b45a42e5a7d4":()=>h.LD,"406c8a5fa8b6f219b1d6c0d2ed6d4215e348e5c534":()=>l.Lf,"407ad343a0d07dddd296d749ab0d60ad67dfc5bb39":()=>h.rC,"4085652545b10cc37283ef55992935bd43a8ce947e":()=>e.zZ,"408c54ad33973364b68d8475849f76b4a4ca590722":()=>e.EP,"408c94c431661ae65070856bc4a78d84f2cbfcba1c":()=>e.EZ,"40939e0ffddd5729906956a18bd5a10b991b0ccc8b":()=>l.d5,"409ba91156ff082c07d90f218ef67bfea8be50f67c":()=>l.DI,"409ee2d098a25e0103bd4e5cbd3c84c821bce98df9":()=>f.fW,"40b3f399476b2e0c0084bb235048022f7151d8d61a":()=>j.Qt,"40bd3493b6cd183a3f75aa7b2dffe9f325b07a2b9d":()=>g.Xx,"40c15e87ca74d3ad5ae09fdc0c6d9616384469f25f":()=>k._,"40c58d0bc8d4f91d67a942b18e51dcb1bf43076f6e":()=>l.zZ,"40d0448bacb32a373d23394258f9e7de4aa7fd38a9":()=>l.EP,"40f4619201eea9704cbf15357e730e9458fc66e834":()=>e.KB,"6011fc1c38056bdf4ffec77b46cde7479e7bed0ffe":()=>h.vL,"6023146a7bfefc423ba02712c56694a31432de707c":()=>e.zO,"6052254d233f0ea6b36992b2b81ce07178dee95ad7":()=>j.oS,"6073e98acf09f5000817ebcdd05234acc9c4d29f85":()=>f.rj,"60e34f9cbe57141cf2262bc166578e2d558a98e99f":()=>l.zO,"60eed12072721bc1c2c48214672b423b5d4cc8a6f3":()=>k.L,"7003bafa516cae88838b2870c227bb8f7b1ef595ec":()=>h.Nb,"70303f32e5ed8b56558bdc328a329d038fd2e61ace":()=>h.I0,"7036a92c4c51de937e481f7c0d6bc541b735f99157":()=>h.k5,"704baf0749912d6e636a66524e43f80ce5c8454d38":()=>h.xo,"70a2ee919f2d86ac514a326d140a0804c759a4d955":()=>h.Kq,"7efe1f798361b3ef301fd7b48f8f3206292a2cecba":()=>h.AZ,"7f085acd10c7b589563e59e7e18d605a9cf6eb6b56":()=>f.cl,"7f4fa596b78e1050be57bd23eeef63bf754e59a5c8":()=>j.xi,"7f56b7b077f6ef503c674aaefafd2b7951d91adaa8":()=>h.LQ,"7fbd1d6bc63ebe1b1eeb689b35afc9c8cba834559f":()=>h.f9,"7fc073ecd1a2a3a687a33b240d39c28a9944119247":()=>j.Z7,"7fe3cedf8b5b39f6ca6561f08402f1ad7a82ecff97":()=>g.mt,"7fff34be9ad53d22bcedbe289fd19cffbcbb61a920":()=>h.ro});var e=c(95378),f=c(94762),g=c(54756),h=c(24799),i=c(28541),j=c(18210),k=c(87965),l=c(39661),m=c(13732),n=c(40982),o=c(33875),p=c(3315),q=a([e,f,g,h,i,j,k,l,m,n,o]);[e,f,g,h,i,j,k,l,m,n,o]=q.then?(await q)():q,d()}catch(a){d(a)}})},28354:a=>{"use strict";a.exports=require("util")},29021:a=>{"use strict";a.exports=require("fs")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:a=>{"use strict";a.exports=require("path")},34631:a=>{"use strict";a.exports=require("tls")},37067:a=>{"use strict";a.exports=require("node:http")},37613:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{"00454095f373f8afcf3cd8b88a3e9643ba6181edb6":()=>h.y4,"005773e734ccf3535fa61ed9b34042d47625b1ede6":()=>i.O0,"0079928ff14026085419c5483c28b98ee3311389f6":()=>f.$E,"0084d26686615403d39adac4c095e2f442ed3af27d":()=>f.iS,"009e84f93947e0a432e28675ea07a71949bfe66943":()=>f.Lf,"00afcee30c25fc6521aeaf596fabd0fef5e0ca707f":()=>i.qV,"00d790a9c67325f46e1dda5ba33e59ecfd95062466":()=>h.HW,"00e358f3436e9739dfe740f6be22aedc1117f6422a":()=>g.getFinanceMap,"00f8105cf2df698dda196c821059bffd2c12bb65d6":()=>j.fO,"4012e9d0afaf5977818266842659883d1e03e6c32f":()=>g.C,"40213622e57351942781ff52345df063ded4056884":()=>h.Sm,"40290c8e8678ea3c7dc08bc14a2b21bf84ced558a3":()=>i.lo,"406818275705b776627a9e14558eaa7857fbec9b73":()=>i.ht,"4085aac590f12a4a641b5bc7fff47d5353af49510e":()=>h.S,"40894ff0ee9a14922c13beed18ea3d0c678338253d":()=>e.eA,"408d4523c5fa8dbd353900a15d896d0ebee083358b":()=>h.X7,"409c8a7c4192cd1e36809ce6ea14b1b4ba417e8767":()=>g.T,"40c0dccd0c2a8e67f36983065fa5432d130bc97c65":()=>e.N2,"40ca4bf9958b6d1d26e411af5f72ad73b881d7ffc2":()=>e.Bx,"40cf063cd0996b5720c994376cff75a5921b27cb15":()=>e.sN,"40d0a9025cfae5e19ff9bfb1d8c43204722c4febb5":()=>e.xu,"40d4790cf5bfe15d462399ad8c52d1baec8babf86f":()=>i.nu,"40dc0f099e7b5a731a230c5f6ba0d64c59c23245aa":()=>e.li,"40e13d085ff779b8dfbb82e790ebb21702ce079192":()=>i.Cm,"40ef77a697a84cf599002575e6afc4c1de58c3cdab":()=>i.hG,"40f3e2b0ca2e561c506ffb1575ff80c4dac60766e4":()=>j.tu,"40fc6757a7ed8ba6cf86a7bf30e6bf0934f153f439":()=>h.Lx,"601532f3b7a46dae258a5ff32f14fb4b3e2e141e9f":()=>i.TK,"601838acb9f969bfd30fa9f583c86dd453b19524dd":()=>i.v_,"60186e37473393f3008b2a76484829f65c2825bc22":()=>e.vq,"60bfff327e3bf73dac5fa7bb6d2690e1fed6e5cf56":()=>j.PR,"60f0caf2093b9fcfdd71247bdb544c4372ceacd6c0":()=>g.postJournalEntries,"70278708d5cbbc8d6310dcac5ed55f18c8eab7bbdd":()=>e.Uo,"7057bd85393d69e4688037e9bf4c49ca196efecf46":()=>e.T2,"70cfe727250a23b23d98bdaa484b32a157baabef97":()=>e.yF,"7f33ef79ae72de1c2db1340cf81f1c0a0a525a8033":()=>h.kl,"7f33fcd02c8b1dfc136d21fd7035ce40fe2d48b135":()=>h.ht,"7f7cc5ac28f76953e580388c96325185bdb57f592c":()=>h.EZ,"7faf63d9d8686c0ff053833c82fd60b3e9c6fa0bff":()=>h.$T,"7ffb585af41918dddb19e9e747514fc75eda9f07ca":()=>e.dJ});var e=c(27066),f=c(43513),g=c(83479),h=c(33152),i=c(40776),j=c(97842),k=a([e,f,g,h,i,j]);[e,f,g,h,i,j]=k.then?(await k)():k,d()}catch(a){d(a)}})},37830:a=>{"use strict";a.exports=require("node:stream/web")},38522:a=>{"use strict";a.exports=require("node:zlib")},38710:(a,b,c)=>{"use strict";c.d(b,{ai:()=>f});var d=c(8567),e=c(55446);let f=(0,d.genkit)({plugins:[(0,e.YF)()],model:"googleai/gemini-1.5-flash"})},39043:(a,b,c)=>{"use strict";c.d(b,{S:()=>i});var d=c(21124),e=c(38301),f=c(89339),g=c(8015),h=c(44943);let i=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.bL,{ref:c,className:(0,h.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...b,children:(0,d.jsx)(f.C1,{className:(0,h.cn)("flex items-center justify-center text-current"),children:(0,d.jsx)(g.A,{className:"h-4 w-4"})})}));i.displayName=f.bL.displayName},41025:a=>{"use strict";a.exports=require("next/dist/server/app-render/dynamic-access-async-storage.external.js")},41304:(a,b,c)=>{"use strict";c.d(b,{default:()=>d});let d=(0,c(97954).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/user/studio/src/app/bookings/components/bookings-content.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/user/studio/src/app/bookings/components/bookings-content.tsx","default")},44043:(a,b,c)=>{"use strict";c.d(b,{A:()=>d});let d=(0,c(8808).A)("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]])},44708:a=>{"use strict";a.exports=require("node:https")},45702:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>n});var e=c(75338),f=c(74515),g=c(41304),h=c(27066),i=c(68162),j=c(18373),k=c(62159),l=a([h]);async function m({page:a,limit:b}){let[{bookings:c,total:d},f]=await (0,h.dJ)({page:a,limit:b}).then(a=>[a,null]).catch(a=>[{bookings:[],total:0},a.message||"فشل تحميل البيانات"]);if(f)return(0,e.jsxs)(i.Fc,{variant:"destructive",children:[(0,e.jsx)(j.A,{className:"h-4 w-4"}),(0,e.jsx)(i.XL,{children:"حدث خطأ!"}),(0,e.jsx)(i.TN,{children:f||"فشل تحميل البيانات الضرورية لهذه الصفحة."})]});let k=c.map(a=>a.originalData);return(0,e.jsx)(g.default,{initialData:k,totalBookings:d})}async function n({searchParams:a}){let b=Number(a?.page??"1"),c=Number(a?.limit??"15");return(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)("div",{className:"px-0 sm:px-6",children:[(0,e.jsx)("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"إدارة الحجوزات والعمليات"}),(0,e.jsx)("p",{className:"text-muted-foreground",children:"إدارة شاملة لجميع الحجوزات وعمليات التذاكر (إصدار، تغيير، استرجاع، إلغاء) في مكان واحد."})]}),(0,e.jsx)(f.Suspense,{fallback:(0,e.jsx)(k.E,{className:"h-96 w-full"}),children:(0,e.jsx)(m,{page:b,limit:c})})]})}h=(l.then?(await l)():l)[0],d()}catch(a){d(a)}})},47002:a=>{function b(a){var b=Error("Cannot find module '"+a+"'");throw b.code="MODULE_NOT_FOUND",b}b.keys=()=>[],b.resolve=b,b.id=47002,a.exports=b},49231:(a,b,c)=>{Promise.resolve().then(c.bind(c,41304))},55322:(a,b,c)=>{"use strict";c.d(b,{A:()=>d});let d=(0,c(8808).A)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},55511:a=>{"use strict";a.exports=require("crypto")},55591:a=>{"use strict";a.exports=require("https")},56801:a=>{"use strict";a.exports=require("import-in-the-middle")},57075:a=>{"use strict";a.exports=require("node:stream")},57479:(a,b,c)=>{Promise.resolve().then(c.bind(c,13406))},57975:a=>{"use strict";a.exports=require("node:util")},61012:(a,b,c)=>{"use strict";c.d(b,{A:()=>d});let d=(0,c(8808).A)("ChevronsRight",[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]])},62159:(a,b,c)=>{"use strict";c.d(b,{E:()=>f});var d=c(75338),e=c(70673);function f({className:a,...b}){return(0,d.jsx)("div",{className:(0,e.cn)("animate-pulse rounded-md bg-muted",a),...b})}},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},67094:(a,b,c)=>{"use strict";c.d(b,{Ke:()=>g,Nt:()=>e,R6:()=>f});var d=c(59147);let e=d.bL,f=d.R6,g=d.Ke},73024:a=>{"use strict";a.exports=require("node:fs")},73136:a=>{"use strict";a.exports=require("node:url")},73496:a=>{"use strict";a.exports=require("http2")},73566:a=>{"use strict";a.exports=require("worker_threads")},74053:(a,b,c)=>{"use strict";c.d(b,{C:()=>j,z:()=>i});var d=c(21124),e=c(38301),f=c(64450),g=c(46171),h=c(44943);let i=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.bL,{className:(0,h.cn)("grid gap-2",a),...b,ref:c}));i.displayName=f.bL.displayName;let j=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.q7,{ref:c,className:(0,h.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),...b,children:(0,d.jsx)(f.C1,{className:"flex items-center justify-center",children:(0,d.jsx)(g.A,{className:"h-2.5 w-2.5 fill-current text-current"})})}));j.displayName=f.q7.displayName},74075:a=>{"use strict";a.exports=require("zlib")},74998:a=>{"use strict";a.exports=require("perf_hooks")},76760:a=>{"use strict";a.exports=require("node:path")},77030:a=>{"use strict";a.exports=require("node:net")},77598:a=>{"use strict";a.exports=require("node:crypto")},78473:(a,b,c)=>{"use strict";c.d(b,{k:()=>v});var d=c(21124),e=c(38301),f=c(2332),g=c(6406),h="Progress",[i,j]=(0,f.A)(h),[k,l]=i(h),m=e.forwardRef((a,b)=>{var c,e;let{__scopeProgress:f,value:h=null,max:i,getValueLabel:j=p,...l}=a;(i||0===i)&&!s(i)&&console.error((c=`${i}`,`Invalid prop \`max\` of value \`${c}\` supplied to \`Progress\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`));let m=s(i)?i:100;null===h||t(h,m)||console.error((e=`${h}`,`Invalid prop \`value\` of value \`${e}\` supplied to \`Progress\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`));let n=t(h,m)?h:null,o=r(n)?j(n,m):void 0;return(0,d.jsx)(k,{scope:f,value:n,max:m,children:(0,d.jsx)(g.sG.div,{"aria-valuemax":m,"aria-valuemin":0,"aria-valuenow":r(n)?n:void 0,"aria-valuetext":o,role:"progressbar","data-state":q(n,m),"data-value":n??void 0,"data-max":m,...l,ref:b})})});m.displayName=h;var n="ProgressIndicator",o=e.forwardRef((a,b)=>{let{__scopeProgress:c,...e}=a,f=l(n,c);return(0,d.jsx)(g.sG.div,{"data-state":q(f.value,f.max),"data-value":f.value??void 0,"data-max":f.max,...e,ref:b})});function p(a,b){return`${Math.round(a/b*100)}%`}function q(a,b){return null==a?"indeterminate":a===b?"complete":"loading"}function r(a){return"number"==typeof a}function s(a){return r(a)&&!isNaN(a)&&a>0}function t(a,b){return r(a)&&!isNaN(a)&&a<=b&&a>=0}o.displayName=n;var u=c(44943);let v=e.forwardRef(({className:a,value:b,...c},e)=>(0,d.jsx)(m,{ref:e,className:(0,u.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",a),style:{zIndex:9999},...c,children:(0,d.jsx)(o,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(b||0)}%)`}})}));v.displayName=m.displayName},79428:a=>{"use strict";a.exports=require("buffer")},79551:a=>{"use strict";a.exports=require("url")},79646:a=>{"use strict";a.exports=require("child_process")},79748:a=>{"use strict";a.exports=require("fs/promises")},80623:(a,b,c)=>{"use strict";c.d(b,{A:()=>d});let d=(0,c(8808).A)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]])},80665:(a,b,c)=>{"use strict";c.d(b,{$:()=>i,F:()=>h});var d=c(21124),e=c(38301),f=c(84550),g=c(44943);let h=e.forwardRef(({className:a,children:b,...c},e)=>(0,d.jsxs)(f.bL,{ref:e,className:(0,g.cn)("relative overflow-hidden",a),...c,children:[(0,d.jsx)(f.LM,{className:"h-full w-full rounded-[inherit]",children:b}),(0,d.jsx)(i,{}),(0,d.jsx)(f.OK,{})]}));h.displayName=f.bL.displayName;let i=e.forwardRef(({className:a,orientation:b="vertical",...c},e)=>(0,d.jsx)(f.VM,{ref:e,orientation:b,className:(0,g.cn)("flex touch-none select-none transition-colors","vertical"===b&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===b&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...c,children:(0,d.jsx)(f.lr,{className:"relative flex-1 rounded-full bg-border"})}));i.displayName=f.VM.displayName},81630:a=>{"use strict";a.exports=require("http")},84297:a=>{"use strict";a.exports=require("async_hooks")},85846:(a,b,c)=>{"use strict";c.d(b,{A:()=>d});let d=(0,c(8808).A)("CloudUpload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]])},86281:(a,b,c)=>{"use strict";c.d(b,{F:()=>g});var d=c(81171);let e=a=>"boolean"==typeof a?`${a}`:0===a?"0":a,f=d.$,g=(a,b)=>c=>{var d;if((null==b?void 0:b.variants)==null)return f(a,null==c?void 0:c.class,null==c?void 0:c.className);let{variants:g,defaultVariants:h}=b,i=Object.keys(g).map(a=>{let b=null==c?void 0:c[a],d=null==h?void 0:h[a];if(null===b)return null;let f=e(b)||e(d);return g[a][f]}),j=c&&Object.entries(c).reduce((a,b)=>{let[c,d]=b;return void 0===d||(a[c]=d),a},{});return f(a,i,null==b||null==(d=b.compoundVariants)?void 0:d.reduce((a,b)=>{let{class:c,className:d,...e}=b;return Object.entries(e).every(a=>{let[b,c]=a;return Array.isArray(c)?c.includes({...h,...j}[b]):({...h,...j})[b]===c})?[...a,c,d]:a},[]),null==c?void 0:c.class,null==c?void 0:c.className)}},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},87604:(a,b,c)=>{"use strict";c.d(b,{A:()=>h});var d=c(74515);let e=(...a)=>a.filter((a,b,c)=>!!a&&""!==a.trim()&&c.indexOf(a)===b).join(" ").trim();var f={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let g=(0,d.forwardRef)(({color:a="currentColor",size:b=24,strokeWidth:c=2,absoluteStrokeWidth:g,className:h="",children:i,iconNode:j,...k},l)=>(0,d.createElement)("svg",{ref:l,...f,width:b,height:b,stroke:a,strokeWidth:g?24*Number(c)/Number(b):c,className:e("lucide",h),...k},[...j.map(([a,b])=>(0,d.createElement)(a,b)),...Array.isArray(i)?i:[i]])),h=(a,b)=>{let c=(0,d.forwardRef)(({className:c,...f},h)=>(0,d.createElement)(g,{ref:h,iconNode:b,className:e(`lucide-${a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,c),...f}));return c.displayName=`${a}`,c}},89339:(a,b,c)=>{"use strict";c.d(b,{C1:()=>x,bL:()=>v});var d=c(38301),e=c(92808),f=c(2332),g=c(87868),h=c(11720),i=c(10350),j=c(96386),k=c(29988),l=c(6406),m=c(21124),n="Checkbox",[o,p]=(0,f.A)(n),[q,r]=o(n);function s(a){let{__scopeCheckbox:b,checked:c,children:e,defaultChecked:f,disabled:g,form:i,name:j,onCheckedChange:k,required:l,value:o="on",internal_do_not_use_render:p}=a,[r,s]=(0,h.i)({prop:c,defaultProp:f??!1,onChange:k,caller:n}),[t,u]=d.useState(null),[v,w]=d.useState(null),x=d.useRef(!1),y=!t||!!i||!!t.closest("form"),z={checked:r,disabled:g,setChecked:s,control:t,setControl:u,name:j,form:i,value:o,hasConsumerStoppedPropagationRef:x,required:l,defaultChecked:!A(f)&&f,isFormControl:y,bubbleInput:v,setBubbleInput:w};return(0,m.jsx)(q,{scope:b,...z,children:"function"==typeof p?p(z):e})}var t="CheckboxTrigger",u=d.forwardRef(({__scopeCheckbox:a,onKeyDown:b,onClick:c,...f},h)=>{let{control:i,value:j,disabled:k,checked:n,required:o,setControl:p,setChecked:q,hasConsumerStoppedPropagationRef:s,isFormControl:u,bubbleInput:v}=r(t,a),w=(0,e.s)(h,p),x=d.useRef(n);return d.useEffect(()=>{let a=i?.form;if(a){let b=()=>q(x.current);return a.addEventListener("reset",b),()=>a.removeEventListener("reset",b)}},[i,q]),(0,m.jsx)(l.sG.button,{type:"button",role:"checkbox","aria-checked":A(n)?"mixed":n,"aria-required":o,"data-state":B(n),"data-disabled":k?"":void 0,disabled:k,value:j,...f,ref:w,onKeyDown:(0,g.mK)(b,a=>{"Enter"===a.key&&a.preventDefault()}),onClick:(0,g.mK)(c,a=>{q(a=>!!A(a)||!a),v&&u&&(s.current=a.isPropagationStopped(),s.current||a.stopPropagation())})})});u.displayName=t;var v=d.forwardRef((a,b)=>{let{__scopeCheckbox:c,name:d,checked:e,defaultChecked:f,required:g,disabled:h,value:i,onCheckedChange:j,form:k,...l}=a;return(0,m.jsx)(s,{__scopeCheckbox:c,checked:e,defaultChecked:f,disabled:h,required:g,onCheckedChange:j,name:d,form:k,value:i,internal_do_not_use_render:({isFormControl:a})=>(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(u,{...l,ref:b,__scopeCheckbox:c}),a&&(0,m.jsx)(z,{__scopeCheckbox:c})]})})});v.displayName=n;var w="CheckboxIndicator",x=d.forwardRef((a,b)=>{let{__scopeCheckbox:c,forceMount:d,...e}=a,f=r(w,c);return(0,m.jsx)(k.C,{present:d||A(f.checked)||!0===f.checked,children:(0,m.jsx)(l.sG.span,{"data-state":B(f.checked),"data-disabled":f.disabled?"":void 0,...e,ref:b,style:{pointerEvents:"none",...a.style}})})});x.displayName=w;var y="CheckboxBubbleInput",z=d.forwardRef(({__scopeCheckbox:a,...b},c)=>{let{control:f,hasConsumerStoppedPropagationRef:g,checked:h,defaultChecked:k,required:n,disabled:o,name:p,value:q,form:s,bubbleInput:t,setBubbleInput:u}=r(y,a),v=(0,e.s)(c,u),w=(0,i.Z)(h),x=(0,j.X)(f);d.useEffect(()=>{if(!t)return;let a=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set,b=!g.current;if(w!==h&&a){let c=new Event("click",{bubbles:b});t.indeterminate=A(h),a.call(t,!A(h)&&h),t.dispatchEvent(c)}},[t,w,h,g]);let z=d.useRef(!A(h)&&h);return(0,m.jsx)(l.sG.input,{type:"checkbox","aria-hidden":!0,defaultChecked:k??z.current,required:n,disabled:o,name:p,value:q,form:s,...b,tabIndex:-1,ref:v,style:{...b.style,...x,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function A(a){return"indeterminate"===a}function B(a){return A(a)?"indeterminate":a?"checked":"unchecked"}z.displayName=y},90023:(a,b,c)=>{"use strict";c.d(b,{A:()=>d});let d=(0,c(8808).A)("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]])},90097:(a,b,c)=>{"use strict";c.d(b,{A:()=>d});let d=(0,c(8808).A)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]])},90114:(a,b,c)=>{"use strict";c.d(b,{T:()=>m});var d=c(21124),e=c(61012),f=c(77503),g=c(93400),h=c(3613),i=c(44943),j=c(35284),k=c(45608),l=c(42378);function m({table:a,className:b,totalRows:c}){let m=(0,l.useRouter)(),n=(0,l.usePathname)(),o=(0,l.useSearchParams)(),p=void 0!==c,q=a.getState().pagination.pageIndex,r=a.getState().pagination.pageSize,s=p?Math.ceil(c/r):a.getPageCount(),t=p?q>0:a.getCanPreviousPage();p||a.getCanNextPage();let u=p?a=>{let b=new URLSearchParams(o.toString());b.set("page",(a+1).toString()),m.push(`${n}?${b.toString()}`)}:a.setPageIndex;return(0,d.jsxs)("div",{className:(0,i.cn)("flex flex-col-reverse items-center justify-between gap-4 sm:flex-row sm:gap-6 lg:gap-8",b),children:[(0,d.jsxs)("div",{className:"flex-1 text-sm text-muted-foreground",children:[a.getFilteredSelectedRowModel().rows.length," من"," ",p?c:a.getFilteredRowModel().rows.length," صفوف مختارة."]}),(0,d.jsxs)("div",{className:"flex flex-col-reverse items-center gap-4 sm:flex-row sm:gap-6 lg:gap-8",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-2 space-x-reverse",children:[(0,d.jsx)("p",{className:"text-sm font-medium",children:"صفوف لكل صفحة"}),(0,d.jsxs)(k.l6,{value:`${r}`,onValueChange:b=>{var c;c=Number(b),p?(a=>{let b=new URLSearchParams(o.toString());b.set("limit",a.toString()),b.set("page","1"),m.push(`${n}?${b.toString()}`)})(c):a.setPageSize(c)},children:[(0,d.jsx)(k.bq,{className:"h-8 w-[70px]",children:(0,d.jsx)(k.yv,{placeholder:r})}),(0,d.jsx)(k.gC,{side:"top",children:[5,10,15,20,30,50].map(a=>(0,d.jsx)(k.eb,{value:`${a}`,children:a},a))})]})]}),(0,d.jsxs)("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium",children:["صفحة ",q+1," من"," ",s]}),(0,d.jsxs)("div",{className:"flex items-center space-x-2 space-x-reverse",children:[(0,d.jsxs)(j.$,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>u(0),disabled:!t,children:[(0,d.jsx)("span",{className:"sr-only",children:"Go to first page"}),(0,d.jsx)(e.A,{className:"h-4 w-4"})]}),(0,d.jsxs)(j.$,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>a.previousPage(),disabled:!a.getCanPreviousPage(),children:[(0,d.jsx)("span",{className:"sr-only",children:"Go to previous page"}),(0,d.jsx)(f.A,{className:"h-4 w-4"})]}),(0,d.jsxs)(j.$,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>a.nextPage(),disabled:!a.getCanNextPage(),children:[(0,d.jsx)("span",{className:"sr-only",children:"Go to next page"}),(0,d.jsx)(g.A,{className:"h-4 w-4"})]}),(0,d.jsxs)(j.$,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>a.setPageIndex(a.getPageCount()-1),disabled:!a.getCanNextPage(),children:[(0,d.jsx)("span",{className:"sr-only",children:"Go to last page"}),(0,d.jsx)(h.A,{className:"h-4 w-4"})]})]})]})]})}},91645:a=>{"use strict";a.exports=require("net")},94735:a=>{"use strict";a.exports=require("events")},97223:(a,b,c)=>{"use strict";c.r(b),c.d(b,{GlobalError:()=>D.a,__next_app__:()=>J,handler:()=>L,pages:()=>I,routeModule:()=>K,tree:()=>H});var d=c(49754),e=c(9117),f=c(46595),g=c(32324),h=c(39326),i=c(38928),j=c(20175),k=c(12),l=c(54290),m=c(12696),n=c(82802),o=c(77533),p=c(45229),q=c(32822),r=c(261),s=c(26453),t=c(52474),u=c(26713),v=c(51356),w=c(62685),x=c(36225),y=c(63446),z=c(2762),A=c(45742),B=c(86439),C=c(81170),D=c.n(C),E=c(62506),F=c(91203),G={};for(let a in E)0>["default","tree","pages","GlobalError","__next_app__","routeModule","handler"].indexOf(a)&&(G[a]=()=>E[a]);c.d(b,G);let H={children:["",{children:["bookings",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(c.bind(c,45702)),"/home/user/studio/src/app/bookings/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(c.bind(c,51472)),"/home/user/studio/src/app/layout.tsx"],"global-error":[()=>Promise.resolve().then(c.t.bind(c,81170,23)),"next/dist/client/components/builtin/global-error.js"],"not-found":[()=>Promise.resolve().then(c.t.bind(c,87028,23)),"next/dist/client/components/builtin/not-found.js"],forbidden:[()=>Promise.resolve().then(c.t.bind(c,90461,23)),"next/dist/client/components/builtin/forbidden.js"],unauthorized:[()=>Promise.resolve().then(c.t.bind(c,32768,23)),"next/dist/client/components/builtin/unauthorized.js"]}]}.children,I=["/home/user/studio/src/app/bookings/page.tsx"],J={require:c,loadChunk:()=>Promise.resolve()},K=new d.AppPageRouteModule({definition:{kind:e.RouteKind.APP_PAGE,page:"/bookings/page",pathname:"/bookings",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:H},distDir:".next",relativeProjectDir:""});async function L(a,b,d){var C;let G="/bookings/page";"/index"===G&&(G="/");let M=(0,h.getRequestMeta)(a,"postponed"),N=(0,h.getRequestMeta)(a,"minimalMode"),O=await K.prepare(a,b,{srcPage:G,multiZoneDraftMode:!1});if(!O)return b.statusCode=400,b.end("Bad Request"),null==d.waitUntil||d.waitUntil.call(d,Promise.resolve()),null;let{buildId:P,query:Q,params:R,parsedUrl:S,pageIsDynamic:T,buildManifest:U,nextFontManifest:V,reactLoadableManifest:W,serverActionsManifest:X,clientReferenceManifest:Y,subresourceIntegrityManifest:Z,prerenderManifest:$,isDraftMode:_,resolvedPathname:aa,revalidateOnlyGenerated:ab,routerServerContext:ac,nextConfig:ad,interceptionRoutePatterns:ae}=O,af=S.pathname||"/",ag=(0,r.normalizeAppPath)(G),{isOnDemandRevalidate:ah}=O,ai=K.match(af,$),aj=!!$.routes[aa],ak=!!(ai||aj||$.routes[ag]),al=a.headers["user-agent"]||"",am=(0,u.getBotType)(al),an=(0,p.isHtmlBotRequest)(a),ao=(0,h.getRequestMeta)(a,"isPrefetchRSCRequest")??"1"===a.headers[t.NEXT_ROUTER_PREFETCH_HEADER],ap=(0,h.getRequestMeta)(a,"isRSCRequest")??!!a.headers[t.RSC_HEADER],aq=(0,s.getIsPossibleServerAction)(a),ar=(0,m.checkIsAppPPREnabled)(ad.experimental.ppr)&&(null==(C=$.routes[ag]??$.dynamicRoutes[ag])?void 0:C.renderingMode)==="PARTIALLY_STATIC",as=!1,at=!1,au=ar?M:void 0,av=ar&&ap&&!ao,aw=(0,h.getRequestMeta)(a,"segmentPrefetchRSCRequest"),ax=!al||(0,p.shouldServeStreamingMetadata)(al,ad.htmlLimitedBots);an&&ar&&(ak=!1,ax=!1);let ay=!0===K.isDev||!ak||"string"==typeof M||av,az=an&&ar,aA=null;_||!ak||ay||aq||au||av||(aA=aa);let aB=aA;!aB&&K.isDev&&(aB=aa),K.isDev||_||!ak||!ap||av||(0,k.d)(a.headers);let aC={...E,tree:H,pages:I,GlobalError:D(),handler:L,routeModule:K,__next_app__:J};X&&Y&&(0,o.setReferenceManifestsSingleton)({page:G,clientReferenceManifest:Y,serverActionsManifest:X,serverModuleMap:(0,q.createServerModuleMap)({serverActionsManifest:X})});let aD=a.method||"GET",aE=(0,g.getTracer)(),aF=aE.getActiveScopeSpan();try{let f=K.getVaryHeader(aa,ae);b.setHeader("Vary",f);let k=async(c,d)=>{let e=new l.NodeNextRequest(a),f=new l.NodeNextResponse(b);return K.render(e,f,d).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=aE.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==i.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${aD} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${aD} ${a.url}`)})},m=async({span:e,postponed:f,fallbackRouteParams:g})=>{let i={query:Q,params:R,page:ag,sharedContext:{buildId:P},serverComponentsHmrCache:(0,h.getRequestMeta)(a,"serverComponentsHmrCache"),fallbackRouteParams:g,renderOpts:{App:()=>null,Document:()=>null,pageConfig:{},ComponentMod:aC,Component:(0,j.T)(aC),params:R,routeModule:K,page:G,postponed:f,shouldWaitOnAllReady:az,serveStreamingMetadata:ax,supportsDynamicResponse:"string"==typeof f||ay,buildManifest:U,nextFontManifest:V,reactLoadableManifest:W,subresourceIntegrityManifest:Z,serverActionsManifest:X,clientReferenceManifest:Y,setIsrStatus:null==ac?void 0:ac.setIsrStatus,dir:c(33873).join(process.cwd(),K.relativeProjectDir),isDraftMode:_,isRevalidate:ak&&!f&&!av,botType:am,isOnDemandRevalidate:ah,isPossibleServerAction:aq,assetPrefix:ad.assetPrefix,nextConfigOutput:ad.output,crossOrigin:ad.crossOrigin,trailingSlash:ad.trailingSlash,previewProps:$.preview,deploymentId:ad.deploymentId,enableTainting:ad.experimental.taint,htmlLimitedBots:ad.htmlLimitedBots,devtoolSegmentExplorer:ad.experimental.devtoolSegmentExplorer,reactMaxHeadersLength:ad.reactMaxHeadersLength,multiZoneDraftMode:!1,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:ad.experimental.cacheLife,basePath:ad.basePath,serverActions:ad.experimental.serverActions,...as?{nextExport:!0,supportsDynamicResponse:!1,isStaticGeneration:!0,isRevalidate:!0,isDebugDynamicAccesses:as}:{},experimental:{isRoutePPREnabled:ar,expireTime:ad.expireTime,staleTimes:ad.experimental.staleTimes,cacheComponents:!!ad.experimental.cacheComponents,clientSegmentCache:!!ad.experimental.clientSegmentCache,clientParamParsing:!!ad.experimental.clientParamParsing,dynamicOnHover:!!ad.experimental.dynamicOnHover,inlineCss:!!ad.experimental.inlineCss,authInterrupts:!!ad.experimental.authInterrupts,clientTraceMetadata:ad.experimental.clientTraceMetadata||[]},waitUntil:d.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:()=>{},onInstrumentationRequestError:(b,c,d)=>K.onRequestError(a,b,d,ac),err:(0,h.getRequestMeta)(a,"invokeError"),dev:K.isDev}},l=await k(e,i),{metadata:m}=l,{cacheControl:n,headers:o={},fetchTags:p}=m;if(p&&(o[y.NEXT_CACHE_TAGS_HEADER]=p),a.fetchMetrics=m.fetchMetrics,ak&&(null==n?void 0:n.revalidate)===0&&!K.isDev&&!ar){let a=m.staticBailoutInfo,b=Object.defineProperty(Error(`Page changed from static to dynamic at runtime ${aa}${(null==a?void 0:a.description)?`, reason: ${a.description}`:""}
see more here https://nextjs.org/docs/messages/app-static-to-dynamic-error`),"__NEXT_ERROR_CODE",{value:"E132",enumerable:!1,configurable:!0});if(null==a?void 0:a.stack){let c=a.stack;b.stack=b.message+c.substring(c.indexOf("\n"))}throw b}return{value:{kind:v.CachedRouteKind.APP_PAGE,html:l,headers:o,rscData:m.flightData,postponed:m.postponed,status:m.statusCode,segmentData:m.segmentData},cacheControl:n}},o=async({hasResolved:c,previousCacheEntry:f,isRevalidating:g,span:i})=>{let j,k=!1===K.isDev,l=c||b.writableEnded;if(ah&&ab&&!f&&!N)return(null==ac?void 0:ac.render404)?await ac.render404(a,b):(b.statusCode=404,b.end("This page could not be found")),null;if(ai&&(j=(0,w.parseFallbackField)(ai.fallback)),j===w.FallbackMode.PRERENDER&&(0,u.isBot)(al)&&(!ar||an)&&(j=w.FallbackMode.BLOCKING_STATIC_RENDER),(null==f?void 0:f.isStale)===-1&&(ah=!0),ah&&(j!==w.FallbackMode.NOT_FOUND||f)&&(j=w.FallbackMode.BLOCKING_STATIC_RENDER),!N&&j!==w.FallbackMode.BLOCKING_STATIC_RENDER&&aB&&!l&&!_&&T&&(k||!aj)){let b;if((k||ai)&&j===w.FallbackMode.NOT_FOUND)throw new B.NoFallbackError;if(ar&&!ap){let c="string"==typeof(null==ai?void 0:ai.fallback)?ai.fallback:k?ag:null;if(b=await K.handleResponse({cacheKey:c,req:a,nextConfig:ad,routeKind:e.RouteKind.APP_PAGE,isFallback:!0,prerenderManifest:$,isRoutePPREnabled:ar,responseGenerator:async()=>m({span:i,postponed:void 0,fallbackRouteParams:k||at?(0,n.u)(ag):null}),waitUntil:d.waitUntil}),null===b)return null;if(b)return delete b.cacheControl,b}}let o=ah||g||!au?void 0:au;if(as&&void 0!==o)return{cacheControl:{revalidate:1,expire:void 0},value:{kind:v.CachedRouteKind.PAGES,html:x.default.EMPTY,pageData:{},headers:void 0,status:void 0}};let p=T&&ar&&((0,h.getRequestMeta)(a,"renderFallbackShell")||at)?(0,n.u)(af):null;return m({span:i,postponed:o,fallbackRouteParams:p})},p=async c=>{var f,g,i,j,k;let l,n=await K.handleResponse({cacheKey:aA,responseGenerator:a=>o({span:c,...a}),routeKind:e.RouteKind.APP_PAGE,isOnDemandRevalidate:ah,isRoutePPREnabled:ar,req:a,nextConfig:ad,prerenderManifest:$,waitUntil:d.waitUntil});if(_&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate"),K.isDev&&b.setHeader("Cache-Control","no-store, must-revalidate"),!n){if(aA)throw Object.defineProperty(Error("invariant: cache entry required but not generated"),"__NEXT_ERROR_CODE",{value:"E62",enumerable:!1,configurable:!0});return null}if((null==(f=n.value)?void 0:f.kind)!==v.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant app-page handler received invalid cache entry ${null==(i=n.value)?void 0:i.kind}`),"__NEXT_ERROR_CODE",{value:"E707",enumerable:!1,configurable:!0});let p="string"==typeof n.value.postponed;ak&&!av&&(!p||ao)&&(N||b.setHeader("x-nextjs-cache",ah?"REVALIDATED":n.isMiss?"MISS":n.isStale?"STALE":"HIT"),b.setHeader(t.NEXT_IS_PRERENDER_HEADER,"1"));let{value:q}=n;if(au)l={revalidate:0,expire:void 0};else if(N&&ap&&!ao&&ar)l={revalidate:0,expire:void 0};else if(!K.isDev)if(_)l={revalidate:0,expire:void 0};else if(ak){if(n.cacheControl)if("number"==typeof n.cacheControl.revalidate){if(n.cacheControl.revalidate<1)throw Object.defineProperty(Error(`Invalid revalidate configuration provided: ${n.cacheControl.revalidate} < 1`),"__NEXT_ERROR_CODE",{value:"E22",enumerable:!1,configurable:!0});l={revalidate:n.cacheControl.revalidate,expire:(null==(j=n.cacheControl)?void 0:j.expire)??ad.expireTime}}else l={revalidate:y.CACHE_ONE_YEAR,expire:void 0}}else b.getHeader("Cache-Control")||(l={revalidate:0,expire:void 0});if(n.cacheControl=l,"string"==typeof aw&&(null==q?void 0:q.kind)===v.CachedRouteKind.APP_PAGE&&q.segmentData){b.setHeader(t.NEXT_DID_POSTPONE_HEADER,"2");let c=null==(k=q.headers)?void 0:k[y.NEXT_CACHE_TAGS_HEADER];N&&ak&&c&&"string"==typeof c&&b.setHeader(y.NEXT_CACHE_TAGS_HEADER,c);let d=q.segmentData.get(aw);return void 0!==d?(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.fromStatic(d,t.RSC_CONTENT_TYPE_HEADER),cacheControl:n.cacheControl}):(b.statusCode=204,(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.EMPTY,cacheControl:n.cacheControl}))}let r=(0,h.getRequestMeta)(a,"onCacheEntry");if(r&&await r({...n,value:{...n.value,kind:"PAGE"}},{url:(0,h.getRequestMeta)(a,"initURL")}))return null;if(p&&au)throw Object.defineProperty(Error("Invariant: postponed state should not be present on a resume request"),"__NEXT_ERROR_CODE",{value:"E396",enumerable:!1,configurable:!0});if(q.headers){let a={...q.headers};for(let[c,d]of(N&&ak||delete a[y.NEXT_CACHE_TAGS_HEADER],Object.entries(a)))if(void 0!==d)if(Array.isArray(d))for(let a of d)b.appendHeader(c,a);else"number"==typeof d&&(d=d.toString()),b.appendHeader(c,d)}let s=null==(g=q.headers)?void 0:g[y.NEXT_CACHE_TAGS_HEADER];if(N&&ak&&s&&"string"==typeof s&&b.setHeader(y.NEXT_CACHE_TAGS_HEADER,s),!q.status||ap&&ar||(b.statusCode=q.status),!N&&q.status&&F.RedirectStatusCode[q.status]&&ap&&(b.statusCode=200),p&&b.setHeader(t.NEXT_DID_POSTPONE_HEADER,"1"),ap&&!_){if(void 0===q.rscData){if(q.postponed)throw Object.defineProperty(Error("Invariant: Expected postponed to be undefined"),"__NEXT_ERROR_CODE",{value:"E372",enumerable:!1,configurable:!0});return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:q.html,cacheControl:av?{revalidate:0,expire:void 0}:n.cacheControl})}return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.fromStatic(q.rscData,t.RSC_CONTENT_TYPE_HEADER),cacheControl:n.cacheControl})}let u=q.html;if(!p||N||ap)return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:n.cacheControl});if(as)return u.push(new ReadableStream({start(a){a.enqueue(z.ENCODED_TAGS.CLOSED.BODY_AND_HTML),a.close()}})),(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:{revalidate:0,expire:void 0}});let w=new TransformStream;return u.push(w.readable),m({span:c,postponed:q.postponed,fallbackRouteParams:null}).then(async a=>{var b,c;if(!a)throw Object.defineProperty(Error("Invariant: expected a result to be returned"),"__NEXT_ERROR_CODE",{value:"E463",enumerable:!1,configurable:!0});if((null==(b=a.value)?void 0:b.kind)!==v.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant: expected a page response, got ${null==(c=a.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E305",enumerable:!1,configurable:!0});await a.value.html.pipeTo(w.writable)}).catch(a=>{w.writable.abort(a).catch(a=>{console.error("couldn't abort transformer",a)})}),(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:{revalidate:0,expire:void 0}})};if(!aF)return await aE.withPropagatedContext(a.headers,()=>aE.trace(i.BaseServerSpan.handleRequest,{spanName:`${aD} ${a.url}`,kind:g.SpanKind.SERVER,attributes:{"http.method":aD,"http.target":a.url}},p));await p(aF)}catch(b){throw b instanceof B.NoFallbackError||await K.onRequestError(a,b,{routerKind:"App Router",routePath:G,routeType:"render",revalidateReason:(0,f.c)({isRevalidate:ak,isOnDemandRevalidate:ah})},ac),b}}}};var b=require("../../webpack-runtime.js");b.C(a);var c=b.X(0,[4586,8298,3103,9664,7180,6153,7846,8777,1134,4515,9667,4550,2740,5446,4154,4799,3152,7358,1842],()=>b(b.s=97223));module.exports=c})();