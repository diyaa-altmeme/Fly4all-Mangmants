(()=>{var a={};a.id=9420,a.ids=[9420],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3896:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),!function(a,b){for(var c in b)Object.defineProperty(a,c,{enumerable:!0,get:b[c]})}(b,{INTERCEPTION_ROUTE_MARKERS:function(){return e},extractInterceptionRouteInformation:function(){return g},isInterceptionRouteAppPath:function(){return f}});let d=c(48723),e=["(..)(..)","(.)","(..)","(...)"];function f(a){return void 0!==a.split("/").find(a=>e.find(b=>a.startsWith(b)))}function g(a){let b,c,f;for(let d of a.split("/"))if(c=e.find(a=>d.startsWith(a))){[b,f]=a.split(c,2);break}if(!b||!c||!f)throw Object.defineProperty(Error("Invalid interception route: "+a+". Must be in the format /<intercepting route>/(..|...|..)(..)/<intercepted route>"),"__NEXT_ERROR_CODE",{value:"E269",enumerable:!1,configurable:!0});switch(b=(0,d.normalizeAppPath)(b),c){case"(.)":f="/"===b?"/"+f:b+"/"+f;break;case"(..)":if("/"===b)throw Object.defineProperty(Error("Invalid interception route: "+a+". Cannot use (..) marker at the root level, use (.) instead."),"__NEXT_ERROR_CODE",{value:"E207",enumerable:!1,configurable:!0});f=b.split("/").slice(0,-1).concat(f).join("/");break;case"(...)":f="/"+f;break;case"(..)(..)":let g=b.split("/");if(g.length<=2)throw Object.defineProperty(Error("Invalid interception route: "+a+". Cannot use (..)(..) marker at the root level or one level up."),"__NEXT_ERROR_CODE",{value:"E486",enumerable:!1,configurable:!0});f=g.slice(0,-2).concat(f).join("/");break;default:throw Object.defineProperty(Error("Invariant: unexpected marker"),"__NEXT_ERROR_CODE",{value:"E112",enumerable:!1,configurable:!0})}return{interceptingRoute:b,interceptedRoute:f}}},7879:a=>{"use strict";a.exports=import("firebase-admin/firestore")},8079:(a,b,c)=>{"use strict";c.d(b,{I2:()=>h,Um:()=>f,aV:()=>g,yZ:()=>j});let d=(a,b)=>{if(!a||!b)return!1;let c=a.trim(),d=b.trim();return!!c&&!!d&&(c===d||c.startsWith(`${d}-`)||c.startsWith(`${d}.`)||c.startsWith(`${d}/`)||c.startsWith(d))},e=(a,b)=>{for(let c of b)if(d(a,c))return!0;return!1};function f(a,b){if(!a||!b)return"other";let{defaultCashId:c,defaultBankId:f,receivableAccountId:g,arAccountId:h,payableAccountId:i,apAccountId:j,hybridRelationAccountId:k,clearingAccountId:l,revenueMap:m,expenseMap:n,generalRevenueId:o,generalExpenseId:p}=b;return d(a,c)?"cash":d(a,f)?"bank":d(a,k)?"hybrid":d(a,g)||d(a,h)?"client":d(a,i)||d(a,j)?"supplier":d(a,l)?"clearing":e(a,[o,...Object.values(m||{})])?"revenue":e(a,[p,...Object.values(n||{})])?"expense":"other"}function g(a,b){return"revenue"===f(a,b)}function h(a,b){return"expense"===f(a,b)}let i=a=>{if("number"==typeof a&&!Number.isNaN(a))return a;if("string"==typeof a&&""!==a.trim()){let b=Number(a);return Number.isFinite(b)?b:0}return 0};function j(a,b){if(Array.isArray(a.entries)&&a.entries.length>0)return a.entries.map(a=>{let c=i(a.debit??("debit"===a.type?a.amount:0)),d=i(a.credit??("credit"===a.type?a.amount:0)),e=a.accountType||f(a.accountId,b);return{accountId:a.accountId,debit:c,credit:d,amount:c>0?c:d,description:a.description??a.note,currency:a.currency,relationId:a.relationId,companyId:a.companyId,accountType:e,type:c>0?"debit":"credit"}});let c=[];if(Array.isArray(a.debitEntries))for(let d of a.debitEntries){let a=i(d.amount??d.debit);c.push({accountId:d.accountId,debit:a,credit:0,amount:a,description:d.description,currency:d.currency,relationId:d.relationId,companyId:d.companyId,accountType:f(d.accountId,b),type:"debit"})}if(Array.isArray(a.creditEntries))for(let d of a.creditEntries){let a=i(d.amount??d.credit);c.push({accountId:d.accountId,debit:0,credit:a,amount:a,description:d.description,currency:d.currency,relationId:d.relationId,companyId:d.companyId,accountType:f(d.accountId,b),type:"credit"})}return c}},9801:a=>{"use strict";a.exports=import("firebase-admin/app")},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14276:a=>{"use strict";a.exports=import("firebase-admin/auth")},19121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},24803:a=>{"use strict";a.exports=import("firebase-admin/storage")},28354:a=>{"use strict";a.exports=require("util")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30787:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(b,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return i}});let d=function(a,b){if(a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=e(b);if(c&&c.has(a))return c.get(a);var d={__proto__:null},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var g in a)if("default"!==g&&Object.prototype.hasOwnProperty.call(a,g)){var h=f?Object.getOwnPropertyDescriptor(a,g):null;h&&(h.get||h.set)?Object.defineProperty(d,g,h):d[g]=a[g]}return d.default=a,c&&c.set(a,d),d}(c(74515));function e(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(e=function(a){return a?c:b})(a)}let f={current:null},g="function"==typeof d.cache?d.cache:a=>a,h=console.warn;function i(a){return function(...b){h(a(...b))}}g(a=>{try{h(f.current)}finally{f.current=null}})},40329:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{handler:()=>x,patchFetch:()=>w,routeModule:()=>y,serverHooks:()=>B,workAsyncStorage:()=>z,workUnitAsyncStorage:()=>A});var e=c(95736),f=c(9117),g=c(4044),h=c(39326),i=c(32324),j=c(261),k=c(54290),l=c(85328),m=c(38928),n=c(46595),o=c(3421),p=c(17679),q=c(41681),r=c(63446),s=c(86439),t=c(51356),u=c(66283),v=a([u]);u=(v.then?(await v)():v)[0];let y=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/reports/profit-loss/route",pathname:"/api/reports/profit-loss",filename:"route",bundlePath:"app/api/reports/profit-loss/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"/home/user/studio/src/app/api/reports/profit-loss/route.ts",nextConfigOutput:"",userland:u}),{workAsyncStorage:z,workUnitAsyncStorage:A,serverHooks:B}=y;function w(){return(0,g.patchFetch)({workAsyncStorage:z,workUnitAsyncStorage:A})}async function x(a,b,c){var d;let e="/api/reports/profit-loss/route";"/index"===e&&(e="/");let g=await y.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:z,routerServerContext:A,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,resolvedPathname:D}=g,E=(0,j.normalizeAppPath)(e),F=!!(z.dynamicRoutes[E]||z.routes[D]);if(F&&!x){let a=!!z.routes[D],b=z.dynamicRoutes[E];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let G=null;!F||y.isDev||x||(G=D,G="/index"===G?"/":G);let H=!0===y.isDev||!F,I=F&&!H,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:z,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:H,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>y.onRequestError(a,b,d,A)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>y.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&B&&C&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!F)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await y.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})},A),b}},l=await y.handleResponse({req:a,nextConfig:w,cacheKey:G,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:z,isRoutePPREnabled:!1,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,responseGenerator:k,waitUntil:c.waitUntil});if(!F)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",B?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&F||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(b instanceof s.NoFallbackError||await y.onRequestError(a,b,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})}),F)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}d()}catch(a){d(a)}})},44870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:a=>{"use strict";a.exports=require("crypto")},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66283:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{GET:()=>k});var e=c(43513),f=c(46587),g=c(10641),h=c(97092),i=c(8079),j=a([e,f]);[e,f]=j.then?(await j)():j;let l=a=>{if(!a)return new Date().toISOString();if("string"==typeof a){let b=new Date(a);return Number.isNaN(b.getTime())?new Date().toISOString():b.toISOString()}if(a instanceof Date)return a.toISOString();if("function"==typeof a.toDate){let b=a.toDate();return b instanceof Date?b.toISOString():new Date().toISOString()}return"number"==typeof a.seconds?new Date(1e3*a.seconds).toISOString():new Date().toISOString()};async function k(){try{let a=await (0,e.Lf)();if(!a)return g.NextResponse.json({error:"Database not available"},{status:500});let b=await (0,f.mt)(),c=(0,h.uJ)(b.financeAccounts);if(!c.generalRevenueId||!c.generalExpenseId||!c.receivableAccountId)return g.NextResponse.json({error:"Finance settings not configured"},{status:500});let d=await a.collection("journal-vouchers").get(),j=[],k=0,m=0;d.forEach(a=>{let b=a.data();if(b.isDeleted)return;let d=(0,i.yZ)(b,c),e=l(b.date),f=b.notes||b.description||"";d.forEach(d=>{d.credit>0&&(0,i.aV)(d.accountId,c)?(k+=d.credit,j.push({voucherId:a.id,accountId:d.accountId,amount:d.credit,currency:d.currency||b.currency||"USD",type:"revenue",date:e,description:d.description||f,sourceType:b.sourceType||b.voucherType,sourceId:b.sourceId||b.originalData?.sourceId})):d.debit>0&&(0,i.I2)(d.accountId,c)&&(m+=d.debit,j.push({voucherId:a.id,accountId:d.accountId,amount:d.debit,currency:d.currency||b.currency||"USD",type:"expense",date:e,description:d.description||f,sourceType:b.sourceType||b.voucherType,sourceId:b.sourceId||b.originalData?.sourceId}))})});try{(await a.collection("journals").get()).forEach(a=>{let b=a.data(),d=l(b.date),e=b.description||"";(b.entries||[]).forEach(f=>{if("credit"===f.type&&(0,i.aV)(f.accountId,c)){let c=Number(f.amount)||0;k+=c,j.push({voucherId:a.id,accountId:f.accountId,amount:c,currency:f.currency||b.currency||"USD",type:"revenue",date:d,description:f.description||e,sourceType:b.sourceType||"legacy_journal",sourceId:b.sourceId})}else if("debit"===f.type&&(0,i.I2)(f.accountId,c)){let c=Number(f.amount)||0;m+=c,j.push({voucherId:a.id,accountId:f.accountId,amount:c,currency:f.currency||b.currency||"USD",type:"expense",date:d,description:f.description||e,sourceType:b.sourceType||"legacy_journal",sourceId:b.sourceId})}})})}catch(a){console.warn("Failed to load legacy journals for profit/loss:",a)}let n=k-m;return g.NextResponse.json({entries:j,totals:{revenue:k,expense:m,profit:n}})}catch(a){return g.NextResponse.json({error:a.message},{status:500})}}d()}catch(a){d(a)}})},78335:()=>{},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},88606:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{"0004c295195cb02aa74b7e03b9ab47835262f651f3":()=>f._u,"00454095f373f8afcf3cd8b88a3e9643ba6181edb6":()=>g.y4,"005773e734ccf3535fa61ed9b34042d47625b1ede6":()=>h.O0,"0079928ff14026085419c5483c28b98ee3311389f6":()=>e.$E,"0084d26686615403d39adac4c095e2f442ed3af27d":()=>e.iS,"009e84f93947e0a432e28675ea07a71949bfe66943":()=>e.Lf,"00afcee30c25fc6521aeaf596fabd0fef5e0ca707f":()=>h.qV,"00d790a9c67325f46e1dda5ba33e59ecfd95062466":()=>g.HW,"40213622e57351942781ff52345df063ded4056884":()=>g.Sm,"40290c8e8678ea3c7dc08bc14a2b21bf84ced558a3":()=>h.lo,"406818275705b776627a9e14558eaa7857fbec9b73":()=>h.ht,"4085aac590f12a4a641b5bc7fff47d5353af49510e":()=>g.S,"408d4523c5fa8dbd353900a15d896d0ebee083358b":()=>g.X7,"40ae79a531e9ac50ecc04279061a2192af6e60d6f4":()=>i.iL,"40bd3493b6cd183a3f75aa7b2dffe9f325b07a2b9d":()=>f.Xx,"40d4790cf5bfe15d462399ad8c52d1baec8babf86f":()=>h.nu,"40e13d085ff779b8dfbb82e790ebb21702ce079192":()=>h.Cm,"40ef77a697a84cf599002575e6afc4c1de58c3cdab":()=>h.hG,"40fc6757a7ed8ba6cf86a7bf30e6bf0934f153f439":()=>g.Lx,"601532f3b7a46dae258a5ff32f14fb4b3e2e141e9f":()=>h.TK,"601838acb9f969bfd30fa9f583c86dd453b19524dd":()=>h.v_,"7f06d4b21a91bbe15e581c350a136426169075ee5f":()=>i.oH,"7f33ef79ae72de1c2db1340cf81f1c0a0a525a8033":()=>g.kl,"7f33fcd02c8b1dfc136d21fd7035ce40fe2d48b135":()=>g.ht,"7f7cc5ac28f76953e580388c96325185bdb57f592c":()=>g.EZ,"7faf63d9d8686c0ff053833c82fd60b3e9c6fa0bff":()=>g.$T,"7fd691cbe2382ade3c2dc739956026d2c3c806df06":()=>i.t6,"7fe3cedf8b5b39f6ca6561f08402f1ad7a82ecff97":()=>f.mt});var e=c(43513),f=c(46587),g=c(33152),h=c(40776),i=c(86988),j=a([e,f,g,h,i]);[e,f,g,h,i]=j.then?(await j)():j,d()}catch(a){d(a)}})},96487:()=>{},97092:(a,b,c)=>{"use strict";c.d(b,{rN:()=>j,uJ:()=>i});let d=a=>(a??"").trim(),e=(a,b)=>Array.from(new Set([...b,...Object.keys(a||{})])).reduce((b,c)=>(b[c]=d(a?.[c]),b),{}),f=a=>Object.values(a).find(a=>a.length>0)||"",g=["tickets","visas","subscriptions","segments","profit_distribution","other"],h=["tickets","visas","subscriptions","partners","operating","cost_tickets","cost_visas","operating_salaries","operating_rent","operating_utilities","marketing"];function i(a){let b={...a?.revenueMap||{},...a?.customRevenues||{}},c={...a?.expenseMap||{},...a?.customExpenses||{}},i=e(b,g),j=e(c,h),k=d(a?.receivableAccountId||a?.arAccountId),l=d(a?.payableAccountId||a?.apAccountId),m=d(a?.generalRevenueId)||f(i),n=d(a?.generalExpenseId)||f(j);return{receivableAccountId:k,payableAccountId:l,hybridRelationAccountId:d(a?.hybridRelationAccountId),clearingAccountId:d(a?.clearingAccountId),defaultCashId:d(a?.defaultCashId),defaultBankId:d(a?.defaultBankId),arAccountId:k,apAccountId:l,generalRevenueId:m,generalExpenseId:n,preventDirectCashRevenue:!!a?.preventDirectCashRevenue,revenueMap:i,expenseMap:j}}function j(a){let b=e(a.revenueMap||{},g),c=e(a.expenseMap||{},h),i=d(a.receivableAccountId),j=d(a.payableAccountId),k=d(a.generalRevenueId)||f(b),l=d(a.generalExpenseId)||f(c);return{receivableAccountId:i,payableAccountId:j,hybridRelationAccountId:d(a.hybridRelationAccountId),clearingAccountId:d(a.clearingAccountId),defaultCashId:d(a.defaultCashId),defaultBankId:d(a.defaultBankId),preventDirectCashRevenue:!!a.preventDirectCashRevenue,generalRevenueId:k,generalExpenseId:l,arAccountId:i,apAccountId:j,revenueMap:b,customRevenues:b,expenseMap:c,customExpenses:c}}}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[4586,8298,7180,7846,1692,3152,6587],()=>b(b.s=40329));module.exports=c})();