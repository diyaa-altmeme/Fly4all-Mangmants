(()=>{var a={};a.id=8758,a.ids=[8758],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},1448:(a,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.isDuration=b.durationToMs=b.msToDuration=void 0,b.msToDuration=function(a){return{seconds:a/1e3|0,nanos:a%1e3*1e6|0}},b.durationToMs=function(a){return 1e3*a.seconds+a.nanos/1e6|0},b.isDuration=function(a){return"number"==typeof a.seconds&&"number"==typeof a.nanos}},2234:(a,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.getErrorCode=b.getErrorMessage=void 0,b.getErrorMessage=function(a){return a instanceof Error?a.message:String(a)},b.getErrorCode=function(a){return"object"==typeof a&&null!==a&&"code"in a&&"number"==typeof a.code?a.code:null}},2313:(a,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.addAdminServicesToServer=b.registerAdminService=void 0;let c=[];b.registerAdminService=function(a,b){c.push({getServiceDefinition:a,getHandlers:b})},b.addAdminServicesToServer=function(a){for(let{getServiceDefinition:b,getHandlers:d}of c)a.addService(b(),d())}},2929:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.Client=void 0;let d=c(21880),e=c(6269),f=c(59173),g=c(51387),h=c(61291),i=c(44258),j=Symbol(),k=Symbol(),l=Symbol(),m=Symbol();function n(a){return"function"==typeof a}function o(a){return a.stack.split("\n").slice(1).join("\n")}class p{constructor(a,b,c={}){var d,f;if(c=Object.assign({},c),this[k]=null!=(d=c.interceptors)?d:[],delete c.interceptors,this[l]=null!=(f=c.interceptor_providers)?f:[],delete c.interceptor_providers,this[k].length>0&&this[l].length>0)throw Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[m]=c.callInvocationTransformer,delete c.callInvocationTransformer,c.channelOverride)this[j]=c.channelOverride;else if(c.channelFactoryOverride){let d=c.channelFactoryOverride;delete c.channelFactoryOverride,this[j]=d(a,b,c)}else this[j]=new e.ChannelImplementation(a,b,c)}close(){this[j].close()}getChannel(){return this[j]}waitForReady(a,b){let c=d=>{let e;if(d)return void b(Error("Failed to connect before the deadline"));try{e=this[j].getConnectivityState(!0)}catch(a){b(Error("The channel has been closed"));return}if(e===f.ConnectivityState.READY)b();else try{this[j].watchConnectivityState(e,a,c)}catch(a){b(Error("The channel has been closed"))}};setImmediate(c)}checkOptionalUnaryResponseArguments(a,b,c){if(n(a))return{metadata:new h.Metadata,options:{},callback:a};if(n(b))if(a instanceof h.Metadata)return{metadata:a,options:{},callback:b};else return{metadata:new h.Metadata,options:a,callback:b};if(!(a instanceof h.Metadata&&b instanceof Object&&n(c)))throw Error("Incorrect arguments passed");return{metadata:a,options:b,callback:c}}makeUnaryRequest(a,b,c,e,f,h,n){var p,q;let r=this.checkOptionalUnaryResponseArguments(f,h,n),s={argument:e,metadata:r.metadata,call:new d.ClientUnaryCallImpl,channel:this[j],methodDefinition:{path:a,requestStream:!1,responseStream:!1,requestSerialize:b,responseDeserialize:c},callOptions:r.options,callback:r.callback};this[m]&&(s=this[m](s));let t=s.call,u={clientInterceptors:this[k],clientInterceptorProviders:this[l],callInterceptors:null!=(p=s.callOptions.interceptors)?p:[],callInterceptorProviders:null!=(q=s.callOptions.interceptor_providers)?q:[]},v=(0,i.getInterceptingCall)(u,s.methodDefinition,s.callOptions,s.channel);t.call=v;let w=null,x=!1,y=Error();return v.start(s.metadata,{onReceiveMetadata:a=>{t.emit("metadata",a)},onReceiveMessage(a){null!==w&&v.cancelWithStatus(g.Status.INTERNAL,"Too many responses received"),w=a},onReceiveStatus(a){if(!x){if(x=!0,a.code===g.Status.OK)if(null===w){let b=o(y);s.callback((0,d.callErrorFromStatus)({code:g.Status.INTERNAL,details:"No message received",metadata:a.metadata},b))}else s.callback(null,w);else{let b=o(y);s.callback((0,d.callErrorFromStatus)(a,b))}y=null,t.emit("status",a)}}}),v.sendMessage(e),v.halfClose(),t}makeClientStreamRequest(a,b,c,e,f,h){var n,p;let q=this.checkOptionalUnaryResponseArguments(e,f,h),r={metadata:q.metadata,call:new d.ClientWritableStreamImpl(b),channel:this[j],methodDefinition:{path:a,requestStream:!0,responseStream:!1,requestSerialize:b,responseDeserialize:c},callOptions:q.options,callback:q.callback};this[m]&&(r=this[m](r));let s=r.call,t={clientInterceptors:this[k],clientInterceptorProviders:this[l],callInterceptors:null!=(n=r.callOptions.interceptors)?n:[],callInterceptorProviders:null!=(p=r.callOptions.interceptor_providers)?p:[]},u=(0,i.getInterceptingCall)(t,r.methodDefinition,r.callOptions,r.channel);s.call=u;let v=null,w=!1,x=Error();return u.start(r.metadata,{onReceiveMetadata:a=>{s.emit("metadata",a)},onReceiveMessage(a){null!==v&&u.cancelWithStatus(g.Status.INTERNAL,"Too many responses received"),v=a},onReceiveStatus(a){if(!w){if(w=!0,a.code===g.Status.OK)if(null===v){let b=o(x);r.callback((0,d.callErrorFromStatus)({code:g.Status.INTERNAL,details:"No message received",metadata:a.metadata},b))}else r.callback(null,v);else{let b=o(x);r.callback((0,d.callErrorFromStatus)(a,b))}x=null,s.emit("status",a)}}}),s}checkMetadataAndOptions(a,b){let c,d;return a instanceof h.Metadata?(c=a,d=b||{}):(d=a||{},c=new h.Metadata),{metadata:c,options:d}}makeServerStreamRequest(a,b,c,e,f,h){var n,p;let q=this.checkMetadataAndOptions(f,h),r={argument:e,metadata:q.metadata,call:new d.ClientReadableStreamImpl(c),channel:this[j],methodDefinition:{path:a,requestStream:!1,responseStream:!0,requestSerialize:b,responseDeserialize:c},callOptions:q.options};this[m]&&(r=this[m](r));let s=r.call,t={clientInterceptors:this[k],clientInterceptorProviders:this[l],callInterceptors:null!=(n=r.callOptions.interceptors)?n:[],callInterceptorProviders:null!=(p=r.callOptions.interceptor_providers)?p:[]},u=(0,i.getInterceptingCall)(t,r.methodDefinition,r.callOptions,r.channel);s.call=u;let v=!1,w=Error();return u.start(r.metadata,{onReceiveMetadata(a){s.emit("metadata",a)},onReceiveMessage(a){s.push(a)},onReceiveStatus(a){if(!v){if(v=!0,s.push(null),a.code!==g.Status.OK){let b=o(w);s.emit("error",(0,d.callErrorFromStatus)(a,b))}w=null,s.emit("status",a)}}}),u.sendMessage(e),u.halfClose(),s}makeBidiStreamRequest(a,b,c,e,f){var h,n;let p=this.checkMetadataAndOptions(e,f),q={metadata:p.metadata,call:new d.ClientDuplexStreamImpl(b,c),channel:this[j],methodDefinition:{path:a,requestStream:!0,responseStream:!0,requestSerialize:b,responseDeserialize:c},callOptions:p.options};this[m]&&(q=this[m](q));let r=q.call,s={clientInterceptors:this[k],clientInterceptorProviders:this[l],callInterceptors:null!=(h=q.callOptions.interceptors)?h:[],callInterceptorProviders:null!=(n=q.callOptions.interceptor_providers)?n:[]},t=(0,i.getInterceptingCall)(s,q.methodDefinition,q.callOptions,q.channel);r.call=t;let u=!1,v=Error();return t.start(q.metadata,{onReceiveMetadata(a){r.emit("metadata",a)},onReceiveMessage(a){r.push(a)},onReceiveStatus(a){if(!u){if(u=!0,r.push(null),a.code!==g.Status.OK){let b=o(v);r.emit("error",(0,d.callErrorFromStatus)(a,b))}v=null,r.emit("status",a)}}}),r}}b.Client=p},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4933:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.getProxiedConnection=b.mapProxyName=void 0;let d=c(74271),e=c(51387),f=c(61774),g=c(81630),h=c(34631),i=c(74271),j=c(55392),k=c(71790),l=c(79551),m=c(28900);function n(a){i.trace(e.LogVerbosity.DEBUG,"proxy",a)}b.mapProxyName=function(a,b){var c;let f,g,h={target:a,extraOptions:{}};if((null!=(c=b["grpc.enable_http_proxy"])?c:1)===0||"unix"===a.scheme)return h;let i=function(){let a,b="",c="";if(process.env.grpc_proxy)c="grpc_proxy",b=process.env.grpc_proxy;else if(process.env.https_proxy)c="https_proxy",b=process.env.https_proxy;else{if(!process.env.http_proxy)return{};c="http_proxy",b=process.env.http_proxy}try{a=new l.URL(b)}catch(a){return(0,d.log)(e.LogVerbosity.ERROR,`cannot parse value of "${c}" env var`),{}}if("http:"!==a.protocol)return(0,d.log)(e.LogVerbosity.ERROR,`"${a.protocol}" scheme not supported in proxy URI`),{};let f=null;a.username&&(a.password?((0,d.log)(e.LogVerbosity.INFO,"userinfo found in proxy URI"),f=`${a.username}:${a.password}`):f=a.username);let g=a.hostname,h=a.port;""===h&&(h="80");let i={address:`${g}:${h}`};return f&&(i.creds=f),n("Proxy server "+i.address+" set by environment variable "+c),i}();if(!i.address)return h;let j=(0,k.splitHostPort)(a.path);if(!j)return h;let m=j.host;for(let b of(f=process.env.no_grpc_proxy,g="no_grpc_proxy",(f||(f=process.env.no_proxy,g="no_proxy"),f)?(n("No proxy server list set by environment variable "+g),f.split(",")):[]))if(b===m)return n("Not using proxy for target in no_proxy list: "+(0,k.uriToString)(a)),h;let o={"grpc.http_connect_target":(0,k.uriToString)(a)};return i.creds&&(o["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:o}},b.getProxiedConnection=function(a,b,c){var i;if(!("grpc.http_connect_target"in b))return Promise.resolve({});let l=b["grpc.http_connect_target"],o=(0,k.parseUri)(l);if(null===o)return Promise.resolve({});let p=(0,k.splitHostPort)(o.path);if(null===p)return Promise.resolve({});let q=`${p.host}:${null!=(i=p.port)?i:m.DEFAULT_PORT}`,r={method:"CONNECT",path:q},s={Host:q};(0,j.isTcpSubchannelAddress)(a)?(r.host=a.host,r.port=a.port):r.socketPath=a.path,"grpc.http_connect_creds"in b&&(s["Proxy-Authorization"]="Basic "+Buffer.from(b["grpc.http_connect_creds"]).toString("base64")),r.headers=s;let t=(0,j.subchannelAddressToString)(a);return n("Using proxy "+t+" to connect to "+r.path),new Promise((a,b)=>{let i=g.request(r);i.once("connect",(g,j,l)=>{var m;if(i.removeAllListeners(),j.removeAllListeners(),200===g.statusCode)if(n("Successfully connected to "+r.path+" through proxy "+t),"secureContext"in c){let d=(0,f.getDefaultAuthority)(o),e=(0,k.splitHostPort)(d),g=null!=(m=null==e?void 0:e.host)?m:d,i=h.connect(Object.assign({host:g,servername:g,socket:j},c),()=>{n("Successfully established a TLS connection to "+r.path+" through proxy "+t),a({socket:i,realTarget:o})});i.on("error",a=>{n("Failed to establish a TLS connection to "+r.path+" through proxy "+t+" with error "+a.message),b()})}else n("Successfully established a plaintext connection to "+r.path+" through proxy "+t),a({socket:j,realTarget:o});else(0,d.log)(e.LogVerbosity.ERROR,"Failed to connect to "+r.path+" through proxy "+t+" with status "+g.statusCode),b()}),i.once("error",a=>{i.removeAllListeners(),(0,d.log)(e.LogVerbosity.ERROR,"Failed to connect to proxy "+t+" with error "+a.message),b()}),i.end()})}},6269:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.ChannelImplementation=void 0;let d=c(34284),e=c(98697);class f{constructor(a,b,c){if("string"!=typeof a)throw TypeError("Channel target must be a string");if(!(b instanceof d.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(c&&"object"!=typeof c)throw TypeError("Channel options must be an object");this.internalChannel=new e.InternalChannel(a,b,c)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(a){return this.internalChannel.getConnectivityState(a)}watchConnectivityState(a,b,c){this.internalChannel.watchConnectivityState(a,b,c)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(a,b,c,d,e){if("string"!=typeof a)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof b||b instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(a,b,c,d,e)}}b.ChannelImplementation=f},7702:(a,b,c)=>{"use strict";var d;Object.defineProperty(b,"__esModule",{value:!0}),b.QueuePicker=b.UnavailablePicker=b.PickResultType=void 0;let e=c(61291),f=c(51387);!function(a){a[a.COMPLETE=0]="COMPLETE",a[a.QUEUE=1]="QUEUE",a[a.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",a[a.DROP=3]="DROP"}(d||(b.PickResultType=d={}));class g{constructor(a){this.status=Object.assign({code:f.Status.UNAVAILABLE,details:"No connection established",metadata:new e.Metadata},a)}pick(a){return{pickResultType:d.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}}b.UnavailablePicker=g;class h{constructor(a){this.loadBalancer=a,this.calledExitIdle=!1}pick(a){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:d.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}}b.QueuePicker=h},7879:a=>{"use strict";a.exports=import("firebase-admin/firestore")},9801:a=>{"use strict";a.exports=import("firebase-admin/app")},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11905:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.restrictControlPlaneStatusCode=void 0;let d=c(51387),e=[d.Status.OK,d.Status.INVALID_ARGUMENT,d.Status.NOT_FOUND,d.Status.ALREADY_EXISTS,d.Status.FAILED_PRECONDITION,d.Status.ABORTED,d.Status.OUT_OF_RANGE,d.Status.DATA_LOSS];b.restrictControlPlaneStatusCode=function(a,b){return e.includes(a)?{code:d.Status.INTERNAL,details:`Invalid status from control plane: ${a} ${d.Status[a]} ${b}`}:{code:a,details:b}}},13187:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>k});var d=c(21124),e=c(38301),f=c(85708);let g=(0,f.createServerReference)("409d1987d2031262bc2c3c840d8d69edd61b373a07",f.callServer,void 0,f.findSourceMapURL,"setInitialAdmin");var h=c(35284),i=c(49113);let j="5V2a9sFmEjZosRARbpA8deWhdVJ3";function k(){let[a,b]=(0,e.useState)(!1),[c,f]=(0,e.useState)(null),k=async()=>{b(!0),f(await g(j)),b(!1)};return(0,d.jsx)("div",{className:"flex flex-col items-center justify-center min-h-screen",children:(0,d.jsxs)("div",{className:"w-full max-w-md p-8 space-y-6 bg-white rounded-lg shadow-md",children:[(0,d.jsx)("h1",{className:"text-2xl font-bold text-center",children:"إعداد حساب المسؤول الأول"}),(0,d.jsxs)("p",{className:"text-center text-gray-600",children:['انقر على الزر أدناه لتعيين المستخدم "ضياء التميمي" كمسؤول للنظام باستخدام المعرف:',(0,d.jsx)("br",{}),(0,d.jsx)("code",{className:"block p-2 mt-2 text-sm text-gray-800 bg-gray-100 rounded",children:j})]}),(0,d.jsxs)(h.$,{onClick:k,disabled:a||!!c,className:"w-full",children:[a&&(0,d.jsx)(i.A,{className:"mr-2 h-4 w-4 animate-spin"}),a?"جاري الإعداد...":"بدء الإعداد"]}),c&&(0,d.jsxs)("div",{className:`p-4 rounded text-center ${c.success?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[(0,d.jsx)("p",{className:"font-semibold",children:c.message}),c.success&&(0,d.jsx)("a",{href:"/dashboard",className:"mt-2 inline-block underline",children:"الانتقال إلى لوحة التحكم"})]})]})})}},13610:(a,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.InterceptingListenerImpl=b.isInterceptingListener=void 0,b.isInterceptingListener=function(a){return void 0!==a.onReceiveMetadata&&1===a.onReceiveMetadata.length};class c{constructor(a,b){this.listener=a,this.nextListener=b,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(a){this.processingMetadata=!0,this.listener.onReceiveMetadata(a,a=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(a),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(a){this.processingMessage=!0,this.listener.onReceiveMessage(a,a=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=a,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(a),this.processPendingStatus())})}onReceiveStatus(a){this.listener.onReceiveStatus(a,a=>{this.processingMetadata||this.processingMessage?this.pendingStatus=a:this.nextListener.onReceiveStatus(a)})}}b.InterceptingListenerImpl=c},14261:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{"0004c295195cb02aa74b7e03b9ab47835262f651f3":()=>i._u,"00454095f373f8afcf3cd8b88a3e9643ba6181edb6":()=>e.y4,"005773e734ccf3535fa61ed9b34042d47625b1ede6":()=>f.O0,"006a7d18b222ac9fd27f636e3f60be09c88c550762":()=>l.ib,"00afcee30c25fc6521aeaf596fabd0fef5e0ca707f":()=>f.qV,"00d790a9c67325f46e1dda5ba33e59ecfd95062466":()=>e.HW,"400c0115434cd29d4eca4428f9840cb7a074049ed1":()=>n.EZ,"400c84b00cbc18181ec896b17d3329ab44688122ee":()=>q.q,"400e621b7f78c4800cffc85d668ca10cd73eb6853c":()=>g.Lf,"4013135d45b93942093eced825516b1e20941831b7":()=>p.d,"401b140032a44590c12253e287a8d7d0383408525e":()=>h.lc,"40211bb4321aca8530a09b81e44f46cc59da30c2c4":()=>n.KB,"40213622e57351942781ff52345df063ded4056884":()=>e.Sm,"40290c8e8678ea3c7dc08bc14a2b21bf84ced558a3":()=>f.lo,"403331dfc341d9a7f9cbe156b5d10cfd49a20be531":()=>g.d5,"40341251e8d632597ecf83a7ab87f3793a83f06b51":()=>o.r,"403c01bdb267219d16430eb023611daabec8b63ec8":()=>j.nX,"405181b3416ca6fb6435ab9096a0a68342e5255501":()=>k.u,"405872236907704344162aca1c38160d1eac727fe8":()=>g.DI,"405ce651eeff5dd6c93f3965b62049b45a42e5a7d4":()=>j.LD,"406818275705b776627a9e14558eaa7857fbec9b73":()=>f.ht,"406c8a5fa8b6f219b1d6c0d2ed6d4215e348e5c534":()=>n.Lf,"407ad343a0d07dddd296d749ab0d60ad67dfc5bb39":()=>j.rC,"4085652545b10cc37283ef55992935bd43a8ce947e":()=>g.zZ,"4085aac590f12a4a641b5bc7fff47d5353af49510e":()=>e.S,"408c54ad33973364b68d8475849f76b4a4ca590722":()=>g.EP,"408c94c431661ae65070856bc4a78d84f2cbfcba1c":()=>g.EZ,"408d4523c5fa8dbd353900a15d896d0ebee083358b":()=>e.X7,"40939e0ffddd5729906956a18bd5a10b991b0ccc8b":()=>n.d5,"409ba91156ff082c07d90f218ef67bfea8be50f67c":()=>n.DI,"409d1987d2031262bc2c3c840d8d69edd61b373a07":()=>r.w,"409ee2d098a25e0103bd4e5cbd3c84c821bce98df9":()=>h.fW,"40b3f399476b2e0c0084bb235048022f7151d8d61a":()=>l.Qt,"40bd3493b6cd183a3f75aa7b2dffe9f325b07a2b9d":()=>i.Xx,"40c15e87ca74d3ad5ae09fdc0c6d9616384469f25f":()=>m._,"40c58d0bc8d4f91d67a942b18e51dcb1bf43076f6e":()=>n.zZ,"40d0448bacb32a373d23394258f9e7de4aa7fd38a9":()=>n.EP,"40d4790cf5bfe15d462399ad8c52d1baec8babf86f":()=>f.nu,"40e13d085ff779b8dfbb82e790ebb21702ce079192":()=>f.Cm,"40ef77a697a84cf599002575e6afc4c1de58c3cdab":()=>f.hG,"40f4619201eea9704cbf15357e730e9458fc66e834":()=>g.KB,"40fc6757a7ed8ba6cf86a7bf30e6bf0934f153f439":()=>e.Lx,"6011fc1c38056bdf4ffec77b46cde7479e7bed0ffe":()=>j.vL,"601532f3b7a46dae258a5ff32f14fb4b3e2e141e9f":()=>f.TK,"601838acb9f969bfd30fa9f583c86dd453b19524dd":()=>f.v_,"6023146a7bfefc423ba02712c56694a31432de707c":()=>g.zO,"6052254d233f0ea6b36992b2b81ce07178dee95ad7":()=>l.oS,"6073e98acf09f5000817ebcdd05234acc9c4d29f85":()=>h.rj,"60e34f9cbe57141cf2262bc166578e2d558a98e99f":()=>n.zO,"60eed12072721bc1c2c48214672b423b5d4cc8a6f3":()=>m.L,"7003bafa516cae88838b2870c227bb8f7b1ef595ec":()=>j.Nb,"70303f32e5ed8b56558bdc328a329d038fd2e61ace":()=>j.I0,"7036a92c4c51de937e481f7c0d6bc541b735f99157":()=>j.k5,"704baf0749912d6e636a66524e43f80ce5c8454d38":()=>j.xo,"70a2ee919f2d86ac514a326d140a0804c759a4d955":()=>j.Kq,"7efe1f798361b3ef301fd7b48f8f3206292a2cecba":()=>j.AZ,"7f085acd10c7b589563e59e7e18d605a9cf6eb6b56":()=>h.cl,"7f33ef79ae72de1c2db1340cf81f1c0a0a525a8033":()=>e.kl,"7f33fcd02c8b1dfc136d21fd7035ce40fe2d48b135":()=>e.ht,"7f4fa596b78e1050be57bd23eeef63bf754e59a5c8":()=>l.xi,"7f56b7b077f6ef503c674aaefafd2b7951d91adaa8":()=>j.LQ,"7f7cc5ac28f76953e580388c96325185bdb57f592c":()=>e.EZ,"7faf63d9d8686c0ff053833c82fd60b3e9c6fa0bff":()=>e.$T,"7fbd1d6bc63ebe1b1eeb689b35afc9c8cba834559f":()=>j.f9,"7fc073ecd1a2a3a687a33b240d39c28a9944119247":()=>l.Z7,"7fe3cedf8b5b39f6ca6561f08402f1ad7a82ecff97":()=>i.mt,"7fff34be9ad53d22bcedbe289fd19cffbcbb61a920":()=>j.ro});var e=c(62641),f=c(90521),g=c(95378),h=c(94762),i=c(54756),j=c(24799),k=c(28541),l=c(18210),m=c(87965),n=c(39661),o=c(13732),p=c(40982),q=c(33875),r=c(62944),s=a([e,f,g,h,i,j,k,l,m,n,o,p,q,r]);[e,f,g,h,i,j,k,l,m,n,o,p,q,r]=s.then?(await s)():s,d()}catch(a){d(a)}})},14276:a=>{"use strict";a.exports=import("firebase-admin/auth")},14985:a=>{"use strict";a.exports=require("dns")},16277:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.ChildLoadBalancerHandler=void 0;let d=c(66655),e=c(59173);class f{constructor(a){this.channelControlHelper=a,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(a){this.parent=a,this.child=null}createSubchannel(a,b){return this.parent.channelControlHelper.createSubchannel(a,b)}updateState(a,b){var c;if(this.calledByPendingChild()){if(a===e.ConnectivityState.CONNECTING)return;null==(c=this.parent.currentChild)||c.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(a,b)}requestReresolution(){var a;let b=null!=(a=this.parent.pendingChild)?a:this.parent.currentChild;this.child===b&&this.parent.channelControlHelper.requestReresolution()}setChild(a){this.child=a}addChannelzChild(a){this.parent.channelControlHelper.addChannelzChild(a)}removeChannelzChild(a){this.parent.channelControlHelper.removeChannelzChild(a)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(a,b){return a.getLoadBalancerName()!==b.getLoadBalancerName()}updateAddressList(a,b,c){let e;if(null===this.currentChild||null===this.latestConfig||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,b)){let a=new this.ChildPolicyHelper(this),c=(0,d.createLoadBalancer)(b,a);a.setChild(c),null===this.currentChild?(this.currentChild=c,e=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=c,e=this.pendingChild)}else e=null===this.pendingChild?this.currentChild:this.pendingChild;this.latestConfig=b,e.updateAddressList(a,b,c)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return"child_load_balancer_helper"}}b.ChildLoadBalancerHandler=f},19121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},19771:a=>{"use strict";a.exports=require("process")},21820:a=>{"use strict";a.exports=require("os")},21880:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.ClientDuplexStreamImpl=b.ClientWritableStreamImpl=b.ClientReadableStreamImpl=b.ClientUnaryCallImpl=b.callErrorFromStatus=void 0;let d=c(94735),e=c(27910),f=c(51387);b.callErrorFromStatus=function(a,b){let c=`${a.code} ${f.Status[a.code]}: ${a.details}`,d=Error(c),e=`${d.stack}
for call at
${b}`;return Object.assign(Error(c),a,{stack:e})};class g extends d.EventEmitter{constructor(){super()}cancel(){var a;null==(a=this.call)||a.cancelWithStatus(f.Status.CANCELLED,"Cancelled on client")}getPeer(){var a,b;return null!=(b=null==(a=this.call)?void 0:a.getPeer())?b:"unknown"}}b.ClientUnaryCallImpl=g;class h extends e.Readable{constructor(a){super({objectMode:!0}),this.deserialize=a}cancel(){var a;null==(a=this.call)||a.cancelWithStatus(f.Status.CANCELLED,"Cancelled on client")}getPeer(){var a,b;return null!=(b=null==(a=this.call)?void 0:a.getPeer())?b:"unknown"}_read(a){var b;null==(b=this.call)||b.startRead()}}b.ClientReadableStreamImpl=h;class i extends e.Writable{constructor(a){super({objectMode:!0}),this.serialize=a}cancel(){var a;null==(a=this.call)||a.cancelWithStatus(f.Status.CANCELLED,"Cancelled on client")}getPeer(){var a,b;return null!=(b=null==(a=this.call)?void 0:a.getPeer())?b:"unknown"}_write(a,b,c){var d;let e={callback:c},f=Number(b);Number.isNaN(f)||(e.flags=f),null==(d=this.call)||d.sendMessageWithContext(e,a)}_final(a){var b;null==(b=this.call)||b.halfClose(),a()}}b.ClientWritableStreamImpl=i;class j extends e.Duplex{constructor(a,b){super({objectMode:!0}),this.serialize=a,this.deserialize=b}cancel(){var a;null==(a=this.call)||a.cancelWithStatus(f.Status.CANCELLED,"Cancelled on client")}getPeer(){var a,b;return null!=(b=null==(a=this.call)?void 0:a.getPeer())?b:"unknown"}_read(a){var b;null==(b=this.call)||b.startRead()}_write(a,b,c){var d;let e={callback:c},f=Number(b);Number.isNaN(f)||(e.flags=f),null==(d=this.call)||d.sendMessageWithContext(e,a)}_final(a){var b;null==(b=this.call)||b.halfClose(),a()}}b.ClientDuplexStreamImpl=j},22509:(a,b,c)=>{"use strict";c.r(b),c.d(b,{GlobalError:()=>D.a,__next_app__:()=>J,handler:()=>L,pages:()=>I,routeModule:()=>K,tree:()=>H});var d=c(49754),e=c(9117),f=c(46595),g=c(32324),h=c(39326),i=c(38928),j=c(20175),k=c(12),l=c(54290),m=c(12696),n=c(82802),o=c(77533),p=c(45229),q=c(32822),r=c(261),s=c(26453),t=c(52474),u=c(26713),v=c(51356),w=c(62685),x=c(36225),y=c(63446),z=c(2762),A=c(45742),B=c(86439),C=c(81170),D=c.n(C),E=c(62506),F=c(91203),G={};for(let a in E)0>["default","tree","pages","GlobalError","__next_app__","routeModule","handler"].indexOf(a)&&(G[a]=()=>E[a]);c.d(b,G);let H={children:["",{children:["setup-admin",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(c.bind(c,59251)),"/home/user/studio/src/app/setup-admin/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(c.bind(c,51472)),"/home/user/studio/src/app/layout.tsx"],"global-error":[()=>Promise.resolve().then(c.t.bind(c,81170,23)),"next/dist/client/components/builtin/global-error.js"],"not-found":[()=>Promise.resolve().then(c.t.bind(c,87028,23)),"next/dist/client/components/builtin/not-found.js"],forbidden:[()=>Promise.resolve().then(c.t.bind(c,90461,23)),"next/dist/client/components/builtin/forbidden.js"],unauthorized:[()=>Promise.resolve().then(c.t.bind(c,32768,23)),"next/dist/client/components/builtin/unauthorized.js"]}]}.children,I=["/home/user/studio/src/app/setup-admin/page.tsx"],J={require:c,loadChunk:()=>Promise.resolve()},K=new d.AppPageRouteModule({definition:{kind:e.RouteKind.APP_PAGE,page:"/setup-admin/page",pathname:"/setup-admin",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:H},distDir:".next",relativeProjectDir:""});async function L(a,b,d){var C;let G="/setup-admin/page";"/index"===G&&(G="/");let M=(0,h.getRequestMeta)(a,"postponed"),N=(0,h.getRequestMeta)(a,"minimalMode"),O=await K.prepare(a,b,{srcPage:G,multiZoneDraftMode:!1});if(!O)return b.statusCode=400,b.end("Bad Request"),null==d.waitUntil||d.waitUntil.call(d,Promise.resolve()),null;let{buildId:P,query:Q,params:R,parsedUrl:S,pageIsDynamic:T,buildManifest:U,nextFontManifest:V,reactLoadableManifest:W,serverActionsManifest:X,clientReferenceManifest:Y,subresourceIntegrityManifest:Z,prerenderManifest:$,isDraftMode:_,resolvedPathname:aa,revalidateOnlyGenerated:ab,routerServerContext:ac,nextConfig:ad,interceptionRoutePatterns:ae}=O,af=S.pathname||"/",ag=(0,r.normalizeAppPath)(G),{isOnDemandRevalidate:ah}=O,ai=K.match(af,$),aj=!!$.routes[aa],ak=!!(ai||aj||$.routes[ag]),al=a.headers["user-agent"]||"",am=(0,u.getBotType)(al),an=(0,p.isHtmlBotRequest)(a),ao=(0,h.getRequestMeta)(a,"isPrefetchRSCRequest")??"1"===a.headers[t.NEXT_ROUTER_PREFETCH_HEADER],ap=(0,h.getRequestMeta)(a,"isRSCRequest")??!!a.headers[t.RSC_HEADER],aq=(0,s.getIsPossibleServerAction)(a),ar=(0,m.checkIsAppPPREnabled)(ad.experimental.ppr)&&(null==(C=$.routes[ag]??$.dynamicRoutes[ag])?void 0:C.renderingMode)==="PARTIALLY_STATIC",as=!1,at=!1,au=ar?M:void 0,av=ar&&ap&&!ao,aw=(0,h.getRequestMeta)(a,"segmentPrefetchRSCRequest"),ax=!al||(0,p.shouldServeStreamingMetadata)(al,ad.htmlLimitedBots);an&&ar&&(ak=!1,ax=!1);let ay=!0===K.isDev||!ak||"string"==typeof M||av,az=an&&ar,aA=null;_||!ak||ay||aq||au||av||(aA=aa);let aB=aA;!aB&&K.isDev&&(aB=aa),K.isDev||_||!ak||!ap||av||(0,k.d)(a.headers);let aC={...E,tree:H,pages:I,GlobalError:D(),handler:L,routeModule:K,__next_app__:J};X&&Y&&(0,o.setReferenceManifestsSingleton)({page:G,clientReferenceManifest:Y,serverActionsManifest:X,serverModuleMap:(0,q.createServerModuleMap)({serverActionsManifest:X})});let aD=a.method||"GET",aE=(0,g.getTracer)(),aF=aE.getActiveScopeSpan();try{let f=K.getVaryHeader(aa,ae);b.setHeader("Vary",f);let k=async(c,d)=>{let e=new l.NodeNextRequest(a),f=new l.NodeNextResponse(b);return K.render(e,f,d).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=aE.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==i.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${aD} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${aD} ${a.url}`)})},m=async({span:e,postponed:f,fallbackRouteParams:g})=>{let i={query:Q,params:R,page:ag,sharedContext:{buildId:P},serverComponentsHmrCache:(0,h.getRequestMeta)(a,"serverComponentsHmrCache"),fallbackRouteParams:g,renderOpts:{App:()=>null,Document:()=>null,pageConfig:{},ComponentMod:aC,Component:(0,j.T)(aC),params:R,routeModule:K,page:G,postponed:f,shouldWaitOnAllReady:az,serveStreamingMetadata:ax,supportsDynamicResponse:"string"==typeof f||ay,buildManifest:U,nextFontManifest:V,reactLoadableManifest:W,subresourceIntegrityManifest:Z,serverActionsManifest:X,clientReferenceManifest:Y,setIsrStatus:null==ac?void 0:ac.setIsrStatus,dir:c(33873).join(process.cwd(),K.relativeProjectDir),isDraftMode:_,isRevalidate:ak&&!f&&!av,botType:am,isOnDemandRevalidate:ah,isPossibleServerAction:aq,assetPrefix:ad.assetPrefix,nextConfigOutput:ad.output,crossOrigin:ad.crossOrigin,trailingSlash:ad.trailingSlash,previewProps:$.preview,deploymentId:ad.deploymentId,enableTainting:ad.experimental.taint,htmlLimitedBots:ad.htmlLimitedBots,devtoolSegmentExplorer:ad.experimental.devtoolSegmentExplorer,reactMaxHeadersLength:ad.reactMaxHeadersLength,multiZoneDraftMode:!1,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:ad.experimental.cacheLife,basePath:ad.basePath,serverActions:ad.experimental.serverActions,...as?{nextExport:!0,supportsDynamicResponse:!1,isStaticGeneration:!0,isRevalidate:!0,isDebugDynamicAccesses:as}:{},experimental:{isRoutePPREnabled:ar,expireTime:ad.expireTime,staleTimes:ad.experimental.staleTimes,cacheComponents:!!ad.experimental.cacheComponents,clientSegmentCache:!!ad.experimental.clientSegmentCache,clientParamParsing:!!ad.experimental.clientParamParsing,dynamicOnHover:!!ad.experimental.dynamicOnHover,inlineCss:!!ad.experimental.inlineCss,authInterrupts:!!ad.experimental.authInterrupts,clientTraceMetadata:ad.experimental.clientTraceMetadata||[]},waitUntil:d.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:()=>{},onInstrumentationRequestError:(b,c,d)=>K.onRequestError(a,b,d,ac),err:(0,h.getRequestMeta)(a,"invokeError"),dev:K.isDev}},l=await k(e,i),{metadata:m}=l,{cacheControl:n,headers:o={},fetchTags:p}=m;if(p&&(o[y.NEXT_CACHE_TAGS_HEADER]=p),a.fetchMetrics=m.fetchMetrics,ak&&(null==n?void 0:n.revalidate)===0&&!K.isDev&&!ar){let a=m.staticBailoutInfo,b=Object.defineProperty(Error(`Page changed from static to dynamic at runtime ${aa}${(null==a?void 0:a.description)?`, reason: ${a.description}`:""}
see more here https://nextjs.org/docs/messages/app-static-to-dynamic-error`),"__NEXT_ERROR_CODE",{value:"E132",enumerable:!1,configurable:!0});if(null==a?void 0:a.stack){let c=a.stack;b.stack=b.message+c.substring(c.indexOf("\n"))}throw b}return{value:{kind:v.CachedRouteKind.APP_PAGE,html:l,headers:o,rscData:m.flightData,postponed:m.postponed,status:m.statusCode,segmentData:m.segmentData},cacheControl:n}},o=async({hasResolved:c,previousCacheEntry:f,isRevalidating:g,span:i})=>{let j,k=!1===K.isDev,l=c||b.writableEnded;if(ah&&ab&&!f&&!N)return(null==ac?void 0:ac.render404)?await ac.render404(a,b):(b.statusCode=404,b.end("This page could not be found")),null;if(ai&&(j=(0,w.parseFallbackField)(ai.fallback)),j===w.FallbackMode.PRERENDER&&(0,u.isBot)(al)&&(!ar||an)&&(j=w.FallbackMode.BLOCKING_STATIC_RENDER),(null==f?void 0:f.isStale)===-1&&(ah=!0),ah&&(j!==w.FallbackMode.NOT_FOUND||f)&&(j=w.FallbackMode.BLOCKING_STATIC_RENDER),!N&&j!==w.FallbackMode.BLOCKING_STATIC_RENDER&&aB&&!l&&!_&&T&&(k||!aj)){let b;if((k||ai)&&j===w.FallbackMode.NOT_FOUND)throw new B.NoFallbackError;if(ar&&!ap){let c="string"==typeof(null==ai?void 0:ai.fallback)?ai.fallback:k?ag:null;if(b=await K.handleResponse({cacheKey:c,req:a,nextConfig:ad,routeKind:e.RouteKind.APP_PAGE,isFallback:!0,prerenderManifest:$,isRoutePPREnabled:ar,responseGenerator:async()=>m({span:i,postponed:void 0,fallbackRouteParams:k||at?(0,n.u)(ag):null}),waitUntil:d.waitUntil}),null===b)return null;if(b)return delete b.cacheControl,b}}let o=ah||g||!au?void 0:au;if(as&&void 0!==o)return{cacheControl:{revalidate:1,expire:void 0},value:{kind:v.CachedRouteKind.PAGES,html:x.default.EMPTY,pageData:{},headers:void 0,status:void 0}};let p=T&&ar&&((0,h.getRequestMeta)(a,"renderFallbackShell")||at)?(0,n.u)(af):null;return m({span:i,postponed:o,fallbackRouteParams:p})},p=async c=>{var f,g,i,j,k;let l,n=await K.handleResponse({cacheKey:aA,responseGenerator:a=>o({span:c,...a}),routeKind:e.RouteKind.APP_PAGE,isOnDemandRevalidate:ah,isRoutePPREnabled:ar,req:a,nextConfig:ad,prerenderManifest:$,waitUntil:d.waitUntil});if(_&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate"),K.isDev&&b.setHeader("Cache-Control","no-store, must-revalidate"),!n){if(aA)throw Object.defineProperty(Error("invariant: cache entry required but not generated"),"__NEXT_ERROR_CODE",{value:"E62",enumerable:!1,configurable:!0});return null}if((null==(f=n.value)?void 0:f.kind)!==v.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant app-page handler received invalid cache entry ${null==(i=n.value)?void 0:i.kind}`),"__NEXT_ERROR_CODE",{value:"E707",enumerable:!1,configurable:!0});let p="string"==typeof n.value.postponed;ak&&!av&&(!p||ao)&&(N||b.setHeader("x-nextjs-cache",ah?"REVALIDATED":n.isMiss?"MISS":n.isStale?"STALE":"HIT"),b.setHeader(t.NEXT_IS_PRERENDER_HEADER,"1"));let{value:q}=n;if(au)l={revalidate:0,expire:void 0};else if(N&&ap&&!ao&&ar)l={revalidate:0,expire:void 0};else if(!K.isDev)if(_)l={revalidate:0,expire:void 0};else if(ak){if(n.cacheControl)if("number"==typeof n.cacheControl.revalidate){if(n.cacheControl.revalidate<1)throw Object.defineProperty(Error(`Invalid revalidate configuration provided: ${n.cacheControl.revalidate} < 1`),"__NEXT_ERROR_CODE",{value:"E22",enumerable:!1,configurable:!0});l={revalidate:n.cacheControl.revalidate,expire:(null==(j=n.cacheControl)?void 0:j.expire)??ad.expireTime}}else l={revalidate:y.CACHE_ONE_YEAR,expire:void 0}}else b.getHeader("Cache-Control")||(l={revalidate:0,expire:void 0});if(n.cacheControl=l,"string"==typeof aw&&(null==q?void 0:q.kind)===v.CachedRouteKind.APP_PAGE&&q.segmentData){b.setHeader(t.NEXT_DID_POSTPONE_HEADER,"2");let c=null==(k=q.headers)?void 0:k[y.NEXT_CACHE_TAGS_HEADER];N&&ak&&c&&"string"==typeof c&&b.setHeader(y.NEXT_CACHE_TAGS_HEADER,c);let d=q.segmentData.get(aw);return void 0!==d?(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.fromStatic(d,t.RSC_CONTENT_TYPE_HEADER),cacheControl:n.cacheControl}):(b.statusCode=204,(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.EMPTY,cacheControl:n.cacheControl}))}let r=(0,h.getRequestMeta)(a,"onCacheEntry");if(r&&await r({...n,value:{...n.value,kind:"PAGE"}},{url:(0,h.getRequestMeta)(a,"initURL")}))return null;if(p&&au)throw Object.defineProperty(Error("Invariant: postponed state should not be present on a resume request"),"__NEXT_ERROR_CODE",{value:"E396",enumerable:!1,configurable:!0});if(q.headers){let a={...q.headers};for(let[c,d]of(N&&ak||delete a[y.NEXT_CACHE_TAGS_HEADER],Object.entries(a)))if(void 0!==d)if(Array.isArray(d))for(let a of d)b.appendHeader(c,a);else"number"==typeof d&&(d=d.toString()),b.appendHeader(c,d)}let s=null==(g=q.headers)?void 0:g[y.NEXT_CACHE_TAGS_HEADER];if(N&&ak&&s&&"string"==typeof s&&b.setHeader(y.NEXT_CACHE_TAGS_HEADER,s),!q.status||ap&&ar||(b.statusCode=q.status),!N&&q.status&&F.RedirectStatusCode[q.status]&&ap&&(b.statusCode=200),p&&b.setHeader(t.NEXT_DID_POSTPONE_HEADER,"1"),ap&&!_){if(void 0===q.rscData){if(q.postponed)throw Object.defineProperty(Error("Invariant: Expected postponed to be undefined"),"__NEXT_ERROR_CODE",{value:"E372",enumerable:!1,configurable:!0});return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:q.html,cacheControl:av?{revalidate:0,expire:void 0}:n.cacheControl})}return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.fromStatic(q.rscData,t.RSC_CONTENT_TYPE_HEADER),cacheControl:n.cacheControl})}let u=q.html;if(!p||N||ap)return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:n.cacheControl});if(as)return u.push(new ReadableStream({start(a){a.enqueue(z.ENCODED_TAGS.CLOSED.BODY_AND_HTML),a.close()}})),(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:{revalidate:0,expire:void 0}});let w=new TransformStream;return u.push(w.readable),m({span:c,postponed:q.postponed,fallbackRouteParams:null}).then(async a=>{var b,c;if(!a)throw Object.defineProperty(Error("Invariant: expected a result to be returned"),"__NEXT_ERROR_CODE",{value:"E463",enumerable:!1,configurable:!0});if((null==(b=a.value)?void 0:b.kind)!==v.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant: expected a page response, got ${null==(c=a.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E305",enumerable:!1,configurable:!0});await a.value.html.pipeTo(w.writable)}).catch(a=>{w.writable.abort(a).catch(a=>{console.error("couldn't abort transformer",a)})}),(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:{revalidate:0,expire:void 0}})};if(!aF)return await aE.withPropagatedContext(a.headers,()=>aE.trace(i.BaseServerSpan.handleRequest,{spanName:`${aD} ${a.url}`,kind:g.SpanKind.SERVER,attributes:{"http.method":aD,"http.target":a.url}},p));await p(aF)}catch(b){throw b instanceof B.NoFallbackError||await K.onRequestError(a,b,{routerKind:"App Router",routePath:G,routeType:"render",revalidateReason:(0,f.c)({isRevalidate:ak,isOnDemandRevalidate:ah})},ac),b}}},24596:(a,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.channelOptionsEqual=b.recognizedOptions=void 0,b.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0},b.channelOptionsEqual=function(a,b){let c=Object.keys(a).sort(),d=Object.keys(b).sort();if(c.length!==d.length)return!1;for(let e=0;e<c.length;e+=1)if(c[e]!==d[e]||a[c[e]]!==b[d[e]])return!1;return!0}},24803:a=>{"use strict";a.exports=import("firebase-admin/storage")},25049:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.CompressionFilterFactory=b.CompressionFilter=void 0;let d=c(74075),e=c(99245),f=c(51387),g=c(50742),h=c(74271);class i{async writeMessage(a,b){let c=a;b&&(c=await this.compressMessage(c));let d=Buffer.allocUnsafe(c.length+5);return d.writeUInt8(+!!b,0),d.writeUInt32BE(c.length,1),c.copy(d,5),d}async readMessage(a){let b=1===a.readUInt8(0),c=a.slice(5);return b&&(c=await this.decompressMessage(c)),c}}class j extends i{async compressMessage(a){return a}async writeMessage(a,b){let c=Buffer.allocUnsafe(a.length+5);return c.writeUInt8(0,0),c.writeUInt32BE(a.length,1),a.copy(c,5),c}decompressMessage(a){return Promise.reject(Error('Received compressed message but "grpc-encoding" header was identity'))}}class k extends i{constructor(a){super(),this.maxRecvMessageLength=a}compressMessage(a){return new Promise((b,c)=>{d.deflate(a,(a,d)=>{a?c(a):b(d)})})}decompressMessage(a){return new Promise((b,c)=>{let e=0,g=[],h=d.createInflate();h.on("data",a=>{g.push(a),e+=a.byteLength,-1!==this.maxRecvMessageLength&&e>this.maxRecvMessageLength&&(h.destroy(),c({code:f.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),h.on("end",()=>{b(Buffer.concat(g))}),h.write(a),h.end()})}}class l extends i{constructor(a){super(),this.maxRecvMessageLength=a}compressMessage(a){return new Promise((b,c)=>{d.gzip(a,(a,d)=>{a?c(a):b(d)})})}decompressMessage(a){return new Promise((b,c)=>{let e=0,g=[],h=d.createGunzip();h.on("data",a=>{g.push(a),e+=a.byteLength,-1!==this.maxRecvMessageLength&&e>this.maxRecvMessageLength&&(h.destroy(),c({code:f.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),h.on("end",()=>{b(Buffer.concat(g))}),h.write(a),h.end()})}}class m extends i{constructor(a){super(),this.compressionName=a}compressMessage(a){return Promise.reject(Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(a){return Promise.reject(Error(`Compression method not supported: ${this.compressionName}`))}}function n(a,b){switch(a){case"identity":return new j;case"deflate":return new k(b);case"gzip":return new l(b);default:return new m(a)}}class o extends g.BaseFilter{constructor(a,b){var c,d;super(),this.sharedFilterConfig=b,this.sendCompression=new j,this.receiveCompression=new j,this.currentCompressionAlgorithm="identity";let g=a["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=null!=(c=a["grpc.max_receive_message_length"])?c:f.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,void 0!==g)if((a=>"number"==typeof a&&"string"==typeof e.CompressionAlgorithms[a])(g)){let a=e.CompressionAlgorithms[g],c=null==(d=b.serverSupportedEncodingHeader)?void 0:d.split(",");(!c||c.includes(a))&&(this.currentCompressionAlgorithm=a,this.sendCompression=n(this.currentCompressionAlgorithm,-1))}else h.log(f.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${g}`)}async sendMetadata(a){let b=await a;return b.set("grpc-accept-encoding","identity,deflate,gzip"),b.set("accept-encoding","identity"),"identity"===this.currentCompressionAlgorithm?b.remove("grpc-encoding"):b.set("grpc-encoding",this.currentCompressionAlgorithm),b}receiveMetadata(a){let b=a.get("grpc-encoding");if(b.length>0){let a=b[0];"string"==typeof a&&(this.receiveCompression=n(a,this.maxReceiveMessageLength))}a.remove("grpc-encoding");let c=a.get("grpc-accept-encoding")[0];return c&&(this.sharedFilterConfig.serverSupportedEncodingHeader=c,c.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new j,this.currentCompressionAlgorithm="identity")),a.remove("grpc-accept-encoding"),a}async sendMessage(a){var b;let c,d=await a;return c=!(this.sendCompression instanceof j)&&((null!=(b=d.flags)?b:0)&2)==0,{message:await this.sendCompression.writeMessage(d.message,c),flags:d.flags}}async receiveMessage(a){return this.receiveCompression.readMessage(await a)}}b.CompressionFilter=o;class p{constructor(a,b){this.options=b,this.sharedFilterConfig={}}createFilter(){return new o(this.options,this.sharedFilterConfig)}}b.CompressionFilterFactory=p},25098:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.Http2ServerCallStream=b.ServerDuplexStreamImpl=b.ServerWritableStreamImpl=b.ServerReadableStreamImpl=b.ServerUnaryCallImpl=void 0;let d=c(94735),e=c(73496),f=c(27910),g=c(74075),h=c(51387),i=c(61291),j=c(31551),k=c(74271),l=c(2234),m="server_call";function n(a){k.trace(h.LogVerbosity.DEBUG,m,a)}let o="grpc-message",p="grpc-status",q="grpc-timeout",r=/(\d{1,8})\s*([HMSmun])/,s={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},t={"grpc-accept-encoding":"identity,deflate,gzip","grpc-encoding":"identity"},u={[e.constants.HTTP2_HEADER_STATUS]:e.constants.HTTP_STATUS_OK,[e.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},v={waitForTrailers:!0};class w extends d.EventEmitter{constructor(a,b,c){super(),this.call=a,this.metadata=b,this.request=c,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(a){this.call.sendMetadata(a)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}b.ServerUnaryCallImpl=w;class x extends f.Readable{constructor(a,b,c,d){super({objectMode:!0}),this.call=a,this.metadata=b,this.deserialize=c,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,d)}_read(a){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(a){this.call.sendMetadata(a)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}b.ServerReadableStreamImpl=x;class y extends f.Writable{constructor(a,b,c,d){super({objectMode:!0}),this.call=a,this.metadata=b,this.serialize=c,this.request=d,this.cancelled=!1,this.trailingMetadata=new i.Metadata,this.call.setupSurfaceCall(this),this.on("error",a=>{this.call.sendError(a),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(a){this.call.sendMetadata(a)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(a,b,c){try{let b=this.call.serializeMessage(a);if(!this.call.write(b))return void this.call.once("drain",c)}catch(a){this.emit("error",{details:(0,l.getErrorMessage)(a),code:h.Status.INTERNAL})}c()}_final(a){this.call.sendStatus({code:h.Status.OK,details:"OK",metadata:this.trailingMetadata}),a(null)}end(a){return a&&(this.trailingMetadata=a),super.end()}}b.ServerWritableStreamImpl=y;class z extends f.Duplex{constructor(a,b,c,d,e){super({objectMode:!0}),this.call=a,this.metadata=b,this.serialize=c,this.deserialize=d,this.cancelled=!1,this.trailingMetadata=new i.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,e),this.on("error",a=>{this.call.sendError(a),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(a){this.call.sendMetadata(a)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(a){return a&&(this.trailingMetadata=a),super.end()}}b.ServerDuplexStreamImpl=z,z.prototype._read=x.prototype._read,z.prototype._write=y.prototype._write,z.prototype._final=y.prototype._final;class A extends d.EventEmitter{constructor(a,b,c){super(),this.stream=a,this.handler=b,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=h.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=h.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",a=>{}),this.stream.once("close",()=>{var a;n("Request to method "+(null==(a=this.handler)?void 0:a.path)+" stream closed with rstCode "+this.stream.rstCode),!this.statusSent&&(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:h.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in c&&(this.maxSendMessageSize=c["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in c&&(this.maxReceiveMessageSize=c["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(a,b){let c=a.subarray(5);if("identity"===b)return c;if("deflate"!==b&&"gzip"!==b)return Promise.reject({code:h.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${b}"`});{let a;return a="deflate"===b?g.createInflate():g.createGunzip(),new Promise((b,d)=>{let e=0,f=[];a.on("data",b=>{f.push(b),e+=b.byteLength,-1!==this.maxReceiveMessageSize&&e>this.maxReceiveMessageSize&&(a.destroy(),d({code:h.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),a.on("end",()=>{b(Buffer.concat(f))}),a.write(c),a.end()})}}sendMetadata(a){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let b=a?a.toHttp2Headers():null,c=Object.assign(Object.assign(Object.assign({},u),t),b);this.stream.respond(c,v)}receiveMetadata(a){let b=i.Metadata.fromHttp2Headers(a);k.isTracerEnabled(m)&&n("Request to "+this.handler.path+" received headers "+JSON.stringify(b.toJSON()));let c=b.get(q);if(c.length>0){let a=c[0].toString().match(r);if(null===a){let a=Error("Invalid deadline");return a.code=h.Status.OUT_OF_RANGE,this.sendError(a),b}let d=a[1]*s[a[2]]|0,e=new Date;this.deadline=e.setMilliseconds(e.getMilliseconds()+d),this.deadlineTimer=setTimeout(B,d,this),b.remove(q)}return b.remove(e.constants.HTTP2_HEADER_ACCEPT_ENCODING),b.remove(e.constants.HTTP2_HEADER_TE),b.remove(e.constants.HTTP2_HEADER_CONTENT_TYPE),b.remove("grpc-accept-encoding"),b}receiveUnaryMessage(a){return new Promise((b,c)=>{let{stream:d}=this,e=0,f=this,g=[],i=this.maxReceiveMessageSize;function j(a){if(e+=a.byteLength,-1!==i&&e>i){d.removeListener("data",j),d.removeListener("end",k),d.removeListener("error",k),c({code:h.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${e} vs. ${i})`});return}g.push(a)}function k(i){if(d.removeListener("data",j),d.removeListener("end",k),d.removeListener("error",k),void 0!==i)return void c({code:h.Status.INTERNAL,details:i.message});if(0===e)return void c({code:h.Status.INTERNAL,details:"received empty unary message"});f.emit("receiveMessage");let l=Buffer.concat(g,e),m=1===l.readUInt8(0),n=f.getDecompressedMessage(l,m?a:"identity");if(Buffer.isBuffer(n))return void b(f.deserializeMessageWithInternalError(n));n.then(a=>b(f.deserializeMessageWithInternalError(a)),b=>c(b.code?b:{code:h.Status.INTERNAL,details:`Received "grpc-encoding" header "${a}" but ${a} decompression failed`}))}this.stream.on("data",j),this.stream.on("end",k),this.stream.on("error",k)})}async deserializeMessageWithInternalError(a){try{return this.deserializeMessage(a)}catch(a){throw{details:(0,l.getErrorMessage)(a),code:h.Status.INTERNAL}}}serializeMessage(a){let b=this.handler.serialize(a),c=b.byteLength,d=Buffer.allocUnsafe(c+5);return d.writeUInt8(0,0),d.writeUInt32BE(c,1),b.copy(d,5),d}deserializeMessage(a){return this.handler.deserialize(a)}async sendUnaryMessage(a,b,c,d){if(!this.checkCancelled()){if(void 0===c&&(c=null),a){!Object.prototype.hasOwnProperty.call(a,"metadata")&&c&&(a.metadata=c),this.sendError(a);return}try{let a=this.serializeMessage(b);this.write(a),this.sendStatus({code:h.Status.OK,details:"OK",metadata:c})}catch(a){this.sendError({details:(0,l.getErrorMessage)(a),code:h.Status.INTERNAL})}}}sendStatus(a){var b,c;if(this.emit("callEnd",a.code),this.emit("streamEnd",a.code===h.Status.OK),!this.checkCancelled())if(n("Request to method "+(null==(b=this.handler)?void 0:b.path)+" ended with status code: "+h.Status[a.code]+" details: "+a.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var b;let c=Object.assign({[p]:a.code,[o]:encodeURI(a.details)},null==(b=a.metadata)?void 0:b.toHttp2Headers());this.stream.sendTrailers(c),this.statusSent=!0}),this.stream.end());else{let b=Object.assign(Object.assign({[p]:a.code,[o]:encodeURI(a.details)},u),null==(c=a.metadata)?void 0:c.toHttp2Headers());this.stream.respond(b,{endStream:!0}),this.statusSent=!0}}sendError(a){let b={code:h.Status.UNKNOWN,details:"message"in a?a.message:"Unknown Error",metadata:"metadata"in a&&void 0!==a.metadata?a.metadata:null};"code"in a&&"number"==typeof a.code&&Number.isInteger(a.code)&&(b.code=a.code,"details"in a&&"string"==typeof a.details&&(b.details=a.details)),this.sendStatus(b)}write(a){if(!this.checkCancelled())return -1!==this.maxSendMessageSize&&a.length>this.maxSendMessageSize?void this.sendError({code:h.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${a.length} vs. ${this.maxSendMessageSize})`}):(this.sendMetadata(),this.emit("sendMessage"),this.stream.write(a))}resume(){this.stream.resume()}setupSurfaceCall(a){this.once("cancelled",b=>{a.cancelled=!0,a.emit("cancelled",b)}),this.once("callEnd",b=>a.emit("callEnd",b))}setupReadable(a,b){let c=new j.StreamDecoder(this.maxReceiveMessageSize),d=!1,e=!1,f=!1,g=async()=>{f||!d||e||(f=!0,await this.pushOrBufferMessage(a,null))};this.stream.on("data",async d=>{let f;try{f=c.write(d)}catch(a){this.sendError({code:h.Status.RESOURCE_EXHAUSTED,details:a.message});return}for(let c of(e=!0,this.stream.pause(),f)){let d;this.emit("receiveMessage");let e=1===c.readUInt8(0)?b:"identity";try{d=await this.getDecompressedMessage(c,e)}catch(a){this.sendError(a);return}if(!d)return;await this.pushOrBufferMessage(a,d)}e=!1,this.stream.resume(),await g()}),this.stream.once("end",async()=>{d=!0,await g()})}consumeUnpushedMessages(a){for(this.canPush=!0;this.messagesToPush.length>0;){let b=this.messagesToPush.shift(),c=a.push(b);if(null===b||!1===c){this.canPush=!1;break}}return this.canPush}async pushOrBufferMessage(a,b){this.isPushPending?this.bufferedMessages.push(b):await this.pushMessage(a,b)}async pushMessage(a,b){if(null===b){n("Received end of stream"),this.canPush?a.push(null):this.messagesToPush.push(null);return}n("Received message of length "+b.length),this.isPushPending=!0;try{let c=await this.deserializeMessage(b);this.canPush?a.push(c)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(c)}catch(c){this.bufferedMessages.length=0;let b=(0,l.getErrorCode)(c);(null===b||b<h.Status.OK||b>h.Status.UNAUTHENTICATED)&&(b=h.Status.INTERNAL),a.emit("error",{details:(0,l.getErrorMessage)(c),code:b})}this.isPushPending=!1,this.bufferedMessages.length>0&&await this.pushMessage(a,this.bufferedMessages.shift())}getPeer(){var a;let b=null==(a=this.stream.session)?void 0:a.socket;return null!=b&&b.remoteAddress?b.remotePort?`${b.remoteAddress}:${b.remotePort}`:b.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}}function B(a){let b=Error("Deadline exceeded");b.code=h.Status.DEADLINE_EXCEEDED,a.sendError(b),a.cancelled=!0,a.emit("cancelled","deadline")}b.Http2ServerCallStream=A},26223:(a,b,c)=>{"use strict";var d;b.rS=b.Yi=b.Ib=void 0;let e=c(56867),f=c(42260),g=c(18710),h=c(30665);c(74781),!function(a){a.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",a.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",a.IDEMPOTENT="IDEMPOTENT"}(d=b.Ib||(b.Ib={}));let i={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function j(a,b){return function(c){return a.toObject(a.decode(c),b)}}function k(a){return function(b){if(Array.isArray(b))throw Error(`Failed to serialize message: expected object with ${a.name} structure, got array instead`);let c=a.fromObject(b);return a.encode(c).finish()}}function l(a,b){let c=a.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:c.$type.toObject(c,i),fileDescriptorProtos:b}}function m(a,b){let c={};a.resolveAll();let h=a.toDescriptor("proto3").file.map(a=>Buffer.from(g.FileDescriptorProto.encode(a).finish()));for(let[g,m]of function a(b,c){var d;let e=(d=b.name,""===c?d:c+"."+d);return b instanceof f.Service||b instanceof f.Type||b instanceof f.Enum?[[e,b]]:(b instanceof f.Namespace||b instanceof f.Root)&&void 0!==b.nested?Object.keys(b.nested).map(c=>a(b.nested[c],e)).reduce((a,b)=>a.concat(b),[]):[]}(a,""))c[g]=function(a,b,c,g){if(a instanceof f.Service){let f={};for(let h of a.methodsArray)f[h.name]=function(a,b,c,f){let g=a.resolvedRequestType,h=a.resolvedResponseType;return{path:"/"+b+"/"+a.name,requestStream:!!a.requestStream,responseStream:!!a.responseStream,requestSerialize:k(g),requestDeserialize:j(g,c),responseSerialize:k(h),responseDeserialize:j(h,c),originalName:e(a.name),requestType:l(g,f),responseType:l(h,f),options:(a.parsedOptions||[]).reduce((a,b)=>{for(let[c,d]of Object.entries(b))"uninterpreted_option"===c?a.uninterpreted_option.push(b.uninterpreted_option):a[c]=d;return a},{deprecated:!1,idempotency_level:d.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}}(h,b,c,g);return f}if(a instanceof f.Type)return l(a,g);if(a instanceof f.Enum){let b=a.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:b.$type.toObject(b,i),fileDescriptorProtos:g}}throw Error("Type mismatch in reflection object handling")}(m,g,b,h);return c}b.Yi=function(a,b){return m((0,h.loadProtosWithOptionsSync)(a,b),b)},b.rS=function(a,b){b=b||{};let c=f.Root.fromJSON(a);return c.resolveAll(),m(c,b)},(0,h.addCommonProtos)()},26713:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/is-bot")},27910:a=>{"use strict";a.exports=require("stream")},28354:a=>{"use strict";a.exports=require("util")},28900:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.setup=b.DEFAULT_PORT=void 0;let d=c(61774),e=c(14985),f=c(28354),g=c(83724),h=c(51387),i=c(61291),j=c(74271),k=c(51387),l=c(71790),m=c(91645),n=c(29462);function o(a){j.trace(k.LogVerbosity.DEBUG,"dns_resolver",a)}b.DEFAULT_PORT=443;let p=f.promisify(e.resolveTxt),q=f.promisify(e.lookup);class r{constructor(a,c,d){var e,f,g;this.target=a,this.listener=c,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,o("Resolver constructed for target "+(0,l.uriToString)(a));let j=(0,l.splitHostPort)(a.path);null===j?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,m.isIPv4)(j.host)||(0,m.isIPv6)(j.host)?(this.ipResult=[{host:j.host,port:null!=(e=j.port)?e:b.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=j.host,this.port=null!=(f=j.port)?f:b.DEFAULT_PORT),this.percentage=100*Math.random(),1===d["grpc.service_config_disable_resolution"]&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:h.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,l.uriToString)(this.target)}`,metadata:new i.Metadata};let k={initialDelay:d["grpc.initial_reconnect_backoff_ms"],maxDelay:d["grpc.max_reconnect_backoff_ms"]};this.backoff=new n.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},k),this.backoff.unref(),this.minTimeBetweenResolutionsMs=null!=(g=d["grpc.dns_min_time_between_resolutions_ms"])?g:3e4,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(null!==this.ipResult){this.returnedIpResult||(o("Returning IP address for target "+(0,l.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(null===this.dnsHostname)o("Failed to parse DNS address "+(0,l.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:h.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,l.uriToString)(this.target)}`,metadata:new i.Metadata})}),this.stopNextResolutionTimer();else{if(null!==this.pendingLookupPromise)return;o("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let a=this.dnsHostname;this.pendingLookupPromise=q(a,{all:!0}),this.pendingLookupPromise.then(a=>{if(null===this.pendingLookupPromise)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let b=a.filter(a=>4===a.family),c=a.filter(a=>6===a.family);this.latestLookupResult=(function(...a){let b=[];for(let c=0;c<Math.max.apply(null,a.map(a=>a.length));c++)for(let d of a)c<d.length&&b.push(d[c]);return b})(c,b).map(a=>({host:a.address,port:+this.port}));let d="["+this.latestLookupResult.map(a=>a.host+":"+a.port).join(",")+"]";if(o("Resolved addresses for target "+(0,l.uriToString)(this.target)+": "+d),0===this.latestLookupResult.length)return void this.listener.onError(this.defaultResolutionError);this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},a=>{null!==this.pendingLookupPromise&&(o("Resolution error for target "+(0,l.uriToString)(this.target)+": "+a.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&null===this.pendingTxtPromise&&(this.pendingTxtPromise=p(a),this.pendingTxtPromise.then(a=>{if(null!==this.pendingTxtPromise){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,g.extractAndSelectServiceConfig)(a,this.percentage)}catch(a){this.latestServiceConfigError={code:h.Status.UNAVAILABLE,details:`Parsing service config failed with error ${a.message}`,metadata:new i.Metadata}}null!==this.latestLookupResult&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},a=>{}))}}startNextResolutionTimer(){var a,b;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=null==(b=(a=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)?void 0:b.call(a),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){null===this.pendingLookupPromise&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){null===this.pendingLookupPromise&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?o('resolution update delayed by "min time between resolutions" rate limit'):o("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(a){return a.path}}b.setup=function(){(0,d.registerResolver)("dns",r),(0,d.registerDefaultScheme)("dns")}},29021:a=>{"use strict";a.exports=require("fs")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},29462:(a,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.BackoffTimeout=void 0;class c{constructor(a,b){this.callback=a,this.initialDelay=1e3,this.multiplier=1.6,this.maxDelay=12e4,this.jitter=.2,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,b&&(b.initialDelay&&(this.initialDelay=b.initialDelay),b.multiplier&&(this.multiplier=b.multiplier),b.jitter&&(this.jitter=b.jitter),b.maxDelay&&(this.maxDelay=b.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(a){var b,c;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},a),this.hasRef||null==(c=(b=this.timerId).unref)||c.call(b)}runOnce(){var a;this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let b=Math.min(this.nextDelay*this.multiplier,this.maxDelay),c=b*this.jitter;this.nextDelay=b+(a=-c,Math.random()*(c-a)+a)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let a=new Date,b=this.startTime;b.setMilliseconds(b.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),a<b?this.runTimer(b.getTime()-a.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var a,b;this.hasRef=!0,null==(b=(a=this.timerId).ref)||b.call(a)}unref(){var a,b;this.hasRef=!1,null==(b=(a=this.timerId).unref)||b.call(a)}getEndTime(){return this.endTime}}b.BackoffTimeout=c},30665:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.addCommonProtos=b.loadProtosWithOptionsSync=b.loadProtosWithOptions=void 0;let d=c(29021),e=c(33873),f=c(42260);function g(a,b){let c=a.resolvePath;a.resolvePath=(a,f)=>{if(e.isAbsolute(f))return f;for(let a of b){let b=e.join(a,f);try{return d.accessSync(b,d.constants.R_OK),b}catch(a){continue}}return process.emitWarning(`${f} not found in any of the include paths ${b}`),c(a,f)}}b.loadProtosWithOptions=async function(a,b){let c=new f.Root;if((b=b||{}).includeDirs){if(!Array.isArray(b.includeDirs))return Promise.reject(Error("The includeDirs option must be an array"));g(c,b.includeDirs)}let d=await c.load(a,b);return d.resolveAll(),d},b.loadProtosWithOptionsSync=function(a,b){let c=new f.Root;if((b=b||{}).includeDirs){if(!Array.isArray(b.includeDirs))throw Error("The includeDirs option must be an array");g(c,b.includeDirs)}let d=c.loadSync(a,b);return d.resolveAll(),d},b.addCommonProtos=function(){let a=c(96491),b=c(43436),d=c(15696),e=c(16591);f.common("api",a.nested.google.nested.protobuf.nested),f.common("descriptor",b.nested.google.nested.protobuf.nested),f.common("source_context",d.nested.google.nested.protobuf.nested),f.common("type",e.nested.google.nested.protobuf.nested)}},31551:(a,b)=>{"use strict";var c;Object.defineProperty(b,"__esModule",{value:!0}),b.StreamDecoder=void 0,function(a){a[a.NO_DATA=0]="NO_DATA",a[a.READING_SIZE=1]="READING_SIZE",a[a.READING_MESSAGE=2]="READING_MESSAGE"}(c||(c={}));class d{constructor(a){this.maxReadMessageLength=a,this.readState=c.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(a){let b,d=0,e=[];for(;d<a.length;)switch(this.readState){case c.NO_DATA:this.readCompressFlag=a.slice(d,d+1),d+=1,this.readState=c.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case c.READING_SIZE:if(b=Math.min(a.length-d,this.readSizeRemaining),a.copy(this.readPartialSize,4-this.readSizeRemaining,d,d+b),this.readSizeRemaining-=b,d+=b,0===this.readSizeRemaining){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),-1!==this.maxReadMessageLength&&this.readMessageSize>this.maxReadMessageLength)throw Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=c.READING_MESSAGE;else{let a=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=c.NO_DATA,e.push(a)}}break;case c.READING_MESSAGE:if(b=Math.min(a.length-d,this.readMessageRemaining),this.readPartialMessage.push(a.slice(d,d+b)),this.readMessageRemaining-=b,d+=b,0===this.readMessageRemaining){let a=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),b=Buffer.concat(a,this.readMessageSize+5);this.readState=c.NO_DATA,e.push(b)}break;default:throw Error("Unexpected read state")}return e}}b.StreamDecoder=d},31712:(a,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.StatusBuilder=void 0;class c{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(a){return this.code=a,this}withDetails(a){return this.details=a,this}withMetadata(a){return this.metadata=a,this}build(){let a={};return null!==this.code&&(a.code=this.code),null!==this.details&&(a.details=this.details),null!==this.metadata&&(a.metadata=this.metadata),a}}b.StatusBuilder=c},32426:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.getSubchannelPool=b.SubchannelPool=void 0;let d=c(24596),e=c(88251),f=c(55392),g=c(71790),h=c(56091);class i{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let a=!0;for(let b in this.pool){let c=this.pool[b].filter(a=>!a.subchannel.unrefIfOneRef());c.length>0&&(a=!1),this.pool[b]=c}a&&null!==this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var a,b;null===this.cleanupTimer&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},1e4),null==(b=(a=this.cleanupTimer).unref)||b.call(a))}getOrCreateSubchannel(a,b,c,i){this.ensureCleanupTask();let j=(0,g.uriToString)(a);if(j in this.pool){for(let a of this.pool[j])if((0,f.subchannelAddressEqual)(b,a.subchannelAddress)&&(0,d.channelOptionsEqual)(c,a.channelArguments)&&i._equals(a.channelCredentials))return a.subchannel}let k=new e.Subchannel(a,b,c,i,new h.Http2SubchannelConnector(a));return j in this.pool||(this.pool[j]=[]),this.pool[j].push({subchannelAddress:b,channelArguments:c,channelCredentials:i,subchannel:k}),k.ref(),k}}b.SubchannelPool=i;let j=new i;b.getSubchannelPool=function(a){return a?j:new i}},33873:a=>{"use strict";a.exports=require("path")},34284:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.ChannelCredentials=void 0;let d=c(34631),e=c(55289),f=c(43371);function g(a,b){if(a&&!(a instanceof Buffer))throw TypeError(`${b}, if provided, must be a Buffer.`)}class h{constructor(a){this.callCredentials=a||e.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(a,b,c,e){var h;if(g(a,"Root certificate"),g(b,"Private key"),g(c,"Certificate chain"),b&&!c)throw Error("Private key must be given with accompanying certificate chain");if(!b&&c)throw Error("Certificate chain must be given with accompanying private key");return new j((0,d.createSecureContext)({ca:null!=(h=null!=a?a:(0,f.getDefaultRootsData)())?h:void 0,key:null!=b?b:void 0,cert:null!=c?c:void 0,ciphers:f.CIPHER_SUITES}),null!=e?e:{})}static createFromSecureContext(a,b){return new j(a,null!=b?b:{})}static createInsecure(){return new i}}b.ChannelCredentials=h;class i extends h{constructor(a){super(a)}compose(a){throw Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(a){return a instanceof i}}class j extends h{constructor(a,b){super(),this.secureContext=a,this.verifyOptions=b,this.connectionOptions={secureContext:a},(null==b?void 0:b.checkServerIdentity)&&(this.connectionOptions.checkServerIdentity=b.checkServerIdentity)}compose(a){return new k(this,this.callCredentials.compose(a))}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(a){return this===a||a instanceof j&&this.secureContext===a.secureContext&&this.verifyOptions.checkServerIdentity===a.verifyOptions.checkServerIdentity}}class k extends h{constructor(a,b){super(b),this.channelCredentials=a}compose(a){let b=this.callCredentials.compose(a);return new k(this.channelCredentials,b)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(a){return this===a||a instanceof k&&this.channelCredentials._equals(a.channelCredentials)&&this.callCredentials._equals(a.callCredentials)}}},34631:a=>{"use strict";a.exports=require("tls")},37010:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.loadPackageDefinition=b.makeClientConstructor=void 0;let d=c(2929),e={unary:d.Client.prototype.makeUnaryRequest,server_stream:d.Client.prototype.makeServerStreamRequest,client_stream:d.Client.prototype.makeClientStreamRequest,bidi:d.Client.prototype.makeBidiStreamRequest};function f(a){return["__proto__","prototype","constructor"].includes(a)}function g(a,b,c){c||(c={});class g extends d.Client{}return Object.keys(a).forEach(b=>{var c,d,h,i;let j;if(f(b))return;let k=a[b];if("string"==typeof b&&"$"===b.charAt(0))throw Error("Method names cannot start with $");j=k.requestStream?k.responseStream?"bidi":"client_stream":k.responseStream?"server_stream":"unary";let l=k.requestSerialize,m=k.responseDeserialize,n=(c=e[j],d=k.path,h=l,i=m,function(...a){return c.call(this,d,h,i,...a)});g.prototype[b]=n,Object.assign(g.prototype[b],k),k.originalName&&!f(k.originalName)&&(g.prototype[k.originalName]=g.prototype[b])}),g.service=a,g.serviceName=b,g}b.makeClientConstructor=g,b.loadPackageDefinition=function(a){let b={};for(let c in a)if(Object.prototype.hasOwnProperty.call(a,c)){let d=a[c],e=c.split(".");if(e.some(a=>f(a)))continue;let h=e[e.length-1],i=b;for(let a of e.slice(0,-1))i[a]||(i[a]={}),i=i[a];"format"in d?i[h]=d:i[h]=g(d,h,{})}return b}},37020:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.ServerCredentials=void 0;let d=c(43371);class e{static createInsecure(){return new f}static createSsl(a,b,c=!1){if(null!==a&&!Buffer.isBuffer(a))throw TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(b))throw TypeError("keyCertPairs must be an array");if("boolean"!=typeof c)throw TypeError("checkClientCertificate must be a boolean");let e=[],f=[];for(let a=0;a<b.length;a++){let c=b[a];if(null===c||"object"!=typeof c)throw TypeError(`keyCertPair[${a}] must be an object`);if(!Buffer.isBuffer(c.private_key))throw TypeError(`keyCertPair[${a}].private_key must be a Buffer`);if(!Buffer.isBuffer(c.cert_chain))throw TypeError(`keyCertPair[${a}].cert_chain must be a Buffer`);e.push(c.cert_chain),f.push(c.private_key)}return new g({ca:a||(0,d.getDefaultRootsData)()||void 0,cert:e,key:f,requestCert:c,ciphers:d.CIPHER_SUITES})}}b.ServerCredentials=e;class f extends e{_isSecure(){return!1}_getSettings(){return null}}class g extends e{constructor(a){super(),this.options=a}_isSecure(){return!0}_getSettings(){return this.options}}},40042:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.OutlierDetectionLoadBalancingConfig=b.BaseSubchannelWrapper=b.registerAdminService=b.FilterStackFactory=b.BaseFilter=b.PickResultType=b.QueuePicker=b.UnavailablePicker=b.ChildLoadBalancerHandler=b.subchannelAddressToString=b.validateLoadBalancingConfig=b.getFirstUsableConfig=b.registerLoadBalancerType=b.createChildChannelControlHelper=b.BackoffTimeout=b.durationToMs=b.uriToString=b.createResolver=b.registerResolver=b.log=b.trace=void 0;var d=c(74271);Object.defineProperty(b,"trace",{enumerable:!0,get:function(){return d.trace}}),Object.defineProperty(b,"log",{enumerable:!0,get:function(){return d.log}});var e=c(61774);Object.defineProperty(b,"registerResolver",{enumerable:!0,get:function(){return e.registerResolver}}),Object.defineProperty(b,"createResolver",{enumerable:!0,get:function(){return e.createResolver}});var f=c(71790);Object.defineProperty(b,"uriToString",{enumerable:!0,get:function(){return f.uriToString}});var g=c(1448);Object.defineProperty(b,"durationToMs",{enumerable:!0,get:function(){return g.durationToMs}});var h=c(29462);Object.defineProperty(b,"BackoffTimeout",{enumerable:!0,get:function(){return h.BackoffTimeout}});var i=c(66655);Object.defineProperty(b,"createChildChannelControlHelper",{enumerable:!0,get:function(){return i.createChildChannelControlHelper}}),Object.defineProperty(b,"registerLoadBalancerType",{enumerable:!0,get:function(){return i.registerLoadBalancerType}}),Object.defineProperty(b,"getFirstUsableConfig",{enumerable:!0,get:function(){return i.getFirstUsableConfig}}),Object.defineProperty(b,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return i.validateLoadBalancingConfig}});var j=c(55392);Object.defineProperty(b,"subchannelAddressToString",{enumerable:!0,get:function(){return j.subchannelAddressToString}});var k=c(16277);Object.defineProperty(b,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return k.ChildLoadBalancerHandler}});var l=c(7702);Object.defineProperty(b,"UnavailablePicker",{enumerable:!0,get:function(){return l.UnavailablePicker}}),Object.defineProperty(b,"QueuePicker",{enumerable:!0,get:function(){return l.QueuePicker}}),Object.defineProperty(b,"PickResultType",{enumerable:!0,get:function(){return l.PickResultType}});var m=c(50742);Object.defineProperty(b,"BaseFilter",{enumerable:!0,get:function(){return m.BaseFilter}});var n=c(73481);Object.defineProperty(b,"FilterStackFactory",{enumerable:!0,get:function(){return n.FilterStackFactory}});var o=c(2313);Object.defineProperty(b,"registerAdminService",{enumerable:!0,get:function(){return o.registerAdminService}});var p=c(86429);Object.defineProperty(b,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return p.BaseSubchannelWrapper}});var q=c(82246);Object.defineProperty(b,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return q.OutlierDetectionLoadBalancingConfig}})},41025:a=>{"use strict";a.exports=require("next/dist/server/app-render/dynamic-access-async-storage.external.js")},41669:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.setup=b.getChannelzServiceDefinition=b.getChannelzHandlers=b.unregisterChannelzRef=b.registerChannelzSocket=b.registerChannelzServer=b.registerChannelzSubchannel=b.registerChannelzChannel=b.ChannelzCallTracker=b.ChannelzChildrenTracker=b.ChannelzTrace=void 0;let d=c(91645),e=c(59173),f=c(51387),g=c(55392),h=c(2313),i=c(37010);function j(a){return{channel_id:a.id,name:a.name}}function k(a){return{subchannel_id:a.id,name:a.name}}function l(a){return{socket_id:a.id,name:a.name}}class m{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(a,b,c){let d=new Date;this.events.push({description:b,severity:a,timestamp:d,childChannel:(null==c?void 0:c.kind)==="channel"?c:void 0,childSubchannel:(null==c?void 0:c.kind)==="subchannel"?c:void 0}),this.events.length>=64&&(this.events=this.events.slice(32)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:w(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(a=>({description:a.description,severity:a.severity,timestamp:w(a.timestamp),channel_ref:a.childChannel?j(a.childChannel):null,subchannel_ref:a.childSubchannel?k(a.childSubchannel):null}))}}}b.ChannelzTrace=m;class n{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(a){var b,c,d;switch(a.kind){case"channel":{let c=null!=(b=this.channelChildren.get(a.id))?b:{ref:a,count:0};c.count+=1,this.channelChildren.set(a.id,c);break}case"subchannel":{let b=null!=(c=this.subchannelChildren.get(a.id))?c:{ref:a,count:0};b.count+=1,this.subchannelChildren.set(a.id,b);break}case"socket":{let b=null!=(d=this.socketChildren.get(a.id))?d:{ref:a,count:0};b.count+=1,this.socketChildren.set(a.id,b)}}}unrefChild(a){switch(a.kind){case"channel":{let b=this.channelChildren.get(a.id);void 0!==b&&(b.count-=1,0===b.count?this.channelChildren.delete(a.id):this.channelChildren.set(a.id,b));break}case"subchannel":{let b=this.subchannelChildren.get(a.id);void 0!==b&&(b.count-=1,0===b.count?this.subchannelChildren.delete(a.id):this.subchannelChildren.set(a.id,b));break}case"socket":{let b=this.socketChildren.get(a.id);void 0!==b&&(b.count-=1,0===b.count?this.socketChildren.delete(a.id):this.socketChildren.set(a.id,b))}}}getChildLists(){let a=[];for(let{ref:b}of this.channelChildren.values())a.push(b);let b=[];for(let{ref:a}of this.subchannelChildren.values())b.push(a);let c=[];for(let{ref:a}of this.socketChildren.values())c.push(a);return{channels:a,subchannels:b,sockets:c}}}b.ChannelzChildrenTracker=n;class o{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}}b.ChannelzCallTracker=o;let p=1,q=[],r=[],s=[],t=[];function u(a){return""===a?[]:[].concat(...a.split(":").map(a=>(function(a){let b=Number.parseInt(a,16);return[b/256|0,b%256]})(a)))}function v(a){switch(a){case e.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case e.ConnectivityState.IDLE:return{state:"IDLE"};case e.ConnectivityState.READY:return{state:"READY"};case e.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case e.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function w(a){if(!a)return null;let b=a.getTime();return{seconds:b/1e3|0,nanos:b%1e3*1e6}}function x(a){let b=a.getInfo();return{ref:j(a.ref),data:{target:b.target,state:v(b.state),calls_started:b.callTracker.callsStarted,calls_succeeded:b.callTracker.callsSucceeded,calls_failed:b.callTracker.callsFailed,last_call_started_timestamp:w(b.callTracker.lastCallStartedTimestamp),trace:b.trace.getTraceMessage()},channel_ref:b.children.channels.map(a=>j(a)),subchannel_ref:b.children.subchannels.map(a=>k(a))}}function y(a,b){let c=Number.parseInt(a.request.channel_id),d=q[c];if(void 0===d)return void b({code:f.Status.NOT_FOUND,details:"No channel data found for id "+c});b(null,{channel:x(d)})}function z(a,b){let c=Number.parseInt(a.request.max_results),d=[],e=Number.parseInt(a.request.start_channel_id);for(;e<q.length;e++){let a=q[e];if(void 0!==a&&(d.push(x(a)),d.length>=c))break}b(null,{channel:d,end:e>=s.length})}function A(a){let b=a.getInfo();return{ref:{server_id:a.ref.id},data:{calls_started:b.callTracker.callsStarted,calls_succeeded:b.callTracker.callsSucceeded,calls_failed:b.callTracker.callsFailed,last_call_started_timestamp:w(b.callTracker.lastCallStartedTimestamp),trace:b.trace.getTraceMessage()},listen_socket:b.listenerChildren.sockets.map(a=>l(a))}}function B(a,b){let c=Number.parseInt(a.request.server_id),d=s[c];if(void 0===d)return void b({code:f.Status.NOT_FOUND,details:"No server data found for id "+c});b(null,{server:A(d)})}function C(a,b){let c=Number.parseInt(a.request.max_results),d=[],e=Number.parseInt(a.request.start_server_id);for(;e<s.length;e++){let a=s[e];if(void 0!==a&&(d.push(A(a)),d.length>=c))break}b(null,{server:d,end:e>=s.length})}function D(a,b){let c=Number.parseInt(a.request.subchannel_id),d=r[c];if(void 0===d)return void b({code:f.Status.NOT_FOUND,details:"No subchannel data found for id "+c});let e=d.getInfo();b(null,{subchannel:{ref:k(d.ref),data:{target:e.target,state:v(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:w(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},socket_ref:e.children.sockets.map(a=>l(a))}})}function E(a){var b;return(0,g.isTcpSubchannelAddress)(a)?{address:"tcpip_address",tcpip_address:{ip_address:null!=(b=function(a){if((0,d.isIPv4)(a))return Buffer.from(Uint8Array.from(a.split(".").map(a=>Number.parseInt(a))));if(!(0,d.isIPv6)(a))return null;{let b,c,d=a.indexOf("::");-1===d?(b=a,c=""):(b=a.substring(0,d),c=a.substring(d+2));let e=Buffer.from(u(b)),f=Buffer.from(u(c)),g=Buffer.alloc(16-e.length-f.length,0);return Buffer.concat([e,g,f])}}(a.host))?b:void 0,port:a.port}}:{address:"uds_address",uds_address:{filename:a.path}}}function F(a,b){var c,d,e,g,h;let i=Number.parseInt(a.request.socket_id),j=t[i];if(void 0===j)return void b({code:f.Status.NOT_FOUND,details:"No socket data found for id "+i});let k=j.getInfo(),m=k.security?{model:"tls",tls:{cipher_suite:k.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:null!=(c=k.security.cipherSuiteStandardName)?c:void 0,other_name:null!=(d=k.security.cipherSuiteOtherName)?d:void 0,local_certificate:null!=(e=k.security.localCertificate)?e:void 0,remote_certificate:null!=(g=k.security.remoteCertificate)?g:void 0}}:null;b(null,{socket:{ref:l(j.ref),local:k.localAddress?E(k.localAddress):null,remote:k.remoteAddress?E(k.remoteAddress):null,remote_name:null!=(h=k.remoteName)?h:void 0,security:m,data:{keep_alives_sent:k.keepAlivesSent,streams_started:k.streamsStarted,streams_succeeded:k.streamsSucceeded,streams_failed:k.streamsFailed,last_local_stream_created_timestamp:w(k.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:w(k.lastRemoteStreamCreatedTimestamp),messages_received:k.messagesReceived,messages_sent:k.messagesSent,last_message_received_timestamp:w(k.lastMessageReceivedTimestamp),last_message_sent_timestamp:w(k.lastMessageSentTimestamp),local_flow_control_window:k.localFlowControlWindow?{value:k.localFlowControlWindow}:null,remote_flow_control_window:k.remoteFlowControlWindow?{value:k.remoteFlowControlWindow}:null}}})}function G(a,b){let c=Number.parseInt(a.request.server_id),d=s[c];if(void 0===d)return void b({code:f.Status.NOT_FOUND,details:"No server data found for id "+c});let e=Number.parseInt(a.request.start_socket_id),g=Number.parseInt(a.request.max_results),h=d.getInfo().sessionChildren.sockets.sort((a,b)=>a.id-b.id),i=[],j=0;for(;j<h.length&&(!(h[j].id>=e)||(i.push(l(h[j])),!(i.length>=g)));j++);b(null,{socket_ref:i,end:j>=h.length})}function H(){return{GetChannel:y,GetTopChannels:z,GetServer:B,GetServers:C,GetSubchannel:D,GetSocket:F,GetServerSockets:G}}b.registerChannelzChannel=function(a,b,c){let d=p++,e={id:d,name:a,kind:"channel"};return c&&(q[d]={ref:e,getInfo:b}),e},b.registerChannelzSubchannel=function(a,b,c){let d=p++,e={id:d,name:a,kind:"subchannel"};return c&&(r[d]={ref:e,getInfo:b}),e},b.registerChannelzServer=function(a,b){let c=p++,d={id:c,kind:"server"};return b&&(s[c]={ref:d,getInfo:a}),d},b.registerChannelzSocket=function(a,b,c){let d=p++,e={id:d,name:a,kind:"socket"};return c&&(t[d]={ref:e,getInfo:b}),e},b.unregisterChannelzRef=function(a){switch(a.kind){case"channel":delete q[a.id];return;case"subchannel":delete r[a.id];return;case"server":delete s[a.id];return;case"socket":delete t[a.id];return}},b.getChannelzHandlers=H;let I=null;function J(){if(I)return I;let a=(0,c(26223).Yi)("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return I=(0,i.loadPackageDefinition)(a).grpc.channelz.v1.Channelz.service}b.getChannelzServiceDefinition=J,b.setup=function(){(0,h.registerAdminService)(J,H)}},43371:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.getDefaultRootsData=b.CIPHER_SUITES=void 0;let d=c(29021);b.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;let e=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,f=null;b.getDefaultRootsData=function(){return e?(null===f&&(f=d.readFileSync(e)),f):null}},43975:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.LoadBalancingCall=void 0;let d=c(59173),e=c(51387),f=c(50108),g=c(61291),h=c(7702),i=c(71790),j=c(74271),k=c(11905),l=c(73496);class m{constructor(a,b,c,d,e,f,g){var h,j;this.channel=a,this.callConfig=b,this.methodName=c,this.host=d,this.credentials=e,this.deadline=f,this.callNumber=g,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let k=this.methodName.split("/"),l="";k.length>=2&&(l=k[1]);let m=null!=(j=null==(h=(0,i.splitHostPort)(this.host))?void 0:h.host)?j:"localhost";this.serviceUrl=`https://${m}/${l}`}trace(a){j.trace(e.LogVerbosity.DEBUG,"load_balancing_call","["+this.callNumber+"] "+a)}outputStatus(a,b){var c,d;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+a.code+' details="'+a.details+'"');let e=Object.assign(Object.assign({},a),{progress:b});null==(c=this.listener)||c.onReceiveStatus(e),null==(d=this.onCallEnded)||d.call(this,e.code)}}doPick(){var a,b;if(this.ended)return;if(!this.metadata)throw Error("doPick called before start");this.trace("Pick called");let c=this.channel.doPick(this.metadata,this.callConfig.pickInformation),i=c.subchannel?"("+c.subchannel.getChannelzRef().id+") "+c.subchannel.getAddress():""+c.subchannel;switch(this.trace("Pick result: "+h.PickResultType[c.pickResultType]+" subchannel: "+i+" status: "+(null==(a=c.status)?void 0:a.code)+" "+(null==(b=c.status)?void 0:b.details)),c.pickResultType){case h.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var b,h,j;if(this.ended)return void this.trace("Credentials metadata generation finished after call ended");let k=this.metadata.clone();if(k.merge(a),k.get("authorization").length>1&&this.outputStatus({code:e.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new g.Metadata},"PROCESSED"),c.subchannel.getConnectivityState()!==d.ConnectivityState.READY){this.trace("Picked subchannel "+i+" has state "+d.ConnectivityState[c.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&k.set("grpc-timeout",(0,f.getDeadlineTimeoutString)(this.deadline));try{this.child=c.subchannel.getRealSubchannel().createCall(k,this.host,this.methodName,{onReceiveMetadata:a=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(a)},onReceiveMessage:a=>{this.trace("Received message"),this.listener.onReceiveMessage(a)},onReceiveStatus:a=>{this.trace("Received status"),a.rstCode===l.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(a,"REFUSED"):this.outputStatus(a,"PROCESSED")}})}catch(a){this.trace("Failed to start call on picked subchannel "+i+" with error "+a.message),this.outputStatus({code:e.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+a.message,metadata:new g.Metadata},"NOT_STARTED");return}null==(h=(b=this.callConfig).onCommitted)||h.call(b),null==(j=c.onCallStarted)||j.call(c),this.onCallEnded=c.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:b,details:c}=(0,k.restrictControlPlaneStatusCode)("number"==typeof a.code?a.code:e.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:b,details:c,metadata:new g.Metadata},"PROCESSED")});break;case h.PickResultType.DROP:let{code:j,details:m}=(0,k.restrictControlPlaneStatusCode)(c.status.code,c.status.details);setImmediate(()=>{this.outputStatus({code:j,details:m,metadata:c.status.metadata},"DROP")});break;case h.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:b}=(0,k.restrictControlPlaneStatusCode)(c.status.code,c.status.details);setImmediate(()=>{this.outputStatus({code:a,details:b,metadata:c.status.metadata},"PROCESSED")})}break;case h.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(a,b){var c;this.trace("cancelWithStatus code: "+a+' details: "'+b+'"'),null==(c=this.child)||c.cancelWithStatus(a,b),this.outputStatus({code:a,details:b,metadata:new g.Metadata},"PROCESSED")}getPeer(){var a,b;return null!=(b=null==(a=this.child)?void 0:a.getPeer())?b:this.channel.getTarget()}start(a,b){this.trace("start called"),this.listener=b,this.metadata=a,this.doPick()}sendMessageWithContext(a,b){this.trace("write() called with message of length "+b.length),this.child?this.child.sendMessageWithContext(a,b):this.pendingMessage={context:a,message:b}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(a){throw Error("Method not implemented.")}getCallNumber(){return this.callNumber}}b.LoadBalancingCall=m},44258:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.getInterceptingCall=b.InterceptingCall=b.RequesterBuilder=b.ListenerBuilder=b.InterceptorConfigurationError=void 0;let d=c(61291),e=c(13610),f=c(51387),g=c(2234);class h extends Error{constructor(a){super(a),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,h)}}b.InterceptorConfigurationError=h;class i{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(a){return this.metadata=a,this}withOnReceiveMessage(a){return this.message=a,this}withOnReceiveStatus(a){return this.status=a,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}}b.ListenerBuilder=i;class j{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(a){return this.start=a,this}withSendMessage(a){return this.message=a,this}withHalfClose(a){return this.halfClose=a,this}withCancel(a){return this.cancel=a,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}}b.RequesterBuilder=j;let k={onReceiveMetadata:(a,b)=>{b(a)},onReceiveMessage:(a,b)=>{b(a)},onReceiveStatus:(a,b)=>{b(a)}},l={start:(a,b,c)=>{c(a,b)},sendMessage:(a,b)=>{b(a)},halfClose:a=>{a()},cancel:a=>{a()}};class m{constructor(a,b){var c,d,e,f;this.nextCall=a,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,b?this.requester={start:null!=(c=b.start)?c:l.start,sendMessage:null!=(d=b.sendMessage)?d:l.sendMessage,halfClose:null!=(e=b.halfClose)?e:l.halfClose,cancel:null!=(f=b.cancel)?f:l.cancel}:this.requester=l}cancelWithStatus(a,b){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(a,b)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(a,b){var c,d,f,g,h,i;let j={onReceiveMetadata:null!=(d=null==(c=null==b?void 0:b.onReceiveMetadata)?void 0:c.bind(b))?d:a=>{},onReceiveMessage:null!=(g=null==(f=null==b?void 0:b.onReceiveMessage)?void 0:f.bind(b))?g:a=>{},onReceiveStatus:null!=(i=null==(h=null==b?void 0:b.onReceiveStatus)?void 0:h.bind(b))?i:a=>{}};this.processingMetadata=!0,this.requester.start(a,j,(a,b)=>{var c,d,f;let g;if(this.processingMetadata=!1,(0,e.isInterceptingListener)(b))g=b;else{let a={onReceiveMetadata:null!=(c=b.onReceiveMetadata)?c:k.onReceiveMetadata,onReceiveMessage:null!=(d=b.onReceiveMessage)?d:k.onReceiveMessage,onReceiveStatus:null!=(f=b.onReceiveStatus)?f:k.onReceiveStatus};g=new e.InterceptingListenerImpl(a,j)}this.nextCall.start(a,g),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(a,b){this.processingMessage=!0,this.requester.sendMessage(b,c=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=a,this.pendingMessage=b):(this.nextCall.sendMessageWithContext(a,c),this.processPendingHalfClose())})}sendMessage(a){this.sendMessageWithContext({},a)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}}b.InterceptingCall=m;class n{constructor(a,b){this.call=a,this.methodDefinition=b}cancelWithStatus(a,b){this.call.cancelWithStatus(a,b)}getPeer(){return this.call.getPeer()}sendMessageWithContext(a,b){let c;try{c=this.methodDefinition.requestSerialize(b)}catch(a){this.call.cancelWithStatus(f.Status.INTERNAL,`Request message serialization failure: ${(0,g.getErrorMessage)(a)}`);return}this.call.sendMessageWithContext(a,c)}sendMessage(a){this.sendMessageWithContext({},a)}start(a,b){let c=null;this.call.start(a,{onReceiveMetadata:a=>{var c;null==(c=null==b?void 0:b.onReceiveMetadata)||c.call(b,a)},onReceiveMessage:a=>{var e;let h;try{h=this.methodDefinition.responseDeserialize(a)}catch(a){c={code:f.Status.INTERNAL,details:`Response message parsing error: ${(0,g.getErrorMessage)(a)}`,metadata:new d.Metadata},this.call.cancelWithStatus(c.code,c.details);return}null==(e=null==b?void 0:b.onReceiveMessage)||e.call(b,h)},onReceiveStatus:a=>{var d,e;c?null==(d=null==b?void 0:b.onReceiveStatus)||d.call(b,c):null==(e=null==b?void 0:b.onReceiveStatus)||e.call(b,a)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}}class o extends n{constructor(a,b){super(a,b)}start(a,b){var c,d;let e=!1,f={onReceiveMetadata:null!=(d=null==(c=null==b?void 0:b.onReceiveMetadata)?void 0:c.bind(b))?d:a=>{},onReceiveMessage:a=>{var c;e=!0,null==(c=null==b?void 0:b.onReceiveMessage)||c.call(b,a)},onReceiveStatus:a=>{var c,d;e||null==(c=null==b?void 0:b.onReceiveMessage)||c.call(b,null),null==(d=null==b?void 0:b.onReceiveStatus)||d.call(b,a)}};super.start(a,f),this.call.startRead()}}class p extends n{}b.getInterceptingCall=function(a,b,c,d){if(a.clientInterceptors.length>0&&a.clientInterceptorProviders.length>0)throw new h("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(a.callInterceptors.length>0&&a.callInterceptorProviders.length>0)throw new h("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let e=[];e=a.callInterceptors.length>0||a.callInterceptorProviders.length>0?[].concat(a.callInterceptors,a.callInterceptorProviders.map(a=>a(b))).filter(a=>a):[].concat(a.clientInterceptors,a.clientInterceptorProviders.map(a=>a(b))).filter(a=>a);let f=Object.assign({},c,{method_definition:b});return e.reduceRight((a,b)=>c=>b(c,a),a=>(function(a,b,c){let d=function(a,b,c){var d,e;let f=null!=(d=c.deadline)?d:1/0,g=c.host,h=null!=(e=c.parent)?e:null,i=c.propagate_flags,j=c.credentials,k=a.createCall(b,f,g,h,i);return j&&k.setCredentials(j),k}(a,c.path,b);return c.responseStream?new p(d,c):new o(d,c)})(d,a,b))(f)}},44609:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.ResolvingLoadBalancer=void 0;let d=c(66655),e=c(83724),f=c(59173),g=c(61774),h=c(7702),i=c(29462),j=c(51387),k=c(61291),l=c(74271),m=c(51387),n=c(71790),o=c(16277);function p(a){l.trace(m.LogVerbosity.DEBUG,"resolving_load_balancer",a)}let q=["SERVICE_AND_METHOD","SERVICE","EMPTY"];class r{constructor(a,b,c,l,m){this.target=a,this.channelControlHelper=b,this.onSuccessfulResolution=l,this.onFailedResolution=m,this.latestChildState=f.ConnectivityState.IDLE,this.latestChildPicker=new h.QueuePicker(this),this.currentState=f.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,c["grpc.service_config"]?this.defaultServiceConfig=(0,e.validateServiceConfig)(JSON.parse(c["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(f.ConnectivityState.IDLE,new h.QueuePicker(this)),this.childLoadBalancer=new o.ChildLoadBalancerHandler({createSubchannel:b.createSubchannel.bind(b),requestReresolution:()=>{this.backoffTimeout.isRunning()?(p("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,b)=>{this.latestChildState=a,this.latestChildPicker=b,this.updateState(a,b)},addChannelzChild:b.addChannelzChild.bind(b),removeChannelzChild:b.removeChannelzChild.bind(b)}),this.innerResolver=(0,g.createResolver)(a,{onSuccessfulResolution:(a,b,c,e,f)=>{var g;this.backoffTimeout.stop(),this.backoffTimeout.reset();let h=null;null===b?null===c?(this.previousServiceConfig=null,h=this.defaultServiceConfig):null===this.previousServiceConfig?this.handleResolutionFailure(c):h=this.previousServiceConfig:(h=b,this.previousServiceConfig=b);let i=null!=(g=null==h?void 0:h.loadBalancingConfig)?g:[],l=(0,d.getFirstUsableConfig)(i,!0);if(null===l)return void this.handleResolutionFailure({code:j.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new k.Metadata});this.childLoadBalancer.updateAddressList(a,l,f);let m=null!=h?h:this.defaultServiceConfig;this.onSuccessfulResolution(m,null!=e?e:function(a){return function(b,c){var d,e;let f=b.split("/").filter(a=>a.length>0),g=null!=(d=f[0])?d:"",h=null!=(e=f[1])?e:"";if(a&&a.methodConfig)for(let b of q){let c=function(a,b,c,d){for(let e of c)if(function(a,b,c,d){for(let e of c.name)switch(d){case"EMPTY":if(!e.service&&!e.method)return!0;break;case"SERVICE":if(e.service===a&&!e.method)return!0;break;case"SERVICE_AND_METHOD":if(e.service===a&&e.method===b)return!0}return!1}(a,b,e,d))return e;return null}(g,h,a.methodConfig,b);if(c)return{methodConfig:c,pickInformation:{},status:j.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:j.Status.OK,dynamicFilterFactories:[]}}}(m))},onError:a=>{this.handleResolutionFailure(a)}},c);let n={initialDelay:c["grpc.initial_reconnect_backoff_ms"],maxDelay:c["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new i.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},n),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===f.ConnectivityState.IDLE&&this.updateState(f.ConnectivityState.CONNECTING,new h.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(a,b){p((0,n.uriToString)(this.target)+" "+f.ConnectivityState[this.currentState]+" -> "+f.ConnectivityState[a]),a===f.ConnectivityState.IDLE&&(b=new h.QueuePicker(this)),this.currentState=a,this.channelControlHelper.updateState(a,b)}handleResolutionFailure(a){this.latestChildState===f.ConnectivityState.IDLE&&(this.updateState(f.ConnectivityState.TRANSIENT_FAILURE,new h.UnavailablePicker(a)),this.onFailedResolution(a))}exitIdle(){(this.currentState===f.ConnectivityState.IDLE||this.currentState===f.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(a,b){throw Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=f.ConnectivityState.IDLE,this.latestChildPicker=new h.QueuePicker(this),this.currentState=f.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}}b.ResolvingLoadBalancer=r},44906:(a,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.getNextCallNumber=void 0;let c=0;b.getNextCallNumber=function(){return c++}},50108:(a,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.deadlineToString=b.getRelativeTimeout=b.getDeadlineTimeoutString=b.minDeadline=void 0,b.minDeadline=function(...a){let b=1/0;for(let c of a){let a=c instanceof Date?c.getTime():c;a<b&&(b=a)}return b};let c=[["m",1],["S",1e3],["M",6e4],["H",36e5]];b.getDeadlineTimeoutString=function(a){let b=new Date().getTime();a instanceof Date&&(a=a.getTime());let d=Math.max(a-b,0);for(let[a,b]of c){let c=d/b;if(c<1e8)return String(Math.ceil(c))+a}throw Error("Deadline is too far in the future")},b.getRelativeTimeout=function(a){let b=(a instanceof Date?a.getTime():a)-new Date().getTime();return b<0?0:b>0x7fffffff?1/0:b},b.deadlineToString=function(a){if(a instanceof Date)return a.toISOString();{let b=new Date(a);return Number.isNaN(b.getTime())?""+a:b.toISOString()}}},50742:(a,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.BaseFilter=void 0;class c{async sendMetadata(a){return a}receiveMetadata(a){return a}async sendMessage(a){return a}async receiveMessage(a){return a}receiveTrailers(a){return a}}b.BaseFilter=c},51387:(a,b)=>{"use strict";var c,d,e;Object.defineProperty(b,"__esModule",{value:!0}),b.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=b.DEFAULT_MAX_SEND_MESSAGE_LENGTH=b.Propagate=b.LogVerbosity=b.Status=void 0,function(a){a[a.OK=0]="OK",a[a.CANCELLED=1]="CANCELLED",a[a.UNKNOWN=2]="UNKNOWN",a[a.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",a[a.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",a[a.NOT_FOUND=5]="NOT_FOUND",a[a.ALREADY_EXISTS=6]="ALREADY_EXISTS",a[a.PERMISSION_DENIED=7]="PERMISSION_DENIED",a[a.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",a[a.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",a[a.ABORTED=10]="ABORTED",a[a.OUT_OF_RANGE=11]="OUT_OF_RANGE",a[a.UNIMPLEMENTED=12]="UNIMPLEMENTED",a[a.INTERNAL=13]="INTERNAL",a[a.UNAVAILABLE=14]="UNAVAILABLE",a[a.DATA_LOSS=15]="DATA_LOSS",a[a.UNAUTHENTICATED=16]="UNAUTHENTICATED"}(c||(b.Status=c={})),function(a){a[a.DEBUG=0]="DEBUG",a[a.INFO=1]="INFO",a[a.ERROR=2]="ERROR",a[a.NONE=3]="NONE"}(d||(b.LogVerbosity=d={})),function(a){a[a.DEADLINE=1]="DEADLINE",a[a.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",a[a.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",a[a.CANCELLATION=8]="CANCELLATION",a[a.DEFAULTS=65535]="DEFAULTS"}(e||(b.Propagate=e={})),b.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1,b.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4194304},51555:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.setup=void 0;let d=c(61774);class e{constructor(a,b,c){let d;this.listener=b,this.addresses=[],this.hasReturnedResult=!1,d=""===a.authority?"/"+a.path:a.path,this.addresses=[{path:d}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(a){return"localhost"}}b.setup=function(){(0,d.registerResolver)("unix",e)}},53123:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.setup=b.RoundRobinLoadBalancer=void 0;let d=c(66655),e=c(59173),f=c(7702),g=c(55392),h=c(74271),i=c(51387);function j(a){h.trace(i.LogVerbosity.DEBUG,"round_robin",a)}let k="round_robin";class l{getLoadBalancerName(){return k}constructor(){}toJsonObject(){return{[k]:{}}}static createFromJson(a){return new l}}class m{constructor(a,b=0){this.subchannelList=a,this.nextIndex=b}pick(a){let b=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:f.PickResultType.COMPLETE,subchannel:b,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}}class n{constructor(a){this.channelControlHelper=a,this.subchannels=[],this.currentState=e.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(a,b,c,d,f)=>{this.calculateAndUpdateState(),(c===e.ConnectivityState.TRANSIENT_FAILURE||c===e.ConnectivityState.IDLE)&&(f&&(this.lastError=f),this.channelControlHelper.requestReresolution(),a.startConnecting())}}countSubchannelsWithState(a){return this.subchannels.filter(b=>b.getConnectivityState()===a).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(e.ConnectivityState.READY)>0){let a=this.subchannels.filter(a=>a.getConnectivityState()===e.ConnectivityState.READY),b=0;null!==this.currentReadyPicker&&(b=a.indexOf(this.currentReadyPicker.peekNextSubchannel()))<0&&(b=0),this.updateState(e.ConnectivityState.READY,new m(a,b))}else this.countSubchannelsWithState(e.ConnectivityState.CONNECTING)>0?this.updateState(e.ConnectivityState.CONNECTING,new f.QueuePicker(this)):this.countSubchannelsWithState(e.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(e.ConnectivityState.TRANSIENT_FAILURE,new f.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(e.ConnectivityState.IDLE,new f.QueuePicker(this))}updateState(a,b){j(e.ConnectivityState[this.currentState]+" -> "+e.ConnectivityState[a]),a===e.ConnectivityState.READY?this.currentReadyPicker=b:this.currentReadyPicker=null,this.currentState=a,this.channelControlHelper.updateState(a,b)}resetSubchannelList(){for(let a of this.subchannels)a.removeConnectivityStateListener(this.subchannelStateListener),a.unref(),this.channelControlHelper.removeChannelzChild(a.getChannelzRef());this.subchannels=[]}updateAddressList(a,b){for(let b of(this.resetSubchannelList(),j("Connect to address list "+a.map(a=>(0,g.subchannelAddressToString)(a))),this.subchannels=a.map(a=>this.channelControlHelper.createSubchannel(a,{})),this.subchannels)){b.ref(),b.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(b.getChannelzRef());let a=b.getConnectivityState();(a===e.ConnectivityState.IDLE||a===e.ConnectivityState.TRANSIENT_FAILURE)&&b.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let a of this.subchannels)a.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return k}}b.RoundRobinLoadBalancer=n,b.setup=function(){(0,d.registerLoadBalancerType)(k,n,l)}},55289:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.CallCredentials=void 0;let d=c(61291);class e{static createFromMetadataGenerator(a){return new g(a)}static createFromGoogleCredential(a){return e.createFromMetadataGenerator((b,c)=>{let e;(e="getRequestHeaders"in a&&"function"==typeof a.getRequestHeaders?a.getRequestHeaders(b.service_url):new Promise((c,d)=>{a.getRequestMetadata(b.service_url,(a,b)=>a?void d(a):b?void c(b):void d(Error("Headers not set by metadata plugin")))})).then(a=>{let b=new d.Metadata;for(let c of Object.keys(a))b.add(c,a[c]);c(null,b)},a=>{c(a)})})}static createEmpty(){return new h}}b.CallCredentials=e;class f extends e{constructor(a){super(),this.creds=a}async generateMetadata(a){let b=new d.Metadata;for(let c of(await Promise.all(this.creds.map(b=>b.generateMetadata(a)))))b.merge(c);return b}compose(a){return new f(this.creds.concat([a]))}_equals(a){return this===a||a instanceof f&&this.creds.every((b,c)=>b._equals(a.creds[c]))}}class g extends e{constructor(a){super(),this.metadataGenerator=a}generateMetadata(a){return new Promise((b,c)=>{this.metadataGenerator(a,(a,d)=>{void 0!==d?b(d):c(a)})})}compose(a){return new f([this,a])}_equals(a){return this===a||a instanceof g&&this.metadataGenerator===a.metadataGenerator}}class h extends e{generateMetadata(a){return Promise.resolve(new d.Metadata)}compose(a){return a}_equals(a){return a instanceof h}}},55392:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.stringToSubchannelAddress=b.subchannelAddressToString=b.subchannelAddressEqual=b.isTcpSubchannelAddress=void 0;let d=c(91645);function e(a){return"port"in a}b.isTcpSubchannelAddress=e,b.subchannelAddressEqual=function(a,b){return!a&&!b||!!a&&!!b&&(e(a)?e(b)&&a.host===b.host&&a.port===b.port:!e(b)&&a.path===b.path)},b.subchannelAddressToString=function(a){return e(a)?a.host+":"+a.port:a.path},b.stringToSubchannelAddress=function(a,b){return(0,d.isIP)(a)?{host:a,port:null!=b?b:443}:{path:a}}},55511:a=>{"use strict";a.exports=require("crypto")},56091:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.Http2SubchannelConnector=void 0;let d=c(73496),e=c(34631),f=c(41669),g=c(51387),h=c(4933),i=c(74271),j=c(61774),k=c(55392),l=c(71790),m=c(91645),n=c(83072),o=c(44906),p="transport",q=c(97697).rE,{HTTP2_HEADER_AUTHORITY:r,HTTP2_HEADER_CONTENT_TYPE:s,HTTP2_HEADER_METHOD:t,HTTP2_HEADER_PATH:u,HTTP2_HEADER_TE:v,HTTP2_HEADER_USER_AGENT:w}=d.constants,x=Buffer.from("too_many_pings","ascii");class y{constructor(a,b,c,e){this.session=a,this.options=c,this.remoteName=e,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=2e4,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new f.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,k.subchannelAddressToString)(b),0===c["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,f.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[c["grpc.primary_user_agent"],`grpc-node-js/${q}`,c["grpc.secondary_user_agent"]].filter(a=>a).join(" "),"grpc.keepalive_time_ms"in c&&(this.keepaliveTimeMs=c["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in c&&(this.keepaliveTimeoutMs=c["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in c?this.keepaliveWithoutCalls=1===c["grpc.keepalive_permit_without_calls"]:this.keepaliveWithoutCalls=!1,a.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),a.once("goaway",(a,b,c)=>{let e=!1;a===d.constants.NGHTTP2_ENHANCE_YOUR_CALM&&c&&c.equals(x)&&(e=!0),this.trace("connection closed by GOAWAY with code "+a+" and data "+(null==c?void 0:c.toString())),this.reportDisconnectToOwner(e)}),a.once("error",a=>{this.trace("connection closed with error "+a.message)}),i.isTracerEnabled(p)&&(a.on("remoteSettings",b=>{this.trace("new settings received"+(this.session!==a?" on the old connection":"")+": "+JSON.stringify(b))}),a.on("localSettings",b=>{this.trace("local settings acknowledged by remote"+(this.session!==a?" on the old connection":"")+": "+JSON.stringify(b))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var a,b,c;let d,e=this.session.socket,f=e.remoteAddress?(0,k.stringToSubchannelAddress)(e.remoteAddress,e.remotePort):null,g=e.localAddress?(0,k.stringToSubchannelAddress)(e.localAddress,e.localPort):null;if(this.session.encrypted){let b=e.getCipher(),c=e.getCertificate(),f=e.getPeerCertificate();d={cipherSuiteStandardName:null!=(a=b.standardName)?a:null,cipherSuiteOtherName:b.standardName?null:b.name,localCertificate:c&&"raw"in c?c.raw:null,remoteCertificate:f&&"raw"in f?f.raw:null}}else d=null;return{remoteAddress:f,localAddress:g,security:d,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:null!=(b=this.session.state.localWindowSize)?b:null,remoteFlowControlWindow:null!=(c=this.session.state.remoteWindowSize)?c:null}}trace(a){i.trace(g.LogVerbosity.DEBUG,p,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}keepaliveTrace(a){i.trace(g.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}flowControlTrace(a){i.trace(g.LogVerbosity.DEBUG,"transport_flowctrl","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}internalsTrace(a){i.trace(g.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}reportDisconnectToOwner(a){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(b=>b(a)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let a of this.activeCalls)a.onDisconnect()})}addDisconnectListener(a){this.disconnectListeners.push(a)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var a,b;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),null==(b=(a=this.keepaliveTimeoutId).unref)||b.call(a));try{this.session.ping((a,b,c)=>{a&&(this.keepaliveTrace("Ping failed with error "+a.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch(a){this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var a,b;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):this.keepaliveTimerId||this.keepaliveTimeoutId||(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=null==(b=(a=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)?void 0:b.call(a)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(a){this.activeCalls.delete(a),0===this.activeCalls.size&&this.session.unref()}addActiveCall(a){this.activeCalls.add(a),1===this.activeCalls.size&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(a,b,c,d,e){let f,g,h,i=a.toHttp2Headers();i[r]=b,i[w]=this.userAgent,i[s]="application/grpc",i[t]="POST",i[u]=c,i[v]="trailers";try{f=this.session.request(i)}catch(a){throw this.handleDisconnect(),a}return this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed),this.channelzEnabled?(this.streamTracker.addCallStarted(),g={addMessageSent:()=>{var a;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,null==(a=e.addMessageSent)||a.call(e)},addMessageReceived:()=>{var a;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,null==(a=e.addMessageReceived)||a.call(e)},onCallEnd:a=>{var b;null==(b=e.onCallEnd)||b.call(e,a),this.removeActiveCall(h)},onStreamEnd:a=>{var b;a?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),null==(b=e.onStreamEnd)||b.call(e,a)}}):g={addMessageSent:()=>{var a;null==(a=e.addMessageSent)||a.call(e)},addMessageReceived:()=>{var a;null==(a=e.addMessageReceived)||a.call(e)},onCallEnd:a=>{var b;null==(b=e.onCallEnd)||b.call(e,a),this.removeActiveCall(h)},onStreamEnd:a=>{var b;null==(b=e.onStreamEnd)||b.call(e,a)}},h=new n.Http2SubchannelCall(f,g,d,this,(0,o.getNextCallNumber)()),this.addActiveCall(h),h}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,f.unregisterChannelzRef)(this.channelzRef)}}class z{constructor(a){this.channelTarget=a,this.session=null,this.isShutdown=!1}trace(a){i.trace(g.LogVerbosity.DEBUG,p,(0,l.uriToString)(this.channelTarget)+" "+a)}createSession(a,b,c,f){return this.isShutdown?Promise.reject():new Promise((g,h)=>{var i,n,o;let p;f.realTarget?(p=(0,l.uriToString)(f.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,l.uriToString)(f.realTarget))):(p=null,this.trace("creating HTTP/2 session to "+(0,k.subchannelAddressToString)(a)));let q=(0,j.getDefaultAuthority)(null!=(i=f.realTarget)?i:this.channelTarget),r=b._getConnectionOptions()||{};r.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in c?r.maxSessionMemory=c["grpc-node.max_session_memory"]:r.maxSessionMemory=Number.MAX_SAFE_INTEGER;let s="http://";if("secureContext"in r){if(s="https://",c["grpc.ssl_target_name_override"]){let a=c["grpc.ssl_target_name_override"];r.checkServerIdentity=(b,c)=>(0,e.checkServerIdentity)(a,c),r.servername=a}else{let a=null!=(o=null==(n=(0,l.splitHostPort)(q))?void 0:n.host)?o:"localhost";r.servername=a}f.socket&&(r.createConnection=(a,b)=>f.socket)}else r.createConnection=(b,c)=>f.socket?f.socket:m.connect(a);r=Object.assign(Object.assign(Object.assign({},r),a),{enableTrace:1===c["grpc-node.tls_enable_trace"]});let t=d.connect(s+q,r);this.session=t;let u="Failed to connect";t.unref(),t.once("connect",()=>{t.removeAllListeners(),g(new y(t,a,c,p)),this.session=null}),t.once("close",()=>{this.session=null,setImmediate(()=>{h(`${u} (${new Date().toISOString()})`)})}),t.once("error",a=>{u=a.message,this.trace("connection failed with error "+u)})})}connect(a,b,c){var d,f;if(this.isShutdown)return Promise.reject();let g=b._getConnectionOptions()||{};if("secureContext"in g){if(g.ALPNProtocols=["h2"],c["grpc.ssl_target_name_override"]){let a=c["grpc.ssl_target_name_override"];g.checkServerIdentity=(b,c)=>(0,e.checkServerIdentity)(a,c),g.servername=a}else if("grpc.http_connect_target"in c){let a=(0,j.getDefaultAuthority)(null!=(d=(0,l.parseUri)(c["grpc.http_connect_target"]))?d:{path:"localhost"}),b=(0,l.splitHostPort)(a);g.servername=null!=(f=null==b?void 0:b.host)?f:a}c["grpc-node.tls_enable_trace"]&&(g.enableTrace=!0)}return(0,h.getProxiedConnection)(a,c,g).then(d=>this.createSession(a,b,c,d))}shutdown(){var a;this.isShutdown=!0,null==(a=this.session)||a.close(),this.session=null}}b.Http2SubchannelConnector=z},56302:(a,b,c)=>{"use strict";let d,e;c.d(b,{H9:()=>e3,BN:()=>fy});let f=function(a){let b=[],c=0;for(let d=0;d<a.length;d++){let e=a.charCodeAt(d);e<128?b[c++]=e:(e<2048?b[c++]=e>>6|192:((64512&e)==55296&&d+1<a.length&&(64512&a.charCodeAt(d+1))==56320?(e=65536+((1023&e)<<10)+(1023&a.charCodeAt(++d)),b[c++]=e>>18|240,b[c++]=e>>12&63|128):b[c++]=e>>12|224,b[c++]=e>>6&63|128),b[c++]=63&e|128)}return b},g=function(a){let b=[],c=0,d=0;for(;c<a.length;){let e=a[c++];if(e<128)b[d++]=String.fromCharCode(e);else if(e>191&&e<224){let f=a[c++];b[d++]=String.fromCharCode((31&e)<<6|63&f)}else if(e>239&&e<365){let f=a[c++],g=((7&e)<<18|(63&f)<<12|(63&a[c++])<<6|63&a[c++])-65536;b[d++]=String.fromCharCode(55296+(g>>10)),b[d++]=String.fromCharCode(56320+(1023&g))}else{let f=a[c++],g=a[c++];b[d++]=String.fromCharCode((15&e)<<12|(63&f)<<6|63&g)}}return b.join("")},h={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(a,b){if(!Array.isArray(a))throw Error("encodeByteArray takes an array as a parameter");this.init_();let c=b?this.byteToCharMapWebSafe_:this.byteToCharMap_,d=[];for(let b=0;b<a.length;b+=3){let e=a[b],f=b+1<a.length,g=f?a[b+1]:0,h=b+2<a.length,i=h?a[b+2]:0,j=e>>2,k=(3&e)<<4|g>>4,l=(15&g)<<2|i>>6,m=63&i;!h&&(m=64,f||(l=64)),d.push(c[j],c[k],c[l],c[m])}return d.join("")},encodeString(a,b){return this.HAS_NATIVE_SUPPORT&&!b?btoa(a):this.encodeByteArray(f(a),b)},decodeString(a,b){return this.HAS_NATIVE_SUPPORT&&!b?atob(a):g(this.decodeStringToByteArray(a,b))},decodeStringToByteArray(a,b){this.init_();let c=b?this.charToByteMapWebSafe_:this.charToByteMap_,d=[];for(let b=0;b<a.length;){let e=c[a.charAt(b++)],f=b<a.length?c[a.charAt(b)]:0,g=++b<a.length?c[a.charAt(b)]:64,h=++b<a.length?c[a.charAt(b)]:64;if(++b,null==e||null==f||null==g||null==h)throw new i;let j=e<<2|f>>4;if(d.push(j),64!==g){let a=f<<4&240|g>>2;if(d.push(a),64!==h){let a=g<<6&192|h;d.push(a)}}}return d},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let a=0;a<this.ENCODED_VALS.length;a++)this.byteToCharMap_[a]=this.ENCODED_VALS.charAt(a),this.charToByteMap_[this.byteToCharMap_[a]]=a,this.byteToCharMapWebSafe_[a]=this.ENCODED_VALS_WEBSAFE.charAt(a),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[a]]=a,a>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(a)]=a,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(a)]=a)}}};class i extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let j=function(a){let b=f(a);return h.encodeByteArray(b,!0)},k=function(a){return j(a).replace(/\./g,"")};class l extends Error{constructor(a,b,c){super(b),this.code=a,this.customData=c,this.name="FirebaseError",Object.setPrototypeOf(this,l.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,m.prototype.create)}}class m{constructor(a,b,c){this.service=a,this.serviceName=b,this.errors=c}create(a,...b){var c,d;let e=b[0]||{},f=`${this.service}/${a}`,g=this.errors[a],h=g?(c=g,d=e,c.replace(n,(a,b)=>{let c=d[b];return null!=c?String(c):`<${b}?>`})):"Error",i=`${this.serviceName}: ${h} (${f}).`;return new l(f,i,e)}}let n=/\{\$([^}]+)}/g;class o{constructor(a,b,c){this.name=a,this.instanceFactory=b,this.type=c,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(a){return this.instantiationMode=a,this}setMultipleInstances(a){return this.multipleInstances=a,this}setServiceProps(a){return this.serviceProps=a,this}setInstanceCreatedCallback(a){return this.onInstanceCreated=a,this}}let p=[];!function(a){a[a.DEBUG=0]="DEBUG",a[a.VERBOSE=1]="VERBOSE",a[a.INFO=2]="INFO",a[a.WARN=3]="WARN",a[a.ERROR=4]="ERROR",a[a.SILENT=5]="SILENT"}(ar||(ar={}));let q={debug:ar.DEBUG,verbose:ar.VERBOSE,info:ar.INFO,warn:ar.WARN,error:ar.ERROR,silent:ar.SILENT},r=ar.INFO,s={[ar.DEBUG]:"log",[ar.VERBOSE]:"log",[ar.INFO]:"info",[ar.WARN]:"warn",[ar.ERROR]:"error"},t=(a,b,...c)=>{if(b<a.logLevel)return;let d=new Date().toISOString(),e=s[b];if(e)console[e](`[${d}]  ${a.name}:`,...c);else throw Error(`Attempted to log a message with an invalid logType (value: ${b})`)};class u{constructor(a){this.name=a,this._logLevel=r,this._logHandler=t,this._userLogHandler=null,p.push(this)}get logLevel(){return this._logLevel}set logLevel(a){if(!(a in ar))throw TypeError(`Invalid value "${a}" assigned to \`logLevel\``);this._logLevel=a}setLogLevel(a){this._logLevel="string"==typeof a?q[a]:a}get logHandler(){return this._logHandler}set logHandler(a){if("function"!=typeof a)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=a}get userLogHandler(){return this._userLogHandler}set userLogHandler(a){this._userLogHandler=a}debug(...a){this._userLogHandler&&this._userLogHandler(this,ar.DEBUG,...a),this._logHandler(this,ar.DEBUG,...a)}log(...a){this._userLogHandler&&this._userLogHandler(this,ar.VERBOSE,...a),this._logHandler(this,ar.VERBOSE,...a)}info(...a){this._userLogHandler&&this._userLogHandler(this,ar.INFO,...a),this._logHandler(this,ar.INFO,...a)}warn(...a){this._userLogHandler&&this._userLogHandler(this,ar.WARN,...a),this._logHandler(this,ar.WARN,...a)}error(...a){this._userLogHandler&&this._userLogHandler(this,ar.ERROR,...a),this._logHandler(this,ar.ERROR,...a)}}let v=new WeakMap,w=new WeakMap,x=new WeakMap,y=new WeakMap,z=new WeakMap,A={get(a,b,c){if(a instanceof IDBTransaction){if("done"===b)return w.get(a);if("objectStoreNames"===b)return a.objectStoreNames||x.get(a);if("store"===b)return c.objectStoreNames[1]?void 0:c.objectStore(c.objectStoreNames[0])}return B(a[b])},set:(a,b,c)=>(a[b]=c,!0),has:(a,b)=>a instanceof IDBTransaction&&("done"===b||"store"===b)||b in a};function B(a){if(a instanceof IDBRequest){let b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("success",e),a.removeEventListener("error",f)},e=()=>{b(B(a.result)),d()},f=()=>{c(a.error),d()};a.addEventListener("success",e),a.addEventListener("error",f)});return b.then(b=>{b instanceof IDBCursor&&v.set(b,a)}).catch(()=>{}),z.set(b,a),b}if(y.has(a))return y.get(a);let b=function(a){if("function"==typeof a)return a!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(e||(e=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(a)?function(...b){return a.apply(C(this),b),B(v.get(this))}:function(...b){return B(a.apply(C(this),b))}:function(b,...c){let d=a.call(C(this),b,...c);return x.set(d,b.sort?b.sort():[b]),B(d)};return a instanceof IDBTransaction&&function(a){if(w.has(a))return;let b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("complete",e),a.removeEventListener("error",f),a.removeEventListener("abort",f)},e=()=>{b(),d()},f=()=>{c(a.error||new DOMException("AbortError","AbortError")),d()};a.addEventListener("complete",e),a.addEventListener("error",f),a.addEventListener("abort",f)});w.set(a,b)}(a),(d||(d=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(b=>a instanceof b)?new Proxy(a,A):a}(a);return b!==a&&(y.set(a,b),z.set(b,a)),b}let C=a=>z.get(a),D=["get","getKey","getAll","getAllKeys","count"],E=["put","add","delete","clear"],F=new Map;function G(a,b){if(!(a instanceof IDBDatabase&&!(b in a)&&"string"==typeof b))return;if(F.get(b))return F.get(b);let c=b.replace(/FromIndex$/,""),d=b!==c,e=E.includes(c);if(!(c in(d?IDBIndex:IDBObjectStore).prototype)||!(e||D.includes(c)))return;let f=async function(a,...b){let f=this.transaction(a,e?"readwrite":"readonly"),g=f.store;return d&&(g=g.index(b.shift())),(await Promise.all([g[c](...b),e&&f.done]))[0]};return F.set(b,f),f}A=(a=>({...a,get:(b,c,d)=>G(b,c)||a.get(b,c,d),has:(b,c)=>!!G(b,c)||a.has(b,c)}))(A);class H{constructor(a){this.container=a}getPlatformInfoString(){return this.container.getProviders().map(a=>{if(!function(a){let b=a.getComponent();return b?.type==="VERSION"}(a))return null;{let b=a.getImmediate();return`${b.library}/${b.version}`}}).filter(a=>a).join(" ")}}let I="@firebase/app",J="0.14.3",K=new u("@firebase/app"),L={[I]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},M=new Map,N=new Map,O=new Map;function P(a,b){try{a.container.addComponent(b)}catch(c){K.debug(`Component ${b.name} failed to register with FirebaseApp ${a.name}`,c)}}function Q(a){let b=a.name;if(O.has(b))return K.debug(`There were multiple attempts to register component ${b}.`),!1;for(let c of(O.set(b,a),M.values()))P(c,a);for(let b of N.values())P(b,a);return!0}let R=new m("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});function S(a,b,c){let d=L[a]??a;c&&(d+=`-${c}`);let e=d.match(/\s|\//),f=b.match(/\s|\//);if(e||f){let a=[`Unable to register library "${d}" with version "${b}":`];e&&a.push(`library name "${d}" contains illegal characters (whitespace or "/")`),e&&f&&a.push("and"),f&&a.push(`version name "${b}" contains illegal characters (whitespace or "/")`),K.warn(a.join(" "));return}Q(new o(`${d}-version`,()=>({library:d,version:b}),"VERSION"))}let T="firebase-heartbeat-store",U=null;function V(){return U||(U=(function(a,b,{blocked:c,upgrade:d,blocking:e,terminated:f}={}){let g=indexedDB.open(a,1),h=B(g);return d&&g.addEventListener("upgradeneeded",a=>{d(B(g.result),a.oldVersion,a.newVersion,B(g.transaction),a)}),c&&g.addEventListener("blocked",a=>c(a.oldVersion,a.newVersion,a)),h.then(a=>{f&&a.addEventListener("close",()=>f()),e&&a.addEventListener("versionchange",a=>e(a.oldVersion,a.newVersion,a))}).catch(()=>{}),h})("firebase-heartbeat-database",0,{upgrade:(a,b)=>{if(0===b)try{a.createObjectStore(T)}catch(a){console.warn(a)}}}).catch(a=>{throw R.create("idb-open",{originalErrorMessage:a.message})})),U}async function W(a){try{let b=(await V()).transaction(T),c=await b.objectStore(T).get(Y(a));return await b.done,c}catch(a){if(a instanceof l)K.warn(a.message);else{let b=R.create("idb-get",{originalErrorMessage:a?.message});K.warn(b.message)}}}async function X(a,b){try{let c=(await V()).transaction(T,"readwrite"),d=c.objectStore(T);await d.put(b,Y(a)),await c.done}catch(a){if(a instanceof l)K.warn(a.message);else{let b=R.create("idb-set",{originalErrorMessage:a?.message});K.warn(b.message)}}}function Y(a){return`${a.name}!${a.options.appId}`}class Z{constructor(a){this.container=a,this._heartbeatsCache=null;let b=this.container.getProvider("app").getImmediate();this._storage=new _(b),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){try{let a=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),b=$();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===b||this._heartbeatsCache.heartbeats.some(a=>a.date===b))return;if(this._heartbeatsCache.heartbeats.push({date:b,agent:a}),this._heartbeatsCache.heartbeats.length>30){let a=function(a){if(0===a.length)return -1;let b=0,c=a[0].date;for(let d=1;d<a.length;d++)a[d].date<c&&(c=a[d].date,b=d);return b}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){K.warn(a)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let a=$(),{heartbeatsToSend:b,unsentEntries:c}=function(a,b=1024){let c=[],d=a.slice();for(let e of a){let a=c.find(a=>a.agent===e.agent);if(a){if(a.dates.push(e.date),aa(c)>b){a.dates.pop();break}}else if(c.push({agent:e.agent,dates:[e.date]}),aa(c)>b){c.pop();break}d=d.slice(1)}return{heartbeatsToSend:c,unsentEntries:d}}(this._heartbeatsCache.heartbeats),d=k(JSON.stringify({version:2,heartbeats:b}));return this._heartbeatsCache.lastSentHeartbeatDate=a,c.length>0?(this._heartbeatsCache.heartbeats=c,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(a){return K.warn(a),""}}}function $(){return new Date().toISOString().substring(0,10)}class _{constructor(a){this.app=a,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(a){return!1}}()&&new Promise((a,b)=>{try{let c=!0,d="validate-browser-context-for-indexeddb-analytics-module",e=self.indexedDB.open(d);e.onsuccess=()=>{e.result.close(),c||self.indexedDB.deleteDatabase(d),a(!0)},e.onupgradeneeded=()=>{c=!1},e.onerror=()=>{b(e.error?.message||"")}}catch(a){b(a)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let a=await W(this.app);return a?.heartbeats?a:{heartbeats:[]}}}async overwrite(a){if(await this._canUseIndexedDBPromise){let b=await this.read();return X(this.app,{lastSentHeartbeatDate:a.lastSentHeartbeatDate??b.lastSentHeartbeatDate,heartbeats:a.heartbeats})}}async add(a){if(await this._canUseIndexedDBPromise){let b=await this.read();return X(this.app,{lastSentHeartbeatDate:a.lastSentHeartbeatDate??b.lastSentHeartbeatDate,heartbeats:[...b.heartbeats,...a.heartbeats]})}}}function aa(a){return k(JSON.stringify({version:2,heartbeats:a})).length}Q(new o("platform-logger",a=>new H(a),"PRIVATE")),Q(new o("heartbeat",a=>new Z(a),"PRIVATE")),S(I,J,""),S(I,J,"esm2020"),S("fire-js","");let ab=function(a){let b=[],c=0;for(let d=0;d<a.length;d++){let e=a.charCodeAt(d);e<128?b[c++]=e:(e<2048?b[c++]=e>>6|192:((64512&e)==55296&&d+1<a.length&&(64512&a.charCodeAt(d+1))==56320?(e=65536+((1023&e)<<10)+(1023&a.charCodeAt(++d)),b[c++]=e>>18|240,b[c++]=e>>12&63|128):b[c++]=e>>12|224,b[c++]=e>>6&63|128),b[c++]=63&e|128)}return b},ac=function(a){let b=[],c=0,d=0;for(;c<a.length;){let e=a[c++];if(e<128)b[d++]=String.fromCharCode(e);else if(e>191&&e<224){let f=a[c++];b[d++]=String.fromCharCode((31&e)<<6|63&f)}else if(e>239&&e<365){let f=a[c++],g=((7&e)<<18|(63&f)<<12|(63&a[c++])<<6|63&a[c++])-65536;b[d++]=String.fromCharCode(55296+(g>>10)),b[d++]=String.fromCharCode(56320+(1023&g))}else{let f=a[c++],g=a[c++];b[d++]=String.fromCharCode((15&e)<<12|(63&f)<<6|63&g)}}return b.join("")},ad={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(a,b){if(!Array.isArray(a))throw Error("encodeByteArray takes an array as a parameter");this.init_();let c=b?this.byteToCharMapWebSafe_:this.byteToCharMap_,d=[];for(let b=0;b<a.length;b+=3){let e=a[b],f=b+1<a.length,g=f?a[b+1]:0,h=b+2<a.length,i=h?a[b+2]:0,j=e>>2,k=(3&e)<<4|g>>4,l=(15&g)<<2|i>>6,m=63&i;!h&&(m=64,f||(l=64)),d.push(c[j],c[k],c[l],c[m])}return d.join("")},encodeString(a,b){return this.HAS_NATIVE_SUPPORT&&!b?btoa(a):this.encodeByteArray(ab(a),b)},decodeString(a,b){return this.HAS_NATIVE_SUPPORT&&!b?atob(a):ac(this.decodeStringToByteArray(a,b))},decodeStringToByteArray(a,b){this.init_();let c=b?this.charToByteMapWebSafe_:this.charToByteMap_,d=[];for(let b=0;b<a.length;){let e=c[a.charAt(b++)],f=b<a.length?c[a.charAt(b)]:0,g=++b<a.length?c[a.charAt(b)]:64,h=++b<a.length?c[a.charAt(b)]:64;if(++b,null==e||null==f||null==g||null==h)throw new ae;let i=e<<2|f>>4;if(d.push(i),64!==g){let a=f<<4&240|g>>2;if(d.push(a),64!==h){let a=g<<6&192|h;d.push(a)}}}return d},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let a=0;a<this.ENCODED_VALS.length;a++)this.byteToCharMap_[a]=this.ENCODED_VALS.charAt(a),this.charToByteMap_[this.byteToCharMap_[a]]=a,this.byteToCharMapWebSafe_[a]=this.ENCODED_VALS_WEBSAFE.charAt(a),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[a]]=a,a>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(a)]=a,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(a)]=a)}}};class ae extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let af=function(a){try{return ad.decodeString(a,!0)}catch(a){console.error("base64Decode failed: ",a)}return null};class ag extends Error{constructor(a,b,c){super(b),this.code=a,this.customData=c,this.name="FirebaseError",Object.setPrototypeOf(this,ag.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ah.prototype.create)}}class ah{constructor(a,b,c){this.service=a,this.serviceName=b,this.errors=c}create(a,...b){var c,d;let e=b[0]||{},f=`${this.service}/${a}`,g=this.errors[a],h=g?(c=g,d=e,c.replace(ai,(a,b)=>{let c=d[b];return null!=c?String(c):`<${b}?>`})):"Error",i=`${this.serviceName}: ${h} (${f}).`;return new ag(f,i,e)}}let ai=/\{\$([^}]+)}/g;function aj(a){return a&&a._delegate?a._delegate:a}class ak{constructor(a,b,c){this.name=a,this.instanceFactory=b,this.type=c,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(a){return this.instantiationMode=a,this}setMultipleInstances(a){return this.multipleInstances=a,this}setServiceProps(a){return this.serviceProps=a,this}setInstanceCreatedCallback(a){return this.onInstanceCreated=a,this}}let al=[];!function(a){a[a.DEBUG=0]="DEBUG",a[a.VERBOSE=1]="VERBOSE",a[a.INFO=2]="INFO",a[a.WARN=3]="WARN",a[a.ERROR=4]="ERROR",a[a.SILENT=5]="SILENT"}(as||(as={}));let am={debug:as.DEBUG,verbose:as.VERBOSE,info:as.INFO,warn:as.WARN,error:as.ERROR,silent:as.SILENT},an=as.INFO,ao={[as.DEBUG]:"log",[as.VERBOSE]:"log",[as.INFO]:"info",[as.WARN]:"warn",[as.ERROR]:"error"},ap=(a,b,...c)=>{if(b<a.logLevel)return;let d=new Date().toISOString(),e=ao[b];if(e)console[e](`[${d}]  ${a.name}:`,...c);else throw Error(`Attempted to log a message with an invalid logType (value: ${b})`)};class aq{constructor(a){this.name=a,this._logLevel=an,this._logHandler=ap,this._userLogHandler=null,al.push(this)}get logLevel(){return this._logLevel}set logLevel(a){if(!(a in as))throw TypeError(`Invalid value "${a}" assigned to \`logLevel\``);this._logLevel=a}setLogLevel(a){this._logLevel="string"==typeof a?am[a]:a}get logHandler(){return this._logHandler}set logHandler(a){if("function"!=typeof a)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=a}get userLogHandler(){return this._userLogHandler}set userLogHandler(a){this._userLogHandler=a}debug(...a){this._userLogHandler&&this._userLogHandler(this,as.DEBUG,...a),this._logHandler(this,as.DEBUG,...a)}log(...a){this._userLogHandler&&this._userLogHandler(this,as.VERBOSE,...a),this._logHandler(this,as.VERBOSE,...a)}info(...a){this._userLogHandler&&this._userLogHandler(this,as.INFO,...a),this._logHandler(this,as.INFO,...a)}warn(...a){this._userLogHandler&&this._userLogHandler(this,as.WARN,...a),this._logHandler(this,as.WARN,...a)}error(...a){this._userLogHandler&&this._userLogHandler(this,as.ERROR,...a),this._logHandler(this,as.ERROR,...a)}}var ar,as,at,au,av,aw=c(28354),ax="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ay={};(function(){function a(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}var b=function(){this.blockSize=-1};function c(){}function d(a,b,c){c||(c=0);let d=Array(16);if("string"==typeof b)for(var e=0;e<16;++e)d[e]=b.charCodeAt(c++)|b.charCodeAt(c++)<<8|b.charCodeAt(c++)<<16|b.charCodeAt(c++)<<24;else for(e=0;e<16;++e)d[e]=b[c++]|b[c++]<<8|b[c++]<<16|b[c++]<<24;b=a.g[0],c=a.g[1],e=a.g[2];let f=a.g[3],g;g=b+(f^c&(e^f))+d[0]+0xd76aa478|0,g=f+(e^(b=c+(g<<7|g>>>25))&(c^e))+d[1]+0xe8c7b756|0,g=e+(c^(f=b+(g<<12|g>>>20))&(b^c))+d[2]+0x242070db|0,g=c+(b^(e=f+(g<<17|g>>>15))&(f^b))+d[3]+0xc1bdceee|0,g=b+(f^(c=e+(g<<22|g>>>10))&(e^f))+d[4]+0xf57c0faf|0,g=f+(e^(b=c+(g<<7|g>>>25))&(c^e))+d[5]+0x4787c62a|0,g=e+(c^(f=b+(g<<12|g>>>20))&(b^c))+d[6]+0xa8304613|0,g=c+(b^(e=f+(g<<17|g>>>15))&(f^b))+d[7]+0xfd469501|0,g=b+(f^(c=e+(g<<22|g>>>10))&(e^f))+d[8]+0x698098d8|0,g=f+(e^(b=c+(g<<7|g>>>25))&(c^e))+d[9]+0x8b44f7af|0,g=e+(c^(f=b+(g<<12|g>>>20))&(b^c))+d[10]+0xffff5bb1|0,g=c+(b^(e=f+(g<<17|g>>>15))&(f^b))+d[11]+0x895cd7be|0,g=b+(f^(c=e+(g<<22|g>>>10))&(e^f))+d[12]+0x6b901122|0,g=f+(e^(b=c+(g<<7|g>>>25))&(c^e))+d[13]+0xfd987193|0,g=e+(c^(f=b+(g<<12|g>>>20))&(b^c))+d[14]+0xa679438e|0,g=c+(b^(e=f+(g<<17|g>>>15))&(f^b))+d[15]+0x49b40821|0,c=e+(g<<22|g>>>10),g=b+(e^f&(c^e))+d[1]+0xf61e2562|0,b=c+(g<<5|g>>>27),g=f+(c^e&(b^c))+d[6]+0xc040b340|0,f=b+(g<<9|g>>>23),g=e+(b^c&(f^b))+d[11]+0x265e5a51|0,e=f+(g<<14|g>>>18),g=c+(f^b&(e^f))+d[0]+0xe9b6c7aa|0,c=e+(g<<20|g>>>12),g=b+(e^f&(c^e))+d[5]+0xd62f105d|0,b=c+(g<<5|g>>>27),g=f+(c^e&(b^c))+d[10]+0x2441453|0,f=b+(g<<9|g>>>23),g=e+(b^c&(f^b))+d[15]+0xd8a1e681|0,e=f+(g<<14|g>>>18),g=c+(f^b&(e^f))+d[4]+0xe7d3fbc8|0,c=e+(g<<20|g>>>12),g=b+(e^f&(c^e))+d[9]+0x21e1cde6|0,b=c+(g<<5|g>>>27),g=f+(c^e&(b^c))+d[14]+0xc33707d6|0,f=b+(g<<9|g>>>23),g=e+(b^c&(f^b))+d[3]+0xf4d50d87|0,e=f+(g<<14|g>>>18),g=c+(f^b&(e^f))+d[8]+0x455a14ed|0,c=e+(g<<20|g>>>12),g=b+(e^f&(c^e))+d[13]+0xa9e3e905|0,b=c+(g<<5|g>>>27),g=f+(c^e&(b^c))+d[2]+0xfcefa3f8|0,f=b+(g<<9|g>>>23),g=e+(b^c&(f^b))+d[7]+0x676f02d9|0,e=f+(g<<14|g>>>18),g=c+(f^b&(e^f))+d[12]+0x8d2a4c8a|0,g=b+((c=e+(g<<20|g>>>12))^e^f)+d[5]+0xfffa3942|0,g=f+((b=c+(g<<4|g>>>28))^c^e)+d[8]+0x8771f681|0,g=e+((f=b+(g<<11|g>>>21))^b^c)+d[11]+0x6d9d6122|0,g=c+((e=f+(g<<16|g>>>16))^f^b)+d[14]+0xfde5380c|0,g=b+((c=e+(g<<23|g>>>9))^e^f)+d[1]+0xa4beea44|0,g=f+((b=c+(g<<4|g>>>28))^c^e)+d[4]+0x4bdecfa9|0,g=e+((f=b+(g<<11|g>>>21))^b^c)+d[7]+0xf6bb4b60|0,g=c+((e=f+(g<<16|g>>>16))^f^b)+d[10]+0xbebfbc70|0,g=b+((c=e+(g<<23|g>>>9))^e^f)+d[13]+0x289b7ec6|0,g=f+((b=c+(g<<4|g>>>28))^c^e)+d[0]+0xeaa127fa|0,g=e+((f=b+(g<<11|g>>>21))^b^c)+d[3]+0xd4ef3085|0,g=c+((e=f+(g<<16|g>>>16))^f^b)+d[6]+0x4881d05|0,g=b+((c=e+(g<<23|g>>>9))^e^f)+d[9]+0xd9d4d039|0,g=f+((b=c+(g<<4|g>>>28))^c^e)+d[12]+0xe6db99e5|0,g=e+((f=b+(g<<11|g>>>21))^b^c)+d[15]+0x1fa27cf8|0,g=c+((e=f+(g<<16|g>>>16))^f^b)+d[2]+0xc4ac5665|0,c=e+(g<<23|g>>>9),g=b+(e^(c|~f))+d[0]+0xf4292244|0,b=c+(g<<6|g>>>26),g=f+(c^(b|~e))+d[7]+0x432aff97|0,f=b+(g<<10|g>>>22),g=e+(b^(f|~c))+d[14]+0xab9423a7|0,e=f+(g<<15|g>>>17),g=c+(f^(e|~b))+d[5]+0xfc93a039|0,c=e+(g<<21|g>>>11),g=b+(e^(c|~f))+d[12]+0x655b59c3|0,b=c+(g<<6|g>>>26),g=f+(c^(b|~e))+d[3]+0x8f0ccc92|0,f=b+(g<<10|g>>>22),g=e+(b^(f|~c))+d[10]+0xffeff47d|0,e=f+(g<<15|g>>>17),g=c+(f^(e|~b))+d[1]+0x85845dd1|0,c=e+(g<<21|g>>>11),g=b+(e^(c|~f))+d[8]+0x6fa87e4f|0,b=c+(g<<6|g>>>26),g=f+(c^(b|~e))+d[15]+0xfe2ce6e0|0,f=b+(g<<10|g>>>22),g=e+(b^(f|~c))+d[6]+0xa3014314|0,e=f+(g<<15|g>>>17),g=c+(f^(e|~b))+d[13]+0x4e0811a1|0,c=e+(g<<21|g>>>11),g=b+(e^(c|~f))+d[4]+0xf7537e82|0,b=c+(g<<6|g>>>26),g=f+(c^(b|~e))+d[11]+0xbd3af235|0,f=b+(g<<10|g>>>22),g=e+(b^(f|~c))+d[2]+0x2ad7d2bb|0,e=f+(g<<15|g>>>17),g=c+(f^(e|~b))+d[9]+0xeb86d391|0,a.g[0]=a.g[0]+b|0,a.g[1]=a.g[1]+(e+(g<<21|g>>>11))|0,a.g[2]=a.g[2]+e|0,a.g[3]=a.g[3]+f|0}function e(a,b){this.h=b;let c=[],d=!0;for(let e=a.length-1;e>=0;e--){let f=0|a[e];d&&f==b||(c[e]=f,d=!1)}this.g=c}c.prototype=b.prototype,a.F=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.D=function(a,c,d){for(var e=Array(arguments.length-2),f=2;f<arguments.length;f++)e[f-2]=arguments[f];return b.prototype[c].apply(a,e)},a.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},a.prototype.v=function(a,b){void 0===b&&(b=a.length);let c=b-this.blockSize,e=this.C,f=this.h,g=0;for(;g<b;){if(0==f)for(;g<=c;)d(this,a,g),g+=this.blockSize;if("string"==typeof a){for(;g<b;)if(e[f++]=a.charCodeAt(g++),f==this.blockSize){d(this,e),f=0;break}}else for(;g<b;)if(e[f++]=a[g++],f==this.blockSize){d(this,e),f=0;break}}this.h=f,this.o+=b},a.prototype.A=function(){var a=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);a[0]=128;for(var b=1;b<a.length-8;++b)a[b]=0;b=8*this.o;for(var c=a.length-8;c<a.length;++c)a[c]=255&b,b/=256;for(this.v(a),a=Array(16),b=0,c=0;c<4;++c)for(let d=0;d<32;d+=8)a[b++]=this.g[c]>>>d&255;return a};var f,g={};function h(a){var b;return -128<=a&&a<128?(b=function(a){return new e([0|a],a<0?-1:0)},Object.prototype.hasOwnProperty.call(g,a)?g[a]:g[a]=b(a)):new e([0|a],a<0?-1:0)}function i(a){if(isNaN(a)||!isFinite(a))return j;if(a<0)return o(i(-a));let b=[],c=1;for(let d=0;a>=c;d++)b[d]=a/c|0,c*=0x100000000;return new e(b,0)}var j=h(0),k=h(1),l=h(0x1000000);function m(a){if(0!=a.h)return!1;for(let b=0;b<a.g.length;b++)if(0!=a.g[b])return!1;return!0}function n(a){return -1==a.h}function o(a){let b=a.g.length,c=[];for(let d=0;d<b;d++)c[d]=~a.g[d];return new e(c,~a.h).add(k)}function p(a,b){return a.add(o(b))}function q(a,b){for(;(65535&a[b])!=a[b];)a[b+1]+=a[b]>>>16,a[b]&=65535,b++}function r(a,b){this.g=a,this.h=b}function s(a,b){if(m(b))throw Error("division by zero");if(m(a))return new r(j,j);if(n(a))return b=s(o(a),b),new r(o(b.g),o(b.h));if(n(b))return b=s(a,o(b)),new r(o(b.g),b.h);if(a.g.length>30){if(n(a)||n(b))throw Error("slowDivide_ only works with positive integers.");for(var c=k,d=b;0>=d.l(a);)c=t(c),d=t(d);var e=u(c,1),f=u(d,1);for(d=u(d,2),c=u(c,2);!m(d);){var g=f.add(d);0>=g.l(a)&&(e=e.add(c),f=g),d=u(d,1),c=u(c,1)}return b=p(a,e.j(b)),new r(e,b)}for(e=j;a.l(b)>=0;){for(d=(d=Math.ceil(Math.log(c=Math.max(1,Math.floor(a.m()/b.m())))/Math.LN2))<=48?1:Math.pow(2,d-48),g=(f=i(c)).j(b);n(g)||g.l(a)>0;)c-=d,g=(f=i(c)).j(b);m(f)&&(f=k),e=e.add(f),a=p(a,g)}return new r(e,a)}function t(a){let b=a.g.length+1,c=[];for(let d=0;d<b;d++)c[d]=a.i(d)<<1|a.i(d-1)>>>31;return new e(c,a.h)}function u(a,b){let c=b>>5;b%=32;let d=a.g.length-c,f=[];for(let e=0;e<d;e++)f[e]=b>0?a.i(e+c)>>>b|a.i(e+c+1)<<32-b:a.i(e+c);return new e(f,a.h)}(f=e.prototype).m=function(){if(n(this))return-o(this).m();let a=0,b=1;for(let c=0;c<this.g.length;c++){let d=this.i(c);a+=(d>=0?d:0x100000000+d)*b,b*=0x100000000}return a},f.toString=function(a){if((a=a||10)<2||36<a)throw Error("radix out of range: "+a);if(m(this))return"0";if(n(this))return"-"+o(this).toString(a);let b=i(Math.pow(a,6));var c=this;let d="";for(;;){let e=s(c,b).g,f=(((c=p(c,e.j(b))).g.length>0?c.g[0]:c.h)>>>0).toString(a);if(m(c=e))return f+d;for(;f.length<6;)f="0"+f;d=f+d}},f.i=function(a){return a<0?0:a<this.g.length?this.g[a]:this.h},f.l=function(a){return n(a=p(this,a))?-1:+!m(a)},f.abs=function(){return n(this)?o(this):this},f.add=function(a){let b=Math.max(this.g.length,a.g.length),c=[],d=0;for(let e=0;e<=b;e++){let b=d+(65535&this.i(e))+(65535&a.i(e)),f=(b>>>16)+(this.i(e)>>>16)+(a.i(e)>>>16);d=f>>>16,b&=65535,f&=65535,c[e]=f<<16|b}return new e(c,-0x80000000&c[c.length-1]?-1:0)},f.j=function(a){if(m(this)||m(a))return j;if(n(this))return n(a)?o(this).j(o(a)):o(o(this).j(a));if(n(a))return o(this.j(o(a)));if(0>this.l(l)&&0>a.l(l))return i(this.m()*a.m());let b=this.g.length+a.g.length,c=[];for(var d=0;d<2*b;d++)c[d]=0;for(d=0;d<this.g.length;d++)for(let b=0;b<a.g.length;b++){let e=this.i(d)>>>16,f=65535&this.i(d),g=a.i(b)>>>16,h=65535&a.i(b);c[2*d+2*b]+=f*h,q(c,2*d+2*b),c[2*d+2*b+1]+=e*h,q(c,2*d+2*b+1),c[2*d+2*b+1]+=f*g,q(c,2*d+2*b+1),c[2*d+2*b+2]+=e*g,q(c,2*d+2*b+2)}for(a=0;a<b;a++)c[a]=c[2*a+1]<<16|c[2*a];for(a=b;a<2*b;a++)c[a]=0;return new e(c,0)},f.B=function(a){return s(this,a).h},f.and=function(a){let b=Math.max(this.g.length,a.g.length),c=[];for(let d=0;d<b;d++)c[d]=this.i(d)&a.i(d);return new e(c,this.h&a.h)},f.or=function(a){let b=Math.max(this.g.length,a.g.length),c=[];for(let d=0;d<b;d++)c[d]=this.i(d)|a.i(d);return new e(c,this.h|a.h)},f.xor=function(a){let b=Math.max(this.g.length,a.g.length),c=[];for(let d=0;d<b;d++)c[d]=this.i(d)^a.i(d);return new e(c,this.h^a.h)},a.prototype.digest=a.prototype.A,a.prototype.reset=a.prototype.u,a.prototype.update=a.prototype.v,ay.Md5=a,e.prototype.add=e.prototype.add,e.prototype.multiply=e.prototype.j,e.prototype.modulo=e.prototype.B,e.prototype.compare=e.prototype.l,e.prototype.toNumber=e.prototype.m,e.prototype.toString=e.prototype.toString,e.prototype.getBits=e.prototype.i,e.fromNumber=i,e.fromString=function a(b,c){if(0==b.length)throw Error("number format error: empty string");if((c=c||10)<2||36<c)throw Error("radix out of range: "+c);if("-"==b.charAt(0))return o(a(b.substring(1),c));if(b.indexOf("-")>=0)throw Error('number format error: interior "-" character');let d=i(Math.pow(c,8)),e=j;for(let a=0;a<b.length;a+=8){var f=Math.min(8,b.length-a);let g=parseInt(b.substring(a,a+f),c);f<8?(f=i(Math.pow(c,f)),e=e.j(f).add(i(g))):e=(e=e.j(d)).add(i(g))}return e},at=ay.Integer=e}).apply(void 0!==ax?ax:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var az=c(55511),aA=c(73652),aB=c(26223);let aC="@firebase/firestore",aD="4.9.2";class aE{constructor(a){this.uid=a}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(a){return a.uid===this.uid}}aE.UNAUTHENTICATED=new aE(null),aE.GOOGLE_CREDENTIALS=new aE("google-credentials-uid"),aE.FIRST_PARTY=new aE("first-party-uid"),aE.MOCK_USER=new aE("mock-user");let aF="12.3.0",aG=new aq("@firebase/firestore");function aH(){return aG.logLevel}function aI(a,...b){if(aG.logLevel<=as.DEBUG){let c=b.map(aL);aG.debug(`Firestore (${aF}): ${a}`,...c)}}function aJ(a,...b){if(aG.logLevel<=as.ERROR){let c=b.map(aL);aG.error(`Firestore (${aF}): ${a}`,...c)}}function aK(a,...b){if(aG.logLevel<=as.WARN){let c=b.map(aL);aG.warn(`Firestore (${aF}): ${a}`,...c)}}function aL(a){if("string"==typeof a)return a;try{return(0,aw.inspect)(a,{depth:100})}catch(b){return a}}function aM(a,b,c){let d="Unexpected state";"string"==typeof b?d=b:c=b,aN(a,d,c)}function aN(a,b,c){let d=`FIRESTORE (${aF}) INTERNAL ASSERTION FAILED: ${b} (ID: ${a.toString(16)})`;if(void 0!==c)try{let a=JSON.stringify(c);d+=" CONTEXT: "+a}catch(a){d+=" CONTEXT: "+c}throw aJ(d),Error(d)}function aO(a,b,c,d){let e="Unexpected state";"string"==typeof c?e=c:d=c,a||aN(b,e,d)}let aP={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class aQ extends ag{constructor(a,b){super(a,b),this.code=a,this.message=b,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class aR{constructor(){this.promise=new Promise((a,b)=>{this.resolve=a,this.reject=b})}}class aS{constructor(a,b){this.user=b,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${a}`)}}class aT{getToken(){return Promise.resolve(null)}invalidateToken(){}start(a,b){a.enqueueRetryable(()=>b(aE.UNAUTHENTICATED))}shutdown(){}}class aU{constructor(a){this.authProvider=a,this.currentUser=aE.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(a,b){aO(void 0===this.tokenListener,42304);let c=this.tokenCounter,d=a=>this.tokenCounter!==c?(c=this.tokenCounter,b(a)):Promise.resolve(),e=new aR;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),e.resolve(),e=new aR,a.enqueueRetryable(()=>d(this.currentUser))};let f=()=>{let b=e;a.enqueueRetryable(async()=>{await b.promise,await d(this.currentUser)})},g=a=>{aI("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=a,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),f())};this.authProvider.onInit(a=>g(a)),setTimeout(()=>{if(!this.auth){let a=this.authProvider.getImmediate({optional:!0});a?g(a):(aI("FirebaseAuthCredentialsProvider","Auth not yet detected"),e.resolve(),e=new aR)}},0),f()}getToken(){let a=this.tokenCounter,b=this.forceRefresh;return(this.forceRefresh=!1,this.auth)?this.auth.getToken(b).then(b=>this.tokenCounter!==a?(aI("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):b?(aO("string"==typeof b.accessToken,31837,{tokenData:b}),new aS(b.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let a=this.auth&&this.auth.getUid();return aO(null===a||"string"==typeof a,2055,{currentUid:a}),new aE(a)}}class aV{constructor(a,b,c){this.sessionIndex=a,this.iamToken=b,this.authTokenFactory=c,this.type="FirstParty",this.user=aE.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let a=this.getAuthToken();return a&&this._headers.set("Authorization",a),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}}class aW{constructor(a,b,c){this.sessionIndex=a,this.iamToken=b,this.authTokenFactory=c}getToken(){return Promise.resolve(new aV(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(a,b){a.enqueueRetryable(()=>b(aE.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class aX{constructor(a){this.value=a,this.type="AppCheck",this.headers=new Map,a&&a.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class aY{constructor(a,b){this.appCheckProvider=b,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null,this.serverAppAppCheckToken=null,function(a){return null!=a&&void 0!==a.settings}(a)&&a.settings.appCheckToken&&(this.serverAppAppCheckToken=a.settings.appCheckToken)}start(a,b){aO(void 0===this.tokenListener,3512);let c=a=>{null!=a.error&&aI("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${a.error.message}`);let c=a.token!==this.latestAppCheckToken;return this.latestAppCheckToken=a.token,aI("FirebaseAppCheckTokenProvider",`Received ${c?"new":"existing"} token.`),c?b(a.token):Promise.resolve()};this.tokenListener=b=>{a.enqueueRetryable(()=>c(b))};let d=a=>{aI("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(a=>d(a)),setTimeout(()=>{if(!this.appCheck){let a=this.appCheckProvider.getImmediate({optional:!0});a?d(a):aI("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.serverAppAppCheckToken)return Promise.resolve(new aX(this.serverAppAppCheckToken));let a=this.forceRefresh;return(this.forceRefresh=!1,this.appCheck)?this.appCheck.getToken(a).then(a=>a?(aO("string"==typeof a.token,44558,{tokenResult:a}),this.latestAppCheckToken=a.token,new aX(a.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}}class aZ{static newId(){let a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",b=Math.floor(256/a.length)*a.length,c="";for(;c.length<20;){let d=(0,az.randomBytes)(40);for(let e=0;e<d.length;++e)c.length<20&&d[e]<b&&(c+=a.charAt(d[e]%a.length))}return c}}function a$(a,b){return a<b?-1:+(a>b)}function a_(a,b){let c=Math.min(a.length,b.length);for(let d=0;d<c;d++){let c=a.charAt(d),e=b.charAt(d);if(c!==e)return a0(c)===a0(e)?a$(c,e):a0(c)?1:-1}return a$(a.length,b.length)}function a0(a){let b=a.charCodeAt(0);return b>=55296&&b<=57343}function a1(a,b,c){return a.length===b.length&&a.every((a,d)=>c(a,b[d]))}let a2="__name__";class a3{constructor(a,b,c){void 0===b?b=0:b>a.length&&aM(637,{offset:b,range:a.length}),void 0===c?c=a.length-b:c>a.length-b&&aM(1746,{length:c,range:a.length-b}),this.segments=a,this.offset=b,this.len=c}get length(){return this.len}isEqual(a){return 0===a3.comparator(this,a)}child(a){let b=this.segments.slice(this.offset,this.limit());return a instanceof a3?a.forEach(a=>{b.push(a)}):b.push(a),this.construct(b)}limit(){return this.offset+this.length}popFirst(a){return a=void 0===a?1:a,this.construct(this.segments,this.offset+a,this.length-a)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(a){return this.segments[this.offset+a]}isEmpty(){return 0===this.length}isPrefixOf(a){if(a.length<this.length)return!1;for(let b=0;b<this.length;b++)if(this.get(b)!==a.get(b))return!1;return!0}isImmediateParentOf(a){if(this.length+1!==a.length)return!1;for(let b=0;b<this.length;b++)if(this.get(b)!==a.get(b))return!1;return!0}forEach(a){for(let b=this.offset,c=this.limit();b<c;b++)a(this.segments[b])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(a,b){let c=Math.min(a.length,b.length);for(let d=0;d<c;d++){let c=a3.compareSegments(a.get(d),b.get(d));if(0!==c)return c}return a$(a.length,b.length)}static compareSegments(a,b){let c=a3.isNumericId(a),d=a3.isNumericId(b);return c&&!d?-1:!c&&d?1:c&&d?a3.extractNumericId(a).compare(a3.extractNumericId(b)):a_(a,b)}static isNumericId(a){return a.startsWith("__id")&&a.endsWith("__")}static extractNumericId(a){return at.fromString(a.substring(4,a.length-2))}}class a4 extends a3{construct(a,b,c){return new a4(a,b,c)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...a){let b=[];for(let c of a){if(c.indexOf("//")>=0)throw new aQ(aP.INVALID_ARGUMENT,`Invalid segment (${c}). Paths must not contain // in them.`);b.push(...c.split("/").filter(a=>a.length>0))}return new a4(b)}static emptyPath(){return new a4([])}}let a5=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class a6 extends a3{construct(a,b,c){return new a6(a,b,c)}static isValidIdentifier(a){return a5.test(a)}canonicalString(){return this.toArray().map(a=>(a=a.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),a6.isValidIdentifier(a)||(a="`"+a+"`"),a)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===a2}static keyField(){return new a6([a2])}static fromServerFormat(a){let b=[],c="",d=0,e=()=>{if(0===c.length)throw new aQ(aP.INVALID_ARGUMENT,`Invalid field path (${a}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);b.push(c),c=""},f=!1;for(;d<a.length;){let b=a[d];if("\\"===b){if(d+1===a.length)throw new aQ(aP.INVALID_ARGUMENT,"Path has trailing escape character: "+a);let b=a[d+1];if("\\"!==b&&"."!==b&&"`"!==b)throw new aQ(aP.INVALID_ARGUMENT,"Path has invalid escape sequence: "+a);c+=b,d+=2}else"`"===b?f=!f:"."!==b||f?c+=b:e(),d++}if(e(),f)throw new aQ(aP.INVALID_ARGUMENT,"Unterminated ` in path: "+a);return new a6(b)}static emptyPath(){return new a6([])}}class a7{constructor(a){this.path=a}static fromPath(a){return new a7(a4.fromString(a))}static fromName(a){return new a7(a4.fromString(a).popFirst(5))}static empty(){return new a7(a4.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(a){return this.path.length>=2&&this.path.get(this.path.length-2)===a}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(a){return null!==a&&0===a4.comparator(this.path,a.path)}toString(){return this.path.toString()}static comparator(a,b){return a4.comparator(a.path,b.path)}static isDocumentKey(a){return a.length%2==0}static fromSegments(a){return new a7(new a4(a.slice()))}}function a8(a){if(!a7.isDocumentKey(a))throw new aQ(aP.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${a} has ${a.length}.`)}function a9(a){return"object"==typeof a&&null!==a&&(Object.getPrototypeOf(a)===Object.prototype||null===Object.getPrototypeOf(a))}function ba(a){if(void 0===a)return"undefined";if(null===a)return"null";if("string"==typeof a)return a.length>20&&(a=`${a.substring(0,20)}...`),JSON.stringify(a);if("number"==typeof a||"boolean"==typeof a)return""+a;if("object"==typeof a)if(a instanceof Array)return"an array";else{var b;let c=(b=a).constructor?b.constructor.name:null;return c?`a custom ${c} object`:"an object"}else if("function"==typeof a)return"a function";else return aM(12329,{type:typeof a})}function bb(a,b){if("_delegate"in a&&(a=a._delegate),!(a instanceof b))if(b.name===a.constructor.name)throw new aQ(aP.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");else{let c=ba(a);throw new aQ(aP.INVALID_ARGUMENT,`Expected type '${b.name}', but it was: ${c}`)}return a}function bc(a,b){let c={typeString:a};return b&&(c.value=b),c}function bd(a,b){let c;if(!a9(a))throw new aQ(aP.INVALID_ARGUMENT,"JSON must be an object");for(let d in b)if(b[d]){let e=b[d].typeString,f="value"in b[d]?{value:b[d].value}:void 0;if(!(d in a)){c=`JSON missing required field: '${d}'`;break}let g=a[d];if(e&&typeof g!==e){c=`JSON field '${d}' must be a ${e}.`;break}if(void 0!==f&&g!==f.value){c=`Expected '${d}' field to equal '${f.value}'`;break}}if(c)throw new aQ(aP.INVALID_ARGUMENT,c);return!0}class be{static now(){return be.fromMillis(Date.now())}static fromDate(a){return be.fromMillis(a.getTime())}static fromMillis(a){let b=Math.floor(a/1e3),c=Math.floor((a-1e3*b)*1e6);return new be(b,c)}constructor(a,b){if(this.seconds=a,this.nanoseconds=b,b<0||b>=1e9)throw new aQ(aP.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+b);if(a<-0xe7791f700||a>=0x3afff44180)throw new aQ(aP.INVALID_ARGUMENT,"Timestamp seconds out of range: "+a)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(a){return this.seconds===a.seconds?a$(this.nanoseconds,a.nanoseconds):a$(this.seconds,a.seconds)}isEqual(a){return a.seconds===this.seconds&&a.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:be._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(a){if(bd(a,be._jsonSchema))return new be(a.seconds,a.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}be._jsonSchemaVersion="firestore/timestamp/1.0",be._jsonSchema={type:bc("string",be._jsonSchemaVersion),seconds:bc("number"),nanoseconds:bc("number")};class bf{static fromTimestamp(a){return new bf(a)}static min(){return new bf(new be(0,0))}static max(){return new bf(new be(0x3afff4417f,1e9-1))}constructor(a){this.timestamp=a}compareTo(a){return this.timestamp._compareTo(a.timestamp)}isEqual(a){return this.timestamp.isEqual(a.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class bg{constructor(a,b,c,d){this.indexId=a,this.collectionGroup=b,this.fields=c,this.indexState=d}}bg.UNKNOWN_ID=-1;class bh{constructor(a,b,c){this.readTime=a,this.documentKey=b,this.largestBatchId=c}static min(){return new bh(bf.min(),a7.empty(),-1)}static max(){return new bh(bf.max(),a7.empty(),-1)}}class bi{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(a){this.onCommittedListeners.push(a)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(a=>a())}}async function bj(a){if(a.code===aP.FAILED_PRECONDITION&&"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."===a.message)aI("LocalStore","Unexpectedly lost primary lease");else throw a}class bk{constructor(a){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,a(a=>{this.isDone=!0,this.result=a,this.nextCallback&&this.nextCallback(a)},a=>{this.isDone=!0,this.error=a,this.catchCallback&&this.catchCallback(a)})}catch(a){return this.next(void 0,a)}next(a,b){return(this.callbackAttached&&aM(59440),this.callbackAttached=!0,this.isDone)?this.error?this.wrapFailure(b,this.error):this.wrapSuccess(a,this.result):new bk((c,d)=>{this.nextCallback=b=>{this.wrapSuccess(a,b).next(c,d)},this.catchCallback=a=>{this.wrapFailure(b,a).next(c,d)}})}toPromise(){return new Promise((a,b)=>{this.next(a,b)})}wrapUserFunction(a){try{let b=a();if(b instanceof bk)return b;return bk.resolve(b)}catch(a){return bk.reject(a)}}wrapSuccess(a,b){return a?this.wrapUserFunction(()=>a(b)):bk.resolve(b)}wrapFailure(a,b){return a?this.wrapUserFunction(()=>a(b)):bk.reject(b)}static resolve(a){return new bk((b,c)=>{b(a)})}static reject(a){return new bk((b,c)=>{c(a)})}static waitFor(a){return new bk((b,c)=>{let d=0,e=0,f=!1;a.forEach(a=>{++d,a.next(()=>{++e,f&&e===d&&b()},a=>c(a))}),f=!0,e===d&&b()})}static or(a){let b=bk.resolve(!1);for(let c of a)b=b.next(a=>a?bk.resolve(a):c());return b}static forEach(a,b){let c=[];return a.forEach((a,d)=>{c.push(b.call(this,a,d))}),this.waitFor(c)}static mapArray(a,b){return new bk((c,d)=>{let e=a.length,f=Array(e),g=0;for(let h=0;h<e;h++){let i=h;b(a[i]).next(a=>{f[i]=a,++g===e&&c(f)},a=>d(a))}})}static doWhile(a,b){return new bk((c,d)=>{let e=()=>{!0===a()?b().next(()=>{e()},d):c()};e()})}}function bl(a){return"IndexedDbTransactionError"===a.name}class bm{constructor(a,b){this.previousValue=a,b&&(b.sequenceNumberHandler=a=>this.setPreviousValue(a),this.writeNewSequenceNumber=a=>b.writeSequenceNumber(a))}setPreviousValue(a){return this.previousValue=Math.max(a,this.previousValue),this.previousValue}next(){let a=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(a),a}}bm.INVALID=-1;function bn(a){let b=0;for(let c in a)Object.prototype.hasOwnProperty.call(a,c)&&b++;return b}function bo(a,b){for(let c in a)Object.prototype.hasOwnProperty.call(a,c)&&b(c,a[c])}function bp(a){for(let b in a)if(Object.prototype.hasOwnProperty.call(a,b))return!1;return!0}class bq{constructor(a,b){this.comparator=a,this.root=b||bs.EMPTY}insert(a,b){return new bq(this.comparator,this.root.insert(a,b,this.comparator).copy(null,null,bs.BLACK,null,null))}remove(a){return new bq(this.comparator,this.root.remove(a,this.comparator).copy(null,null,bs.BLACK,null,null))}get(a){let b=this.root;for(;!b.isEmpty();){let c=this.comparator(a,b.key);if(0===c)return b.value;c<0?b=b.left:c>0&&(b=b.right)}return null}indexOf(a){let b=0,c=this.root;for(;!c.isEmpty();){let d=this.comparator(a,c.key);if(0===d)return b+c.left.size;d<0?c=c.left:(b+=c.left.size+1,c=c.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(a){return this.root.inorderTraversal(a)}forEach(a){this.inorderTraversal((b,c)=>(a(b,c),!1))}toString(){let a=[];return this.inorderTraversal((b,c)=>(a.push(`${b}:${c}`),!1)),`{${a.join(", ")}}`}reverseTraversal(a){return this.root.reverseTraversal(a)}getIterator(){return new br(this.root,null,this.comparator,!1)}getIteratorFrom(a){return new br(this.root,a,this.comparator,!1)}getReverseIterator(){return new br(this.root,null,this.comparator,!0)}getReverseIteratorFrom(a){return new br(this.root,a,this.comparator,!0)}}class br{constructor(a,b,c,d){this.isReverse=d,this.nodeStack=[];let e=1;for(;!a.isEmpty();)if(e=b?c(a.key,b):1,b&&d&&(e*=-1),e<0)a=this.isReverse?a.left:a.right;else if(0===e){this.nodeStack.push(a);break}else this.nodeStack.push(a),a=this.isReverse?a.right:a.left}getNext(){let a=this.nodeStack.pop(),b={key:a.key,value:a.value};if(this.isReverse)for(a=a.left;!a.isEmpty();)this.nodeStack.push(a),a=a.right;else for(a=a.right;!a.isEmpty();)this.nodeStack.push(a),a=a.left;return b}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let a=this.nodeStack[this.nodeStack.length-1];return{key:a.key,value:a.value}}}class bs{constructor(a,b,c,d,e){this.key=a,this.value=b,this.color=null!=c?c:bs.RED,this.left=null!=d?d:bs.EMPTY,this.right=null!=e?e:bs.EMPTY,this.size=this.left.size+1+this.right.size}copy(a,b,c,d,e){return new bs(null!=a?a:this.key,null!=b?b:this.value,null!=c?c:this.color,null!=d?d:this.left,null!=e?e:this.right)}isEmpty(){return!1}inorderTraversal(a){return this.left.inorderTraversal(a)||a(this.key,this.value)||this.right.inorderTraversal(a)}reverseTraversal(a){return this.right.reverseTraversal(a)||a(this.key,this.value)||this.left.reverseTraversal(a)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(a,b,c){let d=this,e=c(a,d.key);return(d=e<0?d.copy(null,null,null,d.left.insert(a,b,c),null):0===e?d.copy(null,b,null,null,null):d.copy(null,null,null,null,d.right.insert(a,b,c))).fixUp()}removeMin(){if(this.left.isEmpty())return bs.EMPTY;let a=this;return a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),(a=a.copy(null,null,null,a.left.removeMin(),null)).fixUp()}remove(a,b){let c,d=this;if(0>b(a,d.key))d.left.isEmpty()||d.left.isRed()||d.left.left.isRed()||(d=d.moveRedLeft()),d=d.copy(null,null,null,d.left.remove(a,b),null);else{if(d.left.isRed()&&(d=d.rotateRight()),d.right.isEmpty()||d.right.isRed()||d.right.left.isRed()||(d=d.moveRedRight()),0===b(a,d.key))if(d.right.isEmpty())return bs.EMPTY;else c=d.right.min(),d=d.copy(c.key,c.value,null,null,d.right.removeMin());d=d.copy(null,null,null,null,d.right.remove(a,b))}return d.fixUp()}isRed(){return this.color}fixUp(){let a=this;return a.right.isRed()&&!a.left.isRed()&&(a=a.rotateLeft()),a.left.isRed()&&a.left.left.isRed()&&(a=a.rotateRight()),a.left.isRed()&&a.right.isRed()&&(a=a.colorFlip()),a}moveRedLeft(){let a=this.colorFlip();return a.right.left.isRed()&&(a=(a=(a=a.copy(null,null,null,null,a.right.rotateRight())).rotateLeft()).colorFlip()),a}moveRedRight(){let a=this.colorFlip();return a.left.left.isRed()&&(a=(a=a.rotateRight()).colorFlip()),a}rotateLeft(){let a=this.copy(null,null,bs.RED,null,this.right.left);return this.right.copy(null,null,this.color,a,null)}rotateRight(){let a=this.copy(null,null,bs.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,a)}colorFlip(){let a=this.left.copy(null,null,!this.left.color,null,null),b=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,a,b)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw aM(43730,{key:this.key,value:this.value});if(this.right.isRed())throw aM(14113,{key:this.key,value:this.value});let a=this.left.check();if(a===this.right.check())return a+ +!this.isRed();throw aM(27949)}}bs.EMPTY=null,bs.RED=!0,bs.BLACK=!1;class bt{constructor(){this.size=0}get key(){throw aM(57766)}get value(){throw aM(16141)}get color(){throw aM(16727)}get left(){throw aM(29726)}get right(){throw aM(36894)}copy(a,b,c,d,e){return this}insert(a,b,c){return new bs(a,b)}remove(a,b){return this}isEmpty(){return!0}inorderTraversal(a){return!1}reverseTraversal(a){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}}bs.EMPTY=new bt;class bu{constructor(a){this.comparator=a,this.data=new bq(this.comparator)}has(a){return null!==this.data.get(a)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(a){return this.data.indexOf(a)}forEach(a){this.data.inorderTraversal((b,c)=>(a(b),!1))}forEachInRange(a,b){let c=this.data.getIteratorFrom(a[0]);for(;c.hasNext();){let d=c.getNext();if(this.comparator(d.key,a[1])>=0)return;b(d.key)}}forEachWhile(a,b){let c;for(c=void 0!==b?this.data.getIteratorFrom(b):this.data.getIterator();c.hasNext();)if(!a(c.getNext().key))return}firstAfterOrEqual(a){let b=this.data.getIteratorFrom(a);return b.hasNext()?b.getNext().key:null}getIterator(){return new bv(this.data.getIterator())}getIteratorFrom(a){return new bv(this.data.getIteratorFrom(a))}add(a){return this.copy(this.data.remove(a).insert(a,!0))}delete(a){return this.has(a)?this.copy(this.data.remove(a)):this}isEmpty(){return this.data.isEmpty()}unionWith(a){let b=this;return b.size<a.size&&(b=a,a=this),a.forEach(a=>{b=b.add(a)}),b}isEqual(a){if(!(a instanceof bu)||this.size!==a.size)return!1;let b=this.data.getIterator(),c=a.data.getIterator();for(;b.hasNext();){let a=b.getNext().key,d=c.getNext().key;if(0!==this.comparator(a,d))return!1}return!0}toArray(){let a=[];return this.forEach(b=>{a.push(b)}),a}toString(){let a=[];return this.forEach(b=>a.push(b)),"SortedSet("+a.toString()+")"}copy(a){let b=new bu(this.comparator);return b.data=a,b}}class bv{constructor(a){this.iter=a}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class bw{constructor(a){this.fields=a,a.sort(a6.comparator)}static empty(){return new bw([])}unionWith(a){let b=new bu(a6.comparator);for(let a of this.fields)b=b.add(a);for(let c of a)b=b.add(c);return new bw(b.toArray())}covers(a){for(let b of this.fields)if(b.isPrefixOf(a))return!0;return!1}isEqual(a){return a1(this.fields,a.fields,(a,b)=>a.isEqual(b))}}class bx{constructor(a){this.binaryString=a}static fromBase64String(a){return new bx(Buffer.from(a,"base64").toString("binary"))}static fromUint8Array(a){return new bx(function(a){let b="";for(let c=0;c<a.length;++c)b+=String.fromCharCode(a[c]);return b}(a))}[Symbol.iterator](){let a=0;return{next:()=>a<this.binaryString.length?{value:this.binaryString.charCodeAt(a++),done:!1}:{value:void 0,done:!0}}}toBase64(){var a;return a=this.binaryString,Buffer.from(a,"binary").toString("base64")}toUint8Array(){var a=this.binaryString;let b=new Uint8Array(a.length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}approximateByteSize(){return 2*this.binaryString.length}compareTo(a){return a$(this.binaryString,a.binaryString)}isEqual(a){return this.binaryString===a.binaryString}}bx.EMPTY_BYTE_STRING=new bx("");let by=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function bz(a){if(aO(!!a,39018),"string"==typeof a){let b=0,c=by.exec(a);if(aO(!!c,46558,{timestamp:a}),c[1]){let a=c[1];b=Number(a=(a+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(a).getTime()/1e3),nanos:b}}return{seconds:bA(a.seconds),nanos:bA(a.nanos)}}function bA(a){return"number"==typeof a?a:"string"==typeof a?Number(a):0}function bB(a){return"string"==typeof a?bx.fromBase64String(a):bx.fromUint8Array(a)}let bC="server_timestamp",bD="__type__",bE="__previous_value__",bF="__local_write_time__";function bG(a){return(a?.mapValue?.fields||{})[bD]?.stringValue===bC}function bH(a){let b=a.mapValue.fields[bE];return bG(b)?bH(b):b}function bI(a){let b=bz(a.mapValue.fields[bF].timestampValue);return new be(b.seconds,b.nanos)}class bJ{constructor(a,b,c,d,e,f,g,h,i,j){this.databaseId=a,this.appId=b,this.persistenceKey=c,this.host=d,this.ssl=e,this.forceLongPolling=f,this.autoDetectLongPolling=g,this.longPollingOptions=h,this.useFetchStreams=i,this.isUsingEmulator=j}}let bK="(default)";class bL{constructor(a,b){this.projectId=a,this.database=b||bK}static empty(){return new bL("","")}get isDefaultDatabase(){return this.database===bK}isEqual(a){return a instanceof bL&&a.projectId===this.projectId&&a.database===this.database}}function bM(a){return 0===a&&1/a==-1/0}let bN="__type__",bO="__max__",bP={mapValue:{fields:{__type__:{stringValue:bO}}}},bQ="__vector__",bR="value";function bS(a){return"nullValue"in a?0:"booleanValue"in a?1:"integerValue"in a||"doubleValue"in a?2:"timestampValue"in a?3:"stringValue"in a?5:"bytesValue"in a?6:"referenceValue"in a?7:"geoPointValue"in a?8:"arrayValue"in a?9:"mapValue"in a?bG(a)?4:b4(a)?0x1fffffffffffff:b2(a)?10:11:aM(28295,{value:a})}function bT(a,b){if(a===b)return!0;let c=bS(a);if(c!==bS(b))return!1;switch(c){case 0:case 0x1fffffffffffff:return!0;case 1:return a.booleanValue===b.booleanValue;case 4:return bI(a).isEqual(bI(b));case 3:var d,e,f,g,h=a,i=b;if("string"==typeof h.timestampValue&&"string"==typeof i.timestampValue&&h.timestampValue.length===i.timestampValue.length)return h.timestampValue===i.timestampValue;let j=bz(h.timestampValue),k=bz(i.timestampValue);return j.seconds===k.seconds&&j.nanos===k.nanos;case 5:return a.stringValue===b.stringValue;case 6:return d=a,e=b,bB(d.bytesValue).isEqual(bB(e.bytesValue));case 7:return a.referenceValue===b.referenceValue;case 8:return f=a,g=b,bA(f.geoPointValue.latitude)===bA(g.geoPointValue.latitude)&&bA(f.geoPointValue.longitude)===bA(g.geoPointValue.longitude);case 2:var l=a,m=b;if("integerValue"in l&&"integerValue"in m)return bA(l.integerValue)===bA(m.integerValue);if("doubleValue"in l&&"doubleValue"in m){let a=bA(l.doubleValue),b=bA(m.doubleValue);return a===b?bM(a)===bM(b):isNaN(a)&&isNaN(b)}return!1;case 9:return a1(a.arrayValue.values||[],b.arrayValue.values||[],bT);case 10:case 11:var n=a,o=b;let p=n.mapValue.fields||{},q=o.mapValue.fields||{};if(bn(p)!==bn(q))return!1;for(let a in p)if(p.hasOwnProperty(a)&&(void 0===q[a]||!bT(p[a],q[a])))return!1;return!0;default:return aM(52216,{left:a})}}function bU(a,b){return void 0!==(a.values||[]).find(a=>bT(a,b))}function bV(a,b){if(a===b)return 0;let c=bS(a),d=bS(b);if(c!==d)return a$(c,d);switch(c){case 0:case 0x1fffffffffffff:return 0;case 1:return a$(a.booleanValue,b.booleanValue);case 2:var e=a,f=b;let g=bA(e.integerValue||e.doubleValue),h=bA(f.integerValue||f.doubleValue);return g<h?-1:g>h?1:g===h?0:isNaN(g)?isNaN(h)?0:-1:1;case 3:return bW(a.timestampValue,b.timestampValue);case 4:return bW(bI(a),bI(b));case 5:return a_(a.stringValue,b.stringValue);case 6:return function(a,b){let c=bB(a),d=bB(b);return c.compareTo(d)}(a.bytesValue,b.bytesValue);case 7:return function(a,b){let c=a.split("/"),d=b.split("/");for(let a=0;a<c.length&&a<d.length;a++){let b=a$(c[a],d[a]);if(0!==b)return b}return a$(c.length,d.length)}(a.referenceValue,b.referenceValue);case 8:return function(a,b){let c=a$(bA(a.latitude),bA(b.latitude));return 0!==c?c:a$(bA(a.longitude),bA(b.longitude))}(a.geoPointValue,b.geoPointValue);case 9:return bX(a.arrayValue,b.arrayValue);case 10:return function(a,b){let c=a.fields||{},d=b.fields||{},e=c[bR]?.arrayValue,f=d[bR]?.arrayValue,g=a$(e?.values?.length||0,f?.values?.length||0);return 0!==g?g:bX(e,f)}(a.mapValue,b.mapValue);case 11:return function(a,b){if(a===bP.mapValue&&b===bP.mapValue)return 0;if(a===bP.mapValue)return 1;if(b===bP.mapValue)return -1;let c=a.fields||{},d=Object.keys(c),e=b.fields||{},f=Object.keys(e);d.sort(),f.sort();for(let a=0;a<d.length&&a<f.length;++a){let b=a_(d[a],f[a]);if(0!==b)return b;let g=bV(c[d[a]],e[f[a]]);if(0!==g)return g}return a$(d.length,f.length)}(a.mapValue,b.mapValue);default:throw aM(23264,{leftType:c})}}function bW(a,b){if("string"==typeof a&&"string"==typeof b&&a.length===b.length)return a$(a,b);let c=bz(a),d=bz(b),e=a$(c.seconds,d.seconds);return 0!==e?e:a$(c.nanos,d.nanos)}function bX(a,b){let c=a.values||[],d=b.values||[];for(let a=0;a<c.length&&a<d.length;++a){let b=bV(c[a],d[a]);if(b)return b}return a$(c.length,d.length)}function bY(a){if("nullValue"in a)return"null";if("booleanValue"in a)return""+a.booleanValue;if("integerValue"in a)return""+a.integerValue;if("doubleValue"in a)return""+a.doubleValue;if("timestampValue"in a){var b,c,d=a.timestampValue;let e=bz(d);return`time(${e.seconds},${e.nanos})`}else if("stringValue"in a)return a.stringValue;else if("bytesValue"in a)return bB(a.bytesValue).toBase64();else if("referenceValue"in a){return b=a.referenceValue,a7.fromName(b).toString()}else if("geoPointValue"in a){return c=a.geoPointValue,`geo(${c.latitude},${c.longitude})`}else if("arrayValue"in a){var e=a.arrayValue;let b="[",c=!0;for(let a of e.values||[])c?c=!1:b+=",",b+=bY(a);return b+"]"}else if("mapValue"in a)return function(a){let b=Object.keys(a.fields||{}).sort(),c="{",d=!0;for(let e of b)d?d=!1:c+=",",c+=`${e}:${bY(a.fields[e])}`;return c+"}"}(a.mapValue);else return aM(61005,{value:a})}function bZ(a){return!!a&&"integerValue"in a}function b$(a){return!!a&&"arrayValue"in a}function b_(a){return!!a&&"nullValue"in a}function b0(a){return!!a&&"doubleValue"in a&&isNaN(Number(a.doubleValue))}function b1(a){return!!a&&"mapValue"in a}function b2(a){return(a?.mapValue?.fields||{})[bN]?.stringValue===bQ}function b3(a){if(a.geoPointValue)return{geoPointValue:{...a.geoPointValue}};if(a.timestampValue&&"object"==typeof a.timestampValue)return{timestampValue:{...a.timestampValue}};if(a.mapValue){let b={mapValue:{fields:{}}};return bo(a.mapValue.fields,(a,c)=>b.mapValue.fields[a]=b3(c)),b}{if(!a.arrayValue)return{...a};let b={arrayValue:{values:[]}};for(let c=0;c<(a.arrayValue.values||[]).length;++c)b.arrayValue.values[c]=b3(a.arrayValue.values[c]);return b}}function b4(a){return(((a.mapValue||{}).fields||{}).__type__||{}).stringValue===bO}class b5{constructor(a){this.value=a}static empty(){return new b5({mapValue:{}})}field(a){if(a.isEmpty())return this.value;{let b=this.value;for(let c=0;c<a.length-1;++c)if(!b1(b=(b.mapValue.fields||{})[a.get(c)]))return null;return(b=(b.mapValue.fields||{})[a.lastSegment()])||null}}set(a,b){this.getFieldsMap(a.popLast())[a.lastSegment()]=b3(b)}setAll(a){let b=a6.emptyPath(),c={},d=[];a.forEach((a,e)=>{if(!b.isImmediateParentOf(e)){let a=this.getFieldsMap(b);this.applyChanges(a,c,d),c={},d=[],b=e.popLast()}a?c[e.lastSegment()]=b3(a):d.push(e.lastSegment())});let e=this.getFieldsMap(b);this.applyChanges(e,c,d)}delete(a){let b=this.field(a.popLast());b1(b)&&b.mapValue.fields&&delete b.mapValue.fields[a.lastSegment()]}isEqual(a){return bT(this.value,a.value)}getFieldsMap(a){let b=this.value;b.mapValue.fields||(b.mapValue={fields:{}});for(let c=0;c<a.length;++c){let d=b.mapValue.fields[a.get(c)];b1(d)&&d.mapValue.fields||(d={mapValue:{fields:{}}},b.mapValue.fields[a.get(c)]=d),b=d}return b.mapValue.fields}applyChanges(a,b,c){for(let d of(bo(b,(b,c)=>a[b]=c),c))delete a[d]}clone(){return new b5(b3(this.value))}}class b6{constructor(a,b,c,d,e,f,g){this.key=a,this.documentType=b,this.version=c,this.readTime=d,this.createTime=e,this.data=f,this.documentState=g}static newInvalidDocument(a){return new b6(a,0,bf.min(),bf.min(),bf.min(),b5.empty(),0)}static newFoundDocument(a,b,c,d){return new b6(a,1,b,bf.min(),c,d,0)}static newNoDocument(a,b){return new b6(a,2,b,bf.min(),bf.min(),b5.empty(),0)}static newUnknownDocument(a,b){return new b6(a,3,b,bf.min(),bf.min(),b5.empty(),2)}convertToFoundDocument(a,b){return this.createTime.isEqual(bf.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=a),this.version=a,this.documentType=1,this.data=b,this.documentState=0,this}convertToNoDocument(a){return this.version=a,this.documentType=2,this.data=b5.empty(),this.documentState=0,this}convertToUnknownDocument(a){return this.version=a,this.documentType=3,this.data=b5.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=bf.min(),this}setReadTime(a){return this.readTime=a,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(a){return a instanceof b6&&this.key.isEqual(a.key)&&this.version.isEqual(a.version)&&this.documentType===a.documentType&&this.documentState===a.documentState&&this.data.isEqual(a.data)}mutableCopy(){return new b6(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class b7{constructor(a,b){this.position=a,this.inclusive=b}}function b8(a,b,c){let d=0;for(let e=0;e<a.position.length;e++){let f=b[e],g=a.position[e];if(d=f.field.isKeyField()?a7.comparator(a7.fromName(g.referenceValue),c.key):bV(g,c.data.field(f.field)),"desc"===f.dir&&(d*=-1),0!==d)break}return d}function b9(a,b){if(null===a)return null===b;if(null===b||a.inclusive!==b.inclusive||a.position.length!==b.position.length)return!1;for(let c=0;c<a.position.length;c++)if(!bT(a.position[c],b.position[c]))return!1;return!0}class ca{constructor(a,b="asc"){this.field=a,this.dir=b}}class cb{}class cc extends cb{constructor(a,b,c){super(),this.field=a,this.op=b,this.value=c}static create(a,b,c){if(a.isKeyField())if("in"===b||"not-in"===b)return this.createKeyFieldInFilter(a,b,c);else return new cg(a,b,c);if("array-contains"===b)return new ck(a,c);if("in"===b)return new cl(a,c);if("not-in"===b)return new cm(a,c);if("array-contains-any"===b)return new cn(a,c);else return new cc(a,b,c)}static createKeyFieldInFilter(a,b,c){return"in"===b?new ch(a,c):new ci(a,c)}matches(a){let b=a.data.field(this.field);return"!="===this.op?null!==b&&void 0===b.nullValue&&this.matchesComparison(bV(b,this.value)):null!==b&&bS(this.value)===bS(b)&&this.matchesComparison(bV(b,this.value))}matchesComparison(a){switch(this.op){case"<":return a<0;case"<=":return a<=0;case"==":return 0===a;case"!=":return 0!==a;case">":return a>0;case">=":return a>=0;default:return aM(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class cd extends cb{constructor(a,b){super(),this.filters=a,this.op=b,this.memoizedFlattenedFilters=null}static create(a,b){return new cd(a,b)}matches(a){return ce(this)?void 0===this.filters.find(b=>!b.matches(a)):void 0!==this.filters.find(b=>b.matches(a))}getFlattenedFilters(){return null!==this.memoizedFlattenedFilters||(this.memoizedFlattenedFilters=this.filters.reduce((a,b)=>a.concat(b.getFlattenedFilters()),[])),this.memoizedFlattenedFilters}getFilters(){return Object.assign([],this.filters)}}function ce(a){return"and"===a.op}function cf(a){for(let b of a.filters)if(b instanceof cd)return!1;return!0}class cg extends cc{constructor(a,b,c){super(a,b,c),this.key=a7.fromName(c.referenceValue)}matches(a){let b=a7.comparator(a.key,this.key);return this.matchesComparison(b)}}class ch extends cc{constructor(a,b){super(a,"in",b),this.keys=cj("in",b)}matches(a){return this.keys.some(b=>b.isEqual(a.key))}}class ci extends cc{constructor(a,b){super(a,"not-in",b),this.keys=cj("not-in",b)}matches(a){return!this.keys.some(b=>b.isEqual(a.key))}}function cj(a,b){return(b.arrayValue?.values||[]).map(a=>a7.fromName(a.referenceValue))}class ck extends cc{constructor(a,b){super(a,"array-contains",b)}matches(a){let b=a.data.field(this.field);return b$(b)&&bU(b.arrayValue,this.value)}}class cl extends cc{constructor(a,b){super(a,"in",b)}matches(a){let b=a.data.field(this.field);return null!==b&&bU(this.value.arrayValue,b)}}class cm extends cc{constructor(a,b){super(a,"not-in",b)}matches(a){if(bU(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let b=a.data.field(this.field);return null!==b&&void 0===b.nullValue&&!bU(this.value.arrayValue,b)}}class cn extends cc{constructor(a,b){super(a,"array-contains-any",b)}matches(a){let b=a.data.field(this.field);return!!b$(b)&&!!b.arrayValue.values&&b.arrayValue.values.some(a=>bU(this.value.arrayValue,a))}}class co{constructor(a,b=null,c=[],d=[],e=null,f=null,g=null){this.path=a,this.collectionGroup=b,this.orderBy=c,this.filters=d,this.limit=e,this.startAt=f,this.endAt=g,this.memoizedCanonicalId=null}}function cp(a,b=null,c=[],d=[],e=null,f=null,g=null){return new co(a,b,c,d,e,f,g)}function cq(a){if(null===a.memoizedCanonicalId){let b=a.path.canonicalString();null!==a.collectionGroup&&(b+="|cg:"+a.collectionGroup),b+="|f:",b+=a.filters.map(a=>(function a(b){if(b instanceof cc)return b.field.canonicalString()+b.op.toString()+bY(b.value);{if(cf(b)&&ce(b))return b.filters.map(b=>a(b)).join(",");let c=b.filters.map(b=>a(b)).join(",");return`${b.op}(${c})`}})(a)).join(","),b+="|ob:",b+=a.orderBy.map(a=>a.field.canonicalString()+a.dir).join(","),null!=a.limit&&(b+="|l:",b+=a.limit),a.startAt&&(b+="|lb:",b+=a.startAt.inclusive?"b:":"a:",b+=a.startAt.position.map(a=>bY(a)).join(",")),a.endAt&&(b+="|ub:",b+=a.endAt.inclusive?"a:":"b:",b+=a.endAt.position.map(a=>bY(a)).join(",")),a.memoizedCanonicalId=b}return a.memoizedCanonicalId}function cr(a,b){if(a.limit!==b.limit||a.orderBy.length!==b.orderBy.length)return!1;for(let e=0;e<a.orderBy.length;e++){var c,d;if(c=a.orderBy[e],d=b.orderBy[e],!(c.dir===d.dir&&c.field.isEqual(d.field)))return!1}if(a.filters.length!==b.filters.length)return!1;for(let c=0;c<a.filters.length;c++)if(!function a(b,c){var d,e,f,g;if(b instanceof cc){return d=b,(e=c)instanceof cc&&d.op===e.op&&d.field.isEqual(e.field)&&bT(d.value,e.value)}if(b instanceof cd){return f=b,(g=c)instanceof cd&&f.op===g.op&&f.filters.length===g.filters.length&&f.filters.reduce((b,c,d)=>b&&a(c,g.filters[d]),!0)}aM(19439)}(a.filters[c],b.filters[c]))return!1;return a.collectionGroup===b.collectionGroup&&!!a.path.isEqual(b.path)&&!!b9(a.startAt,b.startAt)&&b9(a.endAt,b.endAt)}class cs{constructor(a,b=null,c=[],d=[],e=null,f="F",g=null,h=null){this.path=a,this.collectionGroup=b,this.explicitOrderBy=c,this.filters=d,this.limit=e,this.limitType=f,this.startAt=g,this.endAt=h,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}}function ct(a){return 0===a.filters.length&&null===a.limit&&null==a.startAt&&null==a.endAt&&(0===a.explicitOrderBy.length||1===a.explicitOrderBy.length&&a.explicitOrderBy[0].field.isKeyField())}function cu(a){if(null===a.memoizedNormalizedOrderBy){let b;a.memoizedNormalizedOrderBy=[];let c=new Set;for(let b of a.explicitOrderBy)a.memoizedNormalizedOrderBy.push(b),c.add(b.field.canonicalString());let d=a.explicitOrderBy.length>0?a.explicitOrderBy[a.explicitOrderBy.length-1].dir:"asc";(b=new bu(a6.comparator),a.filters.forEach(a=>{a.getFlattenedFilters().forEach(a=>{a.isInequality()&&(b=b.add(a.field))})}),b).forEach(b=>{c.has(b.canonicalString())||b.isKeyField()||a.memoizedNormalizedOrderBy.push(new ca(b,d))}),c.has(a6.keyField().canonicalString())||a.memoizedNormalizedOrderBy.push(new ca(a6.keyField(),d))}return a.memoizedNormalizedOrderBy}function cv(a){return a.memoizedTarget||(a.memoizedTarget=function(a,b){if("F"===a.limitType)return cp(a.path,a.collectionGroup,b,a.filters,a.limit,a.startAt,a.endAt);{b=b.map(a=>{let b="desc"===a.dir?"asc":"desc";return new ca(a.field,b)});let c=a.endAt?new b7(a.endAt.position,a.endAt.inclusive):null,d=a.startAt?new b7(a.startAt.position,a.startAt.inclusive):null;return cp(a.path,a.collectionGroup,b,a.filters,a.limit,c,d)}}(a,cu(a))),a.memoizedTarget}function cw(a,b,c){return new cs(a.path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),b,c,a.startAt,a.endAt)}function cx(a,b){return cr(cv(a),cv(b))&&a.limitType===b.limitType}function cy(a){return`${cq(cv(a))}|lt:${a.limitType}`}function cz(a){var b;let c;return`Query(target=${c=(b=cv(a)).path.canonicalString(),null!==b.collectionGroup&&(c+=" collectionGroup="+b.collectionGroup),b.filters.length>0&&(c+=`, filters: [${b.filters.map(a=>(function a(b){var c,d;return b instanceof cc?(c=b,`${c.field.canonicalString()} ${c.op} ${bY(c.value)}`):b instanceof cd?(d=b).op.toString()+" {"+d.getFilters().map(a).join(" ,")+"}":"Filter"})(a)).join(", ")}]`),null!=b.limit&&(c+=", limit: "+b.limit),b.orderBy.length>0&&(c+=`, orderBy: [${b.orderBy.map(a=>`${a.field.canonicalString()} (${a.dir})`).join(", ")}]`),b.startAt&&(c+=", startAt: ",c+=b.startAt.inclusive?"b:":"a:",c+=b.startAt.position.map(a=>bY(a)).join(",")),b.endAt&&(c+=", endAt: ",c+=b.endAt.inclusive?"a:":"b:",c+=b.endAt.position.map(a=>bY(a)).join(",")),`Target(${c})`}; limitType=${a.limitType})`}function cA(a,b){var c,d;return b.isFoundDocument()&&function(a,b){let c=b.key.path;return null!==a.collectionGroup?b.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(c):a7.isDocumentKey(a.path)?a.path.isEqual(c):a.path.isImmediateParentOf(c)}(a,b)&&function(a,b){for(let c of cu(a))if(!c.field.isKeyField()&&null===b.data.field(c.field))return!1;return!0}(a,b)&&function(a,b){for(let c of a.filters)if(!c.matches(b))return!1;return!0}(a,b)&&(c=a,d=b,(!c.startAt||!!function(a,b,c){let d=b8(a,b,c);return a.inclusive?d<=0:d<0}(c.startAt,cu(c),d))&&(!c.endAt||!!function(a,b,c){let d=b8(a,b,c);return a.inclusive?d>=0:d>0}(c.endAt,cu(c),d)))}class cB{constructor(a,b){this.mapKeyFn=a,this.equalsFn=b,this.inner={},this.innerSize=0}get(a){let b=this.mapKeyFn(a),c=this.inner[b];if(void 0!==c){for(let[b,d]of c)if(this.equalsFn(b,a))return d}}has(a){return void 0!==this.get(a)}set(a,b){let c=this.mapKeyFn(a),d=this.inner[c];if(void 0===d){this.inner[c]=[[a,b]],this.innerSize++;return}for(let c=0;c<d.length;c++)if(this.equalsFn(d[c][0],a)){d[c]=[a,b];return}d.push([a,b]),this.innerSize++}delete(a){let b=this.mapKeyFn(a),c=this.inner[b];if(void 0===c)return!1;for(let d=0;d<c.length;d++)if(this.equalsFn(c[d][0],a))return 1===c.length?delete this.inner[b]:c.splice(d,1),this.innerSize--,!0;return!1}forEach(a){bo(this.inner,(b,c)=>{for(let[b,d]of c)a(b,d)})}isEmpty(){return bp(this.inner)}size(){return this.innerSize}}let cC=new bq(a7.comparator),cD=new bq(a7.comparator);function cE(...a){let b=cD;for(let c of a)b=b.insert(c.key,c);return b}function cF(a){let b=cD;return a.forEach((a,c)=>b=b.insert(a,c.overlayedDocument)),b}function cG(){return new cB(a=>a.toString(),(a,b)=>a.isEqual(b))}let cH=new bq(a7.comparator),cI=new bu(a7.comparator);function cJ(...a){let b=cI;for(let c of a)b=b.add(c);return b}let cK=new bu(a$);function cL(a,b){if(a.useProto3Json){if(isNaN(b))return{doubleValue:"NaN"};else if(b===1/0)return{doubleValue:"Infinity"};else if(b===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:bM(b)?"-0":b}}function cM(a){return{integerValue:""+a}}class cN{constructor(){this._=void 0}}function cO(a,b){if(a instanceof cU)return bZ(b)||b&&"doubleValue"in b?b:{integerValue:0};return null}class cP extends cN{}class cQ extends cN{constructor(a){super(),this.elements=a}}function cR(a,b){let c=cW(b);for(let b of a.elements)c.some(a=>bT(a,b))||c.push(b);return{arrayValue:{values:c}}}class cS extends cN{constructor(a){super(),this.elements=a}}function cT(a,b){let c=cW(b);for(let b of a.elements)c=c.filter(a=>!bT(a,b));return{arrayValue:{values:c}}}class cU extends cN{constructor(a,b){super(),this.serializer=a,this.operand=b}}function cV(a){return bA(a.integerValue||a.doubleValue)}function cW(a){return b$(a)&&a.arrayValue.values?a.arrayValue.values.slice():[]}class cX{constructor(a,b){this.version=a,this.transformResults=b}}class cY{constructor(a,b){this.updateTime=a,this.exists=b}static none(){return new cY}static exists(a){return new cY(void 0,a)}static updateTime(a){return new cY(a)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(a){return this.exists===a.exists&&(this.updateTime?!!a.updateTime&&this.updateTime.isEqual(a.updateTime):!a.updateTime)}}function cZ(a,b){return void 0!==a.updateTime?b.isFoundDocument()&&b.version.isEqual(a.updateTime):void 0===a.exists||a.exists===b.isFoundDocument()}class c${}function c_(a,b){if(!a.hasLocalMutations||b&&0===b.fields.length)return null;if(null===b)if(a.isNoDocument())return new c7(a.key,cY.none());else return new c2(a.key,a.data,cY.none());{let c=a.data,d=b5.empty(),e=new bu(a6.comparator);for(let a of b.fields)if(!e.has(a)){let b=c.field(a);null===b&&a.length>1&&(a=a.popLast(),b=c.field(a)),null===b?d.delete(a):d.set(a,b),e=e.add(a)}return new c3(a.key,d,new bw(e.toArray()),cY.none())}}function c0(a,b,c,d){var e,f,g;return a instanceof c2?function(a,b,c,d){if(!cZ(a.precondition,b))return c;let e=a.value.clone(),f=c6(a.fieldTransforms,d,b);return e.setAll(f),b.convertToFoundDocument(b.version,e).setHasLocalMutations(),null}(a,b,c,d):a instanceof c3?function(a,b,c,d){if(!cZ(a.precondition,b))return c;let e=c6(a.fieldTransforms,d,b),f=b.data;return(f.setAll(c4(a)),f.setAll(e),b.convertToFoundDocument(b.version,f).setHasLocalMutations(),null===c)?null:c.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map(a=>a.field))}(a,b,c,d):(e=a,f=b,g=c,cZ(e.precondition,f)?(f.convertToNoDocument(f.version).setHasLocalMutations(),null):g)}function c1(a,b){var c,d;return a.type===b.type&&!!a.key.isEqual(b.key)&&!!a.precondition.isEqual(b.precondition)&&(c=a.fieldTransforms,d=b.fieldTransforms,!!(void 0===c&&void 0===d||c&&d&&a1(c,d,(a,b)=>{var c,d;return a.field.isEqual(b.field)&&(c=a.transform,d=b.transform,c instanceof cQ&&d instanceof cQ||c instanceof cS&&d instanceof cS?a1(c.elements,d.elements,bT):c instanceof cU&&d instanceof cU?bT(c.operand,d.operand):c instanceof cP&&d instanceof cP)}))&&(0===a.type?a.value.isEqual(b.value):1!==a.type||a.data.isEqual(b.data)&&a.fieldMask.isEqual(b.fieldMask)))}class c2 extends c${constructor(a,b,c,d=[]){super(),this.key=a,this.value=b,this.precondition=c,this.fieldTransforms=d,this.type=0}getFieldMask(){return null}}class c3 extends c${constructor(a,b,c,d,e=[]){super(),this.key=a,this.data=b,this.fieldMask=c,this.precondition=d,this.fieldTransforms=e,this.type=1}getFieldMask(){return this.fieldMask}}function c4(a){let b=new Map;return a.fieldMask.fields.forEach(c=>{if(!c.isEmpty()){let d=a.data.field(c);b.set(c,d)}}),b}function c5(a,b,c){let d=new Map;aO(a.length===c.length,32656,{serverTransformResultCount:c.length,fieldTransformCount:a.length});for(let f=0;f<c.length;f++){var e;let g=a[f],h=g.transform,i=b.data.field(g.field);d.set(g.field,(e=c[f],h instanceof cQ?cR(h,i):h instanceof cS?cT(h,i):e))}return d}function c6(a,b,c){let d=new Map;for(let e of a){let a=e.transform,f=c.data.field(e.field);d.set(e.field,function(a,b,c){if(a instanceof cP){var d=b;let a={fields:{[bD]:{stringValue:bC},[bF]:{timestampValue:{seconds:c.seconds,nanos:c.nanoseconds}}}};return d&&bG(d)&&(d=bH(d)),d&&(a.fields[bE]=d),{mapValue:a}}if(a instanceof cQ)return cR(a,b);if(a instanceof cS)return cT(a,b);{var e=a,f=b;let c=cO(e,f),d=cV(c)+cV(e.operand);return bZ(c)&&bZ(e.operand)?cM(d):cL(e.serializer,d)}}(a,f,b))}return d}class c7 extends c${constructor(a,b){super(),this.key=a,this.precondition=b,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class c8 extends c${constructor(a,b){super(),this.key=a,this.precondition=b,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class c9{constructor(a,b,c,d){this.batchId=a,this.localWriteTime=b,this.baseMutations=c,this.mutations=d}applyToRemoteDocument(a,b){let c=b.mutationResults;for(let b=0;b<this.mutations.length;b++){let f=this.mutations[b];if(f.key.isEqual(a.key)){var d,e;let g=c[b];f instanceof c2?function(a,b,c){let d=a.value.clone(),e=c5(a.fieldTransforms,b,c.transformResults);d.setAll(e),b.convertToFoundDocument(c.version,d).setHasCommittedMutations()}(f,a,g):f instanceof c3?function(a,b,c){if(!cZ(a.precondition,b))return b.convertToUnknownDocument(c.version);let d=c5(a.fieldTransforms,b,c.transformResults),e=b.data;e.setAll(c4(a)),e.setAll(d),b.convertToFoundDocument(c.version,e).setHasCommittedMutations()}(f,a,g):(d=a,e=g,d.convertToNoDocument(e.version).setHasCommittedMutations())}}}applyToLocalView(a,b){for(let c of this.baseMutations)c.key.isEqual(a.key)&&(b=c0(c,a,b,this.localWriteTime));for(let c of this.mutations)c.key.isEqual(a.key)&&(b=c0(c,a,b,this.localWriteTime));return b}applyToLocalDocumentSet(a,b){let c=cG();return this.mutations.forEach(d=>{let e=a.get(d.key),f=e.overlayedDocument,g=this.applyToLocalView(f,e.mutatedFields),h=c_(f,g=b.has(d.key)?null:g);null!==h&&c.set(d.key,h),f.isValidDocument()||f.convertToNoDocument(bf.min())}),c}keys(){return this.mutations.reduce((a,b)=>a.add(b.key),cJ())}isEqual(a){return this.batchId===a.batchId&&a1(this.mutations,a.mutations,(a,b)=>c1(a,b))&&a1(this.baseMutations,a.baseMutations,(a,b)=>c1(a,b))}}class da{constructor(a,b,c,d){this.batch=a,this.commitVersion=b,this.mutationResults=c,this.docVersions=d}static from(a,b,c){aO(a.mutations.length===c.length,58842,{mutationsSent:a.mutations.length,resultsReceived:c.length});let d=cH,e=a.mutations;for(let a=0;a<e.length;a++)d=d.insert(e[a].key,c[a].version);return new da(a,b,c,d)}}class db{constructor(a,b){this.largestBatchId=a,this.mutation=b}getKey(){return this.mutation.key}isEqual(a){return null!==a&&this.mutation===a.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}function dc(a){if(void 0===a)return aJ("GRPC error has no .code"),aP.UNKNOWN;switch(a){case au.OK:return aP.OK;case au.CANCELLED:return aP.CANCELLED;case au.UNKNOWN:return aP.UNKNOWN;case au.DEADLINE_EXCEEDED:return aP.DEADLINE_EXCEEDED;case au.RESOURCE_EXHAUSTED:return aP.RESOURCE_EXHAUSTED;case au.INTERNAL:return aP.INTERNAL;case au.UNAVAILABLE:return aP.UNAVAILABLE;case au.UNAUTHENTICATED:return aP.UNAUTHENTICATED;case au.INVALID_ARGUMENT:return aP.INVALID_ARGUMENT;case au.NOT_FOUND:return aP.NOT_FOUND;case au.ALREADY_EXISTS:return aP.ALREADY_EXISTS;case au.PERMISSION_DENIED:return aP.PERMISSION_DENIED;case au.FAILED_PRECONDITION:return aP.FAILED_PRECONDITION;case au.ABORTED:return aP.ABORTED;case au.OUT_OF_RANGE:return aP.OUT_OF_RANGE;case au.UNIMPLEMENTED:return aP.UNIMPLEMENTED;case au.DATA_LOSS:return aP.DATA_LOSS;default:return aM(39323,{code:a})}}!function(a){a[a.OK=0]="OK",a[a.CANCELLED=1]="CANCELLED",a[a.UNKNOWN=2]="UNKNOWN",a[a.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",a[a.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",a[a.NOT_FOUND=5]="NOT_FOUND",a[a.ALREADY_EXISTS=6]="ALREADY_EXISTS",a[a.PERMISSION_DENIED=7]="PERMISSION_DENIED",a[a.UNAUTHENTICATED=16]="UNAUTHENTICATED",a[a.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",a[a.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",a[a.ABORTED=10]="ABORTED",a[a.OUT_OF_RANGE=11]="OUT_OF_RANGE",a[a.UNIMPLEMENTED=12]="UNIMPLEMENTED",a[a.INTERNAL=13]="INTERNAL",a[a.UNAVAILABLE=14]="UNAVAILABLE",a[a.DATA_LOSS=15]="DATA_LOSS"}(au||(au={})),new at([0xffffffff,0xffffffff],0);let dd=(()=>{let a={};return a.asc="ASCENDING",a.desc="DESCENDING",a})(),de=(()=>{let a={};return a["<"]="LESS_THAN",a["<="]="LESS_THAN_OR_EQUAL",a[">"]="GREATER_THAN",a[">="]="GREATER_THAN_OR_EQUAL",a["=="]="EQUAL",a["!="]="NOT_EQUAL",a["array-contains"]="ARRAY_CONTAINS",a.in="IN",a["not-in"]="NOT_IN",a["array-contains-any"]="ARRAY_CONTAINS_ANY",a})(),df=(()=>{let a={};return a.and="AND",a.or="OR",a})();class dg{constructor(a,b){this.databaseId=a,this.useProto3Json=b}}function dh(a,b){if(!a.useProto3Json)return{seconds:""+b.seconds,nanos:b.nanoseconds};{let a=new Date(1e3*b.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),c=("000000000"+b.nanoseconds).slice(-9);return`${a}.${c}Z`}}function di(a){let b=bz(a);return new be(b.seconds,b.nanos)}function dj(a){return aO(!!a,49232),bf.fromTimestamp(di(a))}function dk(a,b){return dl(a,b).canonicalString()}function dl(a,b){var c;let d=new a4(["projects",(c=a).projectId,"databases",c.database]).child("documents");return void 0===b?d:d.child(b)}function dm(a,b){return dk(a.databaseId,b.path)}function dn(a,b,c){return{name:dm(a,b),fields:c.value.mapValue.fields}}function dp(a){return{fieldPath:a.canonicalString()}}function dq(a){return a6.fromServerFormat(a.fieldPath)}class dr{constructor(a){this.remoteSerializer=a}}class ds{constructor(){}writeIndexValue(a,b){this.writeIndexValueAux(a,b),b.writeInfinity()}writeIndexValueAux(a,b){if("nullValue"in a)this.writeValueTypeLabel(b,5);else if("booleanValue"in a)this.writeValueTypeLabel(b,10),b.writeNumber(+!!a.booleanValue);else if("integerValue"in a)this.writeValueTypeLabel(b,15),b.writeNumber(bA(a.integerValue));else if("doubleValue"in a){let c=bA(a.doubleValue);isNaN(c)?this.writeValueTypeLabel(b,13):(this.writeValueTypeLabel(b,15),bM(c)?b.writeNumber(0):b.writeNumber(c))}else if("timestampValue"in a){let c=a.timestampValue;this.writeValueTypeLabel(b,20),"string"==typeof c&&(c=bz(c)),b.writeString(`${c.seconds||""}`),b.writeNumber(c.nanos||0)}else if("stringValue"in a)this.writeIndexString(a.stringValue,b),this.writeTruncationMarker(b);else if("bytesValue"in a)this.writeValueTypeLabel(b,30),b.writeBytes(bB(a.bytesValue)),this.writeTruncationMarker(b);else if("referenceValue"in a)this.writeIndexEntityRef(a.referenceValue,b);else if("geoPointValue"in a){let c=a.geoPointValue;this.writeValueTypeLabel(b,45),b.writeNumber(c.latitude||0),b.writeNumber(c.longitude||0)}else"mapValue"in a?b4(a)?this.writeValueTypeLabel(b,Number.MAX_SAFE_INTEGER):b2(a)?this.writeIndexVector(a.mapValue,b):(this.writeIndexMap(a.mapValue,b),this.writeTruncationMarker(b)):"arrayValue"in a?(this.writeIndexArray(a.arrayValue,b),this.writeTruncationMarker(b)):aM(19022,{indexValue:a})}writeIndexString(a,b){this.writeValueTypeLabel(b,25),this.writeUnlabeledIndexString(a,b)}writeUnlabeledIndexString(a,b){b.writeString(a)}writeIndexMap(a,b){let c=a.fields||{};for(let a of(this.writeValueTypeLabel(b,55),Object.keys(c)))this.writeIndexString(a,b),this.writeIndexValueAux(c[a],b)}writeIndexVector(a,b){let c=a.fields||{};this.writeValueTypeLabel(b,53);let d=c[bR].arrayValue?.values?.length||0;this.writeValueTypeLabel(b,15),b.writeNumber(bA(d)),this.writeIndexString(bR,b),this.writeIndexValueAux(c[bR],b)}writeIndexArray(a,b){let c=a.values||[];for(let a of(this.writeValueTypeLabel(b,50),c))this.writeIndexValueAux(a,b)}writeIndexEntityRef(a,b){this.writeValueTypeLabel(b,37),a7.fromName(a).path.forEach(a=>{this.writeValueTypeLabel(b,60),this.writeUnlabeledIndexString(a,b)})}writeValueTypeLabel(a,b){a.writeNumber(b)}writeTruncationMarker(a){a.writeNumber(2)}}ds.INSTANCE=new ds;class dt{constructor(){this.collectionParentIndex=new du}addToCollectionParentIndex(a,b){return this.collectionParentIndex.add(b),bk.resolve()}getCollectionParents(a,b){return bk.resolve(this.collectionParentIndex.getEntries(b))}addFieldIndex(a,b){return bk.resolve()}deleteFieldIndex(a,b){return bk.resolve()}deleteAllFieldIndexes(a){return bk.resolve()}createTargetIndexes(a,b){return bk.resolve()}getDocumentsMatchingTarget(a,b){return bk.resolve(null)}getIndexType(a,b){return bk.resolve(0)}getFieldIndexes(a,b){return bk.resolve([])}getNextCollectionGroupToUpdate(a){return bk.resolve(null)}getMinOffset(a,b){return bk.resolve(bh.min())}getMinOffsetFromCollectionGroup(a,b){return bk.resolve(bh.min())}updateCollectionGroup(a,b,c){return bk.resolve()}updateIndexEntries(a,b){return bk.resolve()}}class du{constructor(){this.index={}}add(a){let b=a.lastSegment(),c=a.popLast(),d=this.index[b]||new bu(a4.comparator),e=!d.has(c);return this.index[b]=d.add(c),e}has(a){let b=a.lastSegment(),c=a.popLast(),d=this.index[b];return d&&d.has(c)}getEntries(a){return(this.index[a]||new bu(a4.comparator)).toArray()}}new Uint8Array(0);class dv{constructor(a){this.lastId=a}next(){return this.lastId+=2,this.lastId}static forTargetCache(){return new dv(0)}static forSyncEngine(){return new dv(-1)}}let dw={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class dx{static withCacheSize(a){return new dx(a,dx.DEFAULT_COLLECTION_PERCENTILE,dx.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(a,b,c){this.cacheSizeCollectionThreshold=a,this.percentileToCollect=b,this.maximumSequenceNumbersToCollect=c}}dx.DEFAULT_COLLECTION_PERCENTILE=10,dx.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,dx.DEFAULT=new dx(0x2800000,dx.DEFAULT_COLLECTION_PERCENTILE,dx.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),dx.DISABLED=new dx(-1,0,0);let dy="LruGarbageCollector";function dz([a,b],[c,d]){let e=a$(a,c);return 0===e?a$(b,d):e}class dA{constructor(a){this.maxElements=a,this.buffer=new bu(dz),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(a){let b=[a,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(b);else{let a=this.buffer.last();0>dz(b,a)&&(this.buffer=this.buffer.delete(a).add(b))}}get maxValue(){return this.buffer.last()[0]}}class dB{constructor(a,b,c){this.garbageCollector=a,this.asyncQueue=b,this.localStore=c,this.gcTask=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.scheduleGC(6e4)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return null!==this.gcTask}scheduleGC(a){aI(dy,`Garbage collection scheduled in ${a}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",a,async()=>{this.gcTask=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(a){bl(a)?aI(dy,"Ignoring IndexedDB error during garbage collection: ",a):await bj(a)}await this.scheduleGC(3e5)})}}class dC{constructor(a,b){this.delegate=a,this.params=b}calculateTargetCount(a,b){return this.delegate.getSequenceNumberCount(a).next(a=>Math.floor(b/100*a))}nthSequenceNumber(a,b){if(0===b)return bk.resolve(bm.INVALID);let c=new dA(b);return this.delegate.forEachTarget(a,a=>c.addElement(a.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(a,a=>c.addElement(a))).next(()=>c.maxValue)}removeTargets(a,b,c){return this.delegate.removeTargets(a,b,c)}removeOrphanedDocuments(a,b){return this.delegate.removeOrphanedDocuments(a,b)}collect(a,b){return -1===this.params.cacheSizeCollectionThreshold?(aI("LruGarbageCollector","Garbage collection skipped; disabled"),bk.resolve(dw)):this.getCacheSize(a).next(c=>c<this.params.cacheSizeCollectionThreshold?(aI("LruGarbageCollector",`Garbage collection skipped; Cache size ${c} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),dw):this.runGarbageCollection(a,b))}getCacheSize(a){return this.delegate.getCacheSize(a)}runGarbageCollection(a,b){let c,d,e,f,g,h,i,j=Date.now();return this.calculateTargetCount(a,this.params.percentileToCollect).next(b=>(b>this.params.maximumSequenceNumbersToCollect?(aI("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${b}`),d=this.params.maximumSequenceNumbersToCollect):d=b,f=Date.now(),this.nthSequenceNumber(a,d))).next(d=>(c=d,g=Date.now(),this.removeTargets(a,c,b))).next(b=>(e=b,h=Date.now(),this.removeOrphanedDocuments(a,c))).next(a=>(i=Date.now(),aH()<=as.DEBUG&&aI("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${f-j}ms
	Determined least recently used ${d} in ${g-f}ms
	Removed ${e} targets in ${h-g}ms
	Removed ${a} documents in ${i-h}ms
Total Duration: ${i-j}ms`),bk.resolve({didRun:!0,sequenceNumbersCollected:d,targetsRemoved:e,documentsRemoved:a})))}}class dD{constructor(){this.changes=new cB(a=>a.toString(),(a,b)=>a.isEqual(b)),this.changesApplied=!1}addEntry(a){this.assertNotApplied(),this.changes.set(a.key,a)}removeEntry(a,b){this.assertNotApplied(),this.changes.set(a,b6.newInvalidDocument(a).setReadTime(b))}getEntry(a,b){this.assertNotApplied();let c=this.changes.get(b);return void 0!==c?bk.resolve(c):this.getFromCache(a,b)}getEntries(a,b){return this.getAllFromCache(a,b)}apply(a){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(a)}assertNotApplied(){}}class dE{constructor(a,b){this.overlayedDocument=a,this.mutatedFields=b}}class dF{constructor(a,b,c,d){this.remoteDocumentCache=a,this.mutationQueue=b,this.documentOverlayCache=c,this.indexManager=d}getDocument(a,b){let c=null;return this.documentOverlayCache.getOverlay(a,b).next(d=>(c=d,this.remoteDocumentCache.getEntry(a,b))).next(a=>(null!==c&&c0(c.mutation,a,bw.empty(),be.now()),a))}getDocuments(a,b){return this.remoteDocumentCache.getEntries(a,b).next(b=>this.getLocalViewOfDocuments(a,b,cJ()).next(()=>b))}getLocalViewOfDocuments(a,b,c=cJ()){let d=cG();return this.populateOverlays(a,d,b).next(()=>this.computeViews(a,b,d,c).next(a=>{let b=cE();return a.forEach((a,c)=>{b=b.insert(a,c.overlayedDocument)}),b}))}getOverlayedDocuments(a,b){let c=cG();return this.populateOverlays(a,c,b).next(()=>this.computeViews(a,b,c,cJ()))}populateOverlays(a,b,c){let d=[];return c.forEach(a=>{b.has(a)||d.push(a)}),this.documentOverlayCache.getOverlays(a,d).next(a=>{a.forEach((a,c)=>{b.set(a,c)})})}computeViews(a,b,c,d){let e=cC,f=cG(),g=cG();return b.forEach((a,b)=>{let g=c.get(b.key);d.has(b.key)&&(void 0===g||g.mutation instanceof c3)?e=e.insert(b.key,b):void 0!==g?(f.set(b.key,g.mutation.getFieldMask()),c0(g.mutation,b,g.mutation.getFieldMask(),be.now())):f.set(b.key,bw.empty())}),this.recalculateAndSaveOverlays(a,e).next(a=>(a.forEach((a,b)=>f.set(a,b)),b.forEach((a,b)=>g.set(a,new dE(b,f.get(a)??null))),g))}recalculateAndSaveOverlays(a,b){let c=cG(),d=new bq((a,b)=>a-b),e=cJ();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(a,b).next(a=>{for(let e of a)e.keys().forEach(a=>{let f=b.get(a);if(null===f)return;let g=c.get(a)||bw.empty();g=e.applyToLocalView(f,g),c.set(a,g);let h=(d.get(e.batchId)||cJ()).add(a);d=d.insert(e.batchId,h)})}).next(()=>{let f=[],g=d.getReverseIterator();for(;g.hasNext();){let d=g.getNext(),h=d.key,i=d.value,j=cG();i.forEach(a=>{if(!e.has(a)){let d=c_(b.get(a),c.get(a));null!==d&&j.set(a,d),e=e.add(a)}}),f.push(this.documentOverlayCache.saveOverlays(a,h,j))}return bk.waitFor(f)}).next(()=>c)}recalculateAndSaveOverlaysForDocumentKeys(a,b){return this.remoteDocumentCache.getEntries(a,b).next(b=>this.recalculateAndSaveOverlays(a,b))}getDocumentsMatchingQuery(a,b,c,d){return a7.isDocumentKey(b.path)&&null===b.collectionGroup&&0===b.filters.length?this.getDocumentsMatchingDocumentQuery(a,b.path):null!==b.collectionGroup?this.getDocumentsMatchingCollectionGroupQuery(a,b,c,d):this.getDocumentsMatchingCollectionQuery(a,b,c,d)}getNextDocuments(a,b,c,d){return this.remoteDocumentCache.getAllFromCollectionGroup(a,b,c,d).next(e=>{let f=d-e.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(a,b,c.largestBatchId,d-e.size):bk.resolve(cG()),g=-1,h=e;return f.next(b=>bk.forEach(b,(b,c)=>(g<c.largestBatchId&&(g=c.largestBatchId),e.get(b))?bk.resolve():this.remoteDocumentCache.getEntry(a,b).next(a=>{h=h.insert(b,a)})).next(()=>this.populateOverlays(a,b,e)).next(()=>this.computeViews(a,h,b,cJ())).next(a=>({batchId:g,changes:cF(a)})))})}getDocumentsMatchingDocumentQuery(a,b){return this.getDocument(a,new a7(b)).next(a=>{let b=cE();return a.isFoundDocument()&&(b=b.insert(a.key,a)),b})}getDocumentsMatchingCollectionGroupQuery(a,b,c,d){let e=b.collectionGroup,f=cE();return this.indexManager.getCollectionParents(a,e).next(g=>bk.forEach(g,g=>{let h=new cs(g.child(e),null,b.explicitOrderBy.slice(),b.filters.slice(),b.limit,b.limitType,b.startAt,b.endAt);return this.getDocumentsMatchingCollectionQuery(a,h,c,d).next(a=>{a.forEach((a,b)=>{f=f.insert(a,b)})})}).next(()=>f))}getDocumentsMatchingCollectionQuery(a,b,c,d){let e;return this.documentOverlayCache.getOverlaysForCollection(a,b.path,c.largestBatchId).next(f=>(e=f,this.remoteDocumentCache.getDocumentsMatchingQuery(a,b,c,e,d))).next(a=>{e.forEach((b,c)=>{let d=c.getKey();null===a.get(d)&&(a=a.insert(d,b6.newInvalidDocument(d)))});let c=cE();return a.forEach((a,d)=>{let f=e.get(a);void 0!==f&&c0(f.mutation,d,bw.empty(),be.now()),cA(b,d)&&(c=c.insert(a,d))}),c})}}class dG{constructor(a){this.serializer=a,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(a,b){return bk.resolve(this.bundles.get(b))}saveBundleMetadata(a,b){return this.bundles.set(b.id,{id:b.id,version:b.version,createTime:dj(b.createTime)}),bk.resolve()}getNamedQuery(a,b){return bk.resolve(this.namedQueries.get(b))}saveNamedQuery(a,b){return this.namedQueries.set(b.name,{name:b.name,query:function(a){let b=function(a){var b;let c,d=function(a){var b;let c=function(a){var b;let c=a4.fromString(a);return aO((b=c).length>=4&&"projects"===b.get(0)&&"databases"===b.get(2),10190,{key:c.toString()}),c}(a);return 4===c.length?a4.emptyPath():(aO((b=c).length>4&&"documents"===b.get(4),29091,{key:b.toString()}),b.popFirst(5))}(a.parent),e=a.structuredQuery,f=e.from?e.from.length:0,g=null;if(f>0){aO(1===f,65062);let a=e.from[0];a.allDescendants?g=a.collectionId:d=d.child(a.collectionId)}let h=[];e.where&&(h=function(a){var b;let c=function a(b){if(void 0!==b.unaryFilter){var c,d,e=b;switch(e.unaryFilter.op){case"IS_NAN":let a=dq(e.unaryFilter.field);return cc.create(a,"==",{doubleValue:NaN});case"IS_NULL":let f=dq(e.unaryFilter.field);return cc.create(f,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let g=dq(e.unaryFilter.field);return cc.create(g,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let h=dq(e.unaryFilter.field);return cc.create(h,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return aM(61313);default:return aM(60726)}}if(void 0!==b.fieldFilter){return c=b,cc.create(dq(c.fieldFilter.field),function(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return aM(58110);default:return aM(50506)}}(c.fieldFilter.op),c.fieldFilter.value)}if(void 0===b.compositeFilter)return aM(30097,{filter:b});return d=b,cd.create(d.compositeFilter.filters.map(b=>a(b)),function(a){switch(a){case"AND":return"and";case"OR":return"or";default:return aM(1026)}}(d.compositeFilter.op))}(a);return c instanceof cd&&cf(b=c)&&ce(b)?c.getFilters():[c]}(e.where));let i=[];e.orderBy&&(i=e.orderBy.map(a=>{var b;return new ca(dq((b=a).field),function(a){switch(a){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(b.direction))}));let j=null;e.limit&&(j=null==(c="object"==typeof(b=e.limit)?b.value:b)?null:c);let k=null;e.startAt&&(k=function(a){let b=!!a.before;return new b7(a.values||[],b)}(e.startAt));let l=null;return e.endAt&&(l=function(a){let b=!a.before;return new b7(a.values||[],b)}(e.endAt)),new cs(d,g,i,h,j,"F",k,l)}({parent:a.parent,structuredQuery:a.structuredQuery});return"LAST"===a.limitType?cw(b,b.limit,"L"):b}(b.bundledQuery),readTime:dj(b.readTime)}),bk.resolve()}}class dH{constructor(){this.overlays=new bq(a7.comparator),this.overlayByBatchId=new Map}getOverlay(a,b){return bk.resolve(this.overlays.get(b))}getOverlays(a,b){let c=cG();return bk.forEach(b,b=>this.getOverlay(a,b).next(a=>{null!==a&&c.set(b,a)})).next(()=>c)}saveOverlays(a,b,c){return c.forEach((c,d)=>{this.saveOverlay(a,b,d)}),bk.resolve()}removeOverlaysForBatchId(a,b,c){let d=this.overlayByBatchId.get(c);return void 0!==d&&(d.forEach(a=>this.overlays=this.overlays.remove(a)),this.overlayByBatchId.delete(c)),bk.resolve()}getOverlaysForCollection(a,b,c){let d=cG(),e=b.length+1,f=new a7(b.child("")),g=this.overlays.getIteratorFrom(f);for(;g.hasNext();){let a=g.getNext().value,f=a.getKey();if(!b.isPrefixOf(f.path))break;f.path.length===e&&a.largestBatchId>c&&d.set(a.getKey(),a)}return bk.resolve(d)}getOverlaysForCollectionGroup(a,b,c,d){let e=new bq((a,b)=>a-b),f=this.overlays.getIterator();for(;f.hasNext();){let a=f.getNext().value;if(a.getKey().getCollectionGroup()===b&&a.largestBatchId>c){let b=e.get(a.largestBatchId);null===b&&(b=cG(),e=e.insert(a.largestBatchId,b)),b.set(a.getKey(),a)}}let g=cG(),h=e.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((a,b)=>g.set(a,b)),!(g.size()>=d)););return bk.resolve(g)}saveOverlay(a,b,c){let d=this.overlays.get(c.key);if(null!==d){let a=this.overlayByBatchId.get(d.largestBatchId).delete(c.key);this.overlayByBatchId.set(d.largestBatchId,a)}this.overlays=this.overlays.insert(c.key,new db(b,c));let e=this.overlayByBatchId.get(b);void 0===e&&(e=cJ(),this.overlayByBatchId.set(b,e)),this.overlayByBatchId.set(b,e.add(c.key))}}class dI{constructor(){this.sessionToken=bx.EMPTY_BYTE_STRING}getSessionToken(a){return bk.resolve(this.sessionToken)}setSessionToken(a,b){return this.sessionToken=b,bk.resolve()}}class dJ{constructor(){this.refsByKey=new bu(dK.compareByKey),this.refsByTarget=new bu(dK.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(a,b){let c=new dK(a,b);this.refsByKey=this.refsByKey.add(c),this.refsByTarget=this.refsByTarget.add(c)}addReferences(a,b){a.forEach(a=>this.addReference(a,b))}removeReference(a,b){this.removeRef(new dK(a,b))}removeReferences(a,b){a.forEach(a=>this.removeReference(a,b))}removeReferencesForId(a){let b=new a7(new a4([])),c=new dK(b,a),d=new dK(b,a+1),e=[];return this.refsByTarget.forEachInRange([c,d],a=>{this.removeRef(a),e.push(a.key)}),e}removeAllReferences(){this.refsByKey.forEach(a=>this.removeRef(a))}removeRef(a){this.refsByKey=this.refsByKey.delete(a),this.refsByTarget=this.refsByTarget.delete(a)}referencesForId(a){let b=new a7(new a4([])),c=new dK(b,a),d=new dK(b,a+1),e=cJ();return this.refsByTarget.forEachInRange([c,d],a=>{e=e.add(a.key)}),e}containsKey(a){let b=new dK(a,0),c=this.refsByKey.firstAfterOrEqual(b);return null!==c&&a.isEqual(c.key)}}class dK{constructor(a,b){this.key=a,this.targetOrBatchId=b}static compareByKey(a,b){return a7.comparator(a.key,b.key)||a$(a.targetOrBatchId,b.targetOrBatchId)}static compareByTargetId(a,b){return a$(a.targetOrBatchId,b.targetOrBatchId)||a7.comparator(a.key,b.key)}}class dL{constructor(a,b){this.indexManager=a,this.referenceDelegate=b,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new bu(dK.compareByKey)}checkEmpty(a){return bk.resolve(0===this.mutationQueue.length)}addMutationBatch(a,b,c,d){let e=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let f=new c9(e,b,c,d);for(let b of(this.mutationQueue.push(f),d))this.batchesByDocumentKey=this.batchesByDocumentKey.add(new dK(b.key,e)),this.indexManager.addToCollectionParentIndex(a,b.key.path.popLast());return bk.resolve(f)}lookupMutationBatch(a,b){return bk.resolve(this.findMutationBatch(b))}getNextMutationBatchAfterBatchId(a,b){let c=this.indexOfBatchId(b+1),d=c<0?0:c;return bk.resolve(this.mutationQueue.length>d?this.mutationQueue[d]:null)}getHighestUnacknowledgedBatchId(){return bk.resolve(0===this.mutationQueue.length?-1:this.nextBatchId-1)}getAllMutationBatches(a){return bk.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(a,b){let c=new dK(b,0),d=new dK(b,1/0),e=[];return this.batchesByDocumentKey.forEachInRange([c,d],a=>{let b=this.findMutationBatch(a.targetOrBatchId);e.push(b)}),bk.resolve(e)}getAllMutationBatchesAffectingDocumentKeys(a,b){let c=new bu(a$);return b.forEach(a=>{let b=new dK(a,0),d=new dK(a,1/0);this.batchesByDocumentKey.forEachInRange([b,d],a=>{c=c.add(a.targetOrBatchId)})}),bk.resolve(this.findMutationBatches(c))}getAllMutationBatchesAffectingQuery(a,b){let c=b.path,d=c.length+1,e=c;a7.isDocumentKey(e)||(e=e.child(""));let f=new dK(new a7(e),0),g=new bu(a$);return this.batchesByDocumentKey.forEachWhile(a=>{let b=a.key.path;return!!c.isPrefixOf(b)&&(b.length===d&&(g=g.add(a.targetOrBatchId)),!0)},f),bk.resolve(this.findMutationBatches(g))}findMutationBatches(a){let b=[];return a.forEach(a=>{let c=this.findMutationBatch(a);null!==c&&b.push(c)}),b}removeMutationBatch(a,b){aO(0===this.indexOfExistingBatchId(b.batchId,"removed"),55003),this.mutationQueue.shift();let c=this.batchesByDocumentKey;return bk.forEach(b.mutations,d=>{let e=new dK(d.key,b.batchId);return c=c.delete(e),this.referenceDelegate.markPotentiallyOrphaned(a,d.key)}).next(()=>{this.batchesByDocumentKey=c})}removeCachedMutationKeys(a){}containsKey(a,b){let c=new dK(b,0),d=this.batchesByDocumentKey.firstAfterOrEqual(c);return bk.resolve(b.isEqual(d&&d.key))}performConsistencyCheck(a){return this.mutationQueue.length,bk.resolve()}indexOfExistingBatchId(a,b){return this.indexOfBatchId(a)}indexOfBatchId(a){return 0===this.mutationQueue.length?0:a-this.mutationQueue[0].batchId}findMutationBatch(a){let b=this.indexOfBatchId(a);return b<0||b>=this.mutationQueue.length?null:this.mutationQueue[b]}}class dM{constructor(a){this.sizer=a,this.docs=new bq(a7.comparator),this.size=0}setIndexManager(a){this.indexManager=a}addEntry(a,b){let c=b.key,d=this.docs.get(c),e=d?d.size:0,f=this.sizer(b);return this.docs=this.docs.insert(c,{document:b.mutableCopy(),size:f}),this.size+=f-e,this.indexManager.addToCollectionParentIndex(a,c.path.popLast())}removeEntry(a){let b=this.docs.get(a);b&&(this.docs=this.docs.remove(a),this.size-=b.size)}getEntry(a,b){let c=this.docs.get(b);return bk.resolve(c?c.document.mutableCopy():b6.newInvalidDocument(b))}getEntries(a,b){let c=cC;return b.forEach(a=>{let b=this.docs.get(a);c=c.insert(a,b?b.document.mutableCopy():b6.newInvalidDocument(a))}),bk.resolve(c)}getDocumentsMatchingQuery(a,b,c,d){let e=cC,f=b.path,g=new a7(f.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(g);for(;h.hasNext();){let{key:a,value:{document:g}}=h.getNext();if(!f.isPrefixOf(a.path))break;if(!(a.path.length>f.length+1))!(0>=function(a,b){let c=a.readTime.compareTo(b.readTime);return 0!==c||0!==(c=a7.comparator(a.documentKey,b.documentKey))?c:a$(a.largestBatchId,b.largestBatchId)}(new bh(g.readTime,g.key,-1),c))&&(d.has(g.key)||cA(b,g))&&(e=e.insert(g.key,g.mutableCopy()))}return bk.resolve(e)}getAllFromCollectionGroup(a,b,c,d){aM(9500)}forEachDocumentKey(a,b){return bk.forEach(this.docs,a=>b(a))}newChangeBuffer(a){return new dN(this)}getSize(a){return bk.resolve(this.size)}}class dN extends dD{constructor(a){super(),this.documentCache=a}applyChanges(a){let b=[];return this.changes.forEach((c,d)=>{d.isValidDocument()?b.push(this.documentCache.addEntry(a,d)):this.documentCache.removeEntry(c)}),bk.waitFor(b)}getFromCache(a,b){return this.documentCache.getEntry(a,b)}getAllFromCache(a,b){return this.documentCache.getEntries(a,b)}}class dO{constructor(a){this.persistence=a,this.targets=new cB(a=>cq(a),cr),this.lastRemoteSnapshotVersion=bf.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new dJ,this.targetCount=0,this.targetIdGenerator=dv.forTargetCache()}forEachTarget(a,b){return this.targets.forEach((a,c)=>b(c)),bk.resolve()}getLastRemoteSnapshotVersion(a){return bk.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(a){return bk.resolve(this.highestSequenceNumber)}allocateTargetId(a){return this.highestTargetId=this.targetIdGenerator.next(),bk.resolve(this.highestTargetId)}setTargetsMetadata(a,b,c){return c&&(this.lastRemoteSnapshotVersion=c),b>this.highestSequenceNumber&&(this.highestSequenceNumber=b),bk.resolve()}saveTargetData(a){this.targets.set(a.target,a);let b=a.targetId;b>this.highestTargetId&&(this.targetIdGenerator=new dv(b),this.highestTargetId=b),a.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=a.sequenceNumber)}addTargetData(a,b){return this.saveTargetData(b),this.targetCount+=1,bk.resolve()}updateTargetData(a,b){return this.saveTargetData(b),bk.resolve()}removeTargetData(a,b){return this.targets.delete(b.target),this.references.removeReferencesForId(b.targetId),this.targetCount-=1,bk.resolve()}removeTargets(a,b,c){let d=0,e=[];return this.targets.forEach((f,g)=>{g.sequenceNumber<=b&&null===c.get(g.targetId)&&(this.targets.delete(f),e.push(this.removeMatchingKeysForTargetId(a,g.targetId)),d++)}),bk.waitFor(e).next(()=>d)}getTargetCount(a){return bk.resolve(this.targetCount)}getTargetData(a,b){let c=this.targets.get(b)||null;return bk.resolve(c)}addMatchingKeys(a,b,c){return this.references.addReferences(b,c),bk.resolve()}removeMatchingKeys(a,b,c){this.references.removeReferences(b,c);let d=this.persistence.referenceDelegate,e=[];return d&&b.forEach(b=>{e.push(d.markPotentiallyOrphaned(a,b))}),bk.waitFor(e)}removeMatchingKeysForTargetId(a,b){return this.references.removeReferencesForId(b),bk.resolve()}getMatchingKeysForTargetId(a,b){let c=this.references.referencesForId(b);return bk.resolve(c)}containsKey(a,b){return bk.resolve(this.references.containsKey(b))}}class dP{constructor(a,b){this.mutationQueues={},this.overlays={},this.listenSequence=new bm(0),this._started=!1,this._started=!0,this.globalsCache=new dI,this.referenceDelegate=a(this),this.targetCache=new dO(this);let c=a=>this.referenceDelegate.documentSize(a);this.indexManager=new dt,this.remoteDocumentCache=new dM(c),this.serializer=new dr(b),this.bundleCache=new dG(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(a){return this.indexManager}getDocumentOverlayCache(a){let b=this.overlays[a.toKey()];return b||(b=new dH,this.overlays[a.toKey()]=b),b}getMutationQueue(a,b){let c=this.mutationQueues[a.toKey()];return c||(c=new dL(b,this.referenceDelegate),this.mutationQueues[a.toKey()]=c),c}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(a,b,c){aI("MemoryPersistence","Starting transaction:",a);let d=new dQ(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),c(d).next(a=>this.referenceDelegate.onTransactionCommitted(d).next(()=>a)).toPromise().then(a=>(d.raiseOnCommittedEvent(),a))}mutationQueuesContainKey(a,b){return bk.or(Object.values(this.mutationQueues).map(c=>()=>c.containsKey(a,b)))}}class dQ extends bi{constructor(a){super(),this.currentSequenceNumber=a}}class dR{constructor(a){this.persistence=a,this.localViewReferences=new dJ,this._orphanedDocuments=null}static factory(a){return new dR(a)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw aM(60996)}addReference(a,b,c){return this.localViewReferences.addReference(c,b),this.orphanedDocuments.delete(c.toString()),bk.resolve()}removeReference(a,b,c){return this.localViewReferences.removeReference(c,b),this.orphanedDocuments.add(c.toString()),bk.resolve()}markPotentiallyOrphaned(a,b){return this.orphanedDocuments.add(b.toString()),bk.resolve()}removeTarget(a,b){this.localViewReferences.removeReferencesForId(b.targetId).forEach(a=>this.orphanedDocuments.add(a.toString()));let c=this.persistence.getTargetCache();return c.getMatchingKeysForTargetId(a,b.targetId).next(a=>{a.forEach(a=>this.orphanedDocuments.add(a.toString()))}).next(()=>c.removeTargetData(a,b))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(a){let b=this.persistence.getRemoteDocumentCache().newChangeBuffer();return bk.forEach(this.orphanedDocuments,c=>{let d=a7.fromPath(c);return this.isReferenced(a,d).next(a=>{a||b.removeEntry(d,bf.min())})}).next(()=>(this._orphanedDocuments=null,b.apply(a)))}updateLimboDocument(a,b){return this.isReferenced(a,b).next(a=>{a?this.orphanedDocuments.delete(b.toString()):this.orphanedDocuments.add(b.toString())})}documentSize(a){return 0}isReferenced(a,b){return bk.or([()=>bk.resolve(this.localViewReferences.containsKey(b)),()=>this.persistence.getTargetCache().containsKey(a,b),()=>this.persistence.mutationQueuesContainKey(a,b)])}}class dS{constructor(a,b){this.persistence=a,this.orphanedSequenceNumbers=new cB(a=>(function(a){let b="";for(let c=0;c<a.length;c++)b.length>0&&(b+="\x01\x01"),b=function(a,b){let c=b,d=a.length;for(let b=0;b<d;b++){let d=a.charAt(b);switch(d){case"\0":c+="\x01\x10";break;case"\x01":c+="\x01\x11";break;default:c+=d}}return c}(a.get(c),b);return b+"\x01\x01"})(a.path),(a,b)=>a.isEqual(b)),this.garbageCollector=new dC(this,b)}static factory(a,b){return new dS(a,b)}onTransactionStarted(){}onTransactionCommitted(a){return bk.resolve()}forEachTarget(a,b){return this.persistence.getTargetCache().forEachTarget(a,b)}getSequenceNumberCount(a){let b=this.orphanedDocumentCount(a);return this.persistence.getTargetCache().getTargetCount(a).next(a=>b.next(b=>a+b))}orphanedDocumentCount(a){let b=0;return this.forEachOrphanedDocumentSequenceNumber(a,a=>{b++}).next(()=>b)}forEachOrphanedDocumentSequenceNumber(a,b){return bk.forEach(this.orphanedSequenceNumbers,(c,d)=>this.isPinned(a,c,d).next(a=>a?bk.resolve():b(d)))}removeTargets(a,b,c){return this.persistence.getTargetCache().removeTargets(a,b,c)}removeOrphanedDocuments(a,b){let c=0,d=this.persistence.getRemoteDocumentCache(),e=d.newChangeBuffer();return d.forEachDocumentKey(a,d=>this.isPinned(a,d,b).next(a=>{a||(c++,e.removeEntry(d,bf.min()))})).next(()=>e.apply(a)).next(()=>c)}markPotentiallyOrphaned(a,b){return this.orphanedSequenceNumbers.set(b,a.currentSequenceNumber),bk.resolve()}removeTarget(a,b){let c=b.withSequenceNumber(a.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(a,c)}addReference(a,b,c){return this.orphanedSequenceNumbers.set(c,a.currentSequenceNumber),bk.resolve()}removeReference(a,b,c){return this.orphanedSequenceNumbers.set(c,a.currentSequenceNumber),bk.resolve()}updateLimboDocument(a,b){return this.orphanedSequenceNumbers.set(b,a.currentSequenceNumber),bk.resolve()}documentSize(a){let b=a.key.toString().length;return a.isFoundDocument()&&(b+=function a(b){switch(bS(b)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let c=bH(b);return c?16+a(c):16;case 5:return 2*b.stringValue.length;case 6:return bB(b.bytesValue).approximateByteSize();case 7:return b.referenceValue.length;case 9:return(b.arrayValue.values||[]).reduce((b,c)=>b+a(c),0);case 10:case 11:var d;let e;return d=b.mapValue,e=0,bo(d.fields,(b,c)=>{e+=b.length+a(c)}),e;default:throw aM(13486,{value:b})}}(a.data.value)),b}isPinned(a,b,c){return bk.or([()=>this.persistence.mutationQueuesContainKey(a,b),()=>this.persistence.getTargetCache().containsKey(a,b),()=>{let a=this.orphanedSequenceNumbers.get(b);return bk.resolve(void 0!==a&&a>c)}])}getCacheSize(a){return this.persistence.getRemoteDocumentCache().getSize(a)}}class dT{constructor(a,b,c,d){this.persistence=a,this.queryEngine=b,this.serializer=d,this.targetDataByTarget=new bq(a$),this.targetIdByTarget=new cB(a=>cq(a),cr),this.collectionGroupReadTime=new Map,this.remoteDocuments=a.getRemoteDocumentCache(),this.targetCache=a.getTargetCache(),this.bundleCache=a.getBundleCache(),this.initializeUserComponents(c)}initializeUserComponents(a){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(a),this.indexManager=this.persistence.getIndexManager(a),this.mutationQueue=this.persistence.getMutationQueue(a,this.indexManager),this.localDocuments=new dF(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(a){return this.persistence.runTransaction("Collect garbage","readwrite-primary",b=>a.collect(b,this.targetDataByTarget))}}async function dU(a,b){return await a.persistence.runTransaction("Handle user change","readonly",c=>{let d;return a.mutationQueue.getAllMutationBatches(c).next(e=>(d=e,a.initializeUserComponents(b),a.mutationQueue.getAllMutationBatches(c))).next(b=>{let e=[],f=[],g=cJ();for(let a of d)for(let b of(e.push(a.batchId),a.mutations))g=g.add(b.key);for(let a of b)for(let b of(f.push(a.batchId),a.mutations))g=g.add(b.key);return a.localDocuments.getDocuments(c,g).next(a=>({affectedDocuments:a,removedBatchIds:e,addedBatchIds:f}))})})}async function dV(a,b){try{await a.persistence.runTransaction("notifyLocalViewChanges","readwrite",c=>bk.forEach(b,b=>bk.forEach(b.addedKeys,d=>a.persistence.referenceDelegate.addReference(c,b.targetId,d)).next(()=>bk.forEach(b.removedKeys,d=>a.persistence.referenceDelegate.removeReference(c,b.targetId,d)))))}catch(a){if(bl(a))aI("LocalStore","Failed to update sequence numbers: "+a);else throw a}for(let c of b){let b=c.targetId;if(!c.fromCache){let c=a.targetDataByTarget.get(b),d=c.snapshotVersion,e=c.withLastLimboFreeSnapshotVersion(d);a.targetDataByTarget=a.targetDataByTarget.insert(b,e)}}}class dW{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(a){this._documentReadCount+=a}}class dX{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=100,this.relativeIndexReadCostPerDocument=!function(){let a=(()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;let a=process.env.__FIREBASE_DEFAULTS__;if(a)return JSON.parse(a)})()||(()=>{let a;if("undefined"==typeof document)return;try{a=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(a){return}let b=a&&af(a[1]);return b&&JSON.parse(b)})()}catch(a){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${a}`);return}})()?.forceEnvironment;if("node"===a)return!0;if("browser"===a)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(a){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:function(a){let b=a.match(/Android ([\d.]+)/i);return Number(b?b[1].split(".").slice(0,2).join("."):"-1")}("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")>0?6:4}initialize(a,b){this.localDocumentsView=a,this.indexManager=b,this.initialized=!0}getDocumentsMatchingQuery(a,b,c,d){let e={result:null};return this.performQueryUsingIndex(a,b).next(a=>{e.result=a}).next(()=>{if(!e.result)return this.performQueryUsingRemoteKeys(a,b,d,c).next(a=>{e.result=a})}).next(()=>{if(e.result)return;let c=new dW;return this.executeFullCollectionScan(a,b,c).next(d=>{if(e.result=d,this.indexAutoCreationEnabled)return this.createCacheIndexes(a,b,c,d.size)})}).next(()=>e.result)}createCacheIndexes(a,b,c,d){return c.documentReadCount<this.indexAutoCreationMinCollectionSize?(aH()<=as.DEBUG&&aI("QueryEngine","SDK will not create cache indexes for query:",cz(b),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),bk.resolve()):(aH()<=as.DEBUG&&aI("QueryEngine","Query:",cz(b),"scans",c.documentReadCount,"local documents and returns",d,"documents as results."),c.documentReadCount>this.relativeIndexReadCostPerDocument*d)?(aH()<=as.DEBUG&&aI("QueryEngine","The SDK decides to create cache indexes for query:",cz(b),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(a,cv(b))):bk.resolve()}performQueryUsingIndex(a,b){if(ct(b))return bk.resolve(null);let c=cv(b);return this.indexManager.getIndexType(a,c).next(d=>0===d?null:(null!==b.limit&&1===d&&(c=cv(b=cw(b,null,"F"))),this.indexManager.getDocumentsMatchingTarget(a,c).next(d=>{let e=cJ(...d);return this.localDocumentsView.getDocuments(a,e).next(d=>this.indexManager.getMinOffset(a,c).next(c=>{let f=this.applyQuery(b,d);return this.needsRefill(b,f,e,c.readTime)?this.performQueryUsingIndex(a,cw(b,null,"F")):this.appendRemainingResults(a,f,b,c)}))})))}performQueryUsingRemoteKeys(a,b,c,d){return ct(b)||d.isEqual(bf.min())?bk.resolve(null):this.localDocumentsView.getDocuments(a,c).next(e=>{let f=this.applyQuery(b,e);return this.needsRefill(b,f,c,d)?bk.resolve(null):(aH()<=as.DEBUG&&aI("QueryEngine","Re-using previous result from %s to execute query: %s",d.toString(),cz(b)),this.appendRemainingResults(a,f,b,function(a,b){let c=a.toTimestamp().seconds,d=a.toTimestamp().nanoseconds+1;return new bh(bf.fromTimestamp(1e9===d?new be(c+1,0):new be(c,d)),a7.empty(),-1)}(d,0)).next(a=>a))})}applyQuery(a,b){let c=new bu((b,c)=>{let d=!1;for(let e of cu(a)){let a=function(a,b,c){let d=a.field.isKeyField()?a7.comparator(b.key,c.key):function(a,b,c){let d=b.data.field(a),e=c.data.field(a);return null!==d&&null!==e?bV(d,e):aM(42886)}(a.field,b,c);switch(a.dir){case"asc":return d;case"desc":return -1*d;default:return aM(19790,{direction:a.dir})}}(e,b,c);if(0!==a)return a;d=d||e.field.isKeyField()}return 0});return b.forEach((b,d)=>{cA(a,d)&&(c=c.add(d))}),c}needsRefill(a,b,c,d){if(null===a.limit)return!1;if(c.size!==b.size)return!0;let e="F"===a.limitType?b.last():b.first();return!!e&&(e.hasPendingWrites||e.version.compareTo(d)>0)}executeFullCollectionScan(a,b,c){return aH()<=as.DEBUG&&aI("QueryEngine","Using full collection scan to execute query:",cz(b)),this.localDocumentsView.getDocumentsMatchingQuery(a,b,bh.min(),c)}appendRemainingResults(a,b,c,d){return this.localDocumentsView.getDocumentsMatchingQuery(a,c,d).next(a=>(b.forEach(b=>{a=a.insert(b.key,b)}),a))}}class dY{constructor(){this.activeTargetIds=cK}addQueryTarget(a){this.activeTargetIds=this.activeTargetIds.add(a)}removeQueryTarget(a){this.activeTargetIds=this.activeTargetIds.delete(a)}toWebStorageJSON(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class dZ{constructor(){this.localState=new dY,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(a){}updateMutationState(a,b,c){}addLocalQueryTarget(a,b=!0){return b&&this.localState.addQueryTarget(a),this.queryState[a]||"not-current"}updateQueryState(a,b,c){this.queryState[a]=b}removeLocalQueryTarget(a){this.localState.removeQueryTarget(a)}isLocalQueryTarget(a){return this.localState.activeTargetIds.has(a)}clearQueryState(a){delete this.queryState[a]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(a){return this.localState.activeTargetIds.has(a)}start(){return this.localState=new dY,Promise.resolve()}handleUserChange(a,b,c){}setOnlineState(a){}shutdown(){}writeSequenceNumber(a){}notifyBundleLoaded(a){}}class d${addCallback(a){}shutdown(){}}class d_{constructor(a){this.sendFn=a.sendFn,this.closeFn=a.closeFn}onConnected(a){this.wrappedOnConnected=a}onOpen(a){this.wrappedOnOpen=a}onClose(a){this.wrappedOnClose=a}onMessage(a){this.wrappedOnMessage=a}close(){this.closeFn()}send(a){this.sendFn(a)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(a){this.wrappedOnClose(a)}callOnMessage(a){this.wrappedOnMessage(a)}}let d0=null;function d1(){return null===d0?d0=0x10000000+Math.round(0x80000000*Math.random()):d0++,"0x"+d0.toString(16)}let d2="GrpcConnection",d3=`gl-node/${process.versions.node} fire/${aF} grpc/1.9.15`;function d4(a,b,c,d){aO(null===b||"OAuth"===b.type,36936);let e=new aA.OS;return b&&b.headers.forEach((a,b)=>e.set(b,a)),c&&c.headers.forEach((a,b)=>e.set(b,a)),d&&e.set("X-Firebase-GMPID",d),e.set("X-Goog-Api-Client",d3),e.set("Google-Cloud-Resource-Prefix",a),e.set("x-goog-request-params",a),e}class d5{get shouldResourcePathBeIncludedInRequest(){return!0}constructor(a,b){this.databaseInfo=b,this.cachedStub=null,this.firestore=a.google.firestore.v1,this.databasePath=`projects/${b.databaseId.projectId}/databases/${b.databaseId.database}`}ensureActiveStub(){if(!this.cachedStub){aI(d2,"Creating Firestore stub.");let a=this.databaseInfo.ssl?aA.z3.createSsl():aA.z3.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,a)}return this.cachedStub}invokeRPC(a,b,c,d,e){var f;let g=d1(),h=this.ensureActiveStub(),i=d4(this.databasePath,d,e,this.databaseInfo.appId),j={database:this.databasePath,...c};return f=b=>(aI(d2,`RPC '${a}' ${g} invoked with request:`,c),h[a](j,i,(c,d)=>{c?(aI(d2,`RPC '${a}' ${g} failed with error:`,c),b(new aQ(dc(c.code),c.message))):(aI(d2,`RPC '${a}' ${g} completed with response:`,d),b(void 0,d))})),new Promise((a,b)=>{f((c,d)=>{c?b(c):a(d)})})}invokeStreamingRPC(a,b,c,d,e,f){let g=d1(),h=[],i=new aR;aI(d2,`RPC '${a}' ${g} invoked (streaming) with request:`,c);let j=this.ensureActiveStub(),k=d4(this.databasePath,d,e,this.databaseInfo.appId),l={...c,database:this.databasePath},m=j[a](l,k),n=!1;return m.on("data",b=>{aI(d2,`RPC ${a} ${g} received result:`,b),h.push(b),void 0!==f&&h.length===f&&(n=!0,i.resolve(h))}),m.on("end",()=>{aI(d2,`RPC '${a}' ${g} completed.`),n||(n=!0,i.resolve(h))}),m.on("error",b=>{aI(d2,`RPC '${a}' ${g} failed with error:`,b);let c=dc(b.code);i.reject(new aQ(c,b.message))}),i.promise}openStream(a,b,c){let d=d1(),e=this.ensureActiveStub(),f=d4(this.databasePath,b,c,this.databaseInfo.appId),g=e[a](f),h=!1,i=a=>{h||(h=!0,j.callOnClose(a),g.end())},j=new d_({sendFn:b=>{if(h)aI(d2,`RPC '${a}' stream ${d} not sending because gRPC stream is closed:`,b);else{aI(d2,`RPC '${a}' stream ${d} sending:`,b);try{g.write(b)}catch(a){throw aJ("Failure sending:",b),aJ("Error:",a),a}}},closeFn:()=>{aI(d2,`RPC '${a}' stream ${d} closed locally via close().`),i()}}),k=!1;return g.on("data",b=>{h||(aI(d2,`RPC '${a}' stream ${d} received:`,b),k||(j.callOnConnected(),k=!0),j.callOnMessage(b))}),g.on("end",()=>{aI(d2,`RPC '${a}' stream ${d} ended.`),i()}),g.on("error",b=>{h||(aK(d2,`RPC '${a}' stream ${d} error. Code:`,b.code,"Message:",b.message),i(new aQ(dc(b.code),b.message)))}),aI(d2,`Opening RPC '${a}' stream ${d} to ${this.databaseInfo.host}`),setTimeout(()=>{j.callOnOpen()},0),j}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}}let d6={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:0x44f2530,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}};var d7=Object.freeze({__proto__:null,nested:d6,default:{nested:d6}});let d8={longs:String,enums:String,defaults:!0,oneofs:!1};function d9(a){return new dg(a,!1)}class ea{constructor(a,b,c=1e3,d=1.5,e=6e4){this.queue=a,this.timerId=b,this.initialDelayMs=c,this.backoffFactor=d,this.maxDelayMs=e,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(a){this.cancel();let b=Math.floor(this.currentBaseMs+this.jitterDelayMs()),c=Math.max(0,Date.now()-this.lastAttemptTime),d=Math.max(0,b-c);d>0&&aI("ExponentialBackoff",`Backing off for ${d} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${b} ms, last attempt: ${c} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,d,()=>(this.lastAttemptTime=Date.now(),a())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){null!==this.timerPromise&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}}let eb="PersistentStream";class ec{constructor(a,b,c,d,e,f,g,h){this.queue=a,this.idleTimerId=c,this.healthTimerId=d,this.connection=e,this.authCredentialsProvider=f,this.appCheckCredentialsProvider=g,this.listener=h,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new ea(a,b)}isStarted(){return 1===this.state||5===this.state||this.isOpen()}isOpen(){return 2===this.state||3===this.state}start(){if(this.responseCount=0,4===this.state)return void this.performBackoff();this.auth()}async stop(){this.isStarted()&&await this.close(0)}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,()=>this.handleIdleCloseTimer()))}sendRequest(a){this.cancelIdleCheck(),this.stream.send(a)}async handleIdleCloseTimer(){if(this.isOpen())return this.close(0)}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}async close(a,b){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,4!==a?this.backoff.reset():b&&b.code===aP.RESOURCE_EXHAUSTED?(aJ(b.toString()),aJ("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):b&&b.code===aP.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=a,await this.listener.onClose(b)}tearDown(){}auth(){this.state=1;let a=this.getCloseGuardedDispatcher(this.closeCount),b=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,c])=>{this.closeCount===b&&this.startStream(a,c)},b=>{a(()=>{let a=new aQ(aP.UNKNOWN,"Fetching auth token failed: "+b.message);return this.handleStreamClose(a)})})}startStream(a,b){let c=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(a,b),this.stream.onConnected(()=>{c(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{c(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,1e4,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(a=>{c(()=>this.handleStreamClose(a))}),this.stream.onMessage(a=>{c(()=>1==++this.responseCount?this.onFirst(a):this.onNext(a))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(async()=>{this.state=0,this.start()})}handleStreamClose(a){return aI(eb,`close with error: ${a}`),this.stream=null,this.close(4,a)}getCloseGuardedDispatcher(a){return b=>{this.queue.enqueueAndForget(()=>this.closeCount===a?b():(aI(eb,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class ed extends ec{constructor(a,b,c,d,e,f){super(a,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",b,c,d,f),this.serializer=e}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(a,b){return this.connection.openStream("Write",a,b)}onFirst(a){return aO(!!a.streamToken,31322),this.lastStreamToken=a.streamToken,aO(!a.writeResults||0===a.writeResults.length,55816),this.listener.onHandshakeComplete()}onNext(a){var b,c;aO(!!a.streamToken,12678),this.lastStreamToken=a.streamToken,this.backoff.reset();let d=(b=a.writeResults,c=a.commitTime,b&&b.length>0?(aO(void 0!==c,14353),b.map(a=>{let b;return(b=a.updateTime?dj(a.updateTime):dj(c)).isEqual(bf.min())&&(b=dj(c)),new cX(b,a.transformResults||[])})):[]),e=dj(a.commitTime);return this.listener.onMutationResult(e,d)}writeHandshake(){var a;let b={};b.database=new a4(["projects",(a=this.serializer).databaseId.projectId,"databases",a.databaseId.database]).canonicalString(),this.sendRequest(b)}writeMutations(a){let b={streamToken:this.lastStreamToken,writes:a.map(a=>(function(a,b){var c,d;let e;if(b instanceof c2)e={update:dn(a,b.key,b.value)};else if(b instanceof c7)e={delete:dm(a,b.key)};else if(b instanceof c3)e={update:dn(a,b.key,b.data),updateMask:function(a){let b=[];return a.fields.forEach(a=>b.push(a.canonicalString())),{fieldPaths:b}}(b.fieldMask)};else{if(!(b instanceof c8))return aM(16599,{mutationType:b.type});e={verify:dm(a,b.key)}}return b.fieldTransforms.length>0&&(e.updateTransforms=b.fieldTransforms.map(a=>(function(a,b){let c=b.transform;if(c instanceof cP)return{fieldPath:b.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof cQ)return{fieldPath:b.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof cS)return{fieldPath:b.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof cU)return{fieldPath:b.field.canonicalString(),increment:c.operand};throw aM(20930,{transform:b.transform})})(0,a))),b.precondition.isNone||(e.currentDocument=(c=a,void 0!==(d=b.precondition).updateTime?{updateTime:dh(c,d.updateTime.toTimestamp())}:void 0!==d.exists?{exists:d.exists}:aM(27497))),e})(this.serializer,a))};this.sendRequest(b)}}class ee{}class ef extends ee{constructor(a,b,c,d){super(),this.authCredentials=a,this.appCheckCredentials=b,this.connection=c,this.serializer=d,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new aQ(aP.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(a,b,c,d){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,f])=>this.connection.invokeRPC(a,dl(b,c),d,e,f)).catch(a=>{if("FirebaseError"===a.name)throw a.code===aP.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a;throw new aQ(aP.UNKNOWN,a.toString())})}invokeStreamingRPC(a,b,c,d,e){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,g])=>this.connection.invokeStreamingRPC(a,dl(b,c),d,f,g,e)).catch(a=>{if("FirebaseError"===a.name)throw a.code===aP.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a;throw new aQ(aP.UNKNOWN,a.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}}class eg{constructor(a,b){this.asyncQueue=a,this.onlineStateHandler=b,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){0===this.watchStreamFailures&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(a){"Online"===this.state?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=1&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed 1 times. Most recent error: ${a.toString()}`),this.setAndBroadcast("Offline")))}set(a){this.clearOnlineStateTimer(),this.watchStreamFailures=0,"Online"===a&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(a)}setAndBroadcast(a){a!==this.state&&(this.state=a,this.onlineStateHandler(a))}logClientOfflineWarningIfNecessary(a){let b=`Could not reach Cloud Firestore backend. ${a}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(aJ(b),this.shouldWarnClientIsOffline=!1):aI("OnlineStateTracker",b)}clearOnlineStateTimer(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}}let eh="RemoteStore";class ei{constructor(a,b,c,d,e){this.localStore=a,this.datastore=b,this.asyncQueue=c,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=e,this.connectivityMonitor.addCallback(a=>{c.enqueueAndForget(async()=>{em(this)&&(aI(eh,"Restarting streams for network reachability change."),await ex(this))})}),this.onlineStateTracker=new eg(c,d)}}async function ej(a){if(em(a))for(let b of a.onNetworkStatusChange)await b(!0)}async function ek(a){for(let b of a.onNetworkStatusChange)await b(!1)}async function el(a){aI(eh,"RemoteStore shutting down."),a.offlineCauses.add(5),await ek(a),a.connectivityMonitor.shutdown(),a.onlineStateTracker.set("Unknown")}function em(a){return 0===a.offlineCauses.size}async function en(a,b,c){if(bl(b))a.offlineCauses.add(1),await ek(a),a.onlineStateTracker.set("Offline"),c||(c=()=>{var b;return(b=a.localStore).persistence.runTransaction("Get last remote snapshot version","readonly",a=>b.targetCache.getLastRemoteSnapshotVersion(a))}),a.asyncQueue.enqueueRetryable(async()=>{aI(eh,"Retrying IndexedDB access"),await c(),a.offlineCauses.delete(1),await ej(a)});else throw b}function eo(a,b){return b().catch(c=>en(a,c,b))}async function ep(a){var b;let c=eA(a),d=a.writePipeline.length>0?a.writePipeline[a.writePipeline.length-1].batchId:-1;for(;em(b=a)&&b.writePipeline.length<10;)try{let b=await function(a,b){return a.persistence.runTransaction("Get next mutation batch","readonly",c=>(void 0===b&&(b=-1),a.mutationQueue.getNextMutationBatchAfterBatchId(c,b)))}(a.localStore,d);if(null===b){0===a.writePipeline.length&&c.markIdle();break}d=b.batchId,function(a,b){a.writePipeline.push(b);let c=eA(a);c.isOpen()&&c.handshakeComplete&&c.writeMutations(b.mutations)}(a,b)}catch(b){await en(a,b)}eq(a)&&er(a)}function eq(a){return em(a)&&!eA(a).isStarted()&&a.writePipeline.length>0}function er(a){eA(a).start()}async function es(a){eA(a).writeHandshake()}async function et(a){let b=eA(a);for(let c of a.writePipeline)b.writeMutations(c.mutations)}async function eu(a,b,c){let d=a.writePipeline.shift(),e=da.from(d,b,c);await eo(a,()=>a.remoteSyncer.applySuccessfulWrite(e)),await ep(a)}async function ev(a,b){b&&eA(a).handshakeComplete&&await ew(a,b),eq(a)&&er(a)}async function ew(a,b){var c;if(function(a){switch(a){case aP.OK:return aM(64938);case aP.CANCELLED:case aP.UNKNOWN:case aP.DEADLINE_EXCEEDED:case aP.RESOURCE_EXHAUSTED:case aP.INTERNAL:case aP.UNAVAILABLE:case aP.UNAUTHENTICATED:return!1;case aP.INVALID_ARGUMENT:case aP.NOT_FOUND:case aP.ALREADY_EXISTS:case aP.PERMISSION_DENIED:case aP.FAILED_PRECONDITION:case aP.ABORTED:case aP.OUT_OF_RANGE:case aP.UNIMPLEMENTED:case aP.DATA_LOSS:return!0;default:return aM(15467,{code:a})}}(c=b.code)&&c!==aP.ABORTED){let c=a.writePipeline.shift();eA(a).inhibitBackoff(),await eo(a,()=>a.remoteSyncer.rejectFailedWrite(c.batchId,b)),await ep(a)}}async function ex(a){a.offlineCauses.add(4),await ek(a),a.onlineStateTracker.set("Unknown"),a.offlineCauses.delete(4),await ej(a)}async function ey(a,b){a.asyncQueue.verifyOperationInProgress(),aI(eh,"RemoteStore received new credentials");let c=em(a);a.offlineCauses.add(3),await ek(a),c&&a.onlineStateTracker.set("Unknown"),await a.remoteSyncer.handleCredentialChange(b),a.offlineCauses.delete(3),await ej(a)}async function ez(a,b){b?(a.offlineCauses.delete(2),await ej(a)):b||(a.offlineCauses.add(2),await ek(a),a.onlineStateTracker.set("Unknown"))}function eA(a){if(!a.writeStream){var b,c,d;b=a.datastore,c=a.asyncQueue,d={onConnected:()=>Promise.resolve(),onOpen:es.bind(null,a),onClose:ev.bind(null,a),onHandshakeComplete:et.bind(null,a),onMutationResult:eu.bind(null,a)},b.verifyInitialized(),a.writeStream=new ed(c,b.connection,b.authCredentials,b.appCheckCredentials,b.serializer,d),a.onNetworkStatusChange.push(async b=>{b?(a.writeStream.inhibitBackoff(),await ep(a)):(await a.writeStream.stop(),a.writePipeline.length>0&&(aI(eh,`Stopping write stream with ${a.writePipeline.length} pending writes`),a.writePipeline=[]))})}return a.writeStream}class eB{constructor(a,b,c,d,e){this.asyncQueue=a,this.timerId=b,this.targetTimeMs=c,this.op=d,this.removalCallback=e,this.deferred=new aR,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(a,b,c,d,e){let f=new eB(a,b,Date.now()+c,d,e);return f.start(c),f}start(a){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),a)}skipDelay(){return this.handleDelayElapsed()}cancel(a){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new aQ(aP.CANCELLED,"Operation cancelled"+(a?": "+a:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(a=>this.deferred.resolve(a))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function eC(a,b){if(aJ("AsyncQueue",`${b}: ${a}`),bl(a))return new aQ(aP.UNAVAILABLE,`${b}: ${a}`);throw a}class eD{constructor(){this.queries=eE(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){!function(a,b){let c=a.queries;a.queries=eE(),c.forEach((a,c)=>{for(let a of c.listeners)a.onError(b)})}(this,new aQ(aP.ABORTED,"Firestore shutting down"))}}function eE(){return new cB(a=>cy(a),cx)}!function(a){a.Default="default",a.Cache="cache"}(av||(av={}));class eF{constructor(a,b,c,d){this.targetId=a,this.fromCache=b,this.addedKeys=c,this.removedKeys=d}static fromSnapshot(a,b){let c=cJ(),d=cJ();for(let a of b.docChanges)switch(a.type){case 0:c=c.add(a.doc.key);break;case 1:d=d.add(a.doc.key)}return new eF(a,b.fromCache,c,d)}}class eG{constructor(a,b,c,d,e,f){this.localStore=a,this.remoteStore=b,this.eventManager=c,this.sharedClientState=d,this.currentUser=e,this.maxConcurrentLimboResolutions=f,this.syncEngineListener={},this.queryViewsByQuery=new cB(a=>cy(a),cx),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new bq(a7.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new dJ,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=dv.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return!0===this._isPrimaryClient}}async function eH(a,b,c){var d,e,f,g;let h=((d=a).remoteStore.remoteSyncer.applySuccessfulWrite=eJ.bind(null,d),d.remoteStore.remoteSyncer.rejectFailedWrite=eK.bind(null,d),d);try{let a,d=await function(a,b){let c,d,e=be.now(),f=b.reduce((a,b)=>a.add(b.key),cJ());return a.persistence.runTransaction("Locally write mutations","readwrite",g=>{let h=cC,i=cJ();return a.remoteDocuments.getEntries(g,f).next(a=>{(h=a).forEach((a,b)=>{b.isValidDocument()||(i=i.add(a))})}).next(()=>a.localDocuments.getOverlayedDocuments(g,h)).next(d=>{c=d;let f=[];for(let a of b){let b=function(a,b){let c=null;for(let d of a.fieldTransforms){let a=b.data.field(d.field),e=cO(d.transform,a||null);null!=e&&(null===c&&(c=b5.empty()),c.set(d.field,e))}return c||null}(a,c.get(a.key).overlayedDocument);null!=b&&f.push(new c3(a.key,b,function a(b){let c=[];return bo(b.fields,(b,d)=>{let e=new a6([b]);if(b1(d)){let b=a(d.mapValue).fields;if(0===b.length)c.push(e);else for(let a of b)c.push(e.child(a))}else c.push(e)}),new bw(c)}(b.value.mapValue),cY.exists(!0)))}return a.mutationQueue.addMutationBatch(g,e,f,b)}).next(b=>{d=b;let e=b.applyToLocalDocumentSet(c,i);return a.documentOverlayCache.saveOverlays(g,b.batchId,e)})}).then(()=>({batchId:d.batchId,changes:cF(c)}))}(h.localStore,b);h.sharedClientState.addPendingMutation(d.batchId),e=h,f=d.batchId,g=c,(a=e.mutationUserCallbacks[e.currentUser.toKey()])||(a=new bq(a$)),a=a.insert(f,g),e.mutationUserCallbacks[e.currentUser.toKey()]=a,await eN(h,d.changes),await ep(h.remoteStore)}catch(b){let a=eC(b,"Failed to persist write");c.reject(a)}}function eI(a,b,c){var d;if(a.isPrimaryClient&&0===c||!a.isPrimaryClient&&1===c){let c,e=[];a.queryViewsByQuery.forEach((a,c)=>{let d=c.view.applyOnlineStateChange(b);d.snapshot&&e.push(d.snapshot)}),(d=a.eventManager).onlineState=b,c=!1,d.queries.forEach((a,d)=>{for(let a of d.listeners)a.applyOnlineStateChange(b)&&(c=!0)}),c&&d.snapshotsInSyncListeners.forEach(a=>{a.next()}),e.length&&a.syncEngineListener.onWatchChange(e),a.onlineState=b,a.isPrimaryClient&&a.sharedClientState.setOnlineState(b)}}async function eJ(a,b){var c;let d=b.batch.batchId;try{let e=await (c=a.localStore,c.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{let d=b.batch.keys(),e=c.remoteDocuments.newChangeBuffer({trackRemovals:!0});return(function(a,b,c,d){let e=c.batch,f=e.keys(),g=bk.resolve();return f.forEach(a=>{g=g.next(()=>d.getEntry(b,a)).next(b=>{let f=c.docVersions.get(a);aO(null!==f,48541),0>b.version.compareTo(f)&&(e.applyToRemoteDocument(b,c),b.isValidDocument()&&(b.setReadTime(c.commitVersion),d.addEntry(b)))})}),g.next(()=>a.mutationQueue.removeMutationBatch(b,e))})(c,a,b,e).next(()=>e.apply(a)).next(()=>c.mutationQueue.performConsistencyCheck(a)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(a,d,b.batch.batchId)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,function(a){let b=cJ();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(b=b.add(a.batch.mutations[c].key));return b}(b))).next(()=>c.localDocuments.getDocuments(a,d))}));eM(a,d,null),eL(a,d),a.sharedClientState.updateMutationState(d,"acknowledged"),await eN(a,e)}catch(a){await bj(a)}}async function eK(a,b,c){var d;try{let e=await (d=a.localStore,d.persistence.runTransaction("Reject batch","readwrite-primary",a=>{let c;return d.mutationQueue.lookupMutationBatch(a,b).next(b=>(aO(null!==b,37113),c=b.keys(),d.mutationQueue.removeMutationBatch(a,b))).next(()=>d.mutationQueue.performConsistencyCheck(a)).next(()=>d.documentOverlayCache.removeOverlaysForBatchId(a,c,b)).next(()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,c)).next(()=>d.localDocuments.getDocuments(a,c))}));eM(a,b,c),eL(a,b),a.sharedClientState.updateMutationState(b,"rejected",c),await eN(a,e)}catch(a){await bj(a)}}function eL(a,b){(a.pendingWritesCallbacks.get(b)||[]).forEach(a=>{a.resolve()}),a.pendingWritesCallbacks.delete(b)}function eM(a,b,c){let d=a.mutationUserCallbacks[a.currentUser.toKey()];if(d){let e=d.get(b);e&&(c?e.reject(c):e.resolve(),d=d.remove(b)),a.mutationUserCallbacks[a.currentUser.toKey()]=d}}async function eN(a,b,c){let d=[],e=[],f=[];a.queryViewsByQuery.isEmpty()||(a.queryViewsByQuery.forEach((g,h)=>{f.push(a.applyDocChanges(h,b,c).then(b=>{if((b||c)&&a.isPrimaryClient){let d=b?!b.fromCache:c?.targetChanges.get(h.targetId)?.current;a.sharedClientState.updateQueryState(h.targetId,d?"current":"not-current")}if(b){d.push(b);let a=eF.fromSnapshot(h.targetId,b);e.push(a)}}))}),await Promise.all(f),a.syncEngineListener.onWatchChange(d),await dV(a.localStore,e))}async function eO(a,b){if(!a.currentUser.isEqual(b)){aI("SyncEngine","User change. New user:",b.toKey());let c=await dU(a.localStore,b);a.currentUser=b,a.pendingWritesCallbacks.forEach(a=>{a.forEach(a=>{a.reject(new aQ(aP.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),a.pendingWritesCallbacks.clear(),a.sharedClientState.handleUserChange(b,c.removedBatchIds,c.addedBatchIds),await eN(a,c.affectedDocuments)}}class eP{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(a){this.serializer=d9(a.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(a),this.persistence=this.createPersistence(a),await this.persistence.start(),this.localStore=this.createLocalStore(a),this.gcScheduler=this.createGarbageCollectionScheduler(a,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(a,this.localStore)}createGarbageCollectionScheduler(a,b){return null}createIndexBackfillerScheduler(a,b){return null}createLocalStore(a){var b,c;return b=this.persistence,c=new dX,new dT(b,c,a.initialUser,this.serializer)}createPersistence(a){return new dP(dR.factory,this.serializer)}createSharedClientState(a){return new dZ}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}eP.provider={build:()=>new eP};class eQ extends eP{constructor(a){super(),this.cacheSizeBytes=a}createGarbageCollectionScheduler(a,b){return aO(this.persistence.referenceDelegate instanceof dS,46915),new dB(this.persistence.referenceDelegate.garbageCollector,a.asyncQueue,b)}createPersistence(a){let b=void 0!==this.cacheSizeBytes?dx.withCacheSize(this.cacheSizeBytes):dx.DEFAULT;return new dP(a=>dS.factory(a,b),this.serializer)}}class eR{async initialize(a,b){this.localStore||(this.localStore=a.localStore,this.sharedClientState=a.sharedClientState,this.datastore=this.createDatastore(b),this.remoteStore=this.createRemoteStore(b),this.eventManager=this.createEventManager(b),this.syncEngine=this.createSyncEngine(b,!a.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>eI(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=eO.bind(null,this.syncEngine),await ez(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(a){return new eD}createDatastore(a){var b,c;let d=d9(a.databaseInfo.databaseId),e=(b=a.databaseInfo,new d5(function(){let a=aB.rS(d7,d8);return aA.ex(a)}(),b));return c=a.authCredentials,new ef(c,a.appCheckCredentials,e,d)}createRemoteStore(a){var b,c;return b=this.localStore,c=this.datastore,new ei(b,c,a.asyncQueue,a=>eI(this.syncEngine,a,0),new d$)}createSyncEngine(a,b){return function(a,b,c,d,e,f,g){let h=new eG(a,b,c,d,e,f);return g&&(h._isPrimaryClient=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,a.initialUser,a.maxConcurrentLimboResolutions,b)}async terminate(){await el(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}eR.provider={build:()=>new eR};let eS="FirestoreClient";class eT{constructor(a,b,c,d,e){this.authCredentials=a,this.appCheckCredentials=b,this.asyncQueue=c,this.databaseInfo=d,this.user=aE.UNAUTHENTICATED,this.clientId=aZ.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=e,this.authCredentials.start(c,async a=>{aI(eS,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(c,a=>(aI(eS,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(a){this.authCredentialListener=a}setAppCheckTokenChangeListener(a){this.appCheckCredentialListener=a}terminate(){this.asyncQueue.enterRestrictedMode();let a=new aR;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),a.resolve()}catch(c){let b=eC(c,"Failed to shutdown persistence");a.reject(b)}}),a.promise}}async function eU(a,b){a.asyncQueue.verifyOperationInProgress(),aI(eS,"Initializing OfflineComponentProvider");let c=a.configuration;await b.initialize(c);let d=c.initialUser;a.setCredentialChangeListener(async a=>{d.isEqual(a)||(await dU(b.localStore,a),d=a)}),b.persistence.setDatabaseDeletedListener(()=>a.terminate()),a._offlineComponents=b}async function eV(a,b){a.asyncQueue.verifyOperationInProgress();let c=await eW(a);aI(eS,"Initializing OnlineComponentProvider"),await b.initialize(c,a.configuration),a.setCredentialChangeListener(a=>ey(b.remoteStore,a)),a.setAppCheckTokenChangeListener((a,c)=>ey(b.remoteStore,c)),a._onlineComponents=b}async function eW(a){if(!a._offlineComponents)if(a._uninitializedComponentsProvider){aI(eS,"Using user provided OfflineComponentProvider");try{await eU(a,a._uninitializedComponentsProvider._offline)}catch(b){if(!("FirebaseError"===b.name?b.code===aP.FAILED_PRECONDITION||b.code===aP.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&b instanceof DOMException)||22===b.code||20===b.code||11===b.code))throw b;aK("Error using user provided cache. Falling back to memory cache: "+b),await eU(a,new eP)}}else aI(eS,"Using default OfflineComponentProvider"),await eU(a,new eQ(void 0));return a._offlineComponents}async function eX(a){return a._onlineComponents||(a._uninitializedComponentsProvider?(aI(eS,"Using user provided OnlineComponentProvider"),await eV(a,a._uninitializedComponentsProvider._online)):(aI(eS,"Using default OnlineComponentProvider"),await eV(a,new eR))),a._onlineComponents}function eY(a){let b={};return void 0!==a.timeoutSeconds&&(b.timeoutSeconds=a.timeoutSeconds),b}let eZ=new Map;class e${constructor(a){if(void 0===a.host){if(void 0!==a.ssl)throw new aQ(aP.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=a.host,this.ssl=a.ssl??!0;if(this.isUsingEmulator=void 0!==a.emulatorOptions,this.credentials=a.credentials,this.ignoreUndefinedProperties=!!a.ignoreUndefinedProperties,this.localCache=a.localCache,void 0===a.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else if(-1!==a.cacheSizeBytes&&a.cacheSizeBytes<1048576)throw new aQ(aP.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");else this.cacheSizeBytes=a.cacheSizeBytes;var b=a.experimentalForceLongPolling,c=a.experimentalAutoDetectLongPolling;if(!0===b&&!0===c)throw new aQ(aP.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.");this.experimentalForceLongPolling=!!a.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===a.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!a.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=eY(a.experimentalLongPollingOptions??{}),function(a){if(void 0!==a.timeoutSeconds){if(isNaN(a.timeoutSeconds))throw new aQ(aP.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (must not be NaN)`);if(a.timeoutSeconds<5)throw new aQ(aP.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (minimum allowed value is 5)`);if(a.timeoutSeconds>30)throw new aQ(aP.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!a.useFetchStreams}isEqual(a){var b,c;return this.host===a.host&&this.ssl===a.ssl&&this.credentials===a.credentials&&this.cacheSizeBytes===a.cacheSizeBytes&&this.experimentalForceLongPolling===a.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===a.experimentalAutoDetectLongPolling&&(b=this.experimentalLongPollingOptions,c=a.experimentalLongPollingOptions,b.timeoutSeconds===c.timeoutSeconds)&&this.ignoreUndefinedProperties===a.ignoreUndefinedProperties&&this.useFetchStreams===a.useFetchStreams}}class e_{constructor(a,b,c,d){this._authCredentials=a,this._appCheckCredentials=b,this._databaseId=c,this._app=d,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new e$({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new aQ(aP.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(a){if(this._settingsFrozen)throw new aQ(aP.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new e$(a),this._emulatorOptions=a.emulatorOptions||{},void 0!==a.credentials&&(this._authCredentials=function(a){if(!a)return new aT;switch(a.type){case"firstParty":return new aW(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new aQ(aP.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(a.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let a=eZ.get(this);return a&&(aI("ComponentProvider","Removing Datastore"),eZ.delete(this),a.terminate()),Promise.resolve()}}class e0{constructor(a,b,c){this.converter=b,this._query=c,this.type="query",this.firestore=a}withConverter(a){return new e0(this.firestore,a,this._query)}}class e1{constructor(a,b,c){this.converter=b,this._key=c,this.type="document",this.firestore=a}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new e2(this.firestore,this.converter,this._key.path.popLast())}withConverter(a){return new e1(this.firestore,a,this._key)}toJSON(){return{type:e1._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(a,b,c){if(bd(b,e1._jsonSchema))return new e1(a,c||null,new a7(a4.fromString(b.referencePath)))}}e1._jsonSchemaVersion="firestore/documentReference/1.0",e1._jsonSchema={type:bc("string",e1._jsonSchemaVersion),referencePath:bc("string")};class e2 extends e0{constructor(a,b,c){super(a,b,new cs(c)),this._path=c,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let a=this._path.popLast();return a.isEmpty()?null:new e1(this.firestore,null,new a7(a))}withConverter(a){return new e2(this.firestore,a,this._path)}}function e3(a,b,...c){if(a=aj(a),1==arguments.length&&(b=aZ.newId()),!b)throw new aQ(aP.INVALID_ARGUMENT,"Function doc() cannot be called with an empty path.");if(a instanceof e_){let d=a4.fromString(b,...c);return a8(d),new e1(a,null,new a7(d))}{if(!(a instanceof e1)&&!(a instanceof e2))throw new aQ(aP.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let d=a._path.child(a4.fromString(b,...c));return a8(d),new e1(a.firestore,a instanceof e2?a.converter:null,new a7(d))}}class e4{constructor(a=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new ea(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=a}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(a){this.enqueue(a)}enqueueAndForgetEvenWhileRestricted(a){this.verifyNotFailed(),this.enqueueInternal(a)}enterRestrictedMode(a){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=a||!1)}enqueue(a){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let b=new aR;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(a().then(b.resolve,b.reject),b.promise)).then(()=>b.promise)}enqueueRetryable(a){this.enqueueAndForget(()=>(this.retryableOps.push(a),this.retryNextOp()))}async retryNextOp(){if(0!==this.retryableOps.length){try{await this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(a){if(bl(a))aI("AsyncQueue","Operation failed with retryable error: "+a);else throw a}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}}enqueueInternal(a){let b=this.tail.then(()=>(this.operationInProgress=!0,a().catch(a=>{throw this.failure=a,this.operationInProgress=!1,aJ("INTERNAL UNHANDLED ERROR: ",e5(a)),a}).then(a=>(this.operationInProgress=!1,a))));return this.tail=b,b}enqueueAfterDelay(a,b,c){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(a)>-1&&(b=0);let d=eB.createAndSchedule(this,a,b,c,a=>this.removeDelayedOperation(a));return this.delayedOperations.push(d),d}verifyNotFailed(){this.failure&&aM(47125,{messageOrStack:e5(this.failure)})}verifyOperationInProgress(){}async drain(){let a;do a=this.tail,await a;while(a!==this.tail)}containsDelayedOperation(a){for(let b of this.delayedOperations)if(b.timerId===a)return!0;return!1}runAllDelayedOperationsUntil(a){return this.drain().then(()=>{for(let b of(this.delayedOperations.sort((a,b)=>a.targetTimeMs-b.targetTimeMs),this.delayedOperations))if(b.skipDelay(),"all"!==a&&b.timerId===a)break;return this.drain()})}skipDelaysForTimerId(a){this.timerIdsToSkip.push(a)}removeDelayedOperation(a){let b=this.delayedOperations.indexOf(a);this.delayedOperations.splice(b,1)}}function e5(a){let b=a.message||"";return a.stack&&(b=a.stack.includes(a.message)?a.stack:a.message+"\n"+a.stack),b}class e6 extends e_{constructor(a,b,c,d){super(a,b,c,d),this.type="firestore",this._queue=new e4,this._persistenceKey=d?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let a=this._firestoreClient.terminate();this._queue=new e4(a),this._firestoreClient=void 0,await a}}}class e7{constructor(a){this._byteString=a}static fromBase64String(a){try{return new e7(bx.fromBase64String(a))}catch(a){throw new aQ(aP.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+a)}}static fromUint8Array(a){return new e7(bx.fromUint8Array(a))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(a){return this._byteString.isEqual(a._byteString)}toJSON(){return{type:e7._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(a){if(bd(a,e7._jsonSchema))return e7.fromBase64String(a.bytes)}}e7._jsonSchemaVersion="firestore/bytes/1.0",e7._jsonSchema={type:bc("string",e7._jsonSchemaVersion),bytes:bc("string")};class e8{constructor(...a){for(let b=0;b<a.length;++b)if(0===a[b].length)throw new aQ(aP.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new a6(a)}isEqual(a){return this._internalPath.isEqual(a._internalPath)}}class e9{constructor(a){this._methodName=a}}class fa{constructor(a,b){if(!isFinite(a)||a<-90||a>90)throw new aQ(aP.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+a);if(!isFinite(b)||b<-180||b>180)throw new aQ(aP.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+b);this._lat=a,this._long=b}get latitude(){return this._lat}get longitude(){return this._long}isEqual(a){return this._lat===a._lat&&this._long===a._long}_compareTo(a){return a$(this._lat,a._lat)||a$(this._long,a._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:fa._jsonSchemaVersion}}static fromJSON(a){if(bd(a,fa._jsonSchema))return new fa(a.latitude,a.longitude)}}fa._jsonSchemaVersion="firestore/geoPoint/1.0",fa._jsonSchema={type:bc("string",fa._jsonSchemaVersion),latitude:bc("number"),longitude:bc("number")};class fb{constructor(a){this._values=(a||[]).map(a=>a)}toArray(){return this._values.map(a=>a)}isEqual(a){return function(a,b){if(a.length!==b.length)return!1;for(let c=0;c<a.length;++c)if(a[c]!==b[c])return!1;return!0}(this._values,a._values)}toJSON(){return{type:fb._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(a){if(bd(a,fb._jsonSchema)){if(Array.isArray(a.vectorValues)&&a.vectorValues.every(a=>"number"==typeof a))return new fb(a.vectorValues);throw new aQ(aP.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}fb._jsonSchemaVersion="firestore/vectorValue/1.0",fb._jsonSchema={type:bc("string",fb._jsonSchemaVersion),vectorValues:bc("object")};let fc=/^__.*__$/;class fd{constructor(a,b,c){this.data=a,this.fieldMask=b,this.fieldTransforms=c}toMutation(a,b){return null!==this.fieldMask?new c3(a,this.data,this.fieldMask,b,this.fieldTransforms):new c2(a,this.data,b,this.fieldTransforms)}}function fe(a){switch(a){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw aM(40011,{dataSource:a})}}class ff{constructor(a,b,c,d,e,f){this.settings=a,this.databaseId=b,this.serializer=c,this.ignoreUndefinedProperties=d,void 0===e&&this.validatePath(),this.fieldTransforms=e||[],this.fieldMask=f||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(a){return new ff({...this.settings,...a},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(a){let b=this.path?.child(a),c=this.contextWith({path:b,arrayElement:!1});return c.validatePathSegment(a),c}childContextForFieldPath(a){let b=this.path?.child(a),c=this.contextWith({path:b,arrayElement:!1});return c.validatePath(),c}childContextForArray(a){return this.contextWith({path:void 0,arrayElement:!0})}createError(a){return fm(a,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(a){return void 0!==this.fieldMask.find(b=>a.isPrefixOf(b))||void 0!==this.fieldTransforms.find(b=>a.isPrefixOf(b.field))}validatePath(){if(this.path)for(let a=0;a<this.path.length;a++)this.validatePathSegment(this.path.get(a))}validatePathSegment(a){if(0===a.length)throw this.createError("Document fields must not be empty");if(fe(this.dataSource)&&fc.test(a))throw this.createError('Document fields cannot begin and end with "__"')}}class fg{constructor(a,b,c){this.databaseId=a,this.ignoreUndefinedProperties=b,this.serializer=c||d9(a)}createContext(a,b,c,d=!1){return new ff({dataSource:a,methodName:b,targetDoc:c,path:a6.emptyPath(),arrayElement:!1,hasConverter:d},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function fh(a,b){let c={};return bp(a)?b.path&&b.path.length>0&&b.fieldMask.push(b.path):bo(a,(a,d)=>{let e=function a(b,c){if(fi(b=aj(b)))return fj("Unsupported field value:",c,b),fh(b,c);if(b instanceof e9)return function(a,b){if(!fe(b.dataSource))throw b.createError(`${a._methodName}() can only be used with update() and set()`);if(!b.path)throw b.createError(`${a._methodName}() is not currently supported inside arrays`);let c=a._toFieldTransform(b);c&&b.fieldTransforms.push(c)}(b,c),null;if(void 0===b&&c.ignoreUndefinedProperties)return null;if(c.path&&c.fieldMask.push(c.path),!(b instanceof Array))return function(a,b){var c,d,e,f,g,h,i;if(null===(a=aj(a)))return{nullValue:"NULL_VALUE"};if("number"==typeof a)return c=b.serializer,"number"==typeof(e=d=a)&&Number.isInteger(e)&&!bM(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER?cM(d):cL(c,d);if("boolean"==typeof a)return{booleanValue:a};if("string"==typeof a)return{stringValue:a};if(a instanceof Date){let c=be.fromDate(a);return{timestampValue:dh(b.serializer,c)}}else if(a instanceof be){let c=new be(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:dh(b.serializer,c)}}else if(a instanceof fa)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};else if(a instanceof e7)return{bytesValue:(f=b.serializer,g=a._byteString,f.useProto3Json?g.toBase64():g.toUint8Array())};else if(a instanceof e1){let c=b.databaseId,d=a.firestore._databaseId;if(!d.isEqual(c))throw b.createError(`Document reference is for database ${d.projectId}/${d.database} but should be for database ${c.projectId}/${c.database}`);return{referenceValue:dk(a.firestore._databaseId||b.databaseId,a._key.path)}}else if(a instanceof fb){return h=a,i=b,{mapValue:{fields:{[bN]:{stringValue:bQ},[bR]:{arrayValue:{values:h.toArray().map(a=>{if("number"!=typeof a)throw i.createError("VectorValues must only contain numeric values.");return cL(i.serializer,a)})}}}}}}else throw b.createError(`Unsupported field value: ${ba(a)}`)}(b,c);if(c.settings.arrayElement&&4!==c.dataSource)throw c.createError("Nested arrays are not supported");var d=b,e=c;let f=[],g=0;for(let b of d){let c=a(b,e.childContextForArray(g));null==c&&(c={nullValue:"NULL_VALUE"}),f.push(c),g++}return{arrayValue:{values:f}}}(d,b.childContextForField(a));null!=e&&(c[a]=e)}),{mapValue:{fields:c}}}function fi(a){return"object"==typeof a&&null!==a&&!(a instanceof Array)&&!(a instanceof Date)&&!(a instanceof be)&&!(a instanceof fa)&&!(a instanceof e7)&&!(a instanceof e1)&&!(a instanceof e9)&&!(a instanceof fb)}function fj(a,b,c){if(!fi(c)||!a9(c)){let d=ba(c);if("an object"===d)throw b.createError(a+" a custom object");throw b.createError(a+" "+d)}}let fk=RegExp("[~\\*/\\[\\]]");function fl(a,b,c){if(b.search(fk)>=0)throw fm(`Invalid field path (${b}). Paths must not contain '~', '*', '/', '[', or ']'`,a,!1,void 0,c);try{return new e8(...b.split("."))._internalPath}catch(d){throw fm(`Invalid field path (${b}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,a,!1,void 0,c)}}function fm(a,b,c,d,e){let f=d&&!d.isEmpty(),g=void 0!==e,h=`Function ${b}() called with invalid data`;c&&(h+=" (via `toFirestore()`)"),h+=". ";let i="";return(f||g)&&(i+=" (found",f&&(i+=` in field ${d}`),g&&(i+=` in document ${e}`),i+=")"),new aQ(aP.INVALID_ARGUMENT,h+a+i)}class fn{constructor(a,b,c,d,e){this._firestore=a,this._userDataWriter=b,this._key=c,this._document=d,this._converter=e}get id(){return this._key.path.lastSegment()}get ref(){return new e1(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value);{let a=new fo(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(a)}}}get(a){if(this._document){let b=this._document.data.field(fp("DocumentSnapshot.get",a));if(null!==b)return this._userDataWriter.convertValue(b)}}}class fo extends fn{data(){return super.data()}}function fp(a,b){return"string"==typeof b?fl(a,b):b instanceof e8?b._internalPath:b._delegate._internalPath}let fq=new aw.TextEncoder;function fr(a){let b=JSON.stringify(a),c=fq.encode(b).byteLength;return`${c}${b}`}fr({metadata:{id:"test-bundle",createTime:{seconds:0x5e0be105,nanos:6},version:1,totalDocuments:1,totalBytes:416}}),fr({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",readTime:{seconds:5,nanos:6},exists:!0}}),fr({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value"},bar:{integerValue:-42}}}}),fr({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",readTime:{seconds:5,nanos:6},exists:!0}}),fr({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value1"},bar:{integerValue:42},emptyArray:{arrayValue:{}},emptyMap:{mapValue:{}}}}}),fr({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/nodoc",readTime:{seconds:5,nanos:6},exists:!1}}),fr({namedQuery:{name:"limitQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"DESCENDING"}],limit:{value:1}},limitType:"FIRST"},readTime:{seconds:0x5ec5a5f3,nanos:191164e3}}}),fr({namedQuery:{name:"limitToLastQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"ASCENDING"}],limit:{value:1}},limitType:"LAST"},readTime:{seconds:0x5ec5a5f3,nanos:543063e3}}});class fs{constructor(a,b){this.firestore=a,this.bundleId=b,this.documents=new Map,this.namedQueries=new Map,this.latestReadTime=new be(0,0),this.databaseId=a._databaseId,this.serializer=new dg(this.databaseId,!0),this.userDataReader=new fg(this.databaseId,!0,this.serializer)}addBundleDocument(a,b){let c=this.documents.get(a.documentPath),d=c?.metadata.queries,e=a.readTime,f=c?.metadata.readTime?di(c.metadata.readTime):null,g=!e&&null==f,h=void 0!==e&&(null==f||f<e);if((g||h)&&this.documents.set(a.documentPath,{document:this.toBundleDocument(a),metadata:{name:dm(this.serializer,a.documentKey),readTime:e?dh(this.serializer,e):void 0,exists:a.documentExists}}),e&&e>this.latestReadTime&&(this.latestReadTime=e),b){let c=this.documents.get(a.documentPath);c.metadata.queries=d||[],c.metadata.queries.push(b)}}addBundleQuery(a){if(this.namedQueries.has(a.name))throw Error(`Query name conflict: ${name} has already been added.`);let b=new be(0,0);for(let c of a.docBundleDataArray)this.addBundleDocument(c,a.name),c.readTime&&c.readTime>b&&(b=c.readTime);let c=function(a,b){var c,d,e,f;let g,h={structuredQuery:{}},i=b.path;null!==b.collectionGroup?(g=i,h.structuredQuery.from=[{collectionId:b.collectionGroup,allDescendants:!0}]):(g=i.popLast(),h.structuredQuery.from=[{collectionId:i.lastSegment()}]),c=g,h.parent=dk(a.databaseId,c);let j=function(a){if(0!==a.length)return function a(b){return b instanceof cc?function(a){if("=="===a.op){if(b0(a.value))return{unaryFilter:{field:dp(a.field),op:"IS_NAN"}};else if(b_(a.value))return{unaryFilter:{field:dp(a.field),op:"IS_NULL"}}}else if("!="===a.op){if(b0(a.value))return{unaryFilter:{field:dp(a.field),op:"IS_NOT_NAN"}};else if(b_(a.value))return{unaryFilter:{field:dp(a.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:dp(a.field),op:de[a.op],value:a.value}}}(b):b instanceof cd?function(b){let c=b.getFilters().map(b=>a(b));return 1===c.length?c[0]:{compositeFilter:{op:df[b.op],filters:c}}}(b):aM(54877,{filter:b})}(cd.create(a,"and"))}(b.filters);j&&(h.structuredQuery.where=j);let k=function(a){if(0!==a.length)return a.map(a=>{var b;return{field:dp((b=a).field),direction:dd[b.dir]}})}(b.orderBy);k&&(h.structuredQuery.orderBy=k);let l=(d=b.limit,a.useProto3Json||null==d?d:{value:d});return null!==l&&(h.structuredQuery.limit=l),b.startAt&&(h.structuredQuery.startAt={before:(e=b.startAt).inclusive,values:e.position}),b.endAt&&(h.structuredQuery.endAt={before:!(f=b.endAt).inclusive,values:f.position}),{queryTarget:h,parent:g}}(this.serializer,cv(a.query)),d={parent:a.parent,structuredQuery:c.queryTarget.structuredQuery};this.namedQueries.set(a.name,{name:a.name,bundledQuery:d,readTime:dh(this.serializer,b)})}toBundleDocument(a){let b=this.userDataReader.createContext(4,"internal toBundledDocument"),c=fh(a.documentData,b);return{name:dm(this.serializer,a.documentKey),fields:c.mapValue.fields,updateTime:dh(this.serializer,a.versionTime),createTime:dh(this.serializer,a.createdTime)}}lengthPrefixedString(a){let b=JSON.stringify(a),c=fq.encode(b).byteLength;return`${c}${b}`}build(){let a="";for(let b of this.namedQueries.values())a+=this.lengthPrefixedString({namedQuery:b});for(let b of this.documents.values()){let c=b.metadata;a+=this.lengthPrefixedString({documentMetadata:c});let d=b.document;d&&(a+=this.lengthPrefixedString({document:d}))}let b={id:this.bundleId,createTime:dh(this.serializer,this.latestReadTime),version:1,totalDocuments:this.documents.size,totalBytes:fq.encode(a).length};return this.lengthPrefixedString({metadata:b})+a}}function ft(a,b,c){return{documentData:b,documentKey:c.mutableCopy().key,documentPath:a,documentExists:!0,createdTime:c.createTime.toTimestamp(),readTime:c.readTime.toTimestamp(),versionTime:c.version.toTimestamp()}}class fu{constructor(a,b){this.hasPendingWrites=a,this.fromCache=b}isEqual(a){return this.hasPendingWrites===a.hasPendingWrites&&this.fromCache===a.fromCache}}class fv extends fn{constructor(a,b,c,d,e,f){super(a,b,c,d,f),this._firestore=a,this._firestoreImpl=a,this.metadata=e}exists(){return super.exists()}data(a={}){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value,a.serverTimestamps);{let b=new fw(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(b,a)}}}get(a,b={}){if(this._document){let c=this._document.data.field(fp("DocumentSnapshot.get",a));if(null!==c)return this._userDataWriter.convertValue(c,b.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new aQ(aP.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let a=this._document,b={};if(b.type=fv._jsonSchemaVersion,b.bundle="",b.bundleSource="DocumentSnapshot",b.bundleName=this._key.toString(),!a||!a.isValidDocument()||!a.isFoundDocument())return b;let c=this._userDataWriter.convertObjectMap(a.data.value.mapValue.fields,"previous");return b.bundle=function(a,b,c,d){let e=new fs(a,aZ.newId());return e.addBundleDocument(ft(d,c,b)),e.build()}(this._firestore,a,c,this.ref.path),b}}fv._jsonSchemaVersion="firestore/documentSnapshot/1.0",fv._jsonSchema={type:bc("string",fv._jsonSchemaVersion),bundleSource:bc("string","DocumentSnapshot"),bundleName:bc("string"),bundle:bc("string")};class fw extends fv{data(a={}){return super.data(a)}}class fx{constructor(a,b,c,d){this._firestore=a,this._userDataWriter=b,this._snapshot=d,this.metadata=new fu(d.hasPendingWrites,d.fromCache),this.query=c}get docs(){let a=[];return this.forEach(b=>a.push(b)),a}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(a,b){this._snapshot.docs.forEach(c=>{a.call(b,new fw(this._firestore,this._userDataWriter,c.key,c,new fu(this._snapshot.mutatedKeys.has(c.key),this._snapshot.fromCache),this.query.converter))})}docChanges(a={}){let b=!!a.includeMetadataChanges;if(b&&this._snapshot.excludesMetadataChanges)throw new aQ(aP.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===b||(this._cachedChanges=function(a,b){if(a._snapshot.oldDocs.isEmpty()){let b=0;return a._snapshot.docChanges.map(c=>{let d=new fw(a._firestore,a._userDataWriter,c.doc.key,c.doc,new fu(a._snapshot.mutatedKeys.has(c.doc.key),a._snapshot.fromCache),a.query.converter);return c.doc,{type:"added",doc:d,oldIndex:-1,newIndex:b++}})}{let c=a._snapshot.oldDocs;return a._snapshot.docChanges.filter(a=>b||3!==a.type).map(b=>{let d=new fw(a._firestore,a._userDataWriter,b.doc.key,b.doc,new fu(a._snapshot.mutatedKeys.has(b.doc.key),a._snapshot.fromCache),a.query.converter),e=-1,f=-1;return 0!==b.type&&(e=c.indexOf(b.doc.key),c=c.delete(b.doc.key)),1!==b.type&&(f=(c=c.add(b.doc)).indexOf(b.doc.key)),{type:function(a){switch(a){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return aM(61501,{type:a})}}(b.type),doc:d,oldIndex:e,newIndex:f}})}}(this,b),this._cachedChangesIncludeMetadataChanges=b),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new aQ(aP.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let a={};a.type=fx._jsonSchemaVersion,a.bundleSource="QuerySnapshot",a.bundleName=aZ.newId();let b=this._firestore._databaseId.database,c=this._firestore._databaseId.projectId,d=`projects/${c}/databases/${b}/documents`,e=[],f=[],g=[];return this.docs.forEach(a=>{null!==a._document&&(e.push(a._document),f.push(this._userDataWriter.convertObjectMap(a._document.data.value.mapValue.fields,"previous")),g.push(a.ref.path))}),a.bundle=function(a,b,c,d,e,f,g){let h=[];for(let a=0;a<f.length;a++)h.push(ft(e[a],g[a],f[a]));let i=new fs(a,c);return i.addBundleQuery({name:c,query:b,parent:d,docBundleDataArray:h}),i.build()}(this._firestore,this.query._query,a.bundleName,d,g,e,f),a}}function fy(a,b,c){a=bb(a,e1);let d=bb(a.firestore,e6),e=(g=a.converter,g?c&&(c.merge||c.mergeFields)?g.toFirestore(b,c):g.toFirestore(b):b),f=(function(a,b,c,d,e,f={}){let g,h,i=a.createContext(f.merge||f.mergeFields?2:0,b,c,e);fj("Data must be an object, but it was:",i,d);let j=fh(d,i);if(f.merge)g=new bw(i.fieldMask),h=i.fieldTransforms;else if(f.mergeFields){let a=[];for(let d of f.mergeFields){let e=function(a,b,c){if((b=aj(b))instanceof e8)return b._internalPath;if("string"==typeof b)return fl(a,b);throw fm("Field path arguments must be of type string or ",a,!1,void 0,c)}(b,d,c);if(!i.contains(e))throw new aQ(aP.INVALID_ARGUMENT,`Field '${e}' is specified in your field mask but missing from your input data.`);!function(a,b){return a.some(a=>a.isEqual(b))}(a,e)&&a.push(e)}g=new bw(a),h=i.fieldTransforms.filter(a=>g.covers(a.field))}else g=null,h=i.fieldTransforms;return new fd(new b5(j),g,h)})(function(a){let b=a._freezeSettings(),c=d9(a._databaseId);return new fg(a._databaseId,!!b.ignoreUndefinedProperties,c)}(d),"setDoc",a._key,e,null!==a.converter,c).toMutation(a._key,cY.none());var g,h=d,i=[f],j=function(a){if(a._terminated)throw new aQ(aP.FAILED_PRECONDITION,"The client has already been terminated.");return a._firestoreClient||function(a){var b,c;let d=a._freezeSettings(),e=(b=a._databaseId,c=a._app?.options.appId||"",new bJ(b,c,a._persistenceKey,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,eY(d.experimentalLongPollingOptions),d.useFetchStreams,d.isUsingEmulator));!a._componentsProvider&&d.localCache?._offlineComponentProvider&&d.localCache?._onlineComponentProvider&&(a._componentsProvider={_offline:d.localCache._offlineComponentProvider,_online:d.localCache._onlineComponentProvider}),a._firestoreClient=new eT(a._authCredentials,a._appCheckCredentials,a._queue,e,a._componentsProvider&&function(a){let b=a?._online.build();return{_offline:a?._offline.build(b),_online:b}}(a._componentsProvider))}(a),a._firestoreClient}(h);let k=new aR;return j.asyncQueue.enqueueAndForget(async()=>eH(await eX(j).then(a=>a.syncEngine),i,k)),k.promise}fx._jsonSchemaVersion="firestore/querySnapshot/1.0",fx._jsonSchema={type:bc("string",fx._jsonSchemaVersion),bundleSource:bc("string","QuerySnapshot"),bundleName:bc("string"),bundle:bc("string")},new WeakMap,function(a,b=!0){aF="12.3.0",Q(new ak("firestore",(a,{instanceIdentifier:c,options:d})=>{let e=a.getProvider("app").getImmediate(),f=new e6(new aU(a.getProvider("auth-internal")),new aY(e,a.getProvider("app-check-internal")),function(a,b){if(!Object.prototype.hasOwnProperty.apply(a.options,["projectId"]))throw new aQ(aP.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new bL(a.options.projectId,b)}(e,c),e);return d={useFetchStreams:b,...d},f._setSettings(d),f},"PUBLIC").setMultipleInstances(!0)),S(aC,aD,a),S(aC,aD,"esm2020")}("node")},59173:(a,b)=>{"use strict";var c;Object.defineProperty(b,"__esModule",{value:!0}),b.ConnectivityState=void 0,function(a){a[a.IDLE=0]="IDLE",a[a.CONNECTING=1]="CONNECTING",a[a.READY=2]="READY",a[a.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",a[a.SHUTDOWN=4]="SHUTDOWN"}(c||(b.ConnectivityState=c={}))},59251:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>d});let d=(0,c(97954).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/user/studio/src/app/setup-admin/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/user/studio/src/app/setup-admin/page.tsx","default")},61291:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.Metadata=void 0;let d=c(74271),e=c(51387),f=c(2234),g=/^[0-9a-z_.-]+$/,h=/^[ -~]*$/;function i(a){return a.endsWith("-bin")}function j(a){return a.toLowerCase()}function k(a,b){if(!g.test(a))throw Error('Metadata key "'+a+'" contains illegal characters');if(null!=b)if(i(a)){if(!Buffer.isBuffer(b))throw Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(b))throw Error("keys that don't end with '-bin' must have String values");if(!h.test(b))throw Error('Metadata string value "'+b+'" contains illegal characters')}}class l{constructor(a={}){this.internalRepr=new Map,this.options=a}set(a,b){k(a=j(a),b),this.internalRepr.set(a,[b])}add(a,b){k(a=j(a),b);let c=this.internalRepr.get(a);void 0===c?this.internalRepr.set(a,[b]):c.push(b)}remove(a){a=j(a),this.internalRepr.delete(a)}get(a){return a=j(a),this.internalRepr.get(a)||[]}getMap(){let a={};for(let[b,c]of this.internalRepr)if(c.length>0){let d=c[0];a[b]=Buffer.isBuffer(d)?Buffer.from(d):d}return a}clone(){let a=new l(this.options),b=a.internalRepr;for(let[a,c]of this.internalRepr){let d=c.map(a=>Buffer.isBuffer(a)?Buffer.from(a):a);b.set(a,d)}return a}merge(a){for(let[b,c]of a.internalRepr){let a=(this.internalRepr.get(b)||[]).concat(c);this.internalRepr.set(b,a)}}setOptions(a){this.options=a}getOptions(){return this.options}toHttp2Headers(){let a={};for(let[b,c]of this.internalRepr)a[b]=c.map(m);return a}toJSON(){let a={};for(let[b,c]of this.internalRepr)a[b]=c;return a}static fromHttp2Headers(a){let b=new l;for(let c of Object.keys(a)){if(":"===c.charAt(0))continue;let g=a[c];try{i(c)?Array.isArray(g)?g.forEach(a=>{b.add(c,Buffer.from(a,"base64"))}):void 0!==g&&(c.startsWith("grpc-")?b.add(c,Buffer.from(g,"base64")):g.split(",").forEach(a=>{b.add(c,Buffer.from(a.trim(),"base64"))})):Array.isArray(g)?g.forEach(a=>{b.add(c,a)}):void 0!==g&&b.add(c,g)}catch(b){let a=`Failed to add metadata entry ${c}: ${g}. ${(0,f.getErrorMessage)(b)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,d.log)(e.LogVerbosity.ERROR,a)}}return b}}b.Metadata=l;let m=a=>Buffer.isBuffer(a)?a.toString("base64"):a},61774:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.mapUriDefaultScheme=b.getDefaultAuthority=b.createResolver=b.registerDefaultScheme=b.registerResolver=void 0;let d=c(71790),e={},f=null;b.registerResolver=function(a,b){e[a]=b},b.registerDefaultScheme=function(a){f=a},b.createResolver=function(a,b,c){if(void 0!==a.scheme&&a.scheme in e)return new e[a.scheme](a,b,c);throw Error(`No resolver could be created for target ${(0,d.uriToString)(a)}`)},b.getDefaultAuthority=function(a){if(void 0!==a.scheme&&a.scheme in e)return e[a.scheme].getDefaultAuthority(a);throw Error(`Invalid target ${(0,d.uriToString)(a)}`)},b.mapUriDefaultScheme=function(a){if(void 0===a.scheme||!(a.scheme in e))if(null!==f)return{scheme:f,authority:void 0,path:(0,d.uriToString)(a)};else return null;return a}},62944:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{w:()=>k});var e=c(91488);c(27806);var f=c(80446),g=c(14276),h=c(56302),i=c(40410),j=a([f,g]);async function k(a){try{let b=await (0,f.Lf)(),c=(0,h.H9)(b,"users",a);return await (0,h.BN)(c,{role:"admin"},{merge:!0}),await (0,g.getAuth)().setCustomUserClaims(a,{role:"admin"}),console.log(`Successfully assigned 'admin' role to user ${a}`),{success:!0,message:`User ${a} is now an administrator.`}}catch(a){return console.error("Error setting initial admin:",a),{success:!1,message:`Failed to set admin role: ${a.message}`}}}[f,g]=j.then?(await j)():j,(0,i.D)([k]),(0,e.A)(k,"409d1987d2031262bc2c3c840d8d69edd61b373a07",null),d()}catch(a){d(a)}})},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66655:(a,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.validateLoadBalancingConfig=b.getFirstUsableConfig=b.isLoadBalancerNameRegistered=b.createLoadBalancer=b.registerDefaultLoadBalancerType=b.registerLoadBalancerType=b.createChildChannelControlHelper=void 0,b.createChildChannelControlHelper=function(a,b){var c,d,e,f,g,h,i,j,k,l;return{createSubchannel:null!=(d=null==(c=b.createSubchannel)?void 0:c.bind(b))?d:a.createSubchannel.bind(a),updateState:null!=(f=null==(e=b.updateState)?void 0:e.bind(b))?f:a.updateState.bind(a),requestReresolution:null!=(h=null==(g=b.requestReresolution)?void 0:g.bind(b))?h:a.requestReresolution.bind(a),addChannelzChild:null!=(j=null==(i=b.addChannelzChild)?void 0:i.bind(b))?j:a.addChannelzChild.bind(a),removeChannelzChild:null!=(l=null==(k=b.removeChannelzChild)?void 0:k.bind(b))?l:a.removeChannelzChild.bind(a)}};let c={},d=null;b.registerLoadBalancerType=function(a,b,d){c[a]={LoadBalancer:b,LoadBalancingConfig:d}},b.registerDefaultLoadBalancerType=function(a){d=a},b.createLoadBalancer=function(a,b){let d=a.getLoadBalancerName();return d in c?new c[d].LoadBalancer(b):null},b.isLoadBalancerNameRegistered=function(a){return a in c},b.getFirstUsableConfig=function(a,b=!1){for(let b of a)if(b.getLoadBalancerName()in c)return b;return b&&d?new c[d].LoadBalancingConfig:null},b.validateLoadBalancingConfig=function(a){if(null===a||"object"!=typeof a)throw Error("Load balancing config must be an object");let b=Object.keys(a);if(1!==b.length)throw Error("Provided load balancing config has multiple conflicting entries");let d=b[0];if(d in c)return c[d].LoadBalancingConfig.createFromJson(a[d]);throw Error(`Unrecognized load balancing config name ${d}`)}},71790:(a,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.uriToString=b.splitHostPort=b.parseUri=void 0;let c=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;b.parseUri=function(a){let b=c.exec(a);return null===b?null:{scheme:b[1],authority:b[2],path:b[3]}};let d=/^\d+$/;b.splitHostPort=function(a){if(a.startsWith("[")){let b=a.indexOf("]");if(-1===b)return null;let c=a.substring(1,b);if(-1===c.indexOf(":"))return null;if(!(a.length>b+1))return{host:c};if(":"!==a[b+1])return null;{let e=a.substring(b+2);return d.test(e)?{host:c,port:+e}:null}}{let b=a.split(":");return 2!==b.length?{host:a}:d.test(b[1])?{host:b[0],port:+b[1]}:null}},b.uriToString=function(a){let b="";return void 0!==a.scheme&&(b+=a.scheme+":"),void 0!==a.authority&&(b+="//"+a.authority+"/"),b+=a.path}},73481:(a,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.FilterStackFactory=b.FilterStack=void 0;class c{constructor(a){this.filters=a}sendMetadata(a){let b=a;for(let a=0;a<this.filters.length;a++)b=this.filters[a].sendMetadata(b);return b}receiveMetadata(a){let b=a;for(let a=this.filters.length-1;a>=0;a--)b=this.filters[a].receiveMetadata(b);return b}sendMessage(a){let b=a;for(let a=0;a<this.filters.length;a++)b=this.filters[a].sendMessage(b);return b}receiveMessage(a){let b=a;for(let a=this.filters.length-1;a>=0;a--)b=this.filters[a].receiveMessage(b);return b}receiveTrailers(a){let b=a;for(let a=this.filters.length-1;a>=0;a--)b=this.filters[a].receiveTrailers(b);return b}push(a){this.filters.unshift(...a)}getFilters(){return this.filters}}b.FilterStack=c;class d{constructor(a){this.factories=a}push(a){this.factories.unshift(...a)}clone(){return new d([...this.factories])}createFilter(){return new c(this.factories.map(a=>a.createFilter()))}}b.FilterStackFactory=d},73496:a=>{"use strict";a.exports=require("http2")},73652:(a,b,c)=>{"use strict";b.ex=b.OS=b.z3=void 0;let d=c(55289),e=(c(6269),c(99245),c(59173),c(34284)),f=(c(2929),c(51387),c(74271),c(37010));Object.defineProperty(b,"ex",{enumerable:!0,get:function(){return f.loadPackageDefinition}});let g=c(61291);Object.defineProperty(b,"OS",{enumerable:!0,get:function(){return g.Metadata}}),c(82125),c(37020),c(31712),b.z3={combineChannelCredentials:(a,...b)=>b.reduce((a,b)=>a.compose(b),a),combineCallCredentials:(a,...b)=>b.reduce((a,b)=>a.compose(b),a),createInsecure:e.ChannelCredentials.createInsecure,createSsl:e.ChannelCredentials.createSsl,createFromSecureContext:e.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:d.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:d.CallCredentials.createFromGoogleCredential,createEmpty:d.CallCredentials.createEmpty},c(44258),c(41669),c(2313),c(40042);let h=c(28900),i=c(51555),j=c(81396),k=c(87066),l=c(53123),m=c(82246),n=c(41669);h.setup(),i.setup(),j.setup(),k.setup(),l.setup(),m.setup(),n.setup()},74075:a=>{"use strict";a.exports=require("zlib")},74271:(a,b,c)=>{"use strict";var d,e,f,g;Object.defineProperty(b,"__esModule",{value:!0}),b.isTracerEnabled=b.trace=b.log=b.setLoggerVerbosity=b.setLogger=b.getLogger=void 0;let h=c(51387),i=c(19771),j=c(97697).rE,k={error:(a,...b)=>{console.error("E "+a,...b)},info:(a,...b)=>{console.error("I "+a,...b)},debug:(a,...b)=>{console.error("D "+a,...b)}},l=h.LogVerbosity.ERROR;switch((null!=(e=null!=(d=process.env.GRPC_NODE_VERBOSITY)?d:process.env.GRPC_VERBOSITY)?e:"").toUpperCase()){case"DEBUG":l=h.LogVerbosity.DEBUG;break;case"INFO":l=h.LogVerbosity.INFO;break;case"ERROR":l=h.LogVerbosity.ERROR;break;case"NONE":l=h.LogVerbosity.NONE}b.getLogger=()=>k,b.setLogger=a=>{k=a},b.setLoggerVerbosity=a=>{l=a},b.log=(a,...b)=>{let c;if(a>=l){switch(a){case h.LogVerbosity.DEBUG:c=k.debug;break;case h.LogVerbosity.INFO:c=k.info;break;case h.LogVerbosity.ERROR:c=k.error}c||(c=k.error),c&&c.bind(k)(...b)}};let m=null!=(g=null!=(f=process.env.GRPC_NODE_TRACE)?f:process.env.GRPC_TRACE)?g:"",n=new Set,o=new Set;for(let a of m.split(","))a.startsWith("-")?o.add(a.substring(1)):n.add(a);let p=n.has("all");function q(a){return!o.has(a)&&(p||n.has(a))}b.trace=function(a,c,d){q(c)&&(0,b.log)(a,new Date().toISOString()+" | v"+j+" "+i.pid+" | "+c+" | "+d)},b.isTracerEnabled=q},77347:(a,b,c)=>{Promise.resolve().then(c.bind(c,59251))},79551:a=>{"use strict";a.exports=require("url")},81396:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.setup=void 0;let d=c(91645),e=c(51387),f=c(61291),g=c(61774),h=c(71790),i=c(74271);function j(a){i.trace(e.LogVerbosity.DEBUG,"ip_resolver",a)}let k="ipv4",l="ipv6";class m{constructor(a,b,c){var g;this.listener=b,this.addresses=[],this.error=null,this.hasReturnedResult=!1,j("Resolver constructed for target "+(0,h.uriToString)(a));let i=[];if(a.scheme!==k&&a.scheme!==l){this.error={code:e.Status.UNAVAILABLE,details:`Unrecognized scheme ${a.scheme} in IP resolver`,metadata:new f.Metadata};return}for(let b of a.path.split(",")){let c=(0,h.splitHostPort)(b);if(null===c||a.scheme===k&&!(0,d.isIPv4)(c.host)||a.scheme===l&&!(0,d.isIPv6)(c.host)){this.error={code:e.Status.UNAVAILABLE,details:`Failed to parse ${a.scheme} address ${b}`,metadata:new f.Metadata};return}i.push({host:c.host,port:null!=(g=c.port)?g:443})}this.addresses=i,j("Parsed "+a.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(a){return a.path.split(",")[0]}}b.setup=function(){(0,g.registerResolver)(k,m),(0,g.registerResolver)(l,m)}},81630:a=>{"use strict";a.exports=require("http")},82125:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.Server=void 0;let d=c(73496),e=c(51387),f=c(25098),g=c(37020),h=c(61774),i=c(74271),j=c(55392),k=c(71790),l=c(41669),{HTTP2_HEADER_PATH:m}=d.constants;function n(){}function o(a){return{code:e.Status.UNIMPLEMENTED,details:`The server does not implement the method ${a}`}}class p{constructor(a){var b,c,d,e;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new l.ChannelzTrace,this.callTracker=new l.ChannelzCallTracker,this.listenerChildrenTracker=new l.ChannelzChildrenTracker,this.sessionChildrenTracker=new l.ChannelzChildrenTracker,this.options=null!=a?a:{},0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,l.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=null!=(b=this.options["grpc.max_connection_age_ms"])?b:0x7fffffff,this.maxConnectionAgeGraceMs=null!=(c=this.options["grpc.max_connection_age_grace_ms"])?c:0x7fffffff,this.keepaliveTimeMs=null!=(d=this.options["grpc.keepalive_time_ms"])?d:0x7fffffff,this.keepaliveTimeoutMs=null!=(e=this.options["grpc.keepalive_timeout_ms"])?e:2e4,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(a){return()=>{var b,c,d;let e,f=this.sessions.get(a),g=a.socket,h=g.remoteAddress?(0,j.stringToSubchannelAddress)(g.remoteAddress,g.remotePort):null,i=g.localAddress?(0,j.stringToSubchannelAddress)(g.localAddress,g.localPort):null;if(a.encrypted){let a=g.getCipher(),c=g.getCertificate(),d=g.getPeerCertificate();e={cipherSuiteStandardName:null!=(b=a.standardName)?b:null,cipherSuiteOtherName:a.standardName?null:a.name,localCertificate:c&&"raw"in c?c.raw:null,remoteCertificate:d&&"raw"in d?d.raw:null}}else e=null;return{remoteAddress:h,localAddress:i,security:e,remoteName:null,streamsStarted:f.streamTracker.callsStarted,streamsSucceeded:f.streamTracker.callsSucceeded,streamsFailed:f.streamTracker.callsFailed,messagesSent:f.messagesSent,messagesReceived:f.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:f.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:f.lastMessageSentTimestamp,lastMessageReceivedTimestamp:f.lastMessageReceivedTimestamp,localFlowControlWindow:null!=(c=a.state.localWindowSize)?c:null,remoteFlowControlWindow:null!=(d=a.state.remoteWindowSize)?d:null}}}trace(a){i.trace(e.LogVerbosity.DEBUG,"server","("+this.channelzRef.id+") "+a)}addProtoService(){throw Error("Not implemented. Use addService() instead")}addService(a,b){if(null===a||"object"!=typeof a||null===b||"object"!=typeof b)throw Error("addService() requires two objects as arguments");let c=Object.keys(a);if(0===c.length)throw Error("Cannot add an empty service to a server");c.forEach(c=>{let d,e,f=a[c];d=f.requestStream?f.responseStream?"bidi":"clientStream":f.responseStream?"serverStream":"unary";let g=b[c];if(void 0===g&&"string"==typeof f.originalName&&(g=b[f.originalName]),e=void 0!==g?g.bind(b):function(a,b){let c=o(b);switch(a){case"unary":return(a,b)=>{b(c,null)};case"clientStream":return(a,b)=>{b(c,null)};case"serverStream":return a=>{a.emit("error",c)};case"bidi":return a=>{a.emit("error",c)};default:throw Error(`Invalid handlerType ${a}`)}}(d,c),!1===this.register(f.path,e,f.responseSerialize,f.requestDeserialize,d))throw Error(`Method handler for ${f.path} already provided.`)})}removeService(a){if(null===a||"object"!=typeof a)throw Error("removeService() requires object as argument");Object.keys(a).forEach(b=>{let c=a[b];this.unregister(c.path)})}bind(a,b){throw Error("Not implemented. Use bindAsync() instead")}bindAsync(a,b,c){if(!0===this.started)throw Error("server is already started");if(this.shutdown)throw Error("bindAsync called after shutdown");if("string"!=typeof a)throw TypeError("port must be a string");if(null===b||!(b instanceof g.ServerCredentials))throw TypeError("creds must be a ServerCredentials object");if("function"!=typeof c)throw TypeError("callback must be a function");let f=(0,k.parseUri)(a);if(null===f)throw Error(`Could not parse port "${a}"`);let m=(0,h.mapUriDefaultScheme)(f);if(null===m)throw Error(`Could not get a default scheme for port "${a}"`);let o={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?o.maxSessionMemory=this.options["grpc-node.max_session_memory"]:o.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(o.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let p=(a,b)=>{process.nextTick(()=>c(a,b))},q=()=>{let a;if(b._isSecure()){let c=Object.assign(o,b._getSettings());c.enableTrace=1===this.options["grpc-node.tls_enable_trace"],(a=d.createSecureServer(c)).on("secureConnection",a=>{a.on("error",a=>{this.trace("An incoming TLS connection closed with error: "+a.message)})})}else a=d.createServer(o);return a.setTimeout(0,n),this._setupHandlers(a),a},r=(a,b,c)=>0===a.length?Promise.resolve({port:b,count:c}):Promise.all(a.map(a=>{let c;this.trace("Attempting to bind "+(0,j.subchannelAddressToString)(a)),c=(0,j.isTcpSubchannelAddress)(a)?{host:a.host,port:b}:a;let d=q();return new Promise((e,f)=>{let g=b=>{this.trace("Failed to bind "+(0,j.subchannelAddressToString)(a)+" with error "+b.message),e(b)};d.once("error",g),d.listen(c,()=>{let a;if(this.shutdown){d.close(),e(Error("bindAsync failed because server is shutdown"));return}let c=d.address();a="string"==typeof c?{path:c}:{host:c.address,port:c.port};let f=(0,l.registerChannelzSocket)((0,j.subchannelAddressToString)(a),()=>({localAddress:a,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(f),this.http2ServerList.push({server:d,channelzRef:f}),this.trace("Successfully bound "+(0,j.subchannelAddressToString)(a)),e("port"in a?a.port:b),d.removeListener("error",g)})})})).then(a=>{let d=0;for(let c of a)if("number"==typeof c&&(d+=1,c!==b))throw Error("Invalid state: multiple port numbers added from single address");return{port:b,count:d+c}}),s=a=>{if(0===a.length)return Promise.resolve({port:0,count:0});let b=a[0],c=q();return new Promise((d,e)=>{let f=c=>{this.trace("Failed to bind "+(0,j.subchannelAddressToString)(b)+" with error "+c.message),d(s(a.slice(1)))};c.once("error",f),c.listen(b,()=>{if(this.shutdown){c.close(),d({port:0,count:0});return}let b=c.address(),e={host:b.address,port:b.port},g=(0,l.registerChannelzSocket)((0,j.subchannelAddressToString)(e),()=>({localAddress:e,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(g),this.http2ServerList.push({server:c,channelzRef:g}),this.trace("Successfully bound "+(0,j.subchannelAddressToString)(e)),d(r(a.slice(1),b.port,1)),c.removeListener("error",f)})})},t={onSuccessfulResolution:(b,c,d)=>{if(t.onSuccessfulResolution=()=>{},this.shutdown&&p(Error("bindAsync failed because server is shutdown"),0),0===b.length)return void p(Error(`No addresses resolved for port ${a}`),0);((0,j.isTcpSubchannelAddress)(b[0])?0===b[0].port?s(b):r(b,b[0].port,0):r(b,1,0)).then(a=>{if(0===a.count){let a=`No address added out of total ${b.length} resolved`;i.log(e.LogVerbosity.ERROR,a),p(Error(a),0)}else a.count<b.length&&i.log(e.LogVerbosity.INFO,`WARNING Only ${a.count} addresses added out of total ${b.length} resolved`),p(null,a.port)},a=>{let c=`No address added out of total ${b.length} resolved`;i.log(e.LogVerbosity.ERROR,c),p(Error(c),0)})},onError:a=>{p(Error(a.details),0)}};(0,h.createResolver)(m,t,this.options).updateResolution()}forceShutdown(){for(let{server:a,channelzRef:b}of this.http2ServerList)a.listening&&a.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(b),(0,l.unregisterChannelzRef)(b))});this.started=!1,this.shutdown=!0,this.sessions.forEach((a,b)=>{b.destroy(d.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,l.unregisterChannelzRef)(this.channelzRef)}register(a,b,c,d,e){return!this.handlers.has(a)&&(this.handlers.set(a,{func:b,serialize:c,deserialize:d,type:e,path:a}),!0)}unregister(a){return this.handlers.delete(a)}start(){if(0===this.http2ServerList.length||this.http2ServerList.every(({server:a})=>!0!==a.listening))throw Error("server must be bound in order to start");if(!0===this.started)throw Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(a){let b=b=>{this.channelzEnabled&&(0,l.unregisterChannelzRef)(this.channelzRef),a(b)},c=0;function d(){0==--c&&b()}for(let{server:a,channelzRef:b}of(this.started=!1,this.shutdown=!0,this.http2ServerList))a.listening&&(c++,a.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(b),(0,l.unregisterChannelzRef)(b)),d()}));this.sessions.forEach((a,b)=>{b.closed||(c+=1,b.close(d))}),0===c&&b()}addHttp2Port(){throw Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(a,b){let c=b[d.constants.HTTP2_HEADER_CONTENT_TYPE];return"string"==typeof c&&!!c.startsWith("application/grpc")||(a.respond({[d.constants.HTTP2_HEADER_STATUS]:d.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1)}_retrieveHandler(a){this.trace("Received call to method "+a+" at address "+this.serverAddressString);let b=this.handlers.get(a);return void 0===b?(this.trace("No handler registered for method "+a+". Sending UNIMPLEMENTED status."),null):b}_respondWithError(a,b,c=null){let d=new f.Http2ServerCallStream(b,null,this.options);void 0===a.code&&(a.code=e.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),null==c||c.streamTracker.addCallFailed()),d.sendError(a)}_channelzHandler(a,b){let c=this.sessions.get(a.session);if(this.callTracker.addCallStarted(),null==c||c.streamTracker.addCallStarted(),!this._verifyContentType(a,b)){this.callTracker.addCallFailed(),null==c||c.streamTracker.addCallFailed();return}let d=b[m],g=this._retrieveHandler(d);if(!g)return void this._respondWithError(o(d),a,c);let h=new f.Http2ServerCallStream(a,g,this.options);h.once("callEnd",a=>{a===e.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),c&&(h.once("streamEnd",a=>{a?c.streamTracker.addCallSucceeded():c.streamTracker.addCallFailed()}),h.on("sendMessage",()=>{c.messagesSent+=1,c.lastMessageSentTimestamp=new Date}),h.on("receiveMessage",()=>{c.messagesReceived+=1,c.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(h,g,b)||(this.callTracker.addCallFailed(),null==c||c.streamTracker.addCallFailed(),h.sendError({code:e.Status.INTERNAL,details:`Unknown handler type: ${g.type}`}))}_streamHandler(a,b){if(!0!==this._verifyContentType(a,b))return;let c=b[m],d=this._retrieveHandler(c);if(!d)return void this._respondWithError(o(c),a,null);let g=new f.Http2ServerCallStream(a,d,this.options);this._runHandlerForCall(g,d,b)||g.sendError({code:e.Status.INTERNAL,details:`Unknown handler type: ${d.type}`})}_runHandlerForCall(a,b,c){var d;let e=a.receiveMetadata(c),g=null!=(d=e.get("grpc-encoding")[0])?d:"identity";e.remove("grpc-encoding");let{type:h}=b;if("unary"===h)q(a,b,e,g);else if("clientStream"===h){var i=a,j=b,k=e,l=g;let c=new f.ServerReadableStreamImpl(i,k,j.deserialize,l);function m(a,b,d,e){c.destroy(),i.sendUnaryMessage(a,b,d,e)}i.cancelled||(c.on("error",m),j.func(c,m))}else if("serverStream"===h)r(a,b,e,g);else{if("bidi"!==h)return!1;var n=a,o=b,p=e,s=g;let c=new f.ServerDuplexStreamImpl(n,p,o.serialize,o.deserialize,s);n.cancelled||o.func(c)}return!0}_setupHandlers(a){if(null===a)return;let b=a.address(),c="null";b&&(c="string"==typeof b?b:b.address+":"+b.port),this.serverAddressString=c;let e=this.channelzEnabled?this._channelzHandler:this._streamHandler;a.on("stream",e.bind(this)),a.on("session",a=>{var b,c,e,f,g;if(!this.started)return void a.destroy();let h=(0,l.registerChannelzSocket)(null!=(b=a.socket.remoteAddress)?b:"unknown",this.getChannelzSessionInfoGetter(a),this.channelzEnabled),i={ref:h,streamTracker:new l.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(a,i);let j=a.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+j),this.sessionChildrenTracker.refChild(h));let k=null,m=null,n=!1;if(0x7fffffff!==this.maxConnectionAgeMs){let b=this.maxConnectionAgeMs/10,f=Math.random()*b*2-b;k=null==(e=(c=setTimeout(()=>{var b,c;n=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+j);try{a.goaway(d.constants.NGHTTP2_NO_ERROR,0x7fffffff,Buffer.from("max_age"))}catch(b){a.destroy();return}a.close(),0x7fffffff!==this.maxConnectionAgeGraceMs&&(m=null==(c=(b=setTimeout(()=>{a.destroy()},this.maxConnectionAgeGraceMs)).unref)?void 0:c.call(b))},this.maxConnectionAgeMs+f)).unref)?void 0:e.call(c)}let o=null==(g=(f=setInterval(()=>{var b,c;let d=null==(c=(b=setTimeout(()=>{n=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+j),a.close()},this.keepaliveTimeoutMs)).unref)?void 0:c.call(b);try{a.ping((a,b,c)=>{clearTimeout(d)})}catch(b){a.destroy()}},this.keepaliveTimeMs)).unref)?void 0:g.call(f);a.on("close",()=>{this.channelzEnabled&&(n||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+j),this.sessionChildrenTracker.unrefChild(h),(0,l.unregisterChannelzRef)(h)),k&&clearTimeout(k),m&&clearTimeout(m),o&&clearTimeout(o),this.sessions.delete(a)})})}}async function q(a,b,c,d){try{let e=await a.receiveUnaryMessage(d);if(void 0===e||a.cancelled)return;let g=new f.ServerUnaryCallImpl(a,c,e);b.func(g,(b,c,d,e)=>{a.sendUnaryMessage(b,c,d,e)})}catch(b){a.sendError(b)}}async function r(a,b,c,d){try{let e=await a.receiveUnaryMessage(d);if(void 0===e||a.cancelled)return;let g=new f.ServerWritableStreamImpl(a,c,b.serialize,e);b.func(g)}catch(b){a.sendError(b)}}b.Server=p},82246:(a,b,c)=>{"use strict";var d;Object.defineProperty(b,"__esModule",{value:!0}),b.setup=b.OutlierDetectionLoadBalancer=b.OutlierDetectionLoadBalancingConfig=void 0;let e=c(59173),f=c(51387),g=c(1448),h=c(40042),i=c(66655),j=c(16277),k=c(7702),l=c(55392),m=c(86429),n=c(74271);function o(a){n.trace(f.LogVerbosity.DEBUG,"outlier_detection",a)}let p="outlier_detection",q=(null!=(d=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)?d:"true")==="true",r={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},s={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function t(a,b,c,d){if(b in a&&typeof a[b]!==c){let e=d?`${d}.${b}`:b;throw Error(`outlier detection config ${e} parse error: expected ${c}, got ${typeof a[b]}`)}}function u(a,b,c){let d=c?`${c}.${b}`:b;if(b in a){if(!(0,g.isDuration)(a[b]))throw Error(`outlier detection config ${d} parse error: expected Duration, got ${typeof a[b]}`);if(!(a[b].seconds>=0&&a[b].seconds<=315576e6&&a[b].nanos>=0&&a[b].nanos<=0x3b9ac9ff))throw Error(`outlier detection config ${d} parse error: values out of range for non-negative Duaration`)}}function v(a,b,c){let d=c?`${c}.${b}`:b;if(t(a,b,"number",c),b in a&&!(a[b]>=0&&a[b]<=100))throw Error(`outlier detection config ${d} parse error: value out of range for percentage (0-100)`)}class w{constructor(a,b,c,d,e,f,g){if(this.childPolicy=g,g.length>0&&"pick_first"===g[0].getLoadBalancerName())throw Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=null!=a?a:1e4,this.baseEjectionTimeMs=null!=b?b:3e4,this.maxEjectionTimeMs=null!=c?c:3e5,this.maxEjectionPercent=null!=d?d:10,this.successRateEjection=e?Object.assign(Object.assign({},r),e):null,this.failurePercentageEjection=f?Object.assign(Object.assign({},s),f):null}getLoadBalancerName(){return p}toJsonObject(){return{interval:(0,g.msToDuration)(this.intervalMs),base_ejection_time:(0,g.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,g.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(a=>a.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(a){return new w(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,a)}static createFromJson(a){var b;if(u(a,"interval"),u(a,"base_ejection_time"),u(a,"max_ejection_time"),v(a,"max_ejection_percent"),"success_rate_ejection"in a){if("object"!=typeof a.success_rate_ejection)throw Error("outlier detection config success_rate_ejection must be an object");t(a.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),v(a.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),t(a.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),t(a.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in a){if("object"!=typeof a.failure_percentage_ejection)throw Error("outlier detection config failure_percentage_ejection must be an object");v(a.failure_percentage_ejection,"threshold","failure_percentage_ejection"),v(a.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),t(a.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),t(a.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new w(a.interval?(0,g.durationToMs)(a.interval):null,a.base_ejection_time?(0,g.durationToMs)(a.base_ejection_time):null,a.max_ejection_time?(0,g.durationToMs)(a.max_ejection_time):null,null!=(b=a.max_ejection_percent)?b:null,a.success_rate_ejection,a.failure_percentage_ejection,a.child_policy.map(i.validateLoadBalancingConfig))}}b.OutlierDetectionLoadBalancingConfig=w;class x extends m.BaseSubchannelWrapper{constructor(a,b){super(a),this.mapEntry=b,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=a.getConnectivityState(),a.addConnectivityStateListener((a,b,c,d)=>{if(this.childSubchannelState=c,!this.ejected)for(let a of this.stateListeners)a(this,b,c,d)})}getConnectivityState(){return this.ejected?e.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(a){this.stateListeners.push(a)}removeConnectivityStateListener(a){let b=this.stateListeners.indexOf(a);b>-1&&this.stateListeners.splice(b,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let a=this.mapEntry.subchannelWrappers.indexOf(this);a>=0&&this.mapEntry.subchannelWrappers.splice(a,1)}}eject(){for(let a of(this.ejected=!0,this.stateListeners))a(this,this.childSubchannelState,e.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){for(let a of(this.ejected=!1,this.stateListeners))a(this,e.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}}function y(){return{success:0,failure:0}}class z{constructor(){this.activeBucket=y(),this.inactiveBucket=y()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=y()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}}class A{constructor(a,b){this.wrappedPicker=a,this.countCalls=b}pick(a){let b=this.wrappedPicker.pick(a);if(b.pickResultType!==k.PickResultType.COMPLETE)return b;{let a=b.subchannel,c=a.getMapEntry();if(!c)return Object.assign(Object.assign({},b),{subchannel:a.getWrappedSubchannel()});{let d=b.onCallEnded;return this.countCalls&&(d=a=>{var d;a===f.Status.OK?c.counter.addSuccess():c.counter.addFailure(),null==(d=b.onCallEnded)||d.call(b,a)}),Object.assign(Object.assign({},b),{subchannel:a.getWrappedSubchannel(),onCallEnded:d})}}}}class B{constructor(a){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new j.ChildLoadBalancerHandler((0,h.createChildChannelControlHelper)(a,{createSubchannel:(b,c)=>{let d=a.createSubchannel(b,c),e=this.addressMap.get((0,l.subchannelAddressToString)(b)),f=new x(d,e);return(null==e?void 0:e.currentEjectionTimestamp)!==null&&f.eject(),null==e||e.subchannelWrappers.push(f),f},updateState:(b,c)=>{b===e.ConnectivityState.READY?a.updateState(b,new A(c,this.isCountingEnabled())):a.updateState(b,c)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return null!==this.latestConfig&&(null!==this.latestConfig.getSuccessRateEjectionConfig()||null!==this.latestConfig.getFailurePercentageEjectionConfig())}getCurrentEjectionPercent(){let a=0;for(let b of this.addressMap.values())null!==b.currentEjectionTimestamp&&(a+=1);return 100*a/this.addressMap.size}runSuccessRateCheck(a){if(!this.latestConfig)return;let b=this.latestConfig.getSuccessRateEjectionConfig();if(!b)return;o("Running success rate check");let c=b.request_volume,d=0,e=[];for(let[a,b]of this.addressMap){let f=b.counter.getLastSuccesses(),g=b.counter.getLastFailures();o("Stats for "+a+": successes="+f+" failures="+g+" targetRequestVolume="+c),f+g>=c&&(d+=1,e.push(f/(f+g)))}if(o("Found "+d+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+e+"]"),d<b.minimum_hosts)return;let f=e.reduce((a,b)=>a+b)/e.length,g=0;for(let a of e){let b=a-f;g+=b*b}let h=Math.sqrt(g/e.length),i=f-h*(b.stdev_factor/1e3);for(let[d,e]of(o("stdev="+h+" ejectionThreshold="+i),this.addressMap.entries())){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let f=e.counter.getLastSuccesses(),g=e.counter.getLastFailures();if(f+g<c)continue;let h=f/(f+g);if(o("Checking candidate "+d+" successRate="+h),h<i){let c=100*Math.random();o("Candidate "+d+" randomNumber="+c+" enforcement_percentage="+b.enforcement_percentage),c<b.enforcement_percentage&&(o("Ejecting candidate "+d),this.eject(e,a))}}}runFailurePercentageCheck(a){if(!this.latestConfig)return;let b=this.latestConfig.getFailurePercentageEjectionConfig();if(!b)return;o("Running failure percentage check. threshold="+b.threshold+" request volume threshold="+b.request_volume);let c=0;for(let a of this.addressMap.values())a.counter.getLastSuccesses()+a.counter.getLastFailures()>=b.request_volume&&(c+=1);if(!(c<b.minimum_hosts))for(let[c,d]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let e=d.counter.getLastSuccesses(),f=d.counter.getLastFailures();if((o("Candidate successes="+e+" failures="+f),!(e+f<b.request_volume))&&100*f/(f+e)>b.threshold){let e=100*Math.random();o("Candidate "+c+" randomNumber="+e+" enforcement_percentage="+b.enforcement_percentage),e<b.enforcement_percentage&&(o("Ejecting candidate "+c),this.eject(d,a))}}}eject(a,b){for(let b of(a.currentEjectionTimestamp=new Date,a.ejectionTimeMultiplier+=1,a.subchannelWrappers))b.eject()}uneject(a){for(let b of(a.currentEjectionTimestamp=null,a.subchannelWrappers))b.uneject()}switchAllBuckets(){for(let a of this.addressMap.values())a.counter.switchBuckets()}startTimer(a){var b,c;this.ejectionTimer=setTimeout(()=>this.runChecks(),a),null==(c=(b=this.ejectionTimer).unref)||c.call(b)}runChecks(){let a=new Date;if(o("Ejection timer running"),this.switchAllBuckets(),this.latestConfig)for(let[b,c]of(this.timerStartTime=a,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(a),this.runFailurePercentageCheck(a),this.addressMap.entries()))if(null===c.currentEjectionTimestamp)c.ejectionTimeMultiplier>0&&(c.ejectionTimeMultiplier-=1);else{let a=this.latestConfig.getBaseEjectionTimeMs(),d=this.latestConfig.getMaxEjectionTimeMs(),e=new Date(c.currentEjectionTimestamp.getTime());e.setMilliseconds(e.getMilliseconds()+Math.min(a*c.ejectionTimeMultiplier,Math.max(a,d))),e<new Date&&(o("Unejecting "+b),this.uneject(c))}}updateAddressList(a,b,c){if(!(b instanceof w))return;let d=new Set;for(let b of a)d.add((0,l.subchannelAddressToString)(b));for(let a of d)this.addressMap.has(a)||(o("Adding map entry for "+a),this.addressMap.set(a,{counter:new z,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let a of this.addressMap.keys())d.has(a)||(o("Removing map entry for "+a),this.addressMap.delete(a));let e=(0,i.getFirstUsableConfig)(b.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(a,e,c),b.getSuccessRateEjectionConfig()||b.getFailurePercentageEjectionConfig())if(this.timerStartTime){o("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let a=b.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(a)}else o("Starting new timer"),this.timerStartTime=new Date,this.startTimer(b.getIntervalMs()),this.switchAllBuckets();else for(let a of(o("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer),this.addressMap.values()))this.uneject(a),a.ejectionTimeMultiplier=0;this.latestConfig=b}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return p}}b.OutlierDetectionLoadBalancer=B,b.setup=function(){q&&(0,h.registerLoadBalancerType)(p,B,w)}},82307:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.RetryingCall=b.MessageBufferTracker=b.RetryThrottler=void 0;let d=c(51387),e=c(61291),f=c(74271);class g{constructor(a,b,c){this.maxTokens=a,this.tokenRatio=b,c?this.tokens=c.tokens*(a/c.maxTokens):this.tokens=a}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}}b.RetryThrottler=g;class h{constructor(a,b){this.totalLimit=a,this.limitPerCall=b,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(a,b){var c;let d=null!=(c=this.allocatedPerCall.get(b))?c:0;return!(this.limitPerCall-d<a)&&!(this.totalLimit-this.totalAllocated<a)&&(this.allocatedPerCall.set(b,d+a),this.totalAllocated+=a,!0)}free(a,b){var c;if(this.totalAllocated<a)throw Error(`Invalid buffer allocation state: call ${b} freed ${a} > total allocated ${this.totalAllocated}`);this.totalAllocated-=a;let d=null!=(c=this.allocatedPerCall.get(b))?c:0;if(d<a)throw Error(`Invalid buffer allocation state: call ${b} freed ${a} > allocated for call ${d}`);this.allocatedPerCall.set(b,d-a)}freeAll(a){var b;let c=null!=(b=this.allocatedPerCall.get(a))?b:0;if(this.totalAllocated<c)throw Error(`Invalid buffer allocation state: call ${a} allocated ${c} > total allocated ${this.totalAllocated}`);this.totalAllocated-=c,this.allocatedPerCall.delete(a)}}b.MessageBufferTracker=h;let i="grpc-previous-rpc-attempts";class j{constructor(a,b,c,d,e,f,g,h,i){if(this.channel=a,this.callConfig=b,this.methodName=c,this.host=d,this.credentials=e,this.deadline=f,this.callNumber=g,this.bufferTracker=h,this.retryThrottler=i,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,b.methodConfig.retryPolicy){this.state="RETRY";let a=b.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(a.initialBackoff.substring(0,a.initialBackoff.length-1))}else b.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(a){f.trace(d.LogVerbosity.DEBUG,"retrying_call","["+this.callNumber+"] "+a)}reportStatus(a){this.trace("ended with status: code="+a.code+' details="'+a.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var b;null==(b=this.listener)||b.onReceiveStatus({code:a.code,details:a.details,metadata:a.metadata})})}cancelWithStatus(a,b){for(let{call:c}of(this.trace("cancelWithStatus code: "+a+' details: "'+b+'"'),this.reportStatus({code:a,details:b,metadata:new e.Metadata}),this.underlyingCalls))c.cancelWithStatus(a,b)}getPeer(){return null!==this.committedCallIndex?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(a){var b;return null!=(b=this.writeBuffer[a-this.writeBufferOffset])?b:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if("COMMITTED"!==this.state)return;let a=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let b=this.writeBufferOffset;b<a;b++){let a=this.getBufferEntry(b);a.allocated&&this.bufferTracker.free(a.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(a-this.writeBufferOffset),this.writeBufferOffset=a}commitCall(a){if("COMMITTED"!==this.state&&"COMPLETED"!==this.underlyingCalls[a].state){this.trace("Committing call ["+this.underlyingCalls[a].call.getCallNumber()+"] at index "+a),this.state="COMMITTED",this.committedCallIndex=a;for(let b=0;b<this.underlyingCalls.length;b++)b!==a&&"COMPLETED"!==this.underlyingCalls[b].state&&(this.underlyingCalls[b].state="COMPLETED",this.underlyingCalls[b].call.cancelWithStatus(d.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if("COMMITTED"===this.state)return;let a=-1,b=-1;for(let[c,d]of this.underlyingCalls.entries())"ACTIVE"===d.state&&d.nextMessageToSend>a&&(a=d.nextMessageToSend,b=c);-1===b?this.state="TRANSPARENT_ONLY":this.commitCall(b)}isStatusCodeInList(a,b){return a.some(a=>a===b||a.toString().toLowerCase()===d.Status[b].toLowerCase())}getNextRetryBackoffMs(){var a;let b=null==(a=this.callConfig)?void 0:a.methodConfig.retryPolicy;if(!b)return 0;let c=Math.random()*this.nextRetryBackoffSec*1e3,d=Number(b.maxBackoff.substring(0,b.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*b.backoffMultiplier,d),c}maybeRetryCall(a,b){let c;if("RETRY"!==this.state)return void b(!1);let d=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(d.maxAttempts,5))return void b(!1);if(null===a)c=this.getNextRetryBackoffMs();else if(a<0){this.state="TRANSPARENT_ONLY",b(!1);return}else c=a,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var a,c;if("RETRY"!==this.state)return void b(!1);(null==(c=null==(a=this.retryThrottler)?void 0:a.canRetryCall())||c)&&(b(!0),this.attempts+=1,this.startNewAttempt())},c)}countActiveCalls(){let a=0;for(let b of this.underlyingCalls)(null==b?void 0:b.state)==="ACTIVE"&&(a+=1);return a}handleProcessedStatus(a,b,c){var d,e,f;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(b),this.reportStatus(a);break;case"HEDGING":if(this.isStatusCodeInList(null!=(d=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)?d:[],a.code)){let d;if(null==(e=this.retryThrottler)||e.addCallFailed(),null===c)d=0;else if(c<0){this.state="TRANSPARENT_ONLY",this.commitCall(b),this.reportStatus(a);return}else d=c;setTimeout(()=>{this.maybeStartHedgingAttempt(),0===this.countActiveCalls()&&(this.commitCall(b),this.reportStatus(a))},d)}else this.commitCall(b),this.reportStatus(a);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,a.code)?(null==(f=this.retryThrottler)||f.addCallFailed(),this.maybeRetryCall(c,c=>{c||(this.commitCall(b),this.reportStatus(a))})):(this.commitCall(b),this.reportStatus(a))}}getPushback(a){let b=a.get("grpc-retry-pushback-ms");if(0===b.length)return null;try{return parseInt(b[0])}catch(a){return -1}}handleChildStatus(a,b){var c;if("COMPLETED"===this.underlyingCalls[b].state)return;if(this.trace("state="+this.state+" handling status with progress "+a.progress+" from child ["+this.underlyingCalls[b].call.getCallNumber()+"] in state "+this.underlyingCalls[b].state),this.underlyingCalls[b].state="COMPLETED",a.code===d.Status.OK){null==(c=this.retryThrottler)||c.addCallSucceeded(),this.commitCall(b),this.reportStatus(a);return}if("COMMITTED"===this.state)return void this.reportStatus(a);let e=this.getPushback(a.metadata);switch(a.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(a,b,e):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(b),this.reportStatus(a);break;case"PROCESSED":this.handleProcessedStatus(a,b,e)}}maybeStartHedgingAttempt(){if("HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let a=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(a.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var a,b,c;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),"HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let d=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(d.maxAttempts,5))return;let e=null!=(a=d.hedgingDelay)?a:"0s",f=Number(e.substring(0,e.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},1e3*f),null==(c=(b=this.hedgingTimer).unref)||c.call(b)}startNewAttempt(){let a=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+a.getCallNumber()+"] for attempt "+this.attempts);let b=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:a,nextMessageToSend:0});let c=this.attempts-1,d=this.initialMetadata.clone();c>0&&d.set(i,`${c}`);let e=!1;a.start(d,{onReceiveMetadata:d=>{this.trace("Received metadata from child ["+a.getCallNumber()+"]"),this.commitCall(b),e=!0,c>0&&d.set(i,`${c}`),"ACTIVE"===this.underlyingCalls[b].state&&this.listener.onReceiveMetadata(d)},onReceiveMessage:c=>{this.trace("Received message from child ["+a.getCallNumber()+"]"),this.commitCall(b),"ACTIVE"===this.underlyingCalls[b].state&&this.listener.onReceiveMessage(c)},onReceiveStatus:d=>{this.trace("Received status from child ["+a.getCallNumber()+"]"),!e&&c>0&&d.metadata.set(i,`${c}`),this.handleChildStatus(d,b)}}),this.sendNextChildMessage(b),this.readStarted&&a.startRead()}start(a,b){this.trace("start called"),this.listener=b,this.initialMetadata=a,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(a){var b,c;let d=this.underlyingCalls[a],e=d.nextMessageToSend;null==(c=(b=this.getBufferEntry(e)).callback)||c.call(b),this.clearSentMessages(),d.nextMessageToSend+=1,this.sendNextChildMessage(a)}sendNextChildMessage(a){let b=this.underlyingCalls[a];if("COMPLETED"!==b.state&&this.getBufferEntry(b.nextMessageToSend)){let c=this.getBufferEntry(b.nextMessageToSend);switch(c.entryType){case"MESSAGE":b.call.sendMessageWithContext({callback:b=>{this.handleChildWriteCompleted(a)}},c.message.message);break;case"HALF_CLOSE":b.nextMessageToSend+=1,b.call.halfClose()}}}sendMessageWithContext(a,b){var c;this.trace("write() called with message of length "+b.length);let d={message:b,flags:a.flags},e=this.getNextBufferIndex(),f={entryType:"MESSAGE",message:d,allocated:this.bufferTracker.allocate(b.length,this.callNumber)};if(this.writeBuffer.push(f),f.allocated)for(let[d,f]of(null==(c=a.callback)||c.call(a),this.underlyingCalls.entries()))"ACTIVE"===f.state&&f.nextMessageToSend===e&&f.call.sendMessageWithContext({callback:a=>{this.handleChildWriteCompleted(d)}},b);else{if(this.commitCallWithMostMessages(),null===this.committedCallIndex)return;let c=this.underlyingCalls[this.committedCallIndex];f.callback=a.callback,"ACTIVE"===c.state&&c.nextMessageToSend===e&&c.call.sendMessageWithContext({callback:a=>{this.handleChildWriteCompleted(this.committedCallIndex)}},b)}}startRead(){for(let a of(this.trace("startRead called"),this.readStarted=!0,this.underlyingCalls))(null==a?void 0:a.state)==="ACTIVE"&&a.call.startRead()}halfClose(){this.trace("halfClose called");let a=this.getNextBufferIndex();for(let b of(this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1}),this.underlyingCalls))(null==b?void 0:b.state)==="ACTIVE"&&b.nextMessageToSend===a&&(b.nextMessageToSend+=1,b.call.halfClose())}setCredentials(a){throw Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}}b.RetryingCall=j},83072:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.Http2SubchannelCall=void 0;let d=c(73496),e=c(21820),f=c(51387),g=c(61291),h=c(31551),i=c(74271),j=c(51387);class k{constructor(a,b,c,i,j){var k;this.http2Stream=a,this.callEventTracker=b,this.listener=c,this.transport=i,this.callId=j,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=f.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;let l=null!=(k=i.getOptions()["grpc.max_receive_message_length"])?k:f.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new h.StreamDecoder(l),a.on("response",(a,b)=>{let c="";for(let b of Object.keys(a))c+="		"+b+": "+a[b]+"\n";switch(this.trace("Received server headers:\n"+c),a[":status"]){case 400:this.mappedStatusCode=f.Status.INTERNAL;break;case 401:this.mappedStatusCode=f.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=f.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=f.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=f.Status.UNAVAILABLE;break;default:this.mappedStatusCode=f.Status.UNKNOWN}if(b&d.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(a);else{let b;try{b=g.Metadata.fromHttp2Headers(a)}catch(a){this.endCall({code:f.Status.UNKNOWN,details:a.message,metadata:new g.Metadata});return}this.listener.onReceiveMetadata(b)}}),a.on("trailers",a=>{this.handleTrailers(a)}),a.on("data",a=>{let b;if(!this.statusOutput){this.trace("receive HTTP/2 data frame of length "+a.length);try{b=this.decoder.write(a)}catch(a){this.cancelWithStatus(f.Status.RESOURCE_EXHAUSTED,a.message);return}for(let a of b)this.trace("parsed message of length "+a.length),this.callEventTracker.addMessageReceived(),this.tryPush(a)}}),a.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),a.on("close",()=>{process.nextTick(()=>{var b;let c;if(this.trace("HTTP/2 stream closed with code "+a.rstCode),(null==(b=this.finalStatus)?void 0:b.code)===f.Status.OK)return;let e="";switch(a.rstCode){case d.constants.NGHTTP2_NO_ERROR:if(null!==this.finalStatus)return;c=f.Status.INTERNAL,e=`Received RST_STREAM with code ${a.rstCode}`;break;case d.constants.NGHTTP2_REFUSED_STREAM:c=f.Status.UNAVAILABLE,e="Stream refused by server";break;case d.constants.NGHTTP2_CANCEL:c=f.Status.CANCELLED,e="Call cancelled";break;case d.constants.NGHTTP2_ENHANCE_YOUR_CALM:c=f.Status.RESOURCE_EXHAUSTED,e="Bandwidth exhausted or memory limit exceeded";break;case d.constants.NGHTTP2_INADEQUATE_SECURITY:c=f.Status.PERMISSION_DENIED,e="Protocol not secure enough";break;case d.constants.NGHTTP2_INTERNAL_ERROR:c=f.Status.INTERNAL,null===this.internalError?e=`Received RST_STREAM with code ${a.rstCode} (Internal server error)`:"ECONNRESET"===this.internalError.code||"ETIMEDOUT"===this.internalError.code?(c=f.Status.UNAVAILABLE,e=this.internalError.message):e=`Received RST_STREAM with code ${a.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:c=f.Status.INTERNAL,e=`Received RST_STREAM with code ${a.rstCode}`}this.endCall({code:c,details:e,metadata:new g.Metadata,rstCode:a.rstCode})})}),a.on("error",a=>{"ERR_HTTP2_STREAM_ERROR"!==a.code&&(this.trace("Node error event: message="+a.message+" code="+a.code+" errno="+function(a){for(let[b,c]of Object.entries(e.constants.errno))if(c===a)return b;return"Unknown system error "+a}(a.errno)+" syscall="+a.syscall),this.internalError=a),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:f.Status.UNAVAILABLE,details:"Connection dropped",metadata:new g.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(a){i.trace(j.LogVerbosity.DEBUG,"subchannel_call","["+this.callId+"] "+a)}endCall(a){(null===this.finalStatus||this.finalStatus.code===f.Status.OK)&&(this.finalStatus=a,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){null===this.finalStatus||this.finalStatus.code===f.Status.OK&&(!this.readsClosed||0!==this.unpushedReadMessages.length||this.isReadFilterPending||this.isPushPending)||this.outputStatus()}push(a){this.trace("pushing to reader message of length "+(a instanceof Buffer?a.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,this.statusOutput||(this.listener.onReceiveMessage(a),this.maybeOutputStatus())})}tryPush(a){this.canPush?(this.http2Stream.pause(),this.push(a)):(this.trace("unpushedReadMessages.push message of length "+a.length),this.unpushedReadMessages.push(a))}handleTrailers(a){let b;this.callEventTracker.onStreamEnd(!0);let c="";for(let b of Object.keys(a))c+="		"+b+": "+a[b]+"\n";this.trace("Received server trailers:\n"+c);try{b=g.Metadata.fromHttp2Headers(a)}catch(a){b=new g.Metadata}let d=b.getMap(),e=this.mappedStatusCode;if(e===f.Status.UNKNOWN&&"string"==typeof d["grpc-status"]){let a=Number(d["grpc-status"]);a in f.Status&&(e=a,this.trace("received status code "+a+" from server")),b.remove("grpc-status")}let h="";if("string"==typeof d["grpc-message"]){try{h=decodeURI(d["grpc-message"])}catch(a){h=d["grpc-message"]}b.remove("grpc-message"),this.trace('received status details string "'+h+'" from server')}let i={code:e,details:h,metadata:b};this.endCall(i)}destroyHttp2Stream(){var a;if(!this.http2Stream.destroyed){let b;b=(null==(a=this.finalStatus)?void 0:a.code)===f.Status.OK?d.constants.NGHTTP2_NO_ERROR:d.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+b),this.http2Stream.close(b)}}cancelWithStatus(a,b){this.trace("cancelWithStatus code: "+a+' details: "'+b+'"'),this.endCall({code:a,details:b,metadata:new g.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(null!==this.finalStatus&&this.finalStatus.code!==f.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let a=this.unpushedReadMessages.shift();this.push(a);return}this.http2Stream.resume()}sendMessageWithContext(a,b){this.trace("write() called with message of length "+b.length);let c=b=>{process.nextTick(()=>{var c;let d=f.Status.UNAVAILABLE;(null==b?void 0:b.code)==="ERR_STREAM_WRITE_AFTER_END"&&(d=f.Status.INTERNAL),b&&this.cancelWithStatus(d,`Write error: ${b.message}`),null==(c=a.callback)||c.call(a)})};this.trace("sending data chunk of length "+b.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(b,c)}catch(a){this.endCall({code:f.Status.UNAVAILABLE,details:`Write failed with error ${a.message}`,metadata:new g.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}}b.Http2SubchannelCall=k},83486:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.ResolvingCall=void 0;let d=c(51387),e=c(50108),f=c(61291),g=c(74271),h=c(11905);class i{constructor(a,b,c,f,g,h){this.channel=a,this.method=b,this.filterStackFactory=f,this.credentials=g,this.callNumber=h,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=c.deadline,this.host=c.host,c.parentCall&&(c.flags&d.Propagate.CANCELLATION&&c.parentCall.on("cancelled",()=>{this.cancelWithStatus(d.Status.CANCELLED,"Cancelled by parent call")}),c.flags&d.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+c.parentCall.getDeadline()),this.deadline=(0,e.minDeadline)(this.deadline,c.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(a){g.trace(d.LogVerbosity.DEBUG,"resolving_call","["+this.callNumber+"] "+a)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,e.deadlineToString)(this.deadline));let a=(0,e.getRelativeTimeout)(this.deadline);if(a!==1/0){this.trace("Deadline will be reached in "+a+"ms");let b=()=>{this.cancelWithStatus(d.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};a<=0?process.nextTick(b):this.deadlineTimer=setTimeout(b,a)}}outputStatus(a){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let b=this.filterStack.receiveTrailers(a);this.trace("ended with status: code="+b.code+' details="'+b.details+'"'),this.statusWatchers.forEach(a=>a(b)),process.nextTick(()=>{var a;null==(a=this.listener)||a.onReceiveStatus(b)})}}sendMessageOnChild(a,b){if(!this.child)throw Error("sendMessageonChild called with child not populated");let c=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:b,flags:a.flags})).then(b=>{this.writeFilterPending=!1,c.sendMessageWithContext(a,b.message),this.pendingHalfClose&&c.halfClose()},a=>{this.cancelWithStatus(a.code,a.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw Error("getConfig called before start");let a=this.channel.getConfig(this.method,this.metadata);if("NONE"===a.type)return void this.channel.queueCallForConfig(this);if("ERROR"===a.type)return void(this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(a.error));let b=a.config;if(b.status!==d.Status.OK){let{code:a,details:c}=(0,h.restrictControlPlaneStatusCode)(b.status,"Failed to route call to method "+this.method);this.outputStatus({code:a,details:c,metadata:new f.Metadata});return}if(b.methodConfig.timeout){let a=new Date;a.setSeconds(a.getSeconds()+b.methodConfig.timeout.seconds),a.setMilliseconds(a.getMilliseconds()+b.methodConfig.timeout.nanos/1e6),this.deadline=(0,e.minDeadline)(this.deadline,a),this.runDeadlineTimer()}this.filterStackFactory.push(b.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(a=>{this.child=this.channel.createInnerCall(b,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(a,{onReceiveMetadata:a=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(a))},onReceiveMessage:a=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(a).then(a=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(a),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},a=>{this.cancelWithStatus(a.code,a.details)})},onReceiveStatus:a=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=a:this.outputStatus(a)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},a=>{this.outputStatus(a)})}reportResolverError(a){var b;(null==(b=this.metadata)?void 0:b.getOptions().waitForReady)?this.channel.queueCallForConfig(this):this.outputStatus(a)}cancelWithStatus(a,b){var c;this.trace("cancelWithStatus code: "+a+' details: "'+b+'"'),null==(c=this.child)||c.cancelWithStatus(a,b),this.outputStatus({code:a,details:b,metadata:new f.Metadata})}getPeer(){var a,b;return null!=(b=null==(a=this.child)?void 0:a.getPeer())?b:this.channel.getTarget()}start(a,b){this.trace("start called"),this.metadata=a.clone(),this.listener=b,this.getConfig()}sendMessageWithContext(a,b){this.trace("write() called with message of length "+b.length),this.child?this.sendMessageOnChild(a,b):this.pendingMessage={context:a,message:b}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(a){this.credentials=this.credentials.compose(a)}addStatusWatcher(a){this.statusWatchers.push(a)}getCallNumber(){return this.callNumber}}b.ResolvingCall=i},83724:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.extractAndSelectServiceConfig=b.validateServiceConfig=b.validateRetryThrottling=void 0;let d=c(21820),e=c(51387),f=c(66655),g=/^\d+(\.\d{1,9})?s$/;function h(a){if(!("maxTokens"in a)||"number"!=typeof a.maxTokens||a.maxTokens<=0||a.maxTokens>1e3)throw Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in a)||"number"!=typeof a.tokenRatio||a.tokenRatio<=0)throw Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+a.maxTokens.toFixed(3),tokenRatio:+a.tokenRatio.toFixed(3)}}function i(a){let b={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in a)if("string"==typeof a.loadBalancingPolicy)b.loadBalancingPolicy=a.loadBalancingPolicy;else throw Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in a)if(Array.isArray(a.loadBalancingConfig))for(let c of a.loadBalancingConfig)b.loadBalancingConfig.push((0,f.validateLoadBalancingConfig)(c));else throw Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in a&&Array.isArray(a.methodConfig))for(let c of a.methodConfig)b.methodConfig.push(function(a){var b;let c={name:[]};if(!("name"in a)||!Array.isArray(a.name))throw Error("Invalid method config: invalid name array");for(let b of a.name)c.name.push(function(a){if("service"in a&&""!==a.service){if("string"!=typeof a.service)throw Error(`Invalid method config name: invalid service: expected type string, got ${typeof a.service}`);if(!("method"in a)||""===a.method)return{service:a.service};if("string"!=typeof a.method)throw Error(`Invalid method config name: invalid method: expected type string, got ${typeof a.service}`);return{service:a.service,method:a.method}}if("method"in a&&void 0!==a.method)throw Error("Invalid method config name: method set with empty or unset service");return{}}(b));if("waitForReady"in a){if("boolean"!=typeof a.waitForReady)throw Error("Invalid method config: invalid waitForReady");c.waitForReady=a.waitForReady}if("timeout"in a)if("object"==typeof a.timeout){if(!("seconds"in a.timeout)||"number"!=typeof a.timeout.seconds)throw Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in a.timeout)||"number"!=typeof a.timeout.nanos)throw Error("Invalid method config: invalid timeout.nanos");c.timeout=a.timeout}else if("string"==typeof a.timeout&&g.test(a.timeout)){let d=a.timeout.substring(0,a.timeout.length-1).split(".");c.timeout={seconds:0|d[0],nanos:(null!=(b=d[1])?b:0)|0}}else throw Error("Invalid method config: invalid timeout");if("maxRequestBytes"in a){if("number"!=typeof a.maxRequestBytes)throw Error("Invalid method config: invalid maxRequestBytes");c.maxRequestBytes=a.maxRequestBytes}if("maxResponseBytes"in a){if("number"!=typeof a.maxResponseBytes)throw Error("Invalid method config: invalid maxRequestBytes");c.maxResponseBytes=a.maxResponseBytes}if("retryPolicy"in a)if("hedgingPolicy"in a)throw Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");else c.retryPolicy=function(a){if(!("maxAttempts"in a)||!Number.isInteger(a.maxAttempts)||a.maxAttempts<2)throw Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in a)||"string"!=typeof a.initialBackoff||!g.test(a.initialBackoff))throw Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in a)||"string"!=typeof a.maxBackoff||!g.test(a.maxBackoff))throw Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in a)||"number"!=typeof a.backoffMultiplier||a.backoffMultiplier<=0)throw Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in a&&Array.isArray(a.retryableStatusCodes)))throw Error("Invalid method config retry policy: retryableStatusCodes is required");if(0===a.retryableStatusCodes.length)throw Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let b of a.retryableStatusCodes)if("number"==typeof b){if(!Object.values(e.Status).includes(b))throw Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if("string"==typeof b){if(!Object.values(e.Status).includes(b.toUpperCase()))throw Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:a.maxAttempts,initialBackoff:a.initialBackoff,maxBackoff:a.maxBackoff,backoffMultiplier:a.backoffMultiplier,retryableStatusCodes:a.retryableStatusCodes}}(a.retryPolicy);else"hedgingPolicy"in a&&(c.hedgingPolicy=function(a){if(!("maxAttempts"in a)||!Number.isInteger(a.maxAttempts)||a.maxAttempts<2)throw Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in a&&("string"!=typeof a.hedgingDelay||!g.test(a.hedgingDelay)))throw Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in a&&Array.isArray(a.nonFatalStatusCodes))for(let b of a.nonFatalStatusCodes)if("number"==typeof b){if(!Object.values(e.Status).includes(b))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if("string"==typeof b){if(!Object.values(e.Status).includes(b.toUpperCase()))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let b={maxAttempts:a.maxAttempts};return a.hedgingDelay&&(b.hedgingDelay=a.hedgingDelay),a.nonFatalStatusCodes&&(b.nonFatalStatusCodes=a.nonFatalStatusCodes),b}(a.hedgingPolicy));return c}(c));"retryThrottling"in a&&(b.retryThrottling=h(a.retryThrottling));let c=[];for(let a of b.methodConfig)for(let b of a.name){for(let a of c)if(b.service===a.service&&b.method===a.method)throw Error(`Invalid service config: duplicate name ${b.service}/${b.method}`);c.push(b)}return b}b.validateRetryThrottling=h,b.validateServiceConfig=i,b.extractAndSelectServiceConfig=function(a,b){for(let e of a)if(e.length>0&&e[0].startsWith("grpc_config=")){var c=JSON.parse(e.join("").substring(12));if(!Array.isArray(c))throw Error("Invalid service config list");for(let a of c){let c=function(a){if(!("serviceConfig"in a))throw Error("Invalid service config choice: missing service config");let b={serviceConfig:i(a.serviceConfig)};if("clientLanguage"in a)if(Array.isArray(a.clientLanguage))for(let c of(b.clientLanguage=[],a.clientLanguage))if("string"==typeof c)b.clientLanguage.push(c);else throw Error("Invalid service config choice: invalid clientLanguage");else throw Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in a)if(Array.isArray(a.clientHostname))for(let c of(b.clientHostname=[],a.clientHostname))if("string"==typeof c)b.clientHostname.push(c);else throw Error("Invalid service config choice: invalid clientHostname");else throw Error("Invalid service config choice: invalid clientHostname");if("percentage"in a)if("number"==typeof a.percentage&&0<=a.percentage&&a.percentage<=100)b.percentage=a.percentage;else throw Error("Invalid service config choice: invalid percentage");let c=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let b in a)if(!c.includes(b))throw Error(`Invalid service config choice: unexpected field ${b}`);return b}(a);if("number"!=typeof c.percentage||!(b>c.percentage)){if(Array.isArray(c.clientHostname)){let a=!1;for(let b of c.clientHostname)b===d.hostname()&&(a=!0);if(!a)continue}if(Array.isArray(c.clientLanguage)){let a=!1;for(let b of c.clientLanguage)"node"===b&&(a=!0);if(!a)continue}return c.serviceConfig}}throw Error("No matching service config found")}return null}},86429:(a,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.BaseSubchannelWrapper=void 0;class c{constructor(a){this.child=a}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(a){this.child.addConnectivityStateListener(a)}removeConnectivityStateListener(a){this.child.removeConnectivityStateListener(a)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(a){this.child.throttleKeepalive(a)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(a){return this.getRealSubchannel()===a.getRealSubchannel()}}b.BaseSubchannelWrapper=c},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},87066:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.setup=b.PickFirstLoadBalancer=b.shuffled=b.PickFirstLoadBalancingConfig=void 0;let d=c(66655),e=c(59173),f=c(7702),g=c(74271),h=c(51387);function i(a){g.trace(h.LogVerbosity.DEBUG,"pick_first",a)}let j="pick_first";class k{constructor(a){this.shuffleAddressList=a}getLoadBalancerName(){return j}toJsonObject(){return{[j]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(a){if("shuffleAddressList"in a&&"boolean"!=typeof a.shuffleAddressList)throw Error("pick_first config field shuffleAddressList must be a boolean if provided");return new k(!0===a.shuffleAddressList)}}b.PickFirstLoadBalancingConfig=k;class l{constructor(a){this.subchannel=a}pick(a){return{pickResultType:f.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}}function m(a){let b=a.slice();for(let a=b.length-1;a>1;a--){let c=Math.floor(Math.random()*(a+1)),d=b[a];b[a]=b[c],b[c]=d}return b}b.shuffled=m;class n{constructor(a){this.channelControlHelper=a,this.children=[],this.currentState=e.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(a,b,c,d,e)=>{this.onSubchannelStateUpdate(a,b,c,e)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(a=>a.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(e.ConnectivityState.READY,new l(this.currentPick)):0===this.children.length?this.updateState(e.ConnectivityState.IDLE,new f.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(e.ConnectivityState.TRANSIENT_FAILURE,new f.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(e.ConnectivityState.CONNECTING,new f.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){for(let{subchannel:a}of(this.stickyTransientFailureMode=!0,this.children))a.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(null!==this.currentPick){let a=this.currentPick;this.currentPick=null,a.unref(),a.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(a.getChannelzRef())}}onSubchannelStateUpdate(a,b,c,d){var f;if(null==(f=this.currentPick)?void 0:f.realSubchannelEquals(a)){c!==e.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[b,f]of this.children.entries())if(a.realSubchannelEquals(f.subchannel)){c===e.ConnectivityState.READY&&this.pickSubchannel(f.subchannel),c===e.ConnectivityState.TRANSIENT_FAILURE&&(f.hasReportedTransientFailure=!0,d&&(this.lastError=d),this.maybeEnterStickyTransientFailureMode(),b===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(b+1)),f.subchannel.startConnecting();return}}startNextSubchannelConnecting(a){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[b,c]of this.children.entries())if(b>=a){let a=c.subchannel.getConnectivityState();if(a===e.ConnectivityState.IDLE||a===e.ConnectivityState.CONNECTING)return void this.startConnecting(b)}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(a){var b,c;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=a,this.children[a].subchannel.getConnectivityState()===e.ConnectivityState.IDLE&&(i("Start connecting to subchannel with address "+this.children[a].subchannel.getAddress()),process.nextTick(()=>{var b;null==(b=this.children[a])||b.subchannel.startConnecting()})),this.connectionDelayTimeout=null==(c=(b=setTimeout(()=>{this.startNextSubchannelConnecting(a+1)},250)).unref)?void 0:c.call(b)}pickSubchannel(a){this.currentPick&&a.realSubchannelEquals(this.currentPick)||(i("Pick subchannel with address "+a.getAddress()),this.stickyTransientFailureMode=!1,null!==this.currentPick&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=a,a.ref(),this.channelControlHelper.addChannelzChild(a.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(a,b){i(e.ConnectivityState[this.currentState]+" -> "+e.ConnectivityState[a]),this.currentState=a,this.channelControlHelper.updateState(a,b)}resetSubchannelList(){for(let a of this.children)this.currentPick&&a.subchannel.realSubchannelEquals(this.currentPick)||a.subchannel.removeConnectivityStateListener(this.subchannelStateListener),a.subchannel.unref(),this.channelControlHelper.removeChannelzChild(a.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(a){let b=a.map(a=>({subchannel:this.channelControlHelper.createSubchannel(a,{}),hasReportedTransientFailure:!1}));for(let{subchannel:a}of b)a.ref(),this.channelControlHelper.addChannelzChild(a.getChannelzRef());for(let{subchannel:a}of(this.resetSubchannelList(),this.children=b,this.children))if(a.addConnectivityStateListener(this.subchannelStateListener),a.getConnectivityState()===e.ConnectivityState.READY)return void this.pickSubchannel(a);for(let a of this.children)a.subchannel.getConnectivityState()===e.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(a,b){b instanceof k&&(b.getShuffleAddressList()&&(a=m(a)),this.latestAddressList=a,this.connectToAddressList(a))}exitIdle(){this.currentState===e.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return j}}b.PickFirstLoadBalancer=n,b.setup=function(){(0,d.registerLoadBalancerType)(j,n,k),(0,d.registerDefaultLoadBalancerType)(j)}},88251:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.Subchannel=void 0;let d=c(59173),e=c(29462),f=c(74271),g=c(51387),h=c(71790),i=c(55392),j=c(41669);class k{constructor(a,b,c,f,g){var h;this.channelTarget=a,this.subchannelAddress=b,this.options=c,this.credentials=f,this.connector=g,this.connectivityState=d.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new j.ChannelzCallTracker,this.childrenTracker=new j.ChannelzChildrenTracker,this.streamTracker=new j.ChannelzCallTracker;let k={initialDelay:c["grpc.initial_reconnect_backoff_ms"],maxDelay:c["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new e.BackoffTimeout(()=>{this.handleBackoffTimer()},k),this.backoffTimeout.unref(),this.subchannelAddressString=(0,i.subchannelAddressToString)(b),this.keepaliveTime=null!=(h=c["grpc.keepalive_time_ms"])?h:-1,0===c["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new j.ChannelzTrace,this.channelzRef=(0,j.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(c,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(a){f.trace(g.LogVerbosity.DEBUG,"subchannel","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}refTrace(a){f.trace(g.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([d.ConnectivityState.TRANSIENT_FAILURE],d.ConnectivityState.CONNECTING):this.transitionToState([d.ConnectivityState.TRANSIENT_FAILURE],d.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let a=this.options;if(a["grpc.keepalive_time_ms"]){let b=Math.min(this.keepaliveTime,0x7fffffff);a=Object.assign(Object.assign({},a),{"grpc.keepalive_time_ms":b})}this.connector.connect(this.subchannelAddress,this.credentials,a).then(a=>{this.transitionToState([d.ConnectivityState.CONNECTING],d.ConnectivityState.READY)?(this.transport=a,this.channelzEnabled&&this.childrenTracker.refChild(a.getChannelzRef()),a.addDisconnectListener(a=>{this.transitionToState([d.ConnectivityState.READY],d.ConnectivityState.IDLE),a&&this.keepaliveTime>0&&(this.keepaliveTime*=2,f.log(g.LogVerbosity.ERROR,`Connection to ${(0,h.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):a.shutdown()},a=>{this.transitionToState([d.ConnectivityState.CONNECTING],d.ConnectivityState.TRANSIENT_FAILURE,`${a}`)})}transitionToState(a,b,c){var e,f;if(-1===a.indexOf(this.connectivityState))return!1;this.trace(d.ConnectivityState[this.connectivityState]+" -> "+d.ConnectivityState[b]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+d.ConnectivityState[b]);let g=this.connectivityState;switch(this.connectivityState=b,b){case d.ConnectivityState.READY:this.stopBackoff();break;case d.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case d.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null==(e=this.transport)||e.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case d.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null==(f=this.transport)||f.shutdown(),this.transport=null;break;default:throw Error(`Invalid state: unknown ConnectivityState ${b}`)}for(let a of this.stateListeners)a(this,g,b,this.keepaliveTime,c);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,0===this.refcount&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,j.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([d.ConnectivityState.CONNECTING,d.ConnectivityState.READY],d.ConnectivityState.IDLE)}))}unrefIfOneRef(){return 1===this.refcount&&(this.unref(),!0)}createCall(a,b,c,d){let e;if(!this.transport)throw Error("Cannot create call, subchannel not READY");return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),e={onCallEnd:a=>{a.code===g.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):e={},this.transport.createCall(a,b,c,d,e)}startConnecting(){process.nextTick(()=>{this.transitionToState([d.ConnectivityState.IDLE],d.ConnectivityState.CONNECTING)||this.connectivityState!==d.ConnectivityState.TRANSIENT_FAILURE||(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(a){this.stateListeners.add(a)}removeConnectivityStateListener(a){this.stateListeners.delete(a)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([d.ConnectivityState.TRANSIENT_FAILURE],d.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(a){return a.getRealSubchannel()===this}throttleKeepalive(a){a>this.keepaliveTime&&(this.keepaliveTime=a)}}b.Subchannel=k},91419:(a,b,c)=>{Promise.resolve().then(c.bind(c,13187))},91645:a=>{"use strict";a.exports=require("net")},94735:a=>{"use strict";a.exports=require("events")},95378:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{DI:()=>m,EP:()=>q,EZ:()=>o,KB:()=>t,Lf:()=>n,d5:()=>p,zO:()=>r,zZ:()=>s});var e=c(91488);c(27806);var f=c(80446),g=c(91837),h=c(62641),i=c(58749),j=c(29631),k=c(40410),l=a([f,h,i,j]);async function m(a){let{clients:b}=await n({...a,all:!0});return b.map(a=>({value:a.id,label:`${a.name} ${a.code?`(${a.code})`:""}`,relationType:a.relationType,paymentType:a.paymentType}))}async function n(a={}){let{all:b=!1,limit:c=15,page:d=1,searchTerm:e,relationType:g,paymentType:h,status:i,country:j,province:k,sortBy:l="useCount_desc"}=a,m=await (0,f.Lf)();if(!m)return{clients:[],total:0};try{let f,n=m.collection("clients");g&&"all"!==g&&(n=n.where("relationType","in","client"===g?["client","both"]:"supplier"===g?["supplier","both"]:[g])),h&&"all"!==h&&(n=n.where("paymentType","==",h)),i&&"all"!==i&&(n=n.where("status","==",i)),!0===a.includeInactive||i||(n=n.where("status","==","active")),j&&"all"!==j&&(n=n.where("country","==",j)),k&&"all"!==k&&(n=n.where("province","==",k));let o=(await n.get()).docs;if(e){let a=e.toLowerCase();o=o.filter(b=>{let c=b.data();return c.name&&c.name.toLowerCase().includes(a)||c.phone&&String(c.phone).includes(a)||c.code&&c.code.toLowerCase().includes(a)})}let p=o.length;if(l){let[a,b]=l.split("_");o.sort((c,d)=>{let e=c.data(),f=d.data(),g=e[a],h=f[a];if(null==g)return 1;if(null==h)return -1;let i=0;return"string"==typeof g&&"string"==typeof h?i=g.localeCompare(h):g>h?i=1:g<h&&(i=-1),"desc"===b?-1*i:i})}if(b)f=o;else{let a=(d-1)*c;f=o.slice(a,a+c)}if(0===f.length)return{clients:[],total:0};return{clients:f.map(a=>{let b=a.data();return{...JSON.parse(JSON.stringify(b,(a,b)=>b&&"object"==typeof b&&b.hasOwnProperty("seconds")&&b.hasOwnProperty("nanoseconds")?new Date(1e3*b.seconds).toISOString():b)),id:a.id}}),total:p}}catch(a){return console.error("Error getting clients from Firestore: ",String(a)),{clients:[],total:0}}}async function o(a){let b=await (0,f.Lf)();if(!b)return null;try{let c=await b.collection("clients").doc(a).get();if(!c.exists)return null;let d=c.data(),e=JSON.parse(JSON.stringify(d,(a,b)=>b&&"object"==typeof b&&b.hasOwnProperty("seconds")&&b.hasOwnProperty("nanoseconds")?new Date(1e3*b.seconds).toISOString():b));return{id:c.id,...e}}catch(b){return console.error(`Error getting client by ID ${a}:`,String(b)),null}}async function p(a){let b=await (0,f.Lf)();if(!b)return{success:!1,error:"Database not available."};let c=await (0,h.$T)();if(!c)return{success:!1,error:"Unauthorized"};try{let d=c.name,e=await (0,j.tu)("CL"),f={...a,code:e,createdAt:new Date().toISOString(),createdBy:d,balance:{USD:0,IQD:0},lastTransaction:null,useCount:0};f.password&&f.password.length>=6||delete f.password;let h=await b.collection("clients").add(f);await (0,i.iL)({userId:c.uid,userName:c.name,action:"CREATE",targetType:"CLIENT",description:`أنشأ علاقة جديدة باسم: ${f.name} (ID: ${h.id})`}),(0,g.revalidatePath)("/clients"),(0,g.revalidatePath)("/suppliers"),(0,g.revalidatePath)("/reports/debts");let k={...f,id:h.id};return{success:!0,client:k}}catch(a){return console.error("Error adding client:",a),{success:!1,error:a.message}}}async function q(a){let b=await (0,f.Lf)();if(!b)return{success:!1,count:0,error:"Database not available."};let c=await (0,h.$T)();if(!c)return{success:!1,count:0,error:"Unauthorized"};try{for(let d of a){let a=b.batch(),e=b.collection("clients").doc(),f=await (0,j.tu)("CL"),g={...d,code:f,createdAt:new Date().toISOString(),createdBy:`مستورد بواسطة ${c.name}`,type:d.type||"individual",relationType:d.relationType||"client",status:d.status||"active",balance:{USD:0,IQD:0},lastTransaction:null,useCount:0,avatarUrl:""};g.password||delete g.password,a.set(e,g),await a.commit()}return await (0,i.iL)({userId:c.uid,userName:c.name,action:"CREATE",targetType:"CLIENT",description:`استورد ${a.length} علاقات جديدة من ملف.`}),(0,g.revalidatePath)("/clients"),(0,g.revalidatePath)("/suppliers"),(0,g.revalidatePath)("/relations/settings"),(0,g.revalidatePath)("/reports/debts"),{success:!0,count:a.length}}catch(a){return console.error("Error adding multiple clients: ",String(a)),{success:!1,count:0,error:"Failed to add clients."}}}async function r(a,b){let c=await (0,f.Lf)();if(!c)return{success:!1,error:"Database not available."};let d=await (0,h.$T)();if(!d)return{success:!1,error:"Unauthorized"};try{let e=JSON.parse(JSON.stringify(b));(""===b.password||void 0===b.password||null===b.password)&&delete e.password,await c.collection("clients").doc(a).update(e),await (0,i.iL)({userId:d.uid,userName:d.name,action:"UPDATE",targetType:"CLIENT",description:`عدل بيانات العلاقة (ID: ${a})`});let f=await c.collection("clients").doc(a).get(),h=JSON.parse(JSON.stringify(f.data(),(a,b)=>b&&"object"==typeof b&&b.hasOwnProperty("seconds")&&b.hasOwnProperty("nanoseconds")?new Date(1e3*b.seconds).toISOString():b)),j={id:f.id,...h};return(0,g.revalidatePath)("/clients"),(0,g.revalidatePath)("/suppliers"),(0,g.revalidatePath)("/reports/debts"),{success:!0,updatedClient:j}}catch(a){return console.error("Error updating client:",a),{success:!1,error:a.message}}}async function s(a){let b=await (0,f.Lf)();if(!b)return{success:!1,error:"Database not available."};let c=await (0,h.$T)();if(!c)return{success:!1,error:"Unauthorized"};try{let d=(await b.collection("clients").doc(a).get()).data();if(d?.useCount&&d.useCount>0)return{success:!1,error:"لا يمكن حذف هذه العلاقة لوجود معاملات مالية مرتبطة بها."};let e=d?.name||"unknown";return await b.collection("clients").doc(a).delete(),await (0,i.iL)({userId:c.uid,userName:c.name,action:"DELETE",targetType:"CLIENT",description:`حذف العلاقة: ${e} (ID: ${a})`}),(0,g.revalidatePath)("/clients"),(0,g.revalidatePath)("/suppliers"),(0,g.revalidatePath)("/reports/debts"),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function t(a){let b=await (0,f.Lf)();if(!b)return{success:!1,error:"Database not available."};let c=await (0,h.$T)();if(!c)return{success:!1,error:"Unauthorized"};try{let d=b.batch();return a.forEach(a=>{let c=b.collection("clients").doc(a);d.delete(c)}),await d.commit(),await (0,i.iL)({userId:c.uid,userName:c.name,action:"DELETE",targetType:"CLIENT",description:`حذف ${a.length} علاقات بشكل جماعي.`}),(0,g.revalidatePath)("/clients"),(0,g.revalidatePath)("/suppliers"),(0,g.revalidatePath)("/reports/debts"),{success:!0}}catch(a){return{success:!1,error:a.message}}}[f,h,i,j]=l.then?(await l)():l,(0,k.D)([m,n,o,p,q,r,s,t]),(0,e.A)(m,"405872236907704344162aca1c38160d1eac727fe8",null),(0,e.A)(n,"400e621b7f78c4800cffc85d668ca10cd73eb6853c",null),(0,e.A)(o,"408c94c431661ae65070856bc4a78d84f2cbfcba1c",null),(0,e.A)(p,"403331dfc341d9a7f9cbe156b5d10cfd49a20be531",null),(0,e.A)(q,"408c54ad33973364b68d8475849f76b4a4ca590722",null),(0,e.A)(r,"6023146a7bfefc423ba02712c56694a31432de707c",null),(0,e.A)(s,"4085652545b10cc37283ef55992935bd43a8ce947e",null),(0,e.A)(t,"40f4619201eea9704cbf15357e730e9458fc66e834",null),d()}catch(a){d(a)}})},97697:a=>{"use strict";a.exports={rE:"1.9.15"}},98697:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.InternalChannel=void 0;let d=c(34284),e=c(44609),f=c(32426),g=c(7702),h=c(51387),i=c(73481),j=c(25049),k=c(61774),l=c(74271),m=c(4933),n=c(71790),o=c(59173),p=c(41669),q=c(43975),r=c(50108),s=c(83486),t=c(44906),u=c(11905),v=c(82307),w=c(86429),x=new Map;class y extends w.BaseSubchannelWrapper{constructor(a,b){super(a),this.channel=b,this.refCount=0,this.subchannelStateListener=(a,c,d,e)=>{b.throttleKeepalive(e)},a.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}}class z{constructor(a,b,c){var q,r,s,t,w,z,A,B;if(this.credentials=b,this.options=c,this.connectivityState=o.ConnectivityState.IDLE,this.currentPicker=new g.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new p.ChannelzCallTracker,this.childrenTracker=new p.ChannelzChildrenTracker,"string"!=typeof a)throw TypeError("Channel target must be a string");if(!(b instanceof d.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(c&&"object"!=typeof c)throw TypeError("Channel options must be an object");this.originalTarget=a;let C=(0,n.parseUri)(a);if(null===C)throw Error(`Could not parse target name "${a}"`);let D=(0,k.mapUriDefaultScheme)(C);if(null===D)throw Error(`Could not find a default scheme for target name "${a}"`);this.callRefTimer=setInterval(()=>{},0x7fffffff),null==(r=(q=this.callRefTimer).unref)||r.call(q),0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new p.ChannelzTrace,this.channelzRef=(0,p.registerChannelzChannel)(a,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,k.getDefaultAuthority)(D);let E=(0,m.mapProxyName)(D,c);this.target=E.target,this.options=Object.assign({},this.options,E.extraOptions),this.subchannelPool=(0,f.getSubchannelPool)((null!=(s=c["grpc.use_local_subchannel_pool"])?s:0)===0),this.retryBufferTracker=new v.MessageBufferTracker(null!=(t=c["grpc.retry_buffer_size"])?t:0x1000000,null!=(w=c["grpc.per_rpc_retry_buffer_size"])?w:1048576),this.keepaliveTime=null!=(z=c["grpc.keepalive_time_ms"])?z:-1,this.idleTimeoutMs=Math.max(null!=(A=c["grpc.client_idle_timeout_ms"])?A:18e5,1e3),this.resolvingLoadBalancer=new e.ResolvingLoadBalancer(this.target,{createSubchannel:(a,b)=>{let c=this.subchannelPool.getOrCreateSubchannel(this.target,a,Object.assign({},this.options,b),this.credentials);c.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",c.getChannelzRef());let d=new y(c,this);return this.wrappedSubchannels.add(d),d},updateState:(a,b)=>{this.currentPicker=b;let c=this.pickQueue.slice();for(let a of(this.pickQueue=[],c.length>0&&this.callRefTimerUnref(),c))a.doPick();this.updateState(a)},requestReresolution:()=>{throw Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:a=>{this.channelzEnabled&&this.childrenTracker.refChild(a)},removeChannelzChild:a=>{this.channelzEnabled&&this.childrenTracker.unrefChild(a)}},c,(a,b)=>{a.retryThrottling?x.set(this.getTarget(),new v.RetryThrottler(a.retryThrottling.maxTokens,a.retryThrottling.tokenRatio,x.get(this.getTarget()))):x.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=b,this.currentResolutionError=null,process.nextTick(()=>{let a=this.configSelectionQueue;for(let b of(this.configSelectionQueue=[],a.length>0&&this.callRefTimerUnref(),a))b.getConfig()})},a=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+a.code+' and details "'+a.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),null===this.configSelector&&(this.currentResolutionError=Object.assign(Object.assign({},(0,u.restrictControlPlaneStatusCode)(a.code,a.details)),{metadata:a.metadata}));let b=this.configSelectionQueue;for(let c of(this.configSelectionQueue=[],b.length>0&&this.callRefTimerUnref(),b))c.reportResolverError(a)}),this.filterStackFactory=new i.FilterStackFactory([new j.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(c,void 0,2));let F=Error();(0,l.trace)(h.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+") Channel constructed \n"+(null==(B=F.stack)?void 0:B.substring(F.stack.indexOf("\n")+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(a,b){(0,l.trace)(null!=b?b:h.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,n.uriToString)(this.target)+" "+a)}callRefTimerRef(){var a,b,c,d;(null==(b=(a=this.callRefTimer).hasRef)?void 0:b.call(a))||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null==(d=(c=this.callRefTimer).ref)||d.call(c))}callRefTimerUnref(){var a,b;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null==(b=(a=this.callRefTimer).unref)||b.call(a))}removeConnectivityStateWatcher(a){let b=this.connectivityStateWatchers.findIndex(b=>b===a);b>=0&&this.connectivityStateWatchers.splice(b,1)}updateState(a){for(let b of((0,l.trace)(h.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,n.uriToString)(this.target)+" "+o.ConnectivityState[this.connectivityState]+" -> "+o.ConnectivityState[a]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+o.ConnectivityState[a]),this.connectivityState=a,this.connectivityStateWatchers.slice()))a!==b.currentState&&(b.timer&&clearTimeout(b.timer),this.removeConnectivityStateWatcher(b),b.callback());a!==o.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(a){if(a>this.keepaliveTime)for(let b of(this.keepaliveTime=a,this.wrappedSubchannels))b.throttleKeepalive(a)}removeWrappedSubchannel(a){this.wrappedSubchannels.delete(a)}doPick(a,b){return this.currentPicker.pick({metadata:a,extraPickInfo:b})}queueCallForPick(a){this.pickQueue.push(a),this.callRefTimerRef()}getConfig(a,b){return(this.resolvingLoadBalancer.exitIdle(),this.configSelector)?{type:"SUCCESS",config:this.configSelector(a,b)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(a){this.configSelectionQueue.push(a),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(o.ConnectivityState.IDLE),this.currentPicker=new g.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(a){var b,c;this.idleTimer=setTimeout(()=>{if(this.callCount>0)return void this.startIdleTimeout(this.idleTimeoutMs);let a=new Date().valueOf()-this.lastActivityTimestamp.valueOf();a>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-a)},a),null==(c=(b=this.idleTimer).unref)||c.call(b)}maybeStartIdleTimer(){this.connectivityState===o.ConnectivityState.SHUTDOWN||this.idleTimer||this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(a){this.channelzEnabled&&(a.code===h.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(a,b,c,d,e){let f=(0,t.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+f+'] method="'+b+'"'),new q.LoadBalancingCall(this,a,b,c,d,e,f)}createRetryingCall(a,b,c,d,e){let f=(0,t.getNextCallNumber)();return this.trace("createRetryingCall ["+f+'] method="'+b+'"'),new v.RetryingCall(this,a,b,c,d,e,f,this.retryBufferTracker,x.get(this.getTarget()))}createInnerCall(a,b,c,d,e){return 0===this.options["grpc.enable_retries"]?this.createLoadBalancingCall(a,b,c,d,e):this.createRetryingCall(a,b,c,d,e)}createResolvingCall(a,b,c,d,e){let f=(0,t.getNextCallNumber)();this.trace("createResolvingCall ["+f+'] method="'+a+'", deadline='+(0,r.deadlineToString)(b));let g={deadline:b,flags:null!=e?e:h.Propagate.DEFAULTS,host:null!=c?c:this.defaultAuthority,parentCall:d},i=new s.ResolvingCall(this,a,g,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),f);return this.onCallStart(),i.addStatusWatcher(a=>{this.onCallEnd(a)}),i}close(){this.resolvingLoadBalancer.destroy(),this.updateState(o.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,p.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,n.uriToString)(this.target)}getConnectivityState(a){let b=this.connectivityState;return a&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),b}watchConnectivityState(a,b,c){if(this.connectivityState===o.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");let d=null;if(b!==1/0){let a=b instanceof Date?b:new Date(b),f=new Date;if(b===-1/0||a<=f)return void process.nextTick(c,Error("Deadline passed without connectivity state change"));d=setTimeout(()=>{this.removeConnectivityStateWatcher(e),c(Error("Deadline passed without connectivity state change"))},a.getTime()-f.getTime())}let e={currentState:a,callback:c,timer:d};this.connectivityStateWatchers.push(e)}getChannelzRef(){return this.channelzRef}createCall(a,b,c,d,e){if("string"!=typeof a)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof b||b instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===o.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");return this.createResolvingCall(a,b,c,d,e)}}b.InternalChannel=z},99245:(a,b)=>{"use strict";var c;Object.defineProperty(b,"__esModule",{value:!0}),b.CompressionAlgorithms=void 0,function(a){a[a.identity=0]="identity",a[a.deflate=1]="deflate",a[a.gzip=2]="gzip"}(c||(b.CompressionAlgorithms=c={}))}};var b=require("../../webpack-runtime.js");b.C(a);var c=b.X(0,[4586,8298,3103,9664,9667,4154,4799],()=>b(b.s=22509));module.exports=c})();