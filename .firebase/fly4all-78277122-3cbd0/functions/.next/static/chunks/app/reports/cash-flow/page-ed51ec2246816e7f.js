(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4755],{9010:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>w});var r=n(95155),a=n(12115),i=n(86948),l=n(52081),c=n(94374),s=n(82863),o=n(14585),d=n(19708),u=n(14223),p=n(26991),f=n(80019),m=n(47734),y=n(73697),h=n(23508),x=n(47643),b=n(78765),v=n(12235),I=n(69386),g=n(48182),j=n(15377);function w(){let[e,t]=(0,a.useState)([]),[n,w]=(0,a.useState)({inflow:0,outflow:0,net:0});return(0,a.useEffect)(()=>{!async function(){var e;let[n,r]=await Promise.all([(0,d.x7)((0,d.H9)(o.db,"settings","app_settings")),(0,d.GG)((0,d.rJ)(o.db,"journal-vouchers"))]),a=(0,g.uJ)(null==(e=n.data())?void 0:e.financeAccounts),i={},l=0,c=0;r.forEach(e=>{let t=e.data(),n=(0,j.yZ)(t,a),r=(0,u.GP)((e=>{if(!e)return new Date;if("string"==typeof e){let t=new Date(e);return Number.isNaN(t.getTime())?new Date:t}if(e instanceof Date)return e;if("function"==typeof e.toDate){let t=e.toDate();return t instanceof Date?t:new Date}return"number"==typeof e.seconds?new Date(1e3*e.seconds):new Date})(t.date),"MMM yyyy");i[r]||(i[r]={inflow:0,outflow:0}),n.forEach(e=>{("cash"===e.accountType||"bank"===e.accountType)&&(e.debit&&(l+=e.debit,i[r].inflow+=e.debit),e.credit&&(c+=e.credit,i[r].outflow+=e.credit))})}),t(Object.entries(i).map(e=>{let[t,n]=e;return{month:t,inflow:n.inflow,outflow:n.outflow,net:n.inflow-n.outflow}})),w({inflow:l,outflow:c,net:l-c})}()},[]),(0,r.jsxs)("div",{className:"p-6 space-y-6",children:[(0,r.jsxs)("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[(0,r.jsx)(l.A,{className:"text-primary"})," تقرير التدفق النقدي"]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsx)(A,{title:"التدفقات الداخلة",value:n.inflow,icon:c.A,color:"text-green-600"}),(0,r.jsx)(A,{title:"التدفقات الخارجة",value:n.outflow,icon:s.A,color:"text-red-600"}),(0,r.jsx)(A,{title:"صافي التدفق",value:n.net,icon:l.A,color:n.net>=0?"text-blue-600":"text-red-500"})]}),(0,r.jsxs)(i.Zp,{children:[(0,r.jsx)(i.aR,{children:(0,r.jsx)(i.ZB,{children:"التدفق الشهري"})}),(0,r.jsx)(i.Wu,{children:(0,r.jsx)(p.u,{width:"100%",height:300,children:(0,r.jsxs)(f.b,{data:e,children:[(0,r.jsx)(m.W,{dataKey:"month"}),(0,r.jsx)(y.h,{}),(0,r.jsx)(h.m,{}),(0,r.jsx)(x.N,{type:"monotone",dataKey:"inflow",stroke:"#16a34a",strokeWidth:2,name:"التدفقات الداخلة"}),(0,r.jsx)(x.N,{type:"monotone",dataKey:"outflow",stroke:"#dc2626",strokeWidth:2,name:"التدفقات الخارجة"}),(0,r.jsx)(x.N,{type:"monotone",dataKey:"net",stroke:"#2563eb",strokeWidth:2,name:"صافي التدفق"})]})})})]}),(0,r.jsxs)(i.Zp,{children:[(0,r.jsx)(i.aR,{children:(0,r.jsx)(i.ZB,{children:"تحليل التدفقات حسب النوع"})}),(0,r.jsx)(i.Wu,{className:"flex justify-center",children:(0,r.jsx)(p.u,{width:"80%",height:300,children:(0,r.jsxs)(b.r,{children:[(0,r.jsx)(v.F,{data:[{name:"الداخلة",value:n.inflow},{name:"الخارجة",value:n.outflow}],cx:"50%",cy:"50%",label:!0,outerRadius:120,dataKey:"value",children:["#16a34a","#dc2626"].map((e,t)=>(0,r.jsx)(I.f,{fill:e},"cell-".concat(t)))}),(0,r.jsx)(h.m,{})]})})})]})]})}function A(e){let{title:t,value:n,icon:a,color:l}=e;return(0,r.jsxs)(i.Zp,{className:"shadow-md border",children:[(0,r.jsxs)(i.aR,{className:"flex flex-row items-center justify-between pb-2",children:[(0,r.jsx)(i.ZB,{className:"text-sm font-medium",children:t}),(0,r.jsx)(a,{className:"h-5 w-5 ".concat(l)})]}),(0,r.jsx)(i.Wu,{children:(0,r.jsxs)("div",{className:"text-2xl font-bold text-right",children:[n.toLocaleString()," $"]})})]})}},14585:(e,t,n)=>{"use strict";let r,a,i;n.d(t,{db:()=>i,j:()=>a,y:()=>r});var l=n(52078),c=n(19708),s=n(81328);r=(0,l.Dk)().length?(0,l.Dk)()[0]:(0,l.Wp)({apiKey:"AIzaSyCtlF3onBhtwg0Hh3iOOEjygi9mj81wxrA",authDomain:"fly4all-78277122-3cbd0.firebaseapp.com",projectId:"fly4all-78277122-3cbd0",storageBucket:"fly4all-78277122-3cbd0.firebasestorage.app",messagingSenderId:"108505683067",appId:"1:108505683067:web:3ab7755349630154e77ede"}),a=(0,s.xI)(r),i=(0,c.aU)(r)},15377:(e,t,n)=>{"use strict";n.d(t,{yZ:()=>c});let r=(e,t)=>{if(!e||!t)return!1;let n=e.trim(),r=t.trim();return!!n&&!!r&&(n===r||n.startsWith("".concat(r,"-"))||n.startsWith("".concat(r,"."))||n.startsWith("".concat(r,"/"))||n.startsWith(r))},a=(e,t)=>{for(let n of t)if(r(e,n))return!0;return!1};function i(e,t){if(!e||!t)return"other";let{defaultCashId:n,defaultBankId:i,receivableAccountId:l,arAccountId:c,payableAccountId:s,apAccountId:o,hybridRelationAccountId:d,clearingAccountId:u,revenueMap:p,expenseMap:f,generalRevenueId:m,generalExpenseId:y}=t;return r(e,n)?"cash":r(e,i)?"bank":r(e,d)?"hybrid":r(e,l)||r(e,c)?"client":r(e,s)||r(e,o)?"supplier":r(e,u)?"clearing":a(e,[m,...Object.values(p||{})])?"revenue":a(e,[y,...Object.values(f||{})])?"expense":"other"}let l=e=>{if("number"==typeof e&&!Number.isNaN(e))return e;if("string"==typeof e&&""!==e.trim()){let t=Number(e);return Number.isFinite(t)?t:0}return 0};function c(e,t){var n,r;if(Array.isArray(e.entries)&&e.entries.length>0)return e.entries.map(e=>{var n,r,a;let c=l(null!=(n=e.debit)?n:"debit"===e.type?e.amount:0),s=l(null!=(r=e.credit)?r:"credit"===e.type?e.amount:0),o=e.accountType||i(e.accountId,t);return{accountId:e.accountId,debit:c,credit:s,amount:c>0?c:s,description:null!=(a=e.description)?a:e.note,currency:e.currency,relationId:e.relationId,companyId:e.companyId,accountType:o,type:c>0?"debit":"credit"}});let a=[];if(Array.isArray(e.debitEntries))for(let r of e.debitEntries){let e=l(null!=(n=r.amount)?n:r.debit);a.push({accountId:r.accountId,debit:e,credit:0,amount:e,description:r.description,currency:r.currency,relationId:r.relationId,companyId:r.companyId,accountType:i(r.accountId,t),type:"debit"})}if(Array.isArray(e.creditEntries))for(let n of e.creditEntries){let e=l(null!=(r=n.amount)?r:n.credit);a.push({accountId:n.accountId,debit:0,credit:e,amount:e,description:n.description,currency:n.currency,relationId:n.relationId,companyId:n.companyId,accountType:i(n.accountId,t),type:"credit"})}return a}},41956:(e,t,n)=>{Promise.resolve().then(n.bind(n,9010))},48182:(e,t,n)=>{"use strict";n.d(t,{rN:()=>o,uJ:()=>s});let r=e=>(null!=e?e:"").trim(),a=(e,t)=>Array.from(new Set([...t,...Object.keys(e||{})])).reduce((t,n)=>(t[n]=r(null==e?void 0:e[n]),t),{}),i=e=>Object.values(e).find(e=>e.length>0)||"",l=["tickets","visas","subscriptions","segments","profit_distribution","other"],c=["tickets","visas","subscriptions","partners","operating","cost_tickets","cost_visas","operating_salaries","operating_rent","operating_utilities","marketing"];function s(e){let t={...(null==e?void 0:e.revenueMap)||{},...(null==e?void 0:e.customRevenues)||{}},n={...(null==e?void 0:e.expenseMap)||{},...(null==e?void 0:e.customExpenses)||{}},s=a(t,l),o=a(n,c),d=r((null==e?void 0:e.receivableAccountId)||(null==e?void 0:e.arAccountId)),u=r((null==e?void 0:e.payableAccountId)||(null==e?void 0:e.apAccountId)),p=r(null==e?void 0:e.generalRevenueId)||i(s),f=r(null==e?void 0:e.generalExpenseId)||i(o);return{receivableAccountId:d,payableAccountId:u,hybridRelationAccountId:r(null==e?void 0:e.hybridRelationAccountId),clearingAccountId:r(null==e?void 0:e.clearingAccountId),defaultCashId:r(null==e?void 0:e.defaultCashId),defaultBankId:r(null==e?void 0:e.defaultBankId),arAccountId:d,apAccountId:u,generalRevenueId:p,generalExpenseId:f,preventDirectCashRevenue:!!(null==e?void 0:e.preventDirectCashRevenue),revenueMap:s,expenseMap:o}}function o(e){let t=a(e.revenueMap||{},l),n=a(e.expenseMap||{},c),s=r(e.receivableAccountId),o=r(e.payableAccountId),d=r(e.generalRevenueId)||i(t),u=r(e.generalExpenseId)||i(n);return{receivableAccountId:s,payableAccountId:o,hybridRelationAccountId:r(e.hybridRelationAccountId),clearingAccountId:r(e.clearingAccountId),defaultCashId:r(e.defaultCashId),defaultBankId:r(e.defaultBankId),preventDirectCashRevenue:!!e.preventDirectCashRevenue,generalRevenueId:d,generalExpenseId:u,arAccountId:s,apAccountId:o,revenueMap:t,customRevenues:t,expenseMap:n,customExpenses:n}}},64269:(e,t,n)=>{"use strict";n.d(t,{cn:()=>i,pY:()=>l});var r=n(2821),a=n(75889);function i(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,a.QP)((0,r.$)(t))}let l=(e,t,n,r)=>{let a={};return Object.keys(e).map(e=>e.toLowerCase().trim()),n.forEach(t=>{let n,i=null==r?void 0:r[t.id],l=(t.aliases||(null==i?void 0:i.aliases)||[t.label]).map(e=>e.toLowerCase().trim()),c=Array.from(new Set([t.id,t.label,...l].map(e=>e.toLowerCase().trim()))),s=Object.keys(e).find(e=>c.includes(e.toLowerCase().trim()));s&&(n=e[s]),null==n||""===String(n).trim()?a[t.id]=void 0!==t.defaultValue?t.defaultValue:"number"===t.dataType?0:"":"number"===t.dataType?a[t.id]=parseFloat(String(n).trim().replace(/,/g,""))||0:a[t.id]=String(n).trim()}),a}},86948:(e,t,n)=>{"use strict";n.d(t,{BT:()=>o,Wu:()=>d,ZB:()=>s,Zp:()=>l,aR:()=>c,wL:()=>u});var r=n(95155),a=n(12115),i=n(64269);let l=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("rounded-xl border bg-card text-card-foreground shadow-sm",n),...a})});l.displayName="Card";let c=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-4 sm:p-6 text-right",n),...a})});c.displayName="CardHeader";let s=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("h3",{ref:t,className:(0,i.cn)("text-lg sm:text-xl font-bold leading-none tracking-tight",n),...a})});s.displayName="CardTitle";let o=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("p",{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",n),...a})});o.displayName="CardDescription";let d=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("p-4 sm:p-6 pt-0",n),...a})});d.displayName="CardContent";let u=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("flex items-center p-4 sm:p-6 pt-0",n),...a})});u.displayName="CardFooter"}},e=>{e.O(0,[9135,7210,4909,5111,783,4223,1583,7643,4206,8441,1255,7358],()=>e(e.s=41956)),_N_E=e.O()}]);