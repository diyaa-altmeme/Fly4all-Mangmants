(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2500,8407],{3730:(e,s,a)=>{"use strict";a.d(s,{Ke:()=>n,Nt:()=>r,R6:()=>l});var t=a(57259);let r=t.bL,l=t.R6,n=t.Ke},5470:(e,s,a)=>{"use strict";a.d(s,{Z:()=>m,z:()=>x});var t=a(95155),r=a(12115),l=a(9012),n=a(80187),i=a(35656),c=a(96133),d=a(23451),o=a(75660);let u=(0,r.createContext)({data:null,loaded:!1,fetchData:async()=>{},refreshData:async()=>{}}),x=e=>{let{children:s}=e,[a,x]=(0,r.useState)(null),[m,h]=(0,r.useState)(!1),[p,j]=(0,r.useState)(!1),{user:f,loading:g}=(0,d.A)(),N=(0,r.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!p&&(!m||e)){j(!0);try{let[e,s,a,t,r]=await Promise.all([(0,l.L)({all:!0,includeInactive:!1,relationType:"all"}),(0,n.c)(),(0,i.l)({all:!0}),(0,c.m)(),(0,o.r)()]),d=e.clients,u=d.filter(e=>"client"===e.relationType||"both"===e.relationType),m=d.filter(e=>"supplier"===e.relationType||"both"===e.relationType),p=r.accounts||[];x({clients:u,suppliers:m,boxes:s,users:a,exchanges:p,settings:t}),h(!0)}catch(e){console.error("Failed to load initial voucher navigation data:",e)}finally{j(!1)}}},[p,m]);(0,r.useEffect)(()=>{g||!f||"isClient"in f&&f.isClient||N()},[f,g,N]);let v=(0,r.useCallback)(async()=>{await N(!0)},[N]);return(0,t.jsx)(u.Provider,{value:{data:a,loaded:m,fetchData:N,refreshData:v},children:s})},m=()=>{let e=(0,r.useContext)(u);if(void 0===e)throw Error("useVoucherNav must be used within a VoucherNavProvider");return e}},6259:(e,s,a)=>{"use strict";a.d(s,{M5:()=>h,SQ:()=>p,_2:()=>j,lv:()=>x,mB:()=>f,nV:()=>m,rI:()=>o,ty:()=>u});var t=a(95155),r=a(12115),l=a(47971),n=a(63263),i=a(72251),c=a(75797),d=a(64269);let o=l.bL,u=l.l9;l.YJ,l.ZL;let x=l.Pb;l.z6;let m=r.forwardRef((e,s)=>{let{className:a,inset:r,children:i,...c}=e;return(0,t.jsxs)(l.ZP,{ref:s,className:(0,d.cn)("flex cursor-default gap-2 select-none items-center rounded-md px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",a),...c,children:[(0,t.jsx)(n.A,{className:"mr-auto h-4 w-4"}),i]})});m.displayName=l.ZP.displayName;let h=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(l.G5,{ref:s,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})});h.displayName=l.G5.displayName;let p=r.forwardRef((e,s)=>{let{className:a,sideOffset:r=4,...n}=e;return(0,t.jsx)(l.ZL,{children:(0,t.jsx)(l.UC,{ref:s,sideOffset:r,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...n})})});p.displayName=l.UC.displayName;let j=r.forwardRef((e,s)=>{let{className:a,inset:r,...n}=e;return(0,t.jsx)(l.q7,{ref:s,className:(0,d.cn)("relative flex cursor-default select-none items-center gap-2 rounded-md px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",a),...n})});j.displayName=l.q7.displayName,r.forwardRef((e,s)=>{let{className:a,children:r,checked:n,...c}=e;return(0,t.jsxs)(l.H_,{ref:s,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pr-8 pl-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:n,...c,children:[(0,t.jsx)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(l.VF,{children:(0,t.jsx)(i.A,{className:"h-4 w-4"})})}),r]})}).displayName=l.H_.displayName,r.forwardRef((e,s)=>{let{className:a,children:r,...n}=e;return(0,t.jsxs)(l.hN,{ref:s,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pr-8 pl-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...n,children:[(0,t.jsx)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(l.VF,{children:(0,t.jsx)(c.A,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=l.hN.displayName,r.forwardRef((e,s)=>{let{className:a,inset:r,...n}=e;return(0,t.jsx)(l.JU,{ref:s,className:(0,d.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pr-8",a),...n})}).displayName=l.JU.displayName;let f=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(l.wv,{ref:s,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",a),...r})});f.displayName=l.wv.displayName},9012:(e,s,a)=>{"use strict";a.d(s,{L:()=>r});var t=a(30926);let r=(0,t.createServerReference)("400e621b7f78c4800cffc85d668ca10cd73eb6853c",t.callServer,void 0,t.findSourceMapURL,"getClients")},9484:(e,s,a)=>{"use strict";a.d(s,{C1:()=>b,bL:()=>v});var t=a(12115),r=a(3468),l=a(97602),n=a(95155),i="Progress",[c,d]=(0,r.A)(i),[o,u]=c(i),x=t.forwardRef((e,s)=>{var a,t,r,i;let{__scopeProgress:c,value:d=null,max:u,getValueLabel:x=p,...m}=e;(u||0===u)&&!g(u)&&console.error((a="".concat(u),t="Progress","Invalid prop `max` of value `".concat(a,"` supplied to `").concat(t,"`. Only numbers greater than 0 are valid max values. Defaulting to `").concat(100,"`.")));let h=g(u)?u:100;null===d||N(d,h)||console.error((r="".concat(d),i="Progress","Invalid prop `value` of value `".concat(r,"` supplied to `").concat(i,"`. The `value` prop must be:\n  - a positive number\n  - less than the value passed to `max` (or ").concat(100," if no `max` prop is set)\n  - `null` or `undefined` if the progress is indeterminate.\n\nDefaulting to `null`.")));let v=N(d,h)?d:null,b=f(v)?x(v,h):void 0;return(0,n.jsx)(o,{scope:c,value:v,max:h,children:(0,n.jsx)(l.sG.div,{"aria-valuemax":h,"aria-valuemin":0,"aria-valuenow":f(v)?v:void 0,"aria-valuetext":b,role:"progressbar","data-state":j(v,h),"data-value":null!=v?v:void 0,"data-max":h,...m,ref:s})})});x.displayName=i;var m="ProgressIndicator",h=t.forwardRef((e,s)=>{var a;let{__scopeProgress:t,...r}=e,i=u(m,t);return(0,n.jsx)(l.sG.div,{"data-state":j(i.value,i.max),"data-value":null!=(a=i.value)?a:void 0,"data-max":i.max,...r,ref:s})});function p(e,s){return"".concat(Math.round(e/s*100),"%")}function j(e,s){return null==e?"indeterminate":e===s?"complete":"loading"}function f(e){return"number"==typeof e}function g(e){return f(e)&&!isNaN(e)&&e>0}function N(e,s){return f(e)&&!isNaN(e)&&e<=s&&e>=0}h.displayName=m;var v=x,b=h},10634:(e,s,a)=>{"use strict";a.d(s,{default:()=>eK});var t=a(95155),r=a(12115),l=a(87270),n=a(12941),i=a(13381),c=a(26615),d=a(69795),o=a(2546),u=a(98211),x=a(10193),m=a(59007),h=a(41165),p=a(52240),j=a(40671),f=a(28263),g=a(88964),N=a(13630),v=a(60406),b=a(11647),y=a(3998),w=a(6259),C=a(30926);let S=(0,C.createServerReference)("40dc0f099e7b5a731a230c5f6ba0d64c59c23245aa",C.callServer,void 0,C.findSourceMapURL,"softDeleteBooking");var k=a(15894),A=a(98053),I=a(81937),D=a(64269),R=a(15239),P=a(14223),M=a(19056),z=a(5470),L=a(27063),F=a(3730),U=a(86948),B=a(53774),V=a(30563),T=a(92273);let J=(e,s)=>"number"!=typeof e||isNaN(e)?"-":new Intl.NumberFormat("en-US").format(e)+" ".concat(s),E=e=>{let{amount:s,currency:a,icon:r,colorClass:l,title:n}=e;return null!==s&&"number"==typeof s&&isFinite(s)?(0,t.jsxs)("div",{className:"flex items-center gap-2 justify-center",title:n,children:[(0,t.jsx)(r,{className:(0,D.cn)("h-4 w-4",l)}),(0,t.jsx)("span",{className:(0,D.cn)("font-mono font-semibold",l),children:s.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})})]}):(0,t.jsx)("span",{className:"text-muted-foreground",children:"-"})},O=e=>{let{type:s}=e,a={booking:{label:"إصدار",icon:n.A,className:"bg-blue-100 text-blue-800"},exchange:{label:"تغيير",icon:i.A,className:"bg-yellow-100 text-yellow-800"},refund:{label:"استرجاع",icon:c.A,className:"bg-red-100 text-red-800"},void:{label:"فويد",icon:c.A,className:"bg-gray-100 text-gray-800"},Multiple:{label:"عمليات متعددة",icon:d.A,className:"bg-purple-100 text-purple-800"}}[s];if(!a)return(0,t.jsx)(b.E,{variant:"secondary",children:s});let r=a.icon;return(0,t.jsxs)(b.E,{variant:"outline",className:(0,D.cn)("gap-1.5",a.className),children:[(0,t.jsx)(r,{className:"h-3 w-3"}),a.label]})},Z=e=>{let{type:s,className:a}=e,r={Adult:{icon:o.A},Child:{icon:u.A},Infant:{icon:x.A}}[s];if(!r)return null;let l=r.icon;return(0,t.jsx)(l,{className:(0,D.cn)("h-4 w-4",a)})},$=e=>{var s,a;let{booking:n,onBookingUpdated:i,onBookingDeleted:c,clients:d,suppliers:o}=e,{toast:u}=(0,k.dj)();if(!n)return(0,t.jsx)(l.Hj,{children:(0,t.jsx)(l.nA,{colSpan:10,className:"text-center text-destructive",children:"بيانات الحجز الأصلية مفقودة لهذا السجل."})});let x=async()=>{let e=await S(n.id);e.success?(u({title:"تم نقل الحجز إلى سجل المحذوفات"}),c(n.id)):u({title:"خطأ",description:e.error,variant:"destructive"})},b=n.currency||"USD",{totalSale:C,totalPurchase:z,totalProfit:B,supplierId:V,clientId:T,pnr:$,route:_,passengers:q}=(0,r.useMemo)(()=>{let e=(n.passengers||[]).reduce((e,s)=>e+(s.salePrice||0),0),s=(n.passengers||[]).reduce((e,s)=>e+(s.purchasePrice||0),0);return{totalSale:e,totalPurchase:s,totalProfit:e-s,supplierId:n.supplierId,clientId:n.clientId,pnr:n.pnr||n.id.slice(-6),route:n.route,passengers:n.passengers||[]}},[n]),H=(null==(s=o.find(e=>e.id===V))?void 0:s.name)||V,Y=(null==(a=d.find(e=>e.id===T))?void 0:a.name)||T,G=(0,r.useMemo)(()=>"booking",[]);return(0,t.jsxs)(r.Fragment,{children:[(0,t.jsxs)(l.Hj,{className:"font-bold text-center",children:[(0,t.jsx)(l.nA,{className:"border p-2 align-middle",children:(0,t.jsx)(F.R6,{asChild:!0,children:(0,t.jsx)(y.$,{variant:"ghost",size:"icon",className:"h-8 w-8 data-[state=open]:rotate-180",children:(0,t.jsx)(m.A,{className:"h-4 w-4"})})})}),(0,t.jsxs)(l.nA,{className:"border p-2 align-middle",children:[(0,t.jsx)("div",{className:"font-mono text-xs",children:n.invoiceNumber}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:n.issueDate?(0,P.GP)((0,M.H)(n.issueDate),"yyyy-MM-dd"):"-"})]}),(0,t.jsxs)(l.nA,{className:"border p-2 align-middle",children:[(0,t.jsx)("div",{className:"font-mono font-semibold",children:$}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:_})]}),(0,t.jsx)(l.nA,{className:"border p-2 align-middle",children:(0,t.jsxs)(L.cj,{children:[(0,t.jsx)(L.CG,{asChild:!0,children:(0,t.jsx)(y.$,{variant:"link",className:"p-0 h-auto font-bold",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[n.airlineLogoUrl&&(0,t.jsx)(R.default,{src:n.airlineLogoUrl,alt:"",width:24,height:24,className:"rounded-full"}),(0,t.jsxs)("div",{className:"font-semibold",children:[(q||[]).length," مسافر"]})]})})}),(0,t.jsxs)(L.h,{children:[(0,t.jsxs)(L.Fm,{children:[(0,t.jsxs)(L.qp,{children:["المسافرون في حجز: ",$]}),(0,t.jsx)(L.Qs,{children:"تفاصيل المسافرين والبيانات المالية لكل منهم."})]}),(0,t.jsx)("div",{className:"space-y-3 mt-4",children:(q||[]).map((e,s)=>(0,t.jsxs)(U.Zp,{children:[(0,t.jsxs)(U.aR,{className:"p-3",children:[(0,t.jsx)(U.ZB,{className:"text-base",children:e.name}),(0,t.jsxs)(U.BT,{children:["تذكرة: ",e.ticketNumber," | جواز: ",e.passportNumber||"N/A"]})]}),(0,t.jsxs)(U.Wu,{className:"p-3 grid grid-cols-3 gap-2 text-center text-sm",children:[(0,t.jsxs)("div",{className:"bg-red-50 p-2 rounded-md",children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"الشراء"}),(0,t.jsx)("p",{className:"font-bold font-mono",children:J(e.purchasePrice,b)})]}),(0,t.jsxs)("div",{className:"bg-green-50 p-2 rounded-md",children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"البيع"}),(0,t.jsx)("p",{className:"font-bold font-mono",children:J(e.salePrice,b)})]}),(0,t.jsxs)("div",{className:"bg-blue-50 p-2 rounded-md",children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"الربح"}),(0,t.jsx)("p",{className:(0,D.cn)("font-bold font-mono",e.salePrice-e.purchasePrice<0?"text-destructive":""),children:J(e.salePrice-e.purchasePrice,b)})]})]})]},e.id||s))})]})]})}),(0,t.jsx)(l.nA,{className:"border p-2 align-middle",children:(0,t.jsx)(O,{type:G})}),(0,t.jsxs)(l.nA,{className:"border p-2 align-middle",children:[(0,t.jsx)("div",{className:"font-semibold",children:H}),(0,t.jsx)(E,{title:"إجمالي التكلفة (".concat(b,")"),amount:z,currency:b,icon:h.A,colorClass:"text-red-500"})]}),(0,t.jsxs)(l.nA,{className:"border p-2 align-middle",children:[(0,t.jsx)("div",{className:"font-semibold",children:Y}),(0,t.jsx)(E,{title:"إجمالي المبيع (".concat(b,")"),amount:C,currency:b,icon:p.A,colorClass:"text-green-600"})]}),(0,t.jsx)(l.nA,{className:"border p-2 align-middle",children:(0,t.jsx)(E,{title:"الربح",amount:B,currency:b,icon:j.A,colorClass:"text-blue-600 font-bold"})}),(0,t.jsxs)(l.nA,{className:"border p-2 align-middle",children:[(0,t.jsx)("div",{className:"text-xs",children:n.enteredBy}),n.enteredAt&&(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:(0,P.GP)((0,M.H)(n.enteredAt),"yyyy-MM-dd")})]}),(0,t.jsx)(l.nA,{className:"border p-2 align-middle",children:(0,t.jsxs)(w.rI,{children:[(0,t.jsx)(w.ty,{asChild:!0,children:(0,t.jsx)(y.$,{variant:"ghost",size:"icon",children:(0,t.jsx)(f.A,{className:"h-4 w-4"})})}),(0,t.jsxs)(w.SQ,{children:[(0,t.jsx)(I.A,{isEditing:!0,booking:n,onBookingUpdated:i,children:(0,t.jsxs)(w._2,{onSelect:e=>e.preventDefault(),disabled:"booking"!==G,children:[(0,t.jsx)(g.A,{className:"me-2 h-4 w-4"})," تعديل"]})}),(0,t.jsxs)(A.Lt,{children:[(0,t.jsx)(A.tv,{asChild:!0,children:(0,t.jsxs)(w._2,{onSelect:e=>e.preventDefault(),className:"text-destructive focus:text-destructive",children:[(0,t.jsx)(N.A,{className:"me-2 h-4 w-4"})," حذف"]})}),(0,t.jsxs)(A.EO,{children:[(0,t.jsxs)(A.wd,{className:"items-center text-center",children:[(0,t.jsx)("div",{className:"p-3 bg-destructive/10 rounded-full w-fit",children:(0,t.jsx)(v.A,{className:"h-8 w-8 text-destructive"})}),(0,t.jsx)(A.r7,{children:"هل أنت متأكد من الحذف؟"}),(0,t.jsx)(A.$v,{children:"هذا الإجراء سينقل الحجز إلى سجل المحذوفات. يمكنك استعادته لاحقًا."})]}),(0,t.jsxs)(A.ck,{className:"flex-row gap-2 justify-end",children:[(0,t.jsx)(A.Zr,{children:"إلغاء"}),(0,t.jsx)(A.Rx,{onClick:x,className:(0,D.cn)((0,y.r)({variant:"destructive"})),children:"نعم، قم بالحذف"})]})]})]})]})]})})]}),(0,t.jsx)(F.Ke,{asChild:!0,children:(0,t.jsx)(l.Hj,{children:(0,t.jsx)(l.nA,{colSpan:10,className:"p-0",children:(0,t.jsxs)("div",{className:"p-4 bg-muted/50",children:[(0,t.jsx)("h4",{className:"font-bold mb-2",children:"تفاصيل المسافرين:"}),(0,t.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,t.jsxs)(l.XI,{children:[(0,t.jsx)(l.A0,{children:(0,t.jsxs)(l.Hj,{className:"bg-background",children:[(0,t.jsx)(l.nd,{className:"font-semibold",children:"اسم المسافر"}),(0,t.jsx)(l.nd,{className:"font-semibold",children:"رقم الجواز"}),(0,t.jsx)(l.nd,{className:"font-semibold",children:"رقم التذكرة"}),(0,t.jsx)(l.nd,{className:"font-semibold",children:"نوع المسافر"}),(0,t.jsx)(l.nd,{className:"font-semibold",children:"نوع التذكرة"}),(0,t.jsx)(l.nd,{className:"text-center font-semibold",children:"شراء"}),(0,t.jsx)(l.nd,{className:"text-center font-semibold",children:"بيع"}),(0,t.jsx)(l.nd,{className:"text-center font-semibold",children:"ربح"})]})}),(0,t.jsx)(l.BF,{children:(q||[]).map((e,s)=>{let a=e.salePrice-e.purchasePrice;return(0,t.jsxs)(l.Hj,{children:[(0,t.jsx)(l.nA,{className:"font-medium",children:e.name}),(0,t.jsx)(l.nA,{className:"font-mono",children:e.passportNumber||"-"}),(0,t.jsx)(l.nA,{className:"font-mono",children:e.ticketNumber}),(0,t.jsx)(l.nA,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(Z,{type:e.passengerType})," ",e.passengerType]})}),(0,t.jsx)(l.nA,{children:(0,t.jsx)(O,{type:e.ticketType||"Issue"})}),(0,t.jsx)(l.nA,{className:"text-center font-mono",children:J(e.purchasePrice,b)}),(0,t.jsx)(l.nA,{className:"text-center font-mono",children:J(e.salePrice,b)}),(0,t.jsx)(l.nA,{className:(0,D.cn)("text-center font-mono font-bold",a>=0?"text-green-600":"text-destructive"),children:J(a,b)})]},e.id||s)})})]})})]})})})})]})};function _(e){let{bookings:s,totalBookings:a,onBookingUpdated:n,onBookingDeleted:i}=e,{data:c,loaded:d}=(0,z.Z)();if(!d)return(0,t.jsx)("div",{className:"text-center p-8",children:"جاري تحميل البيانات..."});let o=r.useMemo(()=>[],[]),u=(0,V.N4)({data:s,columns:o,manualPagination:!0,pageCount:Math.ceil(a/15),getCoreRowModel:(0,T.HT)(),getPaginationRowModel:(0,T.kW)()});return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"border rounded-lg overflow-x-auto",children:(0,t.jsxs)(l.XI,{className:"border-collapse",children:[(0,t.jsx)(l.A0,{children:(0,t.jsxs)(l.Hj,{children:[(0,t.jsx)(l.nd,{className:"w-[50px] border p-2"}),(0,t.jsx)(l.nd,{className:"border p-2 text-center font-bold",children:"الفاتورة / التاريخ"}),(0,t.jsx)(l.nd,{className:"border p-2 text-center font-bold",children:"PNR / المسار"}),(0,t.jsx)(l.nd,{className:"border p-2 text-center font-bold",children:"المسافرون"}),(0,t.jsx)(l.nd,{className:"border p-2 text-center font-bold",children:"نوع العملية"}),(0,t.jsx)(l.nd,{className:"border p-2 text-center font-bold",children:"المصدر / التكلفة"}),(0,t.jsx)(l.nd,{className:"border p-2 text-center font-bold",children:"المستفيد / المبيع"}),(0,t.jsx)(l.nd,{className:"border p-2 text-center font-bold",children:"الربح"}),(0,t.jsx)(l.nd,{className:"border p-2 text-center font-bold",children:"مدخل البيانات/التاريخ"}),(0,t.jsx)(l.nd,{className:"text-center font-bold border p-2",children:"الإجراءات"})]})}),(0,t.jsx)(l.BF,{children:0===s.length?(0,t.jsx)(l.Hj,{children:(0,t.jsx)(l.nA,{colSpan:10,className:"h-24 text-center border p-2",children:"لا توجد حجوزات لعرضها."})}):s.map((e,s)=>(0,t.jsx)(F.Nt,{asChild:!0,children:(0,t.jsx)($,{booking:e,onBookingUpdated:n,onBookingDeleted:i,clients:c.clients||[],suppliers:c.suppliers||[]})},e.id||s))})]})}),(0,t.jsx)(B.T,{table:u,totalRows:a})]})}var q=a(92033),H=a(22452),Y=a(30848),G=a(60805),W=a(23107),Q=a(60013),K=a(65142),X=a(11186),ee=a(90109),es=a(22544),ea=a(66942),et=a(54879),er=a(76444),el=a(28068),en=a(32810),ei=a(36204),ec=a(73180),ed=a(55858),eo=a(54130),eu=a(23639),ex=a(27432),em=a(97916),eh=a(23451),ep=a(41052),ej=a(53404);let ef=et.Ik({name:et.Yj().min(1,"الاسم مطلوب"),passportNumber:et.Yj().optional(),ticketNumber:et.Yj().min(1,"رقم التذكرة مطلوب"),purchasePrice:et.au.number().min(0,"سعر الشراء يجب أن يكون 0 أو أكثر.").default(0),clientStatement:et.Yj().optional(),salePrice:et.au.number().min(0,"سعر البيع يجب أن يكون 0 أو أكثر.").default(0),passengerType:et.k5(["Adult","Child","Infant"]),ticketType:et.k5(["Issue","Change","Refund","Void"]).default("Issue")}),eg=et.Ik({pnr:et.Yj().min(1,"PNR مطلوب"),supplierId:et.Yj().min(1,"المورد مطلوب"),clientId:et.Yj().min(1,"العميل مطلوب"),travelDate:et.p6({required_error:"تاريخ السفر مطلوب"}),issueDate:et.p6({required_error:"تاريخ الإصدار مطلوب"}),boxId:et.Yj().optional(),currency:et.k5(["USD","IQD"]),passengers:et.YO(ef).min(1,"يجب إضافة مسافر واحد على الأقل"),route1:et.Yj().optional(),route2:et.Yj().optional(),route3:et.Yj().optional(),route4:et.Yj().optional()}),eN=[{value:"Adult",label:"بالغ",icon:o.A},{value:"Child",label:"طفل",icon:u.A},{value:"Infant",label:"رضيع",icon:x.A}];function ev(e){let{onBookingAdded:s,onCancel:a}=e,{toast:n}=(0,k.dj)(),{data:i,loaded:c}=(0,z.Z)(),{user:d}=(0,eh.A)(),[o,u]=(0,r.useState)(null),x=r.useMemo(()=>ej.t.map(e=>({value:e.code,label:"".concat(e.arabicName," (").concat(e.code,")"),arabicName:e.arabicName,city:e.city,country:e.country,arabicCountry:e.arabicCountry,useCount:e.useCount||0})).sort((e,s)=>s.useCount-e.useCount),[]),m=(0,es.mN)({resolver:(0,ea.u)(eg),defaultValues:{pnr:"",supplierId:"",clientId:"",currency:"USD",passengers:[{name:"",passportNumber:"",ticketNumber:"",purchasePrice:0,clientStatement:"",salePrice:0,passengerType:"Adult",ticketType:"Issue"}]}});(0,r.useEffect)(()=>{d&&"role"in d&&d.boxId&&m.setValue("boxId",d.boxId)},[d,m]);let{control:h,handleSubmit:p,formState:{errors:j,isSubmitting:f},setValue:g,watch:b,getValues:w}=m,{fields:C,append:S,remove:I}=(0,es.jz)({control:h,name:"passengers"}),R=r.useMemo(()=>((null==i?void 0:i.suppliers)||[]).map(e=>({value:e.id,label:e.name})),[null==i?void 0:i.suppliers]),M=r.useMemo(()=>((null==i?void 0:i.clients)||[]).map(e=>({value:e.id,label:"".concat(e.name," ").concat(e.code?"(".concat(e.code,")"):"")})),[null==i?void 0:i.clients]),L=async e=>{let a=n({title:"جاري إضافة الحجز..."});try{let t=[e.route1,e.route2,e.route3,e.route4].filter(Boolean).join(" - "),r={pnr:e.pnr,supplierId:e.supplierId,clientId:e.clientId,boxId:e.boxId||"",currency:e.currency,travelDate:e.travelDate.toISOString(),issueDate:e.issueDate.toISOString(),route:t,notes:"",passengers:e.passengers.map(s=>({id:"temp-".concat(Math.random()),name:s.name,passportNumber:s.passportNumber||"",ticketNumber:s.ticketNumber||"",purchasePrice:s.purchasePrice,salePrice:s.salePrice,passengerType:s.passengerType,ticketType:"Issue",clientStatement:s.clientStatement||"",currency:e.currency}))},l=await (0,ed.B)(r);if(l.success&&l.newBooking)a.update({id:a.id,title:"تمت الإضافة بنجاح"}),s(l.newBooking),m.reset();else throw Error(l.error)}catch(e){a.update({id:a.id,title:"خطأ",description:e.message,variant:"destructive"})}},F=async e=>{let s=await (0,eo.x)(e.pnr);if(s&&s.length>0)return void u(s[0]);await L(e)};return c&&i?(0,t.jsxs)("div",{className:"relative pt-4",children:[(0,t.jsx)(y.$,{variant:"ghost",size:"icon",onClick:a,className:"absolute top-0 left-0 z-10",children:(0,t.jsx)(el.A,{className:"h-5 w-5"})}),(0,t.jsx)(A.Lt,{open:!!o,onOpenChange:e=>!e&&u(null),children:(0,t.jsxs)(A.EO,{children:[(0,t.jsxs)(A.wd,{children:[(0,t.jsxs)(A.r7,{className:"flex items-center gap-2",children:[(0,t.jsx)(v.A,{className:"h-6 w-6 text-yellow-500"})," تنبيه: PNR مكرر"]}),(0,t.jsx)(A.$v,{children:"رقم الحجز (PNR) الذي أدخلته موجود بالفعل في النظام. هل أنت متأكد أنك تريد المتابعة وإنشاء حجز جديد بنفس الرقم؟"})]}),(0,t.jsxs)("div",{className:"p-4 bg-muted/50 rounded-lg text-sm",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"PNR:"})," ",null==o?void 0:o.pnr]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"تاريخ الإصدار الأصلي:"})," ",(null==o?void 0:o.issueDate)?(0,P.GP)(new Date(o.issueDate),"yyyy-MM-dd"):"N/A"]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"أدخل بواسطة:"})," ",null==o?void 0:o.enteredBy]})]}),(0,t.jsxs)(A.ck,{children:[(0,t.jsx)(A.Zr,{onClick:()=>u(null),children:"لا، إلغاء"}),(0,t.jsx)(A.Rx,{onClick:()=>{u(null),L(w())},children:"نعم، متابعة على أي حال"})]})]})}),(0,t.jsx)(U.Zp,{children:(0,t.jsx)(U.Wu,{className:"pt-6",children:(0,t.jsx)(ep.lV,{...m,children:(0,t.jsxs)("form",{onSubmit:p(F),className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 items-start p-4 border rounded-lg bg-muted/30",children:[(0,t.jsx)(ep.zB,{name:"pnr",control:h,render:e=>{let{field:s}=e;return(0,t.jsxs)(ep.eI,{children:[(0,t.jsx)(er.J,{children:"رقم PNR"}),(0,t.jsx)(ep.MJ,{children:(0,t.jsx)(K.p,{...s})}),(0,t.jsx)(ep.C5,{})]})}}),(0,t.jsx)(ep.zB,{name:"supplierId",control:h,render:e=>{let{field:s}=e;return(0,t.jsxs)(ep.eI,{children:[(0,t.jsx)(er.J,{children:"المورد"}),(0,t.jsx)(ep.MJ,{children:(0,t.jsx)(eu.j,{options:R,value:s.value,onValueChange:s.onChange,placeholder:"ابحث عن مورد..."})}),(0,t.jsx)(ep.C5,{})]})}}),(0,t.jsx)(ep.zB,{name:"clientId",control:h,render:e=>{let{field:s}=e;return(0,t.jsxs)(ep.eI,{children:[(0,t.jsx)(er.J,{children:"العميل"}),(0,t.jsx)(ep.MJ,{children:(0,t.jsx)(eu.j,{options:M,value:s.value,onValueChange:s.onChange,placeholder:"ابحث عن عميل..."})}),(0,t.jsx)(ep.C5,{})]})}}),(0,t.jsx)(ep.zB,{name:"currency",control:h,render:e=>{let{field:s}=e;return(0,t.jsxs)(ep.eI,{children:[(0,t.jsx)(er.J,{children:"العملة"}),(0,t.jsxs)(X.l6,{onValueChange:s.onChange,value:s.value,children:[(0,t.jsx)(ep.MJ,{children:(0,t.jsx)(X.bq,{children:(0,t.jsx)(X.yv,{})})}),(0,t.jsxs)(X.gC,{children:[(0,t.jsx)(X.eb,{value:"USD",children:"USD"}),(0,t.jsx)(X.eb,{value:"IQD",children:"IQD"})]})]}),(0,t.jsx)(ep.C5,{})]})}}),(0,t.jsx)(ep.zB,{name:"travelDate",control:h,render:e=>{let{field:s}=e;return(0,t.jsxs)(ep.eI,{children:[(0,t.jsx)(er.J,{children:"تاريخ السفر"}),(0,t.jsx)(ep.MJ,{children:(0,t.jsx)(ex.K,{date:s.value,setDate:s.onChange})}),(0,t.jsx)(ep.C5,{})]})}}),(0,t.jsx)(ep.zB,{name:"issueDate",control:h,render:e=>{let{field:s}=e;return(0,t.jsxs)(ep.eI,{children:[(0,t.jsx)(er.J,{children:"تاريخ الإصدار"}),(0,t.jsx)(ep.MJ,{children:(0,t.jsx)(ex.K,{date:s.value,setDate:s.onChange})}),(0,t.jsx)(ep.C5,{})]})}})]}),(0,t.jsxs)("div",{className:"space-y-1 p-4 border rounded-lg bg-muted/30",children:[(0,t.jsx)(er.J,{children:"الروت (خط الرحلة)"}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(en.A,{className:"h-5 w-5 text-muted-foreground"}),(0,t.jsx)(es.xI,{name:"route1",control:h,render:e=>{let{field:s}=e;return(0,t.jsx)(eu.j,{options:x,value:s.value,onValueChange:s.onChange,placeholder:"BGW"})}}),(0,t.jsx)(ei.A,{className:"h-5 w-5 text-muted-foreground"}),(0,t.jsx)(es.xI,{name:"route2",control:h,render:e=>{let{field:s}=e;return(0,t.jsx)(eu.j,{options:x,value:s.value,onValueChange:s.onChange,placeholder:"DXB"})}}),(0,t.jsx)(ei.A,{className:"h-5 w-5 text-muted-foreground"}),(0,t.jsx)(es.xI,{name:"route3",control:h,render:e=>{let{field:s}=e;return(0,t.jsx)(eu.j,{options:x,value:s.value,onValueChange:s.onChange,placeholder:"BKK"})}}),(0,t.jsx)(ei.A,{className:"h-5 w-5 text-muted-foreground"}),(0,t.jsx)(es.xI,{name:"route4",control:h,render:e=>{let{field:s}=e;return(0,t.jsx)(eu.j,{options:x,value:s.value,onValueChange:s.onChange,placeholder:"..."})}})]})]}),(0,t.jsxs)("div",{className:"overflow-x-auto border rounded-lg",children:[(0,t.jsxs)(l.XI,{children:[(0,t.jsx)(l.A0,{children:(0,t.jsxs)(l.Hj,{className:"bg-muted/50",children:[(0,t.jsx)(l.nd,{className:"p-2 text-right",children:"اسم المسافر"}),(0,t.jsx)(l.nd,{className:"p-2 text-right",children:"رقم الجواز"}),(0,t.jsx)(l.nd,{className:"p-2 text-right",children:"رقم التذكرة"}),(0,t.jsx)(l.nd,{className:"p-2 text-right",children:"سعر الشراء"}),(0,t.jsx)(l.nd,{className:"p-2 text-right",children:"سعر البيع"}),(0,t.jsx)(l.nd,{className:"p-2 text-right",children:"نوع المسافر"}),(0,t.jsx)(l.nd,{className:"p-2 w-[50px]"})]})}),(0,t.jsx)(l.BF,{children:C.map((e,s)=>{let a=b("currency");return(0,t.jsxs)(l.Hj,{children:[(0,t.jsx)(l.nA,{className:"p-1",children:(0,t.jsx)(ep.zB,{name:"passengers.".concat(s,".name"),control:h,render:e=>{let{field:s}=e;return(0,t.jsxs)(ep.eI,{children:[(0,t.jsx)(ep.MJ,{children:(0,t.jsx)(K.p,{...s,placeholder:"الاسم الكامل"})}),(0,t.jsx)(ep.C5,{})]})}})}),(0,t.jsx)(l.nA,{className:"p-1",children:(0,t.jsx)(ep.zB,{name:"passengers.".concat(s,".passportNumber"),control:h,render:e=>{let{field:s}=e;return(0,t.jsxs)(ep.eI,{children:[(0,t.jsx)(ep.MJ,{children:(0,t.jsx)(K.p,{...s,placeholder:"رقم الجواز"})}),(0,t.jsx)(ep.C5,{})]})}})}),(0,t.jsx)(l.nA,{className:"p-1",children:(0,t.jsx)(ep.zB,{name:"passengers.".concat(s,".ticketNumber"),control:h,render:e=>{let{field:s}=e;return(0,t.jsxs)(ep.eI,{children:[(0,t.jsx)(ep.MJ,{children:(0,t.jsx)(K.p,{...s,placeholder:"رقم التذكرة"})}),(0,t.jsx)(ep.C5,{})]})}})}),(0,t.jsx)(l.nA,{className:"p-1",children:(0,t.jsx)(ep.zB,{name:"passengers.".concat(s,".purchasePrice"),control:h,render:e=>{let{field:s}=e;return(0,t.jsxs)(ep.eI,{children:[(0,t.jsx)(ep.MJ,{children:(0,t.jsx)(em.O,{currency:a,currencyClassName:(0,D.cn)("USD"===a?"bg-accent text-accent-foreground":"bg-primary text-primary-foreground"),...s,onValueChange:s.onChange})}),(0,t.jsx)(ep.C5,{})]})}})}),(0,t.jsx)(l.nA,{className:"p-1",children:(0,t.jsx)(ep.zB,{name:"passengers.".concat(s,".salePrice"),control:h,render:e=>{let{field:s}=e;return(0,t.jsxs)(ep.eI,{children:[(0,t.jsx)(ep.MJ,{children:(0,t.jsx)(em.O,{currency:a,currencyClassName:(0,D.cn)("USD"===a?"bg-accent text-accent-foreground":"bg-primary text-primary-foreground"),...s,onValueChange:s.onChange})}),(0,t.jsx)(ep.C5,{})]})}})}),(0,t.jsx)(l.nA,{className:"p-1",children:(0,t.jsx)(ep.zB,{name:"passengers.".concat(s,".passengerType"),control:h,render:e=>{let{field:s}=e;return(0,t.jsxs)(ep.eI,{children:[(0,t.jsx)(ep.MJ,{children:(0,t.jsxs)(X.l6,{onValueChange:s.onChange,value:s.value,children:[(0,t.jsx)(X.bq,{children:(0,t.jsx)(X.yv,{})}),(0,t.jsx)(X.gC,{children:eN.map(e=>{let s=e.icon;return(0,t.jsx)(X.eb,{value:e.value,children:(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,t.jsx)("span",{children:e.label}),(0,t.jsx)(s,{className:"h-4 w-4"})]})},e.value)})})]})}),(0,t.jsx)(ep.C5,{})]})}})}),(0,t.jsx)(l.nA,{className:"p-1",children:(0,t.jsx)(y.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>I(s),disabled:C.length<=1,children:(0,t.jsx)(N.A,{className:"h-4 w-4 text-destructive"})})})]},e.id)})})]}),j.passengers&&"object"==typeof j.passengers&&"message"in j.passengers&&(0,t.jsx)("p",{className:"text-sm text-destructive mt-2 p-2",children:j.passengers.message})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center mt-4",children:[(0,t.jsxs)(y.$,{type:"button",variant:"outline",onClick:()=>S({name:"",passportNumber:"",ticketNumber:"",purchasePrice:0,clientStatement:"",salePrice:0,passengerType:"Adult",ticketType:"Issue"}),children:[(0,t.jsx)(H.A,{className:"me-2 h-4 w-4"})," إضافة مسافر"]}),(0,t.jsx)("div",{className:"flex gap-2",children:(0,t.jsxs)(y.$,{type:"submit",disabled:f,children:[f&&(0,t.jsx)(q.A,{className:"me-2 h-4 w-4 animate-spin"}),(0,t.jsx)(ec.A,{className:"me-2 h-4 w-4"}),"حفظ الحجز والمسافرين"]})})]})]})})})})]}):(0,t.jsx)("div",{className:"relative pt-4",children:(0,t.jsx)(U.Zp,{children:(0,t.jsx)(U.Wu,{className:"pt-6 flex justify-center items-center h-48",children:(0,t.jsx)(q.A,{className:"h-8 w-8 animate-spin"})})})})}var eb=a(50732),ey=a(51834),ew=a(56639),eC=a(76140),eS=a(97776),ek=a(51181),eA=a(13141),eI=a(28127),eD=a(27314),eR=a(94972),eP=a(11636);let eM=(0,C.createServerReference)("40894ff0ee9a14922c13beed18ea3d0c678338253d",C.callServer,void 0,C.findSourceMapURL,"addMultipleBookings"),ez=(0,C.createServerReference)("402b41f05271dbe007d0f9816bed0bf5ec263bba15",C.callServer,void 0,C.findSourceMapURL,"extractTicketData");var eL=a(17037),eF=a(80991),eU=a(26333);let eB="smartTicketDialogSettings",eV=[{value:"Adult",label:"بالغ",icon:o.A},{value:"Child",label:"طفل",icon:u.A},{value:"Infant",label:"رضيع",icon:x.A}];function eT(e){var s,a;let{onMultipleBookingsAdded:n,children:i}=e,[d,o]=(0,r.useState)(!1),[u,x]=(0,r.useState)(!1),[m,h]=(0,r.useState)(!1),[p,j]=(0,r.useState)(0),[f,g]=(0,r.useState)([]),[v,w]=(0,r.useState)(new Set),{toast:C}=(0,k.dj)(),{data:S,loaded:I}=(0,z.Z)(),{user:P}=(0,eh.A)(),[M,L]=(0,r.useState)({supplierId:"",clientId:"",currency:"USD"}),[F,B]=(0,r.useState)({width:"1400px",height:"90vh"}),[V,T]=(0,r.useState)(!1);(0,r.useEffect)(()=>{try{let e=localStorage.getItem(eB);e&&B(JSON.parse(e))}catch(e){console.error("Failed to parse dialog settings from localStorage",e)}},[]);let J=(0,r.useCallback)(async e=>{let s=e.filter(e=>!v.has(e.name));if(0===s.length)return void C({title:"لا توجد ملفات جديدة",description:"تم بالفعل معالجة جميع الملفات المحددة."});x(!0),j(0);let a=s.length,t=0,r=e=>new Promise((s,r)=>{let l=new FileReader;l.readAsDataURL(e),l.onload=async()=>{try{let a=l.result,t=await ez({fileDataUri:a});g(s=>[...s,{...t,id:"ticket-".concat(Date.now(),"-").concat(Math.random()),financialData:{supplierId:M.supplierId||"",clientId:M.clientId||"",currency:M.currency||"USD"},passengers:t.passengers.map(e=>({...e,purchasePrice:0,salePrice:0,passportNumber:e.passportNumber||"",ticketType:"Issue"})),file:e}]),w(s=>new Set(s).add(e.name)),s()}catch(s){console.error("Error processing file ".concat(e.name,":"),s),C({title:"خطأ في تحليل ملف: ".concat(e.name),description:s.message||"لم يتمكن الذكاء الاصطناعي من قراءة هذا الملف.",variant:"destructive"}),r(s)}finally{j(++t/a*100)}},l.onerror=s=>{C({title:"خطأ في قراءة ملف: ".concat(e.name),variant:"destructive"}),j(++t/a*100),r(s)}});for(let e of s)await r(e);x(!1),C({title:"اكتمل التحليل",description:"تمت معالجة ".concat(a," تذكرة.")})},[C,v,M]),{getRootProps:E,getInputProps:O,isDragActive:Z}=(0,eP.VB)({onDrop:J,accept:{"application/pdf":[".pdf"]},multiple:!0,disabled:u}),$=(e,s,a,t)=>{g((0,Q.jM)(r=>{let l=r.find(s=>s.id===e);l&&(l.passengers[s][a]=t)}))},_=(e,s,a)=>{g((0,Q.jM)(t=>{let r=t.find(s=>s.id===e);r&&(r.financialData[s]=a)}))},H=async()=>{if(0===f.length)return void C({title:"لا توجد حجوزات للحفظ",variant:"destructive"});if(!P||!("boxId"in P)||!P.boxId)return void C({title:"صندوق غير محدد",description:"لا يوجد صندوق مرتبط بحسابك. يرجى مراجعة المدير.",variant:"destructive"});for(let e of f)if(!e.financialData.supplierId||!e.financialData.clientId)return void C({title:"بيانات غير مكتملة",description:"الرجاء تعبئة بيانات المورد والعميل للحجز ".concat(e.pnr,"."),variant:"destructive"});h(!0),o(!1);let e=f.map(e=>({pnr:e.pnr,route:e.route,issueDate:e.issueDate,travelDate:e.travelDate,supplierId:e.financialData.supplierId,clientId:e.financialData.clientId,boxId:P.boxId||"",notes:"تمت الإضافة عبر الإدخال الذكي من ملف: ".concat(e.file.name),currency:e.financialData.currency,passengers:e.passengers.map(e=>({...e,id:"temp-".concat(Math.random()),clientStatement:"",ticketType:e.ticketType||"Issue"}))})),s=await eM(e);s.success&&s.newBookings?(C({title:"تم حفظ الحجوزات بنجاح",description:"تم حفظ ".concat(s.count," حجز جديد.")}),n(s.newBookings),g([]),w(new Set)):C({title:"خطأ",description:s.error,variant:"destructive"}),h(!1)},Y=e=>parseInt(e.replace(/px|vw|vh/g,""),10)||0;return((null==S?void 0:S.suppliers)||[]).map(e=>({value:e.id,label:e.name})),((null==S?void 0:S.clients)||[]).map(e=>({value:e.id,label:e.name})),(0,t.jsxs)(ey.lG,{open:d,onOpenChange:o,children:[(0,t.jsx)(ey.zM,{asChild:!0,children:i}),(0,t.jsxs)(ey.Cf,{showCloseButton:!1,className:"p-0 flex flex-col",style:{maxWidth:F.width,width:"95vw",height:F.height,resize:"both",overflow:"auto"},children:[(0,t.jsxs)(ey.c7,{className:"bg-primary text-primary-foreground p-3 rounded-t-lg flex flex-row items-center justify-between sticky top-0 z-10 border-b",children:[(0,t.jsx)(ey.HM,{asChild:!0,children:(0,t.jsx)(y.$,{variant:"ghost",size:"icon",className:"text-primary-foreground hover:bg-white/20 h-7 w-7 rounded-full",children:(0,t.jsx)(c.A,{className:"h-4 w-4"})})}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsxs)(ey.L3,{className:"flex items-center gap-2",children:[(0,t.jsx)(G.A,{}),"أداة الإدخال الذكي للتذاكر"]})}),(0,t.jsxs)(eU.AM,{open:V,onOpenChange:T,children:[(0,t.jsx)(eU.Wv,{asChild:!0,children:(0,t.jsx)(y.$,{variant:"ghost",size:"icon",className:"text-white hover:bg-white/20 h-8 w-8",children:(0,t.jsx)(ew.A,{className:"h-5 w-5"})})}),(0,t.jsx)(eU.hl,{className:"w-80",align:"end",children:(0,t.jsxs)("div",{className:"grid gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("h4",{className:"font-medium leading-none",children:"أبعاد النافذة"}),(0,t.jsxs)(A.Lt,{children:[(0,t.jsx)(A.tv,{asChild:!0,children:(0,t.jsxs)(y.$,{type:"button",variant:"ghost",size:"sm",className:"h-auto px-2 py-1 text-xs",children:[(0,t.jsx)(eC.A,{className:"me-1 h-3 w-3"})," إعادة للوضع الافتراضي"]})}),(0,t.jsxs)(A.EO,{children:[(0,t.jsxs)(A.wd,{children:[(0,t.jsx)(A.r7,{children:"هل أنت متأكد؟"}),(0,t.jsx)(A.$v,{children:"سيتم إعادة أبعاد النافذة إلى الحجم الافتراضي."})]}),(0,t.jsxs)(A.ck,{children:[(0,t.jsx)(A.Zr,{children:"إلغاء"}),(0,t.jsx)(A.Rx,{onClick:()=>{let e={width:"1400px",height:"90vh"};B(e),localStorage.setItem(eB,JSON.stringify(e)),C({title:"تمت إعادة تعيين الأبعاد"})},className:(0,D.cn)((0,y.r)({variant:"destructive"})),children:"نعم، قم بالإعادة"})]})]})]})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"تحكم في حجم النافذة لتناسب شاشتك."})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsxs)("div",{className:"grid grid-cols-3 items-center gap-4",children:[(0,t.jsx)(er.J,{htmlFor:"width",children:"العرض (px)"}),(0,t.jsx)(em.O,{id:"width",value:Y(F.width),onValueChange:e=>B(s=>({...s,width:"".concat(e||0,"px")})),className:"col-span-2 h-8"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 items-center gap-4",children:[(0,t.jsx)(er.J,{htmlFor:"height",children:"الارتفاع (vh)"}),(0,t.jsx)(em.O,{id:"height",value:Y(F.height),onValueChange:e=>B(s=>({...s,height:"".concat(e||0,"vh")})),className:"col-span-2 h-8"})]}),(0,t.jsx)(y.$,{onClick:()=>{try{localStorage.setItem(eB,JSON.stringify(F)),C({title:"تم حفظ أبعاد النافذة"}),T(!1)}catch(e){C({title:"خطأ",description:"لم يتم حفظ الإعدادات",variant:"destructive"})}},size:"sm",className:"mt-2",children:"حفظ الأبعاد"})]})]})})]})]}),(0,t.jsx)("div",{className:"flex-grow overflow-y-auto px-6 py-4 space-y-4",children:I&&S?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4 items-end px-4 py-3 border rounded-lg bg-muted/30",children:[(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(er.J,{className:"font-bold",children:"المورد"}),(0,t.jsx)(eu.j,{searchAction:"suppliers",placeholder:"المورد الافتراضي...",value:M.supplierId,onValueChange:e=>L(s=>({...s,supplierId:e}))})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(er.J,{className:"font-bold",children:"العميل"}),(0,t.jsx)(eu.j,{searchAction:"clients",placeholder:"العميل الافتراضي...",value:M.clientId,onValueChange:e=>L(s=>({...s,clientId:e}))})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(er.J,{className:"font-bold",children:"العملة"}),(0,t.jsxs)(X.l6,{value:M.currency,onValueChange:e=>L(s=>({...s,currency:e})),children:[(0,t.jsx)(X.bq,{className:"font-bold",children:(0,t.jsx)(X.yv,{})}),(0,t.jsxs)(X.gC,{children:[(0,t.jsx)(X.eb,{className:"font-bold",value:"USD",children:"USD"}),(0,t.jsx)(X.eb,{className:"font-bold",value:"IQD",children:"IQD"})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(y.$,{className:"w-full font-bold bg-[#5b21b6] hover:bg-[#5b21b6]/90",onClick:()=>{if(!M.supplierId&&!M.clientId)return void C({title:"لا توجد بيانات للتطبيق",description:"الرجاء اختيار مورد وعميل.",variant:"destructive"});g(e=>e.map(e=>{let s={supplierId:M.supplierId||e.financialData.supplierId,clientId:M.clientId||e.financialData.clientId,currency:M.currency||e.financialData.currency};return{...e,financialData:s}})),C({title:"تم تطبيق البيانات الموحدة",description:"تم تحديث ".concat(f.length," تذكرة.")})},children:"تطبيق على الكل"}),(0,t.jsxs)("div",{...E(),className:"cursor-pointer",children:[(0,t.jsx)("input",{...O()}),(0,t.jsx)(y.$,{variant:"outline",size:"icon",disabled:u,children:(0,t.jsx)(eS.A,{className:"h-5 w-5"})})]})]})]}),(0,t.jsx)("div",{className:"flex-grow overflow-hidden",children:(0,t.jsx)(eL.F,{className:"h-[calc(100vh-450px)]",children:(0,t.jsxs)("div",{className:"space-y-4 min-h-full",children:[0===f.length&&!u&&(0,t.jsx)("div",{className:"flex items-center justify-center h-full text-muted-foreground pt-10",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(ek.A,{className:"mx-auto h-24 w-24"}),(0,t.jsx)("p",{className:"mt-4 text-lg font-bold",children:"قائمة انتظار الحجوزات"}),(0,t.jsx)("p",{className:"text-sm",children:"ابدأ برفع ملفات التذاكر من الأيقونة في الأعلى."})]})}),u&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("p",{className:"text-sm text-center font-bold text-muted-foreground mb-1",children:["جاري التحليل... (",Math.round(p),"%)"]}),(0,t.jsx)(eF.k,{value:p,className:"h-2 rounded-full"})]}),f.map(e=>(0,t.jsxs)(U.Zp,{className:"relative group shadow-sm hover:shadow-md transition-shadow",children:[(0,t.jsx)(U.aR,{className:"p-3 bg-muted/30",children:(0,t.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[e.airlineLogoUrl?(0,t.jsx)(R.default,{src:e.airlineLogoUrl,alt:e.airline,width:32,height:32,className:"size-8 shrink-0 object-contain"}):(0,t.jsx)("div",{className:"flex items-center justify-center size-8 bg-background rounded-md shrink-0",children:(0,t.jsx)(eA.A,{className:"size-5 text-muted-foreground"})}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(b.E,{variant:"secondary",className:"font-mono text-base",children:e.pnr}),(0,t.jsx)("span",{className:"font-bold",children:e.airline})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-x-4 text-xs font-bold text-muted-foreground",children:[(0,t.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,t.jsx)(eI.A,{className:"h-3 w-3"}),"إصدار: ",e.issueDate]}),(0,t.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,t.jsx)(eA.A,{className:"h-3 w-3"}),"سفر: ",e.travelDate]})]}),(0,t.jsx)(y.$,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",onClick:()=>(e=>{let s=f.find(s=>s.id===e);s&&(w(e=>{let a=new Set(e);return a.delete(s.file.name),a}),g(s=>s.filter(s=>s.id!==e)))})(e.id),children:(0,t.jsx)(N.A,{className:"h-4 w-4"})})]})}),(0,t.jsx)(U.Wu,{className:"p-0",children:(0,t.jsxs)(l.XI,{dir:"rtl",children:[(0,t.jsx)(l.A0,{children:(0,t.jsxs)(l.Hj,{children:[(0,t.jsx)(l.nd,{className:"font-bold text-right",children:"المسافر"}),(0,t.jsx)(l.nd,{className:"font-bold text-right",children:"رقم الجواز"}),(0,t.jsx)(l.nd,{className:"font-bold text-right",children:"رقم التذكرة"}),(0,t.jsx)(l.nd,{className:"font-bold text-right",children:"شراء"}),(0,t.jsx)(l.nd,{className:"font-bold text-right",children:"بيع"}),(0,t.jsx)(l.nd,{className:"font-bold text-right",children:"الربح"}),(0,t.jsx)(l.nd,{className:"font-bold text-right",children:"نوع المسافر"})]})}),(0,t.jsx)(l.BF,{children:e.passengers.map((s,a)=>{let r=(s.salePrice||0)-(s.purchasePrice||0);return(0,t.jsxs)(l.Hj,{children:[(0,t.jsx)(l.nA,{className:"p-2",children:(0,t.jsx)(K.p,{value:s.name,onChange:s=>$(e.id,a,"name",s.target.value),className:"h-8"})}),(0,t.jsx)(l.nA,{className:"p-2",children:(0,t.jsx)(K.p,{value:s.passportNumber,onChange:s=>$(e.id,a,"passportNumber",s.target.value),className:"h-8"})}),(0,t.jsx)(l.nA,{className:"p-2",children:(0,t.jsx)(K.p,{value:s.ticketNumber,onChange:s=>$(e.id,a,"ticketNumber",s.target.value),className:"h-8"})}),(0,t.jsx)(l.nA,{className:"p-2",children:(0,t.jsx)(em.O,{currency:e.financialData.currency,currencyClassName:(0,D.cn)("USD"===e.financialData.currency?"bg-accent text-accent-foreground":"bg-primary text-primary-foreground"),value:s.purchasePrice,onValueChange:s=>$(e.id,a,"purchasePrice",s||0),className:"h-8"})}),(0,t.jsx)(l.nA,{className:"p-2",children:(0,t.jsx)(em.O,{currency:e.financialData.currency,currencyClassName:(0,D.cn)("USD"===e.financialData.currency?"bg-accent text-accent-foreground":"bg-primary text-primary-foreground"),value:s.salePrice,onValueChange:s=>$(e.id,a,"salePrice",s||0),className:"h-8"})}),(0,t.jsx)(l.nA,{className:"p-2",children:(0,t.jsx)("div",{className:(0,D.cn)("font-mono text-center font-bold",r>=0?"text-green-600":"text-destructive"),children:r.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})}),(0,t.jsx)(l.nA,{className:"p-2",children:(0,t.jsxs)(X.l6,{value:s.passengerType,onValueChange:s=>$(e.id,a,"passengerType",s),children:[(0,t.jsx)(X.bq,{className:"h-8 text-xs px-2 font-bold justify-end gap-2",children:(0,t.jsx)(X.yv,{})}),(0,t.jsx)(X.gC,{children:eV.map(e=>{let s=e.icon;return(0,t.jsx)(X.eb,{value:e.value,className:"font-bold justify-end",children:(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,t.jsx)("span",{children:e.label}),(0,t.jsx)(s,{className:"h-4 w-4"})]})},e.value)})})]})})]},"".concat(e.id,"-").concat(a))})})]})}),(0,t.jsx)(U.wL,{className:"p-3 bg-muted/30 border-t",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 w-full",children:[(0,t.jsx)(eu.j,{searchAction:"suppliers",placeholder:"المورد...",value:e.financialData.supplierId,onValueChange:s=>_(e.id,"supplierId",s)}),(0,t.jsx)(eu.j,{searchAction:"clients",placeholder:"العميل...",value:e.financialData.clientId,onValueChange:s=>_(e.id,"clientId",s)}),(0,t.jsxs)(X.l6,{value:e.financialData.currency,onValueChange:s=>_(e.id,"currency",s),children:[(0,t.jsx)(X.bq,{className:"h-9 text-xs px-2 font-bold",children:(0,t.jsx)(X.yv,{})}),(0,t.jsxs)(X.gC,{children:[(0,t.jsx)(X.eb,{value:"USD",className:"font-bold",children:"USD"}),(0,t.jsx)(X.eb,{value:"IQD",className:"font-bold",children:"IQD"})]})]})]})})]},e.id))]})})})]}):(0,t.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,t.jsx)(q.A,{className:"h-8 w-8 animate-spin"})})}),(0,t.jsxs)(ey.Es,{className:"border-t p-2 bg-background shrink-0 flex-row items-center justify-between",children:[(0,t.jsx)("div",{className:"flex-1"}),(0,t.jsxs)("div",{className:"flex-1 flex items-center justify-center gap-4 text-xs text-muted-foreground",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)(eD.A,{className:"h-4 w-4 text-primary"})," ",(0,t.jsxs)("span",{children:["المستخدم: ",(null==P?void 0:P.name)||"..."]})]}),(null==P?void 0:P.boxId)&&(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)(eR.A,{className:"h-4 w-4 text-primary"})," ",(0,t.jsxs)("span",{children:["الصندوق: ",(null==S||null==(a=S.boxes)||null==(s=a.find(e=>e.id===P.boxId))?void 0:s.name)||"غير محدد"]})]})]}),(0,t.jsx)("div",{className:"flex-1 flex justify-end",children:f.length>0&&(0,t.jsxs)(y.$,{size:"lg",disabled:m||u,onClick:H,className:"w-full sm:w-auto font-bold bg-accent text-accent-foreground hover:bg-accent/90",children:[m?(0,t.jsx)(q.A,{className:"me-2 h-4 w-4 animate-spin"}):(0,t.jsx)(ec.A,{className:"me-2 h-4 w-4"}),"حفظ كل الحجوزات المعلقة (",f.length,")"]})})]})]})]})}var eJ=a(20063);let eE=(0,a(14294).A)("TicketCheck",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var eO=a(33173);let eZ=(0,C.createServerReference)("70278708d5cbbc8d6310dcac5ed55f18c8eab7bbdd",C.callServer,void 0,C.findSourceMapURL,"voidBooking"),e$=(0,C.createServerReference)("70cfe727250a23b23d98bdaa484b32a157baabef97",C.callServer,void 0,C.findSourceMapURL,"refundBooking"),e_=(0,C.createServerReference)("7057bd85393d69e4688037e9bf4c49ca196efecf46",C.callServer,void 0,C.findSourceMapURL,"exchangeBooking");var eq=a(73457),eH=a(86259);let eY=e=>{let{passengers:s,selectedPassengers:a,onPassengerSelect:r,currency:n}=e,i=s.length>0&&a.size===s.length,c=a.size>0&&a.size<s.length;return(0,t.jsxs)(U.Zp,{className:"col-span-full",children:[(0,t.jsxs)(U.aR,{className:"pb-3 pt-4",children:[(0,t.jsx)(U.ZB,{className:"text-base",children:"الخطوة 2: تحديد المسافرين"}),(0,t.jsx)(U.BT,{children:"اختر المسافرين الذين تريد تطبيق العملية عليهم."})]}),(0,t.jsx)(U.Wu,{className:"p-0",children:(0,t.jsx)("div",{className:"overflow-auto max-h-60 rounded-md border",children:(0,t.jsxs)(l.XI,{children:[(0,t.jsx)(l.A0,{children:(0,t.jsxs)(l.Hj,{children:[(0,t.jsx)(l.nd,{className:"w-[50px]",children:(0,t.jsx)(eq.S,{checked:i||c,onCheckedChange:e=>{s.forEach(s=>r(s.ticketNumber,e))},"aria-label":"Select all"})}),(0,t.jsx)(l.nd,{children:"الاسم"}),(0,t.jsx)(l.nd,{children:"رقم التذكرة"}),(0,t.jsx)(l.nd,{className:"text-right",children:"سعر الشراء الأصلي"}),(0,t.jsx)(l.nd,{className:"text-right",children:"سعر البيع الأصلي"})]})}),(0,t.jsx)(l.BF,{children:s.map(e=>(0,t.jsxs)(l.Hj,{children:[(0,t.jsx)(l.nA,{children:(0,t.jsx)(eq.S,{checked:a.has(e.ticketNumber),onCheckedChange:s=>r(e.ticketNumber,!!s)})}),(0,t.jsx)(l.nA,{className:"font-semibold",children:e.name}),(0,t.jsx)(l.nA,{className:"font-mono",children:e.ticketNumber}),(0,t.jsxs)(l.nA,{className:"text-right font-mono",children:[e.purchasePrice.toLocaleString()," ",n]}),(0,t.jsxs)(l.nA,{className:"text-right font-mono",children:[e.salePrice.toLocaleString()," ",n]})]},e.id))})]})})})]})},eG=et.Ik({opType:et.k5(["REFUND","REISSUE","VOID"]),pnr:et.Yj().optional(),ticketNumber:et.Yj().min(1,"رقم التذكرة مطلوب"),passengerName:et.Yj().min(1,"اسم المسافر مطلوب"),supplierId:et.Yj().min(1,"المورد مطلوب"),clientId:et.Yj().min(1,"العميل مطلوب"),currency:et.k5(["USD","IQD"]),notes:et.Yj().optional(),airlineFee:et.au.number().default(0),officeFee:et.au.number().default(0),newPnr:et.Yj().optional(),priceDifference:et.au.number().default(0),supplierVoidPenalty:et.au.number().default(0),clientVoidPenalty:et.au.number().default(0)}),eW=e=>{let{onSave:s,isSaving:a}=e,{data:r}=(0,z.Z)(),l=(0,es.mN)({resolver:(0,ea.u)(eG),defaultValues:{opType:"REFUND",currency:"USD"}}),n=l.watch("opType"),i=l.watch("currency");return(0,t.jsx)(ep.lV,{...l,children:(0,t.jsxs)("form",{onSubmit:l.handleSubmit(s),className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,t.jsx)(ep.zB,{control:l.control,name:"opType",render:e=>{let{field:s}=e;return(0,t.jsxs)(ep.eI,{children:[(0,t.jsx)(er.J,{children:"نوع العملية"}),(0,t.jsxs)(X.l6,{onValueChange:s.onChange,value:s.value,children:[(0,t.jsx)(X.bq,{children:(0,t.jsx)(X.yv,{})}),(0,t.jsxs)(X.gC,{children:[(0,t.jsx)(X.eb,{value:"REFUND",children:"استرجاع"}),(0,t.jsx)(X.eb,{value:"REISSUE",children:"تغيير / إعادة إصدار"}),(0,t.jsx)(X.eb,{value:"VOID",children:"فويد / إلغاء"})]})]}),(0,t.jsx)(ep.C5,{})]})}}),(0,t.jsx)(ep.zB,{control:l.control,name:"pnr",render:e=>{let{field:s}=e;return(0,t.jsxs)(ep.eI,{children:[(0,t.jsx)(er.J,{children:"رقم الحجز (PNR)"}),(0,t.jsx)(ep.MJ,{children:(0,t.jsx)(K.p,{...s})}),(0,t.jsx)(ep.C5,{})]})}}),(0,t.jsx)(ep.zB,{control:l.control,name:"ticketNumber",render:e=>{let{field:s}=e;return(0,t.jsxs)(ep.eI,{children:[(0,t.jsx)(er.J,{children:"رقم التذكرة"}),(0,t.jsx)(ep.MJ,{children:(0,t.jsx)(K.p,{...s})}),(0,t.jsx)(ep.C5,{})]})}}),(0,t.jsx)(ep.zB,{control:l.control,name:"passengerName",render:e=>{let{field:s}=e;return(0,t.jsxs)(ep.eI,{children:[(0,t.jsx)(er.J,{children:"اسم المسافر"}),(0,t.jsx)(ep.MJ,{children:(0,t.jsx)(K.p,{...s})}),(0,t.jsx)(ep.C5,{})]})}}),(0,t.jsx)(ep.zB,{control:l.control,name:"supplierId",render:e=>{let{field:s}=e;return(0,t.jsxs)(ep.eI,{children:[(0,t.jsx)(er.J,{children:"المورد"}),(0,t.jsx)(ep.MJ,{children:(0,t.jsx)(eu.j,{searchAction:"suppliers",value:s.value,onValueChange:s.onChange,placeholder:"اختر مورد..."})}),(0,t.jsx)(ep.C5,{})]})}}),(0,t.jsx)(ep.zB,{control:l.control,name:"clientId",render:e=>{let{field:s}=e;return(0,t.jsxs)(ep.eI,{children:[(0,t.jsx)(er.J,{children:"العميل"}),(0,t.jsx)(ep.MJ,{children:(0,t.jsx)(eu.j,{searchAction:"clients",value:s.value,onValueChange:s.onChange,placeholder:"اختر عميل..."})}),(0,t.jsx)(ep.C5,{})]})}}),(0,t.jsx)(ep.zB,{control:l.control,name:"currency",render:e=>{let{field:s}=e;return(0,t.jsxs)(ep.eI,{children:[(0,t.jsx)(er.J,{children:"العملة"}),(0,t.jsxs)(X.l6,{onValueChange:s.onChange,value:s.value,children:[(0,t.jsx)(ep.MJ,{children:(0,t.jsx)(X.bq,{children:(0,t.jsx)(X.yv,{})})}),(0,t.jsxs)(X.gC,{children:[(0,t.jsx)(X.eb,{value:"USD",children:"USD"}),(0,t.jsx)(X.eb,{value:"IQD",children:"IQD"})]})]}),(0,t.jsx)(ep.C5,{})]})}})]}),"VOID"!==n&&(0,t.jsxs)("div",{className:"p-4 border rounded-lg grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)("h3",{className:"md:col-span-2 font-semibold",children:"التفاصيل المالية"}),(0,t.jsx)(ep.zB,{control:l.control,name:"airlineFee",render:e=>{let{field:s}=e;return(0,t.jsxs)(ep.eI,{children:[(0,t.jsx)(er.J,{children:"غرامة شركة الطيران"}),(0,t.jsx)(ep.MJ,{children:(0,t.jsx)(em.O,{currency:i,...s,onValueChange:e=>s.onChange(e||0)})}),(0,t.jsx)(ep.C5,{})]})}}),(0,t.jsx)(ep.zB,{control:l.control,name:"officeFee",render:e=>{let{field:s}=e;return(0,t.jsxs)(ep.eI,{children:[(0,t.jsx)(er.J,{children:"رسوم المكتب"}),(0,t.jsx)(ep.MJ,{children:(0,t.jsx)(em.O,{currency:i,...s,onValueChange:e=>s.onChange(e||0)})}),(0,t.jsx)(ep.C5,{})]})}}),"REISSUE"===n&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ep.zB,{control:l.control,name:"priceDifference",render:e=>{let{field:s}=e;return(0,t.jsxs)(ep.eI,{children:[(0,t.jsx)(er.J,{children:"فرق السعر (ADC)"}),(0,t.jsx)(ep.MJ,{children:(0,t.jsx)(em.O,{currency:i,...s,onValueChange:e=>s.onChange(e||0)})}),(0,t.jsx)(ep.C5,{})]})}}),(0,t.jsx)(ep.zB,{control:l.control,name:"newPnr",render:e=>{let{field:s}=e;return(0,t.jsxs)(ep.eI,{children:[(0,t.jsx)(er.J,{children:"PNR الجديد"}),(0,t.jsx)(ep.MJ,{children:(0,t.jsx)(K.p,{...s})}),(0,t.jsx)(ep.C5,{})]})}})]})]}),"VOID"===n&&(0,t.jsxs)("div",{className:"p-4 border rounded-lg grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)("h3",{className:"md:col-span-2 font-semibold",children:"غرامات الفويد"}),(0,t.jsx)(ep.zB,{control:l.control,name:"supplierVoidPenalty",render:e=>{let{field:s}=e;return(0,t.jsxs)(ep.eI,{children:[(0,t.jsx)(er.J,{children:"غرامة فويد (للمورد)"}),(0,t.jsx)(ep.MJ,{children:(0,t.jsx)(em.O,{currency:i,...s,onValueChange:e=>s.onChange(e||0)})}),(0,t.jsx)(ep.C5,{})]})}}),(0,t.jsx)(ep.zB,{control:l.control,name:"clientVoidPenalty",render:e=>{let{field:s}=e;return(0,t.jsxs)(ep.eI,{children:[(0,t.jsx)(er.J,{children:"غرامة فويد (للعميل)"}),(0,t.jsx)(ep.MJ,{children:(0,t.jsx)(em.O,{currency:i,...s,onValueChange:e=>s.onChange(e||0)})}),(0,t.jsx)(ep.C5,{})]})}})]}),(0,t.jsxs)(y.$,{type:"submit",disabled:a,className:"w-full",children:[a?(0,t.jsx)(q.A,{className:"animate-spin me-2"}):(0,t.jsx)(ec.A,{className:"me-2 h-4 w-4"}),"حفظ العملية"]})]})})};function eQ(e){let{onDataChanged:s}=e,{toast:a}=(0,k.dj)(),[l,n]=(0,r.useState)(!1),[d,o]=(0,r.useState)(""),[u,x]=(0,r.useState)([]),[m,h]=(0,r.useState)(null),[p,j]=(0,r.useState)(new Set),[f,g]=(0,r.useState)("REFUND"),[N,v]=(0,r.useState)(""),[w,C]=(0,r.useState)(!1),[S,A]=(0,r.useState)(!1),[I,D]=(0,r.useState)(""),[R,P]=(0,r.useState)({base:0,tax:0,penalty:0,fees:0,adc:0,residualEmd:0}),[M,L]=(0,r.useState)({supplierPenalty:0,clientPenalty:0}),[F,B]=(0,r.useState)(null),{data:V}=(0,z.Z)(),T=async()=>{if(!d.trim())return;C(!0),x([]),h(null),j(new Set);let e=await (0,eo.x)(d.trim());e&&e.length>0?(x(e),1===e.length&&h(e[0])):a({title:"لم يتم العثور على أي حجز مطابق",variant:"destructive"}),C(!1)},J=async()=>{if(!m)return void a({title:"الرجاء اختيار حجز أولاً",variant:"destructive"});let e=m.currency||"USD",t=m.passengers.filter(e=>p.has(e.ticketNumber));A(!0);try{let r;if("VOID"===f){if(0===p.size)throw Error("الرجاء اختيار مسافر واحد على الأقل.");r=await eZ(m,{passengers:t,...M,notes:N,currency:e},!1)}else{if(0===p.size)throw Error("الرجاء اختيار مسافر واحد على الأقل.");if("REFUND"===f)r=await e$(m,{passengers:t,airlineFee:R.penalty,officeFee:R.fees,notes:N,currency:e},!1);else if("REISSUE"===f)r=await e_(m,{passengers:t,newPnr:I,airlineFee:R.penalty,officeFee:R.fees,priceDifference:R.adc,notes:N,currency:e},!1);else throw Error("نوع عملية غير معروف.")}if(r.success)a({title:"تم تسجيل عملية ".concat(f," بنجاح")}),n(!1),s();else throw Error(r.error)}catch(e){a({title:"خطأ",description:e.message,variant:"destructive"})}A(!1)},E=async e=>{A(!0);try{let t,r={id:"new-".concat(Date.now()),pnr:e.pnr||"",clientId:e.clientId,supplierId:e.supplierId,passengers:[{id:"new-passenger",name:e.passengerName,ticketNumber:e.ticketNumber,purchasePrice:0,salePrice:0,passengerType:"Adult",ticketType:"Issue",passportNumber:""}]},l=r.passengers;if("VOID"===e.opType)t=await eZ(r,{passengers:l,supplierPenalty:e.supplierVoidPenalty,clientPenalty:e.clientVoidPenalty,notes:e.notes||"",currency:e.currency},!0);else if("REFUND"===e.opType)t=await e$(r,{passengers:l,airlineFee:e.airlineFee,officeFee:e.officeFee,notes:e.notes||"",currency:e.currency},!0);else if("REISSUE"===e.opType)t=await e_(r,{passengers:l,newPnr:e.newPnr||"",airlineFee:e.airlineFee,officeFee:e.officeFee,priceDifference:e.priceDifference,notes:e.notes||"",currency:e.currency},!0);else throw Error("نوع عملية غير معروف.");if(t.success)a({title:"تم تسجيل عملية ".concat(e.opType," الخارجية بنجاح")}),n(!1),s();else throw Error(t.error)}catch(e){a({title:"خطأ",description:e.message,variant:"destructive"})}A(!1)};(0,r.useEffect)(()=>{l||(o(""),x([]),h(null),j(new Set),g("REFUND"),v(""),D(""),L({supplierPenalty:0,clientPenalty:0}),B(null))},[l]);let O=(null==m?void 0:m.currency)||"USD",Z=(0,r.useMemo)(()=>{if(!m||0===p.size)return{totalSale:0,totalPurchase:0,totalFees:0,amountToClient:0,amountFromSupplier:0,netClientDebt:0,netSupplierCredit:0};let e=m.passengers.filter(e=>p.has(e.ticketNumber)),s=e.reduce((e,s)=>e+s.salePrice,0),a=e.reduce((e,s)=>e+s.purchasePrice,0);if("VOID"===f){let e=M.clientPenalty-s,t=a-M.supplierPenalty;return{totalSale:s,totalPurchase:a,totalFees:0,amountToClient:0,amountFromSupplier:0,netClientDebt:e,netSupplierCredit:t}}let t=R.penalty+R.fees,r="REFUND"===f?s-t:t+R.adc,l="REFUND"===f?a-R.penalty:0;return{totalSale:s,totalPurchase:a,totalFees:t,amountToClient:r,amountFromSupplier:l,netClientDebt:0,netSupplierCredit:0}},[m,p,R,f,M]);return(0,t.jsxs)(ey.lG,{open:l,onOpenChange:n,children:[(0,t.jsx)(ey.zM,{asChild:!0,children:(0,t.jsxs)(y.$,{variant:"outline",children:[(0,t.jsx)(i.A,{className:"me-2 h-4 w-4"}),"عمليات التذاكر"]})}),(0,t.jsxs)(ey.Cf,{className:"max-w-[1200px] p-0",dir:"rtl",children:[(0,t.jsxs)(ey.c7,{className:"px-4 py-3 bg-primary text-primary-foreground rounded-t-lg flex flex-row items-center justify-between sticky top-0 z-10 border-b",children:[(0,t.jsx)(ey.HM,{asChild:!0,children:(0,t.jsx)(y.$,{variant:"ghost",size:"icon",className:"text-primary-foreground hover:bg-white/20 h-7 w-7 rounded-full",children:(0,t.jsx)(c.A,{className:"h-4 w-4"})})}),(0,t.jsx)(ey.L3,{className:"text-xl font-semibold",children:F?"عمليات التذكرة - Ticket Operations":"اختر نوع العملية"}),(0,t.jsx)("div",{children:F&&(0,t.jsxs)(y.$,{variant:"ghost",size:"sm",onClick:()=>B(null),children:[(0,t.jsx)(eO.A,{className:"me-2 h-4 w-4"}),"العودة"]})})]}),(0,t.jsx)("div",{className:"p-4 space-y-4",children:F?"new"===F?(0,t.jsx)(eW,{onSave:E,isSaving:S}):(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 items-end",children:[(0,t.jsxs)("div",{className:"md:col-span-3",children:[(0,t.jsx)(er.J,{children:"رقم التذكرة أو PNR"}),(0,t.jsx)(K.p,{value:d,onChange:e=>o(e.target.value),onKeyDown:e=>"Enter"===e.key&&T()})]}),(0,t.jsxs)(y.$,{onClick:T,className:"w-full",variant:"secondary",disabled:w,children:[w?(0,t.jsx)(q.A,{className:"w-4 h-4 animate-spin"}):(0,t.jsx)(ee.A,{className:"w-4 h-4 ml-1"}),"بحث"]})]}),u.length>1&&!m&&(0,t.jsxs)(U.Zp,{children:[(0,t.jsxs)(U.aR,{children:[(0,t.jsx)(U.ZB,{className:"text-base",children:"تم العثور على حجوزات متعددة"}),(0,t.jsx)(U.BT,{children:"الرجاء اختيار الحجز الصحيح للمتابعة."})]}),(0,t.jsx)(U.Wu,{className:"space-y-2",children:u.map(e=>{var s,a;return(0,t.jsxs)("div",{className:"p-2 border rounded-md cursor-pointer hover:bg-muted",onClick:()=>h(e),children:[(0,t.jsxs)("p",{className:"font-bold",children:["PNR: ",e.pnr," - Invoice: ",e.invoiceNumber]}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Client: ",null==V||null==(s=V.clients.find(s=>s.id===e.clientId))?void 0:s.name," | Supplier: ",null==V||null==(a=V.suppliers.find(s=>s.id===e.supplierId))?void 0:a.name]})]},e.id)})})]}),m&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(eY,{passengers:m.passengers,selectedPassengers:p,onPassengerSelect:(e,s)=>{j(a=>{let t=new Set(a);return s?t.add(e):t.delete(e),t})},currency:O}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 items-start",children:[(0,t.jsxs)(U.Zp,{children:[(0,t.jsx)(U.aR,{className:"pb-3 pt-4",children:(0,t.jsx)(U.ZB,{className:"text-base",children:"الخطوة 3: تفاصيل العملية"})}),(0,t.jsxs)(U.Wu,{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(er.J,{children:"نوع العملية"}),(0,t.jsxs)(X.l6,{value:f,onValueChange:e=>g(e),children:[(0,t.jsx)(X.bq,{children:(0,t.jsx)(X.yv,{})}),(0,t.jsxs)(X.gC,{children:[(0,t.jsx)(X.eb,{value:"REFUND",children:"استرجاع"}),(0,t.jsx)(X.eb,{value:"REISSUE",children:"تغيير / إعادة إصدار"}),(0,t.jsx)(X.eb,{value:"VOID",children:"فويد / إلغاء"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(er.J,{children:"العملة"}),(0,t.jsx)(K.p,{value:O,readOnly:!0,disabled:!0})]})]}),"VOID"===f?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(er.J,{children:"غرامة فويد (للمورد)"}),(0,t.jsx)(em.O,{currency:O,value:M.supplierPenalty,onValueChange:e=>L(s=>({...s,supplierPenalty:e||0}))})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(er.J,{children:"غرامة فويد (للعميل)"}),(0,t.jsx)(em.O,{currency:O,value:M.clientPenalty,onValueChange:e=>L(s=>({...s,clientPenalty:e||0}))})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(er.J,{children:"غرامة شركة الطيران"}),(0,t.jsx)(em.O,{currency:O,value:R.penalty,onValueChange:e=>P({...R,penalty:e||0})})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(er.J,{children:"رسوم المكتب"}),(0,t.jsx)(em.O,{currency:O,value:R.fees,onValueChange:e=>P({...R,fees:e||0})})]})]}),"REISSUE"===f&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(er.J,{children:"فرق السعر (ADC)"}),(0,t.jsx)(em.O,{currency:O,value:R.adc,onValueChange:e=>P({...R,adc:e||0})})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(er.J,{children:"PNR الجديد"}),(0,t.jsx)(K.p,{value:I,onChange:e=>D(e.target.value)})]})]})]})]}),(0,t.jsxs)(U.Zp,{children:[(0,t.jsx)(U.aR,{className:"pb-3 pt-4",children:(0,t.jsx)(U.ZB,{className:"text-base",children:"ملخص العملية"})}),(0,t.jsxs)(U.Wu,{className:"space-y-3 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"الحجز المحدد:"}),(0,t.jsx)(b.E,{variant:"secondary",children:m.pnr})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"المسافرون المختارون:"}),(0,t.jsx)(b.E,{children:p.size})]}),(0,t.jsx)(eH.Separator,{}),"VOID"===f?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center font-semibold",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"إجمالي مبيع التذكرة:"}),(0,t.jsxs)("span",{className:"font-mono",children:[Z.totalSale.toLocaleString()," ",O]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center font-semibold text-red-600",children:[(0,t.jsx)("span",{children:"غرامة العميل:"}),(0,t.jsxs)("span",{className:"font-mono",children:[M.clientPenalty.toLocaleString()," ",O]})]}),(0,t.jsx)(eH.Separator,{}),(0,t.jsxs)("div",{className:"flex justify-between items-center font-bold text-lg text-blue-600",children:[(0,t.jsx)("span",{children:"صافي الدين على العميل:"}),(0,t.jsxs)("span",{className:"font-mono",children:[Z.netClientDebt.toLocaleString()," ",O]})]}),(0,t.jsx)(eH.Separator,{}),(0,t.jsxs)("div",{className:"flex justify-between items-center font-semibold",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"إجمالي شراء التذكرة:"}),(0,t.jsxs)("span",{className:"font-mono",children:[Z.totalPurchase.toLocaleString()," ",O]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center font-semibold text-red-600",children:[(0,t.jsx)("span",{children:"غرامة المورد:"}),(0,t.jsxs)("span",{className:"font-mono",children:[M.supplierPenalty.toLocaleString()," ",O]})]}),(0,t.jsx)(eH.Separator,{}),(0,t.jsxs)("div",{className:"flex justify-between items-center font-bold text-lg text-green-600",children:[(0,t.jsx)("span",{children:"المستحق من المورد:"}),(0,t.jsxs)("span",{className:"font-mono",children:[Z.netSupplierCredit.toLocaleString()," ",O]})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center font-semibold",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"إجمالي مبيع التذاكر المختارة:"}),(0,t.jsxs)("span",{className:"font-mono",children:[Z.totalSale.toLocaleString()," ",O]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center font-semibold",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"إجمالي رسوم الإلغاء/التغيير:"}),(0,t.jsxs)("span",{className:"font-mono",children:[Z.totalFees.toLocaleString()," ",O]})]}),"REISSUE"===f&&(0,t.jsxs)("div",{className:"flex justify-between items-center font-semibold",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"فرق السعر (ADC):"}),(0,t.jsxs)("span",{className:"font-mono",children:[R.adc.toLocaleString()," ",O]})]}),(0,t.jsx)(eH.Separator,{}),(0,t.jsxs)("div",{className:"flex justify-between items-center font-bold text-lg text-blue-600",children:[(0,t.jsx)("span",{children:"المبلغ المستحق للعميل:"}),(0,t.jsxs)("span",{className:"font-mono",children:[Z.amountToClient.toLocaleString()," ",O]})]}),"REFUND"===f&&(0,t.jsxs)("div",{className:"flex justify-between items-center font-bold text-lg text-green-600",children:[(0,t.jsx)("span",{children:"المبلغ المستحق من المورد:"}),(0,t.jsxs)("span",{className:"font-mono",children:[Z.amountFromSupplier.toLocaleString()," ",O]})]})]})]}),(0,t.jsx)(U.wL,{children:(0,t.jsxs)(y.$,{onClick:J,disabled:S||0===p.size,className:"w-full h-12 text-md",children:[S?(0,t.jsx)(q.A,{className:"animate-spin"}):(0,t.jsx)(ec.A,{className:"ml-2"}),"حفظ العملية"]})})]})]})]})]}):(0,t.jsxs)("div",{className:"text-center p-8 space-y-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"هل العملية لتذكرة موجودة مسبقًا في النظام أم عملية خارجية؟"}),(0,t.jsxs)("div",{className:"flex justify-center gap-4",children:[(0,t.jsxs)(y.$,{size:"lg",onClick:()=>B("existing"),className:"gap-2",children:[(0,t.jsx)(eE,{className:"h-5 w-5"}),"تذكرة موجودة"]}),(0,t.jsxs)(y.$,{size:"lg",onClick:()=>B("new"),variant:"secondary",className:"gap-2",children:[(0,t.jsx)(H.A,{className:"h-5 w-5"}),"عملية خارجية جديدة"]})]})]})})]})]})}function eK(e){let{initialData:s,totalBookings:a}=e,l=(0,eJ.useRouter)(),[n,i]=r.useState(s),[c,d]=r.useState(!1),{data:o,loaded:u}=(0,z.Z)(),[x,m]=r.useState(""),h=(0,eb.d)(x,300),[p,j]=r.useState({searchField:"all",currencyFilter:"all"}),[f,g]=r.useState(p),N=e=>{i((0,Q.jM)(s=>{s.unshift(e)}))};r.useEffect(()=>{i(s)},[s]);let v=r.useMemo(()=>o?n.filter(e=>{var s,a;if("all"!==f.currencyFilter&&e.currency!==f.currencyFilter)return!1;let t=(null==(s=o.suppliers.find(s=>s.id===e.supplierId))?void 0:s.name)||"",r=(null==(a=o.clients.find(s=>s.id===e.clientId))?void 0:a.name)||"";if("all"!==f.searchField){let s=h.toLowerCase();if(!s)return!0;switch(f.searchField){case"pnr":return(e.pnr||"").toLowerCase().includes(s);case"passenger":return e.passengers.some(e=>(e.name||"").toLowerCase().includes(s));case"ticket":return e.passengers.some(e=>(e.ticketNumber||"").toLowerCase().includes(s));case"supplier":return t.toLowerCase().includes(s);case"client":return r.toLowerCase().includes(s)}}if(h&&"all"===f.searchField){let s=h.toLowerCase();return(e.pnr||"").toLowerCase().includes(s)||(e.route||"").toLowerCase().includes(s)||t.toLowerCase().includes(s)||r.toLowerCase().includes(s)||e.passengers.some(e=>(e.name||"").toLowerCase().includes(s)||(e.ticketNumber||"").toLowerCase().includes(s))}return!0}):[],[h,n,o,f]);return u&&o?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex w-full sm:w-auto items-center gap-2",children:[(0,t.jsx)(I.A,{onBookingAdded:N,children:(0,t.jsxs)(y.$,{children:[(0,t.jsx)(H.A,{className:"me-2 h-4 w-4"})," إضافة حجز جديد"]})}),(0,t.jsx)(eQ,{onDataChanged:()=>{l.refresh()}}),(0,t.jsxs)(w.rI,{children:[(0,t.jsx)(w.ty,{asChild:!0,children:(0,t.jsxs)(y.$,{variant:"outline",children:["إضافة سريعة ",(0,t.jsx)(Y.A,{className:"ms-2 h-4 w-4"})]})}),(0,t.jsxs)(w.SQ,{children:[(0,t.jsx)(w._2,{onSelect:()=>d(e=>!e),children:"إدخال يدوي سريع"}),(0,t.jsx)(eT,{onMultipleBookingsAdded:e=>{l.refresh()},children:(0,t.jsxs)(w._2,{onSelect:e=>e.preventDefault(),children:[(0,t.jsx)(G.A,{className:"me-2 h-4 w-4"}),"الإدخال الذكي (PDF)"]})})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 w-full flex-wrap sm:w-auto sm:flex-nowrap justify-end",children:[(0,t.jsxs)("div",{className:"relative w-full sm:w-64",children:[(0,t.jsx)(ee.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(K.p,{placeholder:"بحث...",className:"ps-10",value:x,onChange:e=>m(e.target.value)})]}),(0,t.jsxs)(X.l6,{value:p.searchField,onValueChange:e=>j(s=>({...s,searchField:e})),children:[(0,t.jsx)(X.bq,{className:"w-full sm:w-[140px]",children:(0,t.jsx)(X.yv,{})}),(0,t.jsxs)(X.gC,{children:[(0,t.jsx)(X.eb,{value:"all",children:"بحث عام"}),(0,t.jsx)(X.eb,{value:"pnr",children:"PNR"}),(0,t.jsx)(X.eb,{value:"passenger",children:"اسم المسافر"}),(0,t.jsx)(X.eb,{value:"ticket",children:"رقم التذكرة"}),(0,t.jsx)(X.eb,{value:"supplier",children:"المورد"}),(0,t.jsx)(X.eb,{value:"client",children:"العميل"})]})]}),(0,t.jsxs)(X.l6,{value:p.currencyFilter,onValueChange:e=>j(s=>({...s,currencyFilter:e})),children:[(0,t.jsx)(X.bq,{className:"w-full sm:w-[120px]",children:(0,t.jsx)(X.yv,{})}),(0,t.jsxs)(X.gC,{children:[(0,t.jsx)(X.eb,{value:"all",children:"كل العملات"}),(0,t.jsx)(X.eb,{value:"USD",children:"USD"}),(0,t.jsx)(X.eb,{value:"IQD",children:"IQD"})]})]}),(0,t.jsxs)(y.$,{onClick:()=>{g(p)},className:"w-full sm:w-auto",children:[(0,t.jsx)(W.A,{className:"me-2 h-4 w-4"}),"تطبيق"]})]})]}),c&&(0,t.jsx)(ev,{onBookingAdded:e=>{N(e),d(!1)},onCancel:()=>d(!1)}),(0,t.jsx)(U.Zp,{children:(0,t.jsx)(U.Wu,{className:"p-0",children:(0,t.jsx)(_,{bookings:v,totalBookings:a,onBookingUpdated:e=>{i((0,Q.jM)(s=>{let a=s.findIndex(s=>s.id===e.id);-1!==a&&(s[a]=e)}))},onBookingDeleted:e=>{i((0,Q.jM)(s=>s.filter(s=>s.id!==e)))}})})})]}):(0,t.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,t.jsx)(q.A,{className:"h-8 w-8 animate-spin"})})}},11186:(e,s,a)=>{"use strict";a.d(s,{bq:()=>x,eb:()=>j,gC:()=>p,l6:()=>o,yv:()=>u});var t=a(95155),r=a(12115),l=a(47887),n=a(59007),i=a(42614),c=a(72251),d=a(64269);let o=l.bL;l.YJ;let u=l.WT,x=r.forwardRef((e,s)=>{let{className:a,children:r,...i}=e;return(0,t.jsxs)(l.l9,{ref:s,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...i,children:[r,(0,t.jsx)(l.In,{asChild:!0,children:(0,t.jsx)(n.A,{className:"h-4 w-4 opacity-50"})})]})});x.displayName=l.l9.displayName;let m=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(l.PP,{ref:s,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,t.jsx)(i.A,{className:"h-4 w-4"})})});m.displayName=l.PP.displayName;let h=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(l.wn,{ref:s,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,t.jsx)(n.A,{className:"h-4 w-4"})})});h.displayName=l.wn.displayName;let p=r.forwardRef((e,s)=>{let{className:a,children:r,position:n="popper",...i}=e;return(0,t.jsx)(l.ZL,{children:(0,t.jsxs)(l.UC,{ref:s,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:n,...i,children:[(0,t.jsx)(m,{}),(0,t.jsx)(l.LM,{className:(0,d.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,t.jsx)(h,{})]})})});p.displayName=l.UC.displayName,r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(l.JU,{ref:s,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...r})}).displayName=l.JU.displayName;let j=r.forwardRef((e,s)=>{let{className:a,children:r,...n}=e;return(0,t.jsxs)(l.q7,{ref:s,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...n,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(l.VF,{children:(0,t.jsx)(c.A,{className:"h-4 w-4"})})}),(0,t.jsx)(l.p4,{children:r})]})});j.displayName=l.q7.displayName,r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(l.wv,{ref:s,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",a),...r})}).displayName=l.wv.displayName},11647:(e,s,a)=>{"use strict";a.d(s,{E:()=>i});var t=a(95155);a(12115);var r=a(83101),l=a(64269);let n=(0,r.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:s,variant:a,...r}=e;return(0,t.jsx)("span",{className:(0,l.cn)(n({variant:a}),s),...r})}},12941:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(14294).A)("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]])},17037:(e,s,a)=>{"use strict";a.d(s,{$:()=>c,F:()=>i});var t=a(95155),r=a(12115),l=a(59034),n=a(64269);let i=r.forwardRef((e,s)=>{let{className:a,children:r,...i}=e;return(0,t.jsxs)(l.bL,{ref:s,className:(0,n.cn)("relative overflow-hidden",a),...i,children:[(0,t.jsx)(l.LM,{className:"h-full w-full rounded-[inherit]",children:r}),(0,t.jsx)(c,{}),(0,t.jsx)(l.OK,{})]})});i.displayName=l.bL.displayName;let c=r.forwardRef((e,s)=>{let{className:a,orientation:r="vertical",...i}=e;return(0,t.jsx)(l.VM,{ref:s,orientation:r,className:(0,n.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...i,children:(0,t.jsx)(l.lr,{className:"relative flex-1 rounded-full bg-border"})})});c.displayName=l.VM.displayName},17878:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(14294).A)("ChevronsRight",[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]])},23639:(e,s,a)=>{"use strict";a.d(s,{j:()=>k});var t=a(95155),r=a(12115),l=a(30848),n=a(92033),i=a(72251),c=a(33173),d=a(36204),o=a(64269),u=a(3998),x=a(41808),m=a(90109);a(51834);let h=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(x.uB,{ref:s,className:(0,o.cn)("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",a),...r})});h.displayName=x.uB.displayName;let p=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsxs)("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[(0,t.jsx)(m.A,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),(0,t.jsx)(x.uB.Input,{ref:s,className:(0,o.cn)("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",a),...r})]})});p.displayName=x.uB.Input.displayName;let j=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(x.uB.List,{ref:s,className:(0,o.cn)("max-h-[300px] overflow-y-auto overflow-x-hidden",a),...r})});j.displayName=x.uB.List.displayName;let f=r.forwardRef((e,s)=>(0,t.jsx)(x.uB.Empty,{ref:s,className:"py-6 text-center text-sm",...e}));f.displayName=x.uB.Empty.displayName;let g=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(x.uB.Group,{ref:s,className:(0,o.cn)("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",a),...r})});g.displayName=x.uB.Group.displayName,r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(x.uB.Separator,{ref:s,className:(0,o.cn)("-mx-1 my-1 h-px bg-border",a),...r})}).displayName=x.uB.Separator.displayName;let N=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(x.uB.Item,{ref:s,className:(0,o.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none aria-selected:bg-primary aria-selected:text-primary-foreground data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50",a),...r})});N.displayName=x.uB.Item.displayName;var v=a(26333),b=a(50732),y=a(30926);y.callServer,y.findSourceMapURL;var w=a(5470),C=a(11647);let S=e=>{let{children:s}=e;return(0,t.jsx)("div",{className:"py-1 px-2 text-xs text-center text-muted-foreground bg-muted/50 border-t",children:s})};function k(e){let{searchAction:s,options:a,value:x,onValueChange:m,placeholder:y,disabled:k=!1,includeInactive:A=!1}=e,[I,D]=r.useState(!1),[R,P]=r.useState(""),[M,z]=r.useState(!1);(0,b.d)(R,400);let[L,F]=r.useState(0),{data:U,loaded:B}=(0,w.Z)(),V=r.useMemo(()=>{if(a)return a;if(!B)return[];let e=e=>"".concat(e.name).concat(e.code?" (".concat(e.code,")"):""),t=[];if(B)switch(s){case"clients":t=(U.clients||[]).filter(e=>"client"===e.relationType||"both"===e.relationType).map(s=>({value:s.id,label:e(s),relationType:s.relationType,paymentType:s.paymentType}));break;case"suppliers":t=(U.suppliers||[]).filter(e=>"supplier"===e.relationType||"both"===e.relationType).map(s=>({value:s.id,label:e(s),relationType:s.relationType,paymentType:s.paymentType}));break;case"users":t=(U.users||[]).map(e=>({value:e.uid,label:e.name,email:e.email}));break;case"boxes":t=(U.boxes||[]).map(e=>({value:e.id,label:e.name}));break;default:t=[...(U.clients||[]).map(s=>({value:s.id,label:e(s),relationType:s.relationType,paymentType:s.paymentType})),...(U.suppliers||[]).map(s=>({value:s.id,label:e(s),relationType:s.relationType,paymentType:s.paymentType})),...(U.boxes||[]).map(e=>({value:e.id,label:"صندوق: ".concat(e.name)}))]}return t.sort((e,s)=>(s.useCount||0)-(e.useCount||0))},[a,U,B,s]),T=r.useMemo(()=>V.find(e=>(null==e?void 0:e.value)===x),[V,x]),J=e=>{let s=E.find(s=>s.value.toLowerCase()===e.toLowerCase());m(s?s.value:""),P(""),D(!1)},E=r.useMemo(()=>{if(!R)return F(0),V;let e=R.toLowerCase(),s=V.filter(s=>s.label.toLowerCase().includes(e)||s.arabicName&&s.arabicName.toLowerCase().includes(e)||s.city&&s.city.toLowerCase().includes(e)||s.email&&s.email.toLowerCase().includes(e));return F(0),s},[V,R]),O=r.useMemo(()=>{let e=10*L;return E.slice(e,e+10)},[E,L,10]),Z=Math.ceil(E.length/10),$=null==a?void 0:a.some(e=>e.country&&e.city);return(0,t.jsxs)(v.AM,{open:I,onOpenChange:D,children:[(0,t.jsx)(v.Wv,{asChild:!0,children:(0,t.jsxs)(u.$,{variant:"outline",role:"combobox","aria-expanded":I,className:"w-full justify-between h-8",disabled:k,children:[(0,t.jsx)("span",{className:(0,o.cn)("truncate",!T&&"text-muted-foreground"),children:T?$?T.value:T.label:y||"Select..."}),(0,t.jsx)(l.A,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,t.jsx)(v.hl,{className:"min-w-[var(--radix-popover-trigger-width)] w-auto p-0",children:(0,t.jsxs)(h,{shouldFilter:!1,children:[(0,t.jsx)(p,{placeholder:y||"بحث...",value:R,onValueChange:P}),(0,t.jsxs)(j,{children:[M&&(0,t.jsx)("div",{className:"p-2 flex justify-center",children:(0,t.jsx)(n.A,{className:"h-5 w-5 animate-spin"})}),!M&&0===O.length&&(0,t.jsx)(f,{children:"لا توجد نتائج."}),(0,t.jsx)(g,{children:O.map((e,s)=>(0,t.jsx)(N,{value:e.value,onSelect:J,className:(0,o.cn)("flex justify-between items-center",$?"p-2":""),children:$?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex-grow text-right",children:[(0,t.jsx)("p",{className:"font-bold text-sm",children:e.arabicName||e.city}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:e.arabicCountry||e.country})]}),(0,t.jsx)(C.E,{variant:"secondary",className:"font-mono text-sm px-2 py-1 ml-3",children:e.value})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(i.A,{className:(0,o.cn)("mr-2 h-4 w-4",x===e.value?"opacity-100":"opacity-0")}),(0,t.jsx)("span",{children:e.label})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[e.paymentType&&(0,t.jsx)(C.E,{variant:"outline",children:(e=>{switch(e){case"cash":return"نقدي";case"credit":return"آجل";default:return""}})(e.paymentType)}),e.relationType&&(0,t.jsx)(C.E,{variant:"secondary",children:(e=>{switch(e){case"client":return"عميل";case"supplier":return"مورد";case"both":return"عميل ومورد";default:return""}})(e.relationType)})]})]})},"".concat(e.value,"-").concat(s)))})]}),E.length>10&&(0,t.jsx)(S,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between px-2",children:[(0,t.jsx)(u.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>F(e=>Math.max(0,e-1)),disabled:0===L,children:(0,t.jsx)(c.A,{className:"h-4 w-4"})}),(0,t.jsxs)("span",{children:["صفحة ",L+1," من ",Z]}),(0,t.jsx)(u.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>F(e=>Math.min(Z-1,e+1)),disabled:L>=Z-1,children:(0,t.jsx)(d.A,{className:"h-4 w-4"})})]})})]})})]})}},26193:(e,s,a)=>{Promise.resolve().then(a.bind(a,10634))},26333:(e,s,a)=>{"use strict";a.d(s,{AM:()=>i,Wv:()=>c,hl:()=>d});var t=a(95155),r=a(12115),l=a(82286),n=a(64269);let i=l.bL,c=l.l9,d=r.forwardRef((e,s)=>{let{className:a,align:r="center",sideOffset:i=4,...c}=e;return(0,t.jsx)(l.ZL,{children:(0,t.jsx)(l.UC,{ref:s,align:r,sideOffset:i,className:(0,n.cn)("z-[9999] w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...c})})});d.displayName=l.UC.displayName},27063:(e,s,a)=>{"use strict";a.d(s,{CG:()=>o,Fm:()=>p,Qs:()=>f,cj:()=>d,h:()=>h,qp:()=>j});var t=a(95155),r=a(12115),l=a(89511),n=a(83101),i=a(26615),c=a(64269);let d=l.bL,o=l.l9;l.bm;let u=l.ZL,x=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(l.hJ,{className:(0,c.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r,ref:s})});x.displayName=l.hJ.displayName;let m=(0,n.F)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),h=r.forwardRef((e,s)=>{let{side:a="right",className:r,children:n,...d}=e;return(0,t.jsxs)(u,{children:[(0,t.jsx)(x,{}),(0,t.jsxs)(l.UC,{ref:s,className:(0,c.cn)(m({side:a}),r),...d,children:[n,(0,t.jsxs)(l.bm,{className:"absolute left-4 top-4 rounded-full p-1.5 opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary bg-muted hover:bg-muted/80",children:[(0,t.jsx)(i.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});h.displayName=l.UC.displayName;let p=e=>{let{className:s,...a}=e;return(0,t.jsx)("div",{className:(0,c.cn)("flex flex-col space-y-2 text-center sm:text-right",s),...a})};p.displayName="SheetHeader";let j=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(l.hE,{ref:s,className:(0,c.cn)("text-lg font-semibold text-foreground",a),...r})});j.displayName=l.hE.displayName;let f=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(l.VY,{ref:s,className:(0,c.cn)("text-sm text-muted-foreground",a),...r})});f.displayName=l.VY.displayName},35656:(e,s,a)=>{"use strict";a.d(s,{l:()=>r});var t=a(30926);let r=(0,t.createServerReference)("40290c8e8678ea3c7dc08bc14a2b21bf84ced558a3",t.callServer,void 0,t.findSourceMapURL,"getUsers")},39285:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(14294).A)("ChevronsLeft",[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]])},40671:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(14294).A)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},41165:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(14294).A)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]])},50732:(e,s,a)=>{"use strict";a.d(s,{d:()=>r});var t=a(12115);function r(e,s){let[a,r]=(0,t.useState)(e);return(0,t.useEffect)(()=>{let a=setTimeout(()=>{r(e)},s);return()=>{clearTimeout(a)}},[e,s]),a}},51181:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(14294).A)("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]])},51834:(e,s,a)=>{"use strict";a.d(s,{Cf:()=>m,Es:()=>p,HM:()=>u,L3:()=>j,c7:()=>h,lG:()=>c,rr:()=>f,zM:()=>d});var t=a(95155),r=a(12115),l=a(89511),n=a(26615),i=a(64269);let c=l.bL,d=l.l9,o=l.ZL,u=l.bm,x=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(l.hJ,{ref:s,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r})});x.displayName=l.hJ.displayName;let m=r.forwardRef((e,s)=>{let{className:a,children:r,showCloseButton:c=!0,...d}=e;return(0,t.jsxs)(o,{children:[(0,t.jsx)(x,{}),(0,t.jsxs)(l.UC,{ref:s,className:(0,i.cn)("fixed left-1/2 top-1/2 z-50 grid w-full max-w-lg -translate-x-1/2 -translate-y-1/2 gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),onOpenAutoFocus:e=>e.preventDefault(),...d,children:[r,c&&(0,t.jsxs)(l.bm,{className:"absolute left-4 top-4 rounded-full p-1.5 opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground bg-muted hover:bg-muted/80",children:[(0,t.jsx)(n.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=l.UC.displayName;let h=e=>{let{className:s,...a}=e;return(0,t.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-right",s),...a})};h.displayName="DialogHeader";let p=e=>{let{className:s,...a}=e;return(0,t.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 rtl:space-x-reverse",s),...a})};p.displayName="DialogFooter";let j=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(l.hE,{ref:s,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",a),...r})});j.displayName=l.hE.displayName;let f=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(l.VY,{ref:s,className:(0,i.cn)("text-sm text-muted-foreground",a),...r})});f.displayName=l.VY.displayName},52240:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(14294).A)("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]])},53774:(e,s,a)=>{"use strict";a.d(s,{T:()=>x});var t=a(95155),r=a(17878),l=a(63263),n=a(51190),i=a(39285),c=a(64269),d=a(3998),o=a(11186),u=a(20063);function x(e){let{table:s,className:a,totalRows:x}=e,m=(0,u.useRouter)(),h=(0,u.usePathname)(),p=(0,u.useSearchParams)(),j=void 0!==x,f=s.getState().pagination.pageIndex,g=s.getState().pagination.pageSize,N=j?Math.ceil(x/g):s.getPageCount(),v=j?f>0:s.getCanPreviousPage();j||s.getCanNextPage();let b=j?e=>{let s=new URLSearchParams(p.toString());s.set("page",(e+1).toString()),m.push("".concat(h,"?").concat(s.toString()))}:s.setPageIndex;return(0,t.jsxs)("div",{className:(0,c.cn)("flex flex-col-reverse items-center justify-between gap-4 sm:flex-row sm:gap-6 lg:gap-8",a),children:[(0,t.jsxs)("div",{className:"flex-1 text-sm text-muted-foreground",children:[s.getFilteredSelectedRowModel().rows.length," من"," ",j?x:s.getFilteredRowModel().rows.length," صفوف مختارة."]}),(0,t.jsxs)("div",{className:"flex flex-col-reverse items-center gap-4 sm:flex-row sm:gap-6 lg:gap-8",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 space-x-reverse",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:"صفوف لكل صفحة"}),(0,t.jsxs)(o.l6,{value:"".concat(g),onValueChange:e=>{var a;a=Number(e),j?(e=>{let s=new URLSearchParams(p.toString());s.set("limit",e.toString()),s.set("page","1"),m.push("".concat(h,"?").concat(s.toString()))})(a):s.setPageSize(a)},children:[(0,t.jsx)(o.bq,{className:"h-8 w-[70px]",children:(0,t.jsx)(o.yv,{placeholder:g})}),(0,t.jsx)(o.gC,{side:"top",children:[5,10,15,20,30,50].map(e=>(0,t.jsx)(o.eb,{value:"".concat(e),children:e},e))})]})]}),(0,t.jsxs)("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium",children:["صفحة ",f+1," من"," ",N]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 space-x-reverse",children:[(0,t.jsxs)(d.$,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>b(0),disabled:!v,children:[(0,t.jsx)("span",{className:"sr-only",children:"Go to first page"}),(0,t.jsx)(r.A,{className:"h-4 w-4"})]}),(0,t.jsxs)(d.$,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>s.previousPage(),disabled:!s.getCanPreviousPage(),children:[(0,t.jsx)("span",{className:"sr-only",children:"Go to previous page"}),(0,t.jsx)(l.A,{className:"h-4 w-4"})]}),(0,t.jsxs)(d.$,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>s.nextPage(),disabled:!s.getCanNextPage(),children:[(0,t.jsx)("span",{className:"sr-only",children:"Go to next page"}),(0,t.jsx)(n.A,{className:"h-4 w-4"})]}),(0,t.jsxs)(d.$,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>s.setPageIndex(s.getPageCount()-1),disabled:!s.getCanNextPage(),children:[(0,t.jsx)("span",{className:"sr-only",children:"Go to last page"}),(0,t.jsx)(i.A,{className:"h-4 w-4"})]})]})]})]})}},60805:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(14294).A)("WandSparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]])},65142:(e,s,a)=>{"use strict";a.d(s,{p:()=>n});var t=a(95155),r=a(12115),l=a(64269);let n=r.forwardRef((e,s)=>{let{className:a,type:r,...n}=e;return(0,t.jsx)("input",{type:r,className:(0,l.cn)("flex h-10 w-full rounded-lg border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:s,...n})});n.displayName="Input"},73457:(e,s,a)=>{"use strict";a.d(s,{S:()=>c});var t=a(95155),r=a(12115),l=a(38162),n=a(72251),i=a(64269);let c=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(l.bL,{ref:s,className:(0,i.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...r,children:(0,t.jsx)(l.C1,{className:(0,i.cn)("flex items-center justify-center text-current"),children:(0,t.jsx)(n.A,{className:"h-4 w-4"})})})});c.displayName=l.bL.displayName},75660:(e,s,a)=>{"use strict";a.d(s,{r:()=>r});var t=a(30926);let r=(0,t.createServerReference)("7fff34be9ad53d22bcedbe289fd19cffbcbb61a920",t.callServer,void 0,t.findSourceMapURL,"getExchanges")},76444:(e,s,a)=>{"use strict";a.d(s,{J:()=>d});var t=a(95155),r=a(12115),l=a(10489),n=a(83101),i=a(64269);let c=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(l.b,{ref:s,className:(0,i.cn)(c(),a),...r})});d.displayName=l.b.displayName},80187:(e,s,a)=>{"use strict";a.d(s,{c:()=>r});var t=a(30926);let r=(0,t.createServerReference)("7f085acd10c7b589563e59e7e18d605a9cf6eb6b56",t.callServer,void 0,t.findSourceMapURL,"getBoxes")},80991:(e,s,a)=>{"use strict";a.d(s,{k:()=>i});var t=a(95155),r=a(12115),l=a(9484),n=a(64269);let i=r.forwardRef((e,s)=>{let{className:a,value:r,...i}=e;return(0,t.jsx)(l.bL,{ref:s,className:(0,n.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",a),style:{zIndex:9999},...i,children:(0,t.jsx)(l.C1,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(r||0),"%)")}})})});i.displayName=l.bL.displayName},83011:(e,s,a)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"useMergedRef",{enumerable:!0,get:function(){return r}});let t=a(12115);function r(e,s){let a=(0,t.useRef)(null),r=(0,t.useRef)(null);return(0,t.useCallback)(t=>{if(null===t){let e=a.current;e&&(a.current=null,e());let s=r.current;s&&(r.current=null,s())}else e&&(a.current=l(e,t)),s&&(r.current=l(s,t))},[e,s])}function l(e,s){if("function"!=typeof e)return e.current=s,()=>{e.current=null};{let a=e(s);return"function"==typeof a?a:()=>e(null)}}("function"==typeof s.default||"object"==typeof s.default&&null!==s.default)&&void 0===s.default.__esModule&&(Object.defineProperty(s.default,"__esModule",{value:!0}),Object.assign(s.default,s),e.exports=s.default)},86948:(e,s,a)=>{"use strict";a.d(s,{BT:()=>d,Wu:()=>o,ZB:()=>c,Zp:()=>n,aR:()=>i,wL:()=>u});var t=a(95155),r=a(12115),l=a(64269);let n=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)("div",{ref:s,className:(0,l.cn)("rounded-xl border bg-card text-card-foreground shadow-sm",a),...r})});n.displayName="Card";let i=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)("div",{ref:s,className:(0,l.cn)("flex flex-col space-y-1.5 p-4 sm:p-6 text-right",a),...r})});i.displayName="CardHeader";let c=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)("h3",{ref:s,className:(0,l.cn)("text-lg sm:text-xl font-bold leading-none tracking-tight",a),...r})});c.displayName="CardTitle";let d=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)("p",{ref:s,className:(0,l.cn)("text-sm text-muted-foreground",a),...r})});d.displayName="CardDescription";let o=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)("div",{ref:s,className:(0,l.cn)("p-4 sm:p-6 pt-0",a),...r})});o.displayName="CardContent";let u=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)("div",{ref:s,className:(0,l.cn)("flex items-center p-4 sm:p-6 pt-0",a),...r})});u.displayName="CardFooter"},96133:(e,s,a)=>{"use strict";a.d(s,{m:()=>r});var t=a(30926);let r=(0,t.createServerReference)("7fe3cedf8b5b39f6ca6561f08402f1ad7a82ecff97",t.callServer,void 0,t.findSourceMapURL,"getSettings")},97766:(e,s,a)=>{"use strict";a.d(s,{T:()=>r});var t=a(30926);let r=(0,t.createServerReference)("601532f3b7a46dae258a5ff32f14fb4b3e2e141e9f",t.callServer,void 0,t.findSourceMapURL,"updateUser")},97776:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(14294).A)("CloudUpload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]])}},e=>{e.O(0,[9135,7210,4909,9625,315,5111,4127,9967,1374,783,4223,8994,43,84,13,2612,5672,563,1636,5239,7116,9034,9100,4762,8579,8441,1255,7358],()=>e(e.s=26193)),_N_E=e.O()}]);