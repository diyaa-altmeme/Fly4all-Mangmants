(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3907],{2546:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});let c=(0,s(14294).A)("SquareUser",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 21v-2a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2",key:"1m6ac2"}]])},10193:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});let c=(0,s(14294).A)("Baby",[["path",{d:"M9 12h.01",key:"157uk2"}],["path",{d:"M15 12h.01",key:"1k8ypt"}],["path",{d:"M10 16c.5.3 1.2.5 2 .5s1.5-.2 2-.5",key:"1u7htd"}],["path",{d:"M19 6.3a9 9 0 0 1 1.8 3.9 2 2 0 0 1 0 3.6 9 9 0 0 1-17.6 0 2 2 0 0 1 0-3.6A9 9 0 0 1 12 3c2 0 3.5 1.1 3.5 2.5s-.9 2.5-2 2.5c-.8 0-1.5-.4-1.5-1",key:"5yv0yz"}]])},20146:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});let c=(0,s(14294).A)("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]])},25677:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>E});var c=s(95155),a=s(12115),l=s(14223),r=s(64269),i=s(3998),n=s(74640),d=s(13630),h=s(87270),x=s(35040),o=s(4731),y=s(12052),p=s(15894),u=s(98053);let m=(e,t)=>{if(0===e)return"0.00";let s=new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(Math.abs(e));return e<0?"(".concat(s,")"):s},j=e=>{let{transaction:t,onActionComplete:s}=e,{toast:a}=(0,p.dj)(),h=async()=>{let e=await (0,y.Q)(t.id);e.success?(a({title:"تم حذف السند بنجاح"}),s()):a({title:"خطأ",description:e.error,variant:"destructive"})};return(0,c.jsxs)("tr",{className:(0,r.cn)("text-center font-bold",t.credit>0?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20"),children:[(0,c.jsx)("td",{className:"p-2 whitespace-nowrap font-mono",children:(0,l.GP)(new Date(t.date),"yyyy-MM-dd")}),(0,c.jsx)("td",{className:"p-2",children:t.type}),(0,c.jsx)("td",{className:"p-2 text-xs font-normal text-right",children:"string"==typeof t.description?t.description:t.description.title}),(0,c.jsx)("td",{className:"p-2 font-mono text-red-600",children:t.debit>0?m(t.debit,t.currency||"IQD"):"-"}),(0,c.jsx)("td",{className:"p-2 font-mono text-green-600",children:t.credit>0?m(t.credit,t.currency||"IQD"):"-"}),(0,c.jsx)("td",{className:"p-2 font-mono",children:m(t.balance,t.currency||"IQD")}),(0,c.jsx)("td",{className:"p-2",children:t.currency}),(0,c.jsx)("td",{className:"p-2",children:t.officer||""}),(0,c.jsx)("td",{className:"p-2",children:(0,c.jsxs)("div",{className:"flex items-center justify-center gap-1",children:[(0,c.jsx)(o.A,{voucherId:t.id,onVoucherUpdated:s,children:(0,c.jsx)(i.$,{size:"icon",variant:"ghost",className:"h-7 w-7 text-blue-600",children:(0,c.jsx)(n.A,{className:"h-4 w-4"})})}),(0,c.jsxs)(u.Lt,{children:[(0,c.jsx)(u.tv,{asChild:!0,children:(0,c.jsx)(i.$,{size:"icon",variant:"ghost",className:"h-7 w-7 text-destructive",children:(0,c.jsx)(d.A,{className:"h-4 w-4"})})}),(0,c.jsxs)(u.EO,{children:[(0,c.jsxs)(u.wd,{children:[(0,c.jsx)(u.r7,{children:"هل أنت متأكد؟"}),(0,c.jsx)(u.$v,{children:"سيتم حذف هذا السند بشكل دائم."})]}),(0,c.jsxs)(u.ck,{children:[(0,c.jsx)(u.Zr,{children:"إلغاء"}),(0,c.jsx)(u.Rx,{onClick:h,className:(0,r.cn)((0,i.r)({variant:"destructive"})),children:"نعم، احذف"})]})]})]})]})})]})};function v(e){let{report:t,shareR:s=50,shareM:l=50,onActionComplete:r=()=>{}}=e;if(!t)return(0,c.jsx)("div",{className:"p-8 text-center text-muted-foreground",children:"الرجاء اختيار حساب وتحديد فترة لعرض التقرير."});let{transactions:i}=t,{totalCredit:n,totalDebit:d,net:o,rShare:y,mShare:p}=(0,a.useMemo)(()=>{let e=i.reduce((e,t)=>e+t.credit,0),t=i.reduce((e,t)=>e+t.debit,0),c=e-t,a=s/100*c,r=l/100*c;return{totalCredit:e,totalDebit:t,net:c,rShare:a,mShare:r}},[i,s,l]);return(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsx)(x.A,{report:t}),(0,c.jsx)("div",{className:"overflow-auto rounded border max-h-[60vh]",children:(0,c.jsxs)(h.XI,{children:[(0,c.jsx)("thead",{className:"bg-muted sticky top-0",children:(0,c.jsxs)("tr",{className:"text-right font-bold",children:[(0,c.jsx)("th",{className:"p-2",children:"التاريخ"}),(0,c.jsx)("th",{className:"p-2",children:"النوع"}),(0,c.jsx)("th",{className:"p-2",children:"البيان"}),(0,c.jsx)("th",{className:"p-2 text-center",children:"مدين"}),(0,c.jsx)("th",{className:"p-2 text-center",children:"دائن"}),(0,c.jsx)("th",{className:"p-2 text-center",children:"الرصيد"}),(0,c.jsx)("th",{className:"p-2 text-center",children:"العملة"}),(0,c.jsx)("th",{className:"p-2 text-center",children:"الموظف"}),(0,c.jsx)("th",{className:"p-2 text-center",children:"إجراءات"})]})}),(0,c.jsx)("tbody",{children:0===i.length?(0,c.jsx)("tr",{children:(0,c.jsx)("td",{className:"p-3 text-center",colSpan:10,children:"لا توجد بيانات ضمن النطاق المحدد."})}):i.map(e=>(0,c.jsx)(j,{transaction:e,onActionComplete:r},e.id))}),(0,c.jsx)("tfoot",{className:"bg-muted/50 font-bold sticky bottom-0",children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{className:"p-2",colSpan:3,children:"إجمالي الحركات"}),(0,c.jsx)("td",{className:"p-2 font-mono text-red-600 text-center",children:m(t.totalDebitUSD,"USD")}),(0,c.jsx)("td",{className:"p-2 font-mono text-green-600 text-center",children:m(t.totalCreditUSD,"USD")}),(0,c.jsx)("td",{className:"p-2",colSpan:4})]})})]})})]})}var k=s(86948),g=s(65142),N=s(76444),f=s(11186),b=s(86259),A=s(92033),w=s(53489),M=s(23451),S=s(28984),D=s(50898),C=s(5273),R=s(5470),U=s(20063),_=s(23639),q=s(63192);function E(){var e;let{user:t}=(0,M.A)(),{toast:s}=(0,p.dj)(),r=(0,U.useRouter)(),[n,d]=(0,a.useState)(50),[h,x]=(0,a.useState)(50),[o,y]=(0,a.useState)(15e3),[u,m]=(0,a.useState)((0,l.GP)(new Date,"yyyy-MM-01")),[j,E]=(0,a.useState)((0,l.GP)(new Date,"yyyy-MM-dd")),[z,B]=(0,a.useState)(""),[H,I]=(0,a.useState)(""),[P,V]=(0,a.useState)("all"),[Z,J]=(0,a.useState)(null),[L,$]=(0,a.useState)(!1),{data:F,loaded:G,fetchData:O}=(0,R.Z)();(0,a.useEffect)(()=>{G||O()},[G,O]);let Q=async()=>{if(!z)return void s({title:"الرجاء اختيار حساب",variant:"destructive"});$(!0),J(null);try{let e=await (0,q.h)({accountId:z,currency:"both",dateRange:{from:new Date(u),to:new Date(j)},typeFilter:"all"===P?[]:[P]});J(e)}catch(e){s({title:"خطأ في جلب التقرير",description:e.message,variant:"destructive"})}finally{$(!1)}},T=(0,a.useMemo)(()=>F?[...(F.clients||[]).map(e=>({value:e.id,label:"عميل: ".concat(e.name)})),...(F.suppliers||[]).map(e=>({value:e.id,label:"مورد: ".concat(e.name)})),...(F.boxes||[]).map(e=>({value:e.id,label:"صندوق: ".concat(e.name)})),...(F.exchanges||[]).map(e=>({value:e.id,label:"بورصة: ".concat(e.name)}))]:[],[F]),W=async()=>{r.refresh(),await O(!0)},X=(0,a.useMemo)(()=>F?[...F.clients||[],...F.suppliers||[]]:[],[F]);return G?(0,c.jsxs)("div",{className:"p-4 space-y-4",children:[(0,c.jsxs)(k.Zp,{children:[(0,c.jsxs)(k.aR,{children:[(0,c.jsx)(k.ZB,{children:"العمليات المالية الشاملة"}),(0,c.jsx)(k.BT,{children:"إدارة كل العمليات المالية والتقارير من واجهة واحدة متقدمة."})]}),(0,c.jsxs)(k.Wu,{children:[(0,c.jsxs)("div",{className:"flex flex-wrap gap-2 items-center justify-between",children:[(0,c.jsxs)("div",{className:"flex gap-2",children:[(0,c.jsx)(S.A,{clients:(null==F?void 0:F.clients)||[],suppliers:(null==F?void 0:F.suppliers)||[],onSuccess:W}),(0,c.jsx)(D.A,{onSubscriptionAdded:W}),(0,c.jsx)(C.A,{partners:X,onSuccess:W})]}),(0,c.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,c.jsx)(_.j,{options:T,value:z,onValueChange:B,placeholder:"\uD83D\uDD0D ابحث عن شركة أو علاقة...",className:"min-w-[220px]"}),(0,c.jsxs)(i.$,{onClick:Q,disabled:L,children:[L?(0,c.jsx)(A.A,{className:"animate-spin me-2"}):null,"عرض كشف الحساب"]})]})]}),(0,c.jsx)(b.Separator,{className:"my-4"}),(0,c.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3 items-end",children:[(0,c.jsxs)("div",{className:"space-y-1",children:[(0,c.jsx)(N.J,{children:"من"}),(0,c.jsx)(g.p,{type:"date",value:u,onChange:e=>m(e.target.value)})]}),(0,c.jsxs)("div",{className:"space-y-1",children:[(0,c.jsx)(N.J,{children:"إلى"}),(0,c.jsx)(g.p,{type:"date",value:j,onChange:e=>E(e.target.value)})]}),(0,c.jsxs)("div",{className:"space-y-1",children:[(0,c.jsx)(N.J,{children:"فلتر التصنيف"}),(0,c.jsxs)(f.l6,{value:P,onValueChange:e=>V(e),children:[(0,c.jsx)(f.bq,{children:(0,c.jsx)(f.yv,{})}),(0,c.jsxs)(f.gC,{children:[(0,c.jsx)(f.eb,{value:"all",children:"الكل"}),(0,c.jsx)(f.eb,{value:"segment",children:"سكمنت"}),(0,c.jsx)(f.eb,{value:"subscription",children:"اشتراك"}),(0,c.jsx)(f.eb,{value:"profit",children:"أرباح"}),(0,c.jsx)(f.eb,{value:"share",children:"توزيع حصص"})]})]})]}),(0,c.jsxs)("div",{className:"space-y-1",children:[(0,c.jsx)(N.J,{children:"نسبة الروضتين %"}),(0,c.jsx)(g.p,{type:"number",value:n,onChange:e=>d(Number(e.target.value))})]}),(0,c.jsxs)("div",{className:"space-y-1",children:[(0,c.jsx)(N.J,{children:"نسبة متّين %"}),(0,c.jsx)(g.p,{type:"number",value:h,onChange:e=>x(Number(e.target.value))})]}),(0,c.jsx)("div",{className:"flex items-end justify-end",children:(0,c.jsxs)(i.$,{onClick:()=>{if(!(null==Z?void 0:Z.transactions)||0===Z.transactions.length)return void s({title:"لا توجد بيانات للتصدير",variant:"destructive"});let e=new Blob([["التاريخ,النوع,البيان,مدين,دائن,الرصيد,العملة,الموظف",...Z.transactions.map(e=>[(0,l.GP)(new Date(e.date),"yyyy-MM-dd"),e.type,"string"==typeof e.description?e.description:e.description.title,e.debit,e.credit,e.balance,e.currency,e.officer||""].map(e=>'"'.concat(String(e).replace(/"/g,'""'),'"'))).map(e=>e.join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download="report_".concat(z,"_").concat(u,"_").concat(j,".csv"),t.click()},variant:"outline",className:"gap-2 w-full",children:[(0,c.jsx)(w.A,{className:"h-4 w-4"})," تصدير CSV"]})})]})]})]}),(0,c.jsxs)(k.Zp,{children:[(0,c.jsxs)(k.aR,{children:[(0,c.jsx)(k.ZB,{children:"كشف الحساب الموحد"}),Z&&(0,c.jsxs)(k.BT,{children:["عرض مباشر وتحليل مالي شامل لـ: ",(0,c.jsx)("b",{children:null==(e=T.find(e=>e.value===z))?void 0:e.label})]})]}),(0,c.jsx)(k.Wu,{children:L?(0,c.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,c.jsx)(A.A,{className:"animate-spin h-8 w-8 text-primary"})}):(0,c.jsx)(v,{report:Z,shareR:n,shareM:h})})]})]}):(0,c.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,c.jsx)(A.A,{className:"h-8 w-8 animate-spin"})})}},28263:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});let c=(0,s(14294).A)("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]])},32810:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});let c=(0,s(14294).A)("Route",[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]])},44381:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});let c=(0,s(14294).A)("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]])},46450:(e,t,s)=>{Promise.resolve().then(s.bind(s,25677))},50705:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});let c=(0,s(14294).A)("Landmark",[["line",{x1:"3",x2:"21",y1:"22",y2:"22",key:"j8o0r"}],["line",{x1:"6",x2:"6",y1:"18",y2:"11",key:"10tf0k"}],["line",{x1:"10",x2:"10",y1:"18",y2:"11",key:"54lgf6"}],["line",{x1:"14",x2:"14",y1:"18",y2:"11",key:"380y"}],["line",{x1:"18",x2:"18",y1:"18",y2:"11",key:"1kevvc"}],["polygon",{points:"12 2 20 7 4 7",key:"jkujk7"}]])},53489:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});let c=(0,s(14294).A)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},56639:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});let c=(0,s(14294).A)("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]])},76140:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});let c=(0,s(14294).A)("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]])},76251:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});let c=(0,s(14294).A)("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]])},82863:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});let c=(0,s(14294).A)("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]])},88964:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});let c=(0,s(14294).A)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])},94374:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});let c=(0,s(14294).A)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]])},94972:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});let c=(0,s(14294).A)("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]])},98039:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});let c=(0,s(14294).A)("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]])},98211:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});let c=(0,s(14294).A)("UserRound",[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]])}},e=>{e.O(0,[9135,7210,4909,9625,315,5111,4127,9967,1374,783,4223,8994,2619,43,84,13,2612,5672,7116,877,4762,2500,2312,8579,898,6779,1424,3935,9710,8441,1255,7358],()=>e(e.s=46450)),_N_E=e.O()}]);