(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8063],{17037:(e,s,a)=>{"use strict";a.d(s,{$:()=>c,F:()=>i});var r=a(95155),t=a(12115),l=a(59034),n=a(64269);let i=t.forwardRef((e,s)=>{let{className:a,children:t,...i}=e;return(0,r.jsxs)(l.bL,{ref:s,className:(0,n.cn)("relative overflow-hidden",a),...i,children:[(0,r.jsx)(l.LM,{className:"h-full w-full rounded-[inherit]",children:t}),(0,r.jsx)(c,{}),(0,r.jsx)(l.OK,{})]})});i.displayName=l.bL.displayName;let c=t.forwardRef((e,s)=>{let{className:a,orientation:t="vertical",...i}=e;return(0,r.jsx)(l.VM,{ref:s,orientation:t,className:(0,n.cn)("flex touch-none select-none transition-colors","vertical"===t&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===t&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...i,children:(0,r.jsx)(l.lr,{className:"relative flex-1 rounded-full bg-border"})})});c.displayName=l.VM.displayName},18332:(e,s,a)=>{"use strict";a.d(s,{Fc:()=>c,TN:()=>o,XL:()=>d});var r=a(95155),t=a(12115),l=a(83101),n=a(64269);let i=(0,l.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),c=t.forwardRef((e,s)=>{let{className:a,variant:t,...l}=e;return(0,r.jsx)("div",{ref:s,role:"alert",className:(0,n.cn)(i({variant:t}),a),...l})});c.displayName="Alert";let d=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("h5",{ref:s,className:(0,n.cn)("mb-1 font-medium leading-none tracking-tight",a),...t})});d.displayName="AlertTitle";let o=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("text-sm [&_p]:leading-relaxed",a),...t})});o.displayName="AlertDescription"},18413:(e,s,a)=>{"use strict";a.d(s,{A:()=>o});var r=a(95155),t=a(12115),l=a(3998),n=a(51834),i=a(74640),c=a(93685),d=a(19056);function o(e){let{booking:s,onBookingUpdated:a}=e,[o,u]=(0,t.useState)(!1),x={...s,submissionDate:s.submissionDate?(0,d.H)(s.submissionDate):new Date};return(0,r.jsxs)(n.lG,{open:o,onOpenChange:u,children:[(0,r.jsx)(n.zM,{asChild:!0,children:(0,r.jsx)(l.$,{variant:"ghost",size:"icon",className:"text-blue-600 h-8 w-8",children:(0,r.jsx)(i.A,{className:"h-4 w-4"})})}),(0,r.jsxs)(n.Cf,{className:"sm:max-w-4xl p-0",children:[(0,r.jsxs)(n.c7,{className:"bg-primary text-primary-foreground p-4 rounded-t-lg",children:[(0,r.jsxs)(n.L3,{children:["تعديل طلب الفيزا (الفاتورة: ",s.invoiceNumber,")"]}),(0,r.jsx)(n.rr,{className:"text-primary-foreground/80",children:"قم بتحديث تفاصيل الطلب هنا."})]}),(0,r.jsx)("div",{className:"max-h-[80vh] overflow-y-auto p-6",children:(0,r.jsx)(c.A,{isEditing:!0,initialData:x,onBookingUpdated:e=>{a(e),u(!1)}})})]})]})}},19940:(e,s,a)=>{"use strict";a.d(s,{A:()=>u});var r=a(95155),t=a(12115),l=a(3998),n=a(51834),i=a(22452),c=a(93685),d=a(5470),o=a(92033);function u(e){let{onBookingAdded:s}=e,[a,u]=(0,t.useState)(!1),{data:x,loaded:m}=(0,d.Z)();return(0,r.jsxs)(n.lG,{open:a,onOpenChange:u,children:[(0,r.jsx)(n.zM,{asChild:!0,children:(0,r.jsxs)(l.$,{children:[(0,r.jsx)(i.A,{className:"me-2 h-4 w-4"})," إضافة طلب فيزا"]})}),(0,r.jsxs)(n.Cf,{className:"sm:max-w-4xl p-0",children:[(0,r.jsxs)(n.c7,{className:"bg-primary text-primary-foreground p-4 rounded-t-lg",children:[(0,r.jsx)(n.L3,{children:"إضافة طلب فيزا جديد"}),(0,r.jsx)(n.rr,{className:"text-primary-foreground/80",children:"أدخل جميع تفاصيل طلب الفيزا هنا."})]}),(0,r.jsx)("div",{className:"max-h-[80vh] overflow-y-auto p-6",children:m?(0,r.jsx)(c.A,{onBookingAdded:e=>{s(e),u(!1)}}):(0,r.jsx)("div",{className:"flex justify-center items-center h-48",children:(0,r.jsx)(o.A,{className:"animate-spin h-8 w-8"})})})]})]})}},20243:(e,s,a)=>{"use strict";a.d(s,{E:()=>l});var r=a(95155),t=a(64269);function l(e){let{className:s,...a}=e;return(0,r.jsx)("div",{className:(0,t.cn)("animate-pulse rounded-md bg-muted",s),...a})}},24458:(e,s,a)=>{Promise.resolve().then(a.bind(a,93641))},27432:(e,s,a)=>{"use strict";a.d(s,{K:()=>x});var r=a(95155);a(12115);var t=a(14223),l=a(28127),n=a(64269),i=a(3998),c=a(50276),d=a(26333),o=a(65142);function u(e){let{date:s,setDate:a}=e,t=s?"".concat(String(s.getHours()).padStart(2,"0"),":").concat(String(s.getMinutes()).padStart(2,"0")):"";return(0,r.jsx)(o.p,{type:"time",value:t,onChange:e=>{let r=e.target.value;if(!r||!s)return;let[t,l]=r.split(":").map(Number),n=new Date(s);n.setHours(t),n.setMinutes(l),a(n)},className:"text-center"})}function x(e){let{date:s,setDate:a}=e;return(0,r.jsxs)(d.AM,{children:[(0,r.jsx)(d.Wv,{asChild:!0,children:(0,r.jsxs)(i.$,{variant:"outline",className:(0,n.cn)("w-full justify-start text-left font-normal",!s&&"text-muted-foreground"),children:[(0,r.jsx)(l.A,{className:"mr-2 h-4 w-4"}),s?(0,t.GP)(s,"yyyy-MM-dd hh:mm a"):(0,r.jsx)("span",{children:"اختر تاريخ ووقت"})]})}),(0,r.jsxs)(d.hl,{className:"w-auto p-0",children:[(0,r.jsx)(c.V,{mode:"single",selected:s,onSelect:e=>{if(!e)return void a(void 0);let r=new Date(e);s&&(r.setHours(s.getHours()),r.setMinutes(s.getMinutes()),r.setSeconds(s.getSeconds())),a(r)},initialFocus:!0}),(0,r.jsx)("div",{className:"p-3 border-t border-border",children:(0,r.jsx)(u,{date:s,setDate:a})})]})]})}},31120:(e,s,a)=>{"use strict";a.d(s,{T:()=>n});var r=a(95155),t=a(12115),l=a(64269);let n=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:s,...t})});n.displayName="Textarea"},50276:(e,s,a)=>{"use strict";a.d(s,{V:()=>u});var r=a(95155);a(12115);var t=a(51190),l=a(63263),n=a(66984),i=a(76422),c=a(64269),d=a(3998),o=a(14223);function u(e){let{className:s,classNames:a,showOutsideDays:u=!0,...x}=e;return(0,r.jsx)(n.hv,{showOutsideDays:u,className:(0,c.cn)("p-3",s),locale:i.ar,formatters:{formatCaption:(e,s)=>{var a;let{year:r,month:t}=(0,n.cq)(),l=e.getFullYear(),i=e.getMonth(),c=null!=(a=null==r?void 0:r.getFullYear())?a:l,d=(0,o.GP)(new Date(c,i),"MMMM",{locale:null==s?void 0:s.locale});return"".concat(d," ").concat(c)}},classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,c.cn)((0,d.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected])]:bg-accent/50 first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,c.cn)((0,d.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"text-muted-foreground opacity-50",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{...s}=e;return(0,r.jsx)(t.A,{className:"h-4 w-4"})},IconRight:e=>{let{...s}=e;return(0,r.jsx)(l.A,{className:"h-4 w-4"})}},...x})}u.displayName="Calendar"},80991:(e,s,a)=>{"use strict";a.d(s,{k:()=>i});var r=a(95155),t=a(12115),l=a(9484),n=a(64269);let i=t.forwardRef((e,s)=>{let{className:a,value:t,...i}=e;return(0,r.jsx)(l.bL,{ref:s,className:(0,n.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",a),style:{zIndex:9999},...i,children:(0,r.jsx)(l.C1,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(t||0),"%)")}})})});i.displayName=l.bL.displayName},86948:(e,s,a)=>{"use strict";a.d(s,{BT:()=>d,Wu:()=>o,ZB:()=>c,Zp:()=>n,aR:()=>i,wL:()=>u});var r=a(95155),t=a(12115),l=a(64269);let n=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("div",{ref:s,className:(0,l.cn)("rounded-xl border bg-card text-card-foreground shadow-sm",a),...t})});n.displayName="Card";let i=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("div",{ref:s,className:(0,l.cn)("flex flex-col space-y-1.5 p-4 sm:p-6 text-right",a),...t})});i.displayName="CardHeader";let c=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("h3",{ref:s,className:(0,l.cn)("text-lg sm:text-xl font-bold leading-none tracking-tight",a),...t})});c.displayName="CardTitle";let d=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("p",{ref:s,className:(0,l.cn)("text-sm text-muted-foreground",a),...t})});d.displayName="CardDescription";let o=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("div",{ref:s,className:(0,l.cn)("p-4 sm:p-6 pt-0",a),...t})});o.displayName="CardContent";let u=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("div",{ref:s,className:(0,l.cn)("flex items-center p-4 sm:p-6 pt-0",a),...t})});u.displayName="CardFooter"},87270:(e,s,a)=>{"use strict";a.d(s,{A0:()=>i,BF:()=>c,Gg:()=>d,Hj:()=>o,XI:()=>n,nA:()=>x,nd:()=>u});var r=a(95155),t=a(12115),l=a(64269);let n=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("div",{className:"relative w-full overflow-auto",children:(0,r.jsx)("table",{ref:s,className:(0,l.cn)("w-full caption-bottom text-sm",a),...t})})});n.displayName="Table";let i=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("thead",{ref:s,className:(0,l.cn)("[&_tr]:border-b",a),...t})});i.displayName="TableHeader";let c=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("tbody",{ref:s,className:(0,l.cn)("[&_tr:last-child]:border-0",a),...t})});c.displayName="TableBody";let d=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("tfoot",{ref:s,className:(0,l.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...t})});d.displayName="TableFooter";let o=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("tr",{ref:s,className:(0,l.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...t})});o.displayName="TableRow";let u=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("th",{ref:s,className:(0,l.cn)("h-12 px-4 text-right align-middle font-bold text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...t})});u.displayName="TableHead";let x=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("td",{ref:s,className:(0,l.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...t})});x.displayName="TableCell",t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("caption",{ref:s,className:(0,l.cn)("mt-4 text-sm text-muted-foreground",a),...t})}).displayName="TableCaption"},93641:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>ei});var r=a(95155),t=a(12115),l=a(86948),n=a(7545),i=a(30926);let c=(0,i.createServerReference)("40274c0e2d9380168c8904f238346316bf9eb85c5d",i.callServer,void 0,i.findSourceMapURL,"getVisaBookings");var d=a(18332),o=a(20243),u=a(87270),x=a(59007),m=a(13630),p=a(3998),h=a(15894),j=a(98053),f=a(64269);let g=(0,i.createServerReference)("404ea7d8eef7c5fae0a7015cbd83317df47c440b3b",i.callServer,void 0,i.findSourceMapURL,"softDeleteVisaBooking");var v=a(18413);let N=e=>{var s,a;let{booking:l,suppliers:n,clients:i,onBookingUpdated:c,onBookingDeleted:d}=e,[o,N]=(0,t.useState)(!1),{toast:b}=(0,h.dj)(),y=async()=>{let e=await g(l.id);e.success?(b({title:"تم نقل الطلب إلى سجل المحذوفات"}),d(l.id)):b({title:"خطأ",description:e.error,variant:"destructive"})},w=(null==(s=n.find(e=>e.id===l.supplierId))?void 0:s.name)||"غير محدد",I=(null==(a=i.find(e=>e.id===l.clientId))?void 0:a.name)||"غير محدد",C=l.passengers.reduce((e,s)=>e+s.purchasePrice,0),A=l.passengers.reduce((e,s)=>e+s.salePrice,0),S=A-C;return(0,r.jsxs)(t.Fragment,{children:[(0,r.jsxs)(u.Hj,{children:[(0,r.jsx)(u.nA,{children:(0,r.jsx)(p.$,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>N(!o),children:(0,r.jsx)(x.A,{className:(0,f.cn)("h-4 w-4 transition-transform",o&&"rotate-180")})})}),(0,r.jsx)(u.nA,{className:"font-medium text-center whitespace-nowrap",children:l.invoiceNumber}),(0,r.jsx)(u.nA,{className:"text-center whitespace-nowrap",children:w}),(0,r.jsx)(u.nA,{className:"text-center whitespace-nowrap",children:I}),(0,r.jsxs)(u.nA,{className:"font-mono text-center whitespace-nowrap",children:[C.toLocaleString()," ",l.currency]}),(0,r.jsxs)(u.nA,{className:"font-mono text-center whitespace-nowrap",children:[A.toLocaleString()," ",l.currency]}),(0,r.jsxs)(u.nA,{className:(0,f.cn)("font-mono text-center font-bold whitespace-nowrap",S>=0?"text-green-600":"text-red-600"),children:[S.toLocaleString()," ",l.currency]}),(0,r.jsxs)(u.nA,{className:"text-center space-x-1 rtl:space-x-reverse whitespace-nowrap",children:[(0,r.jsx)(v.A,{booking:l,onBookingUpdated:c}),(0,r.jsxs)(j.Lt,{children:[(0,r.jsx)(j.tv,{asChild:!0,children:(0,r.jsx)(p.$,{variant:"ghost",size:"icon",className:"text-destructive h-8 w-8",children:(0,r.jsx)(m.A,{className:"h-4 w-4"})})}),(0,r.jsxs)(j.EO,{children:[(0,r.jsxs)(j.wd,{children:[(0,r.jsx)(j.r7,{children:"هل أنت متأكد؟"}),(0,r.jsx)(j.$v,{children:"هذا الإجراء سينقل الطلب إلى سجل المحذوفات. يمكنك استعادته لاحقًا."})]}),(0,r.jsxs)(j.ck,{children:[(0,r.jsx)(j.Zr,{children:"إلغاء"}),(0,r.jsx)(j.Rx,{onClick:()=>y(l.id),variant:"destructive",children:"نعم، احذف"})]})]})]})]})]}),o&&(0,r.jsx)(u.Hj,{children:(0,r.jsx)(u.nA,{colSpan:8,className:"p-0",children:(0,r.jsxs)("div",{className:"p-4 bg-muted/50",children:[(0,r.jsx)("h4",{className:"font-bold mb-2",children:"تفاصيل المسافرين:"}),(0,r.jsxs)(u.XI,{children:[(0,r.jsx)(u.A0,{children:(0,r.jsxs)(u.Hj,{children:[(0,r.jsx)(u.nd,{children:"الاسم"}),(0,r.jsx)(u.nd,{children:"رقم الجواز"}),(0,r.jsx)(u.nd,{children:"نوع الفيزا"}),(0,r.jsx)(u.nd,{className:"text-right",children:"شراء"}),(0,r.jsx)(u.nd,{className:"text-right",children:"بيع"}),(0,r.jsx)(u.nd,{className:"text-right",children:"ربح"})]})}),(0,r.jsx)(u.BF,{children:l.passengers.map(e=>(0,r.jsxs)(u.Hj,{children:[(0,r.jsx)(u.nA,{children:e.name}),(0,r.jsx)(u.nA,{children:e.passportNumber}),(0,r.jsx)(u.nA,{children:e.visaType}),(0,r.jsx)(u.nA,{className:"text-right",children:e.purchasePrice.toLocaleString()}),(0,r.jsx)(u.nA,{className:"text-right",children:e.salePrice.toLocaleString()}),(0,r.jsx)(u.nA,{className:(0,f.cn)("text-right font-bold",e.salePrice-e.purchasePrice>=0?"text-green-600":"text-red-600"),children:(e.salePrice-e.purchasePrice).toLocaleString()})]},e.id))})]})]})})})]})};function b(e){let{bookings:s,clients:a,suppliers:t,boxes:l,onBookingDeleted:n,onBookingUpdated:i}=e;return(0,r.jsx)("div",{className:"border rounded-lg overflow-x-auto",children:(0,r.jsxs)(u.XI,{children:[(0,r.jsx)(u.A0,{children:(0,r.jsxs)(u.Hj,{children:[(0,r.jsx)(u.nd,{className:"w-[50px]"}),(0,r.jsx)(u.nd,{className:"text-center font-bold",children:"رقم الفاتورة"}),(0,r.jsx)(u.nd,{className:"text-center font-bold",children:"الجهة المصدرة"}),(0,r.jsx)(u.nd,{className:"text-center font-bold",children:"الجهة المستفيدة"}),(0,r.jsx)(u.nd,{className:"text-center font-bold",children:"إجمالي الشراء"}),(0,r.jsx)(u.nd,{className:"text-center font-bold",children:"إجمالي البيع"}),(0,r.jsx)(u.nd,{className:"text-center font-bold",children:"الربح"}),(0,r.jsx)(u.nd,{className:"text-center font-bold",children:"الإجراءات"})]})}),(0,r.jsx)(u.BF,{children:0===s.length?(0,r.jsx)(u.Hj,{children:(0,r.jsx)(u.nA,{colSpan:8,className:"h-24 text-center",children:"لا توجد سجلات لعرضها."})}):s.map(e=>(0,r.jsx)(N,{booking:e,suppliers:t,clients:a,onBookingUpdated:i,onBookingDeleted:n},e.id))})]})})}var y=a(22452),w=a(60805),I=a(59915),C=a(23107),A=a(19940),S=a(60013),D=a(65142),k=a(11186),R=a(90109),L=a(50732),F=a(52619),M=a.n(F),V=a(20063),B=a(5470),P=a(51834),U=a(26615),T=a(56639),$=a(76140),z=a(92033),_=a(97776),O=a(93169),E=a(27314),H=a(94972),Y=a(73180),J=a(11636);let Z=(0,i.createServerReference)("40d6d1ef497e31912306b58c3358994aab72657361",i.callServer,void 0,i.findSourceMapURL,"addMultipleVisaBookings"),Q=(0,i.createServerReference)("4073a04ae05b3fc45b819a9dc999d3e8d89e42d692",i.callServer,void 0,i.findSourceMapURL,"extractVisaData");var q=a(76444),X=a(23639),G=a(17037),W=a(80991),K=a(97916),ee=a(26333),es=a(23451),ea=a(11647);let er="smartVisaDialogSettings";function et(e){var s,a;let{onMultipleBookingsAdded:n,children:i}=e,[c,d]=(0,t.useState)(!1),[o,x]=(0,t.useState)(!1),[g,v]=(0,t.useState)(!1),[N,b]=(0,t.useState)(0),[y,I]=(0,t.useState)([]),{toast:C}=(0,h.dj)(),{data:A,loaded:R}=(0,B.Z)(),{user:L}=(0,es.A)(),[F,M]=(0,t.useState)({supplierId:"",clientId:"",currency:"USD"}),[V,et]=(0,t.useState)({width:"1400px",height:"90vh"}),[el,en]=(0,t.useState)(!1);(0,t.useEffect)(()=>{try{let e=localStorage.getItem(er);e&&et(JSON.parse(e))}catch(e){console.error("Failed to parse dialog settings from localStorage",e)}},[]);let ei=(0,t.useCallback)(async e=>{x(!0),b(0);let s=e.length,a=0,r=e=>new Promise((r,t)=>{let l=new FileReader;l.readAsDataURL(e),l.onload=async()=>{try{let s=l.result,a=await Q({fileDataUri:s});I(s=>[...s,{...a,id:"visa-".concat(Date.now(),"-").concat(Math.random()),financialData:{supplierId:F.supplierId||"",clientId:F.clientId||"",currency:F.currency||"USD"},passengers:a.passengers.map(e=>({...e,purchasePrice:0,salePrice:0,passportNumber:e.passportNumber||""})),file:e}]),r()}catch(s){console.error("Error processing file ".concat(e.name,":"),s),C({title:"خطأ في تحليل ملف: ".concat(e.name),description:s.message||"لم يتمكن الذكاء الاصطناعي من قراءة هذا الملف.",variant:"destructive"}),t(s)}finally{b(++a/s*100)}},l.onerror=r=>{C({title:"خطأ في قراءة ملف: ".concat(e.name),variant:"destructive"}),b(++a/s*100),t(r)}});for(let s of e)await r(s);x(!1),C({title:"اكتمل التحليل",description:"تمت معالجة ".concat(s," طلب فيزا.")})},[C,F]),{getRootProps:ec,getInputProps:ed,isDragActive:eo}=(0,J.VB)({onDrop:ei,accept:{"application/pdf":[".pdf"]},multiple:!0,disabled:o}),eu=(e,s,a,r)=>{I((0,S.jM)(t=>{let l=t.find(s=>s.id===e);l&&(l.passengers[s][a]=r)}))},ex=(e,s,a)=>{I((0,S.jM)(r=>{let t=r.find(s=>s.id===e);t&&(t[s]=a)}))},em=async()=>{if(0===y.length)return void C({title:"لا توجد طلبات فيزا للحفظ",variant:"destructive"});if(!(null==L?void 0:L.boxId))return void C({title:"صندوق غير محدد",description:"لا يوجد صندوق مرتبط بحسابك. يرجى مراجعة المدير.",variant:"destructive"});for(let e of y)if(!e.financialData.supplierId||!e.financialData.clientId)return void C({title:"بيانات غير مكتملة",description:"الرجاء تعبئة بيانات المورد والعميل للطلب ".concat(e.applicationNumber||e.id,"."),variant:"destructive"});v(!0),d(!1);let e=y.map(e=>({submissionDate:new Date().toISOString(),supplierId:e.financialData.supplierId,clientId:e.financialData.clientId,boxId:L.boxId||"",notes:"تمت الإضافة عبر الإدخال الذكي من ملف: ".concat(e.file.name),currency:e.financialData.currency,passengers:e.passengers.map(s=>({...s,id:"temp-".concat(Math.random()),applicationNumber:e.applicationNumber||"",visaType:e.visaType||"غير محدد"}))})),s=await Z(e);s.success&&s.newBookings?(C({title:"تم حفظ طلبات الفيزا بنجاح",description:"تم حفظ ".concat(s.count," طلب جديد.")}),n(s.newBookings),I([])):C({title:"خطأ",description:s.error,variant:"destructive"}),v(!1)},ep=e=>parseInt(e.replace(/px|vw|vh/g,""),10)||0;return((null==A?void 0:A.suppliers)||[]).map(e=>({value:e.id,label:e.name})),((null==A?void 0:A.clients)||[]).map(e=>({value:e.id,label:e.name})),(0,r.jsxs)(P.lG,{open:c,onOpenChange:d,children:[(0,r.jsx)(P.zM,{asChild:!0,children:i}),(0,r.jsxs)(P.Cf,{showCloseButton:!1,className:"p-0 flex flex-col",style:{maxWidth:V.width,width:"95vw",height:V.height,resize:"both",overflow:"auto"},children:[(0,r.jsxs)(P.c7,{className:"bg-primary text-primary-foreground p-3 rounded-t-lg flex flex-row items-center justify-between sticky top-0 z-10 border-b",children:[(0,r.jsx)(P.HM,{asChild:!0,children:(0,r.jsx)(p.$,{variant:"ghost",size:"icon",className:"text-primary-foreground hover:bg-white/20 h-7 w-7 rounded-full",children:(0,r.jsx)(U.A,{className:"h-4 w-4"})})}),(0,r.jsx)("div",{className:"text-right",children:(0,r.jsxs)(P.L3,{className:"flex items-center gap-2",children:[(0,r.jsx)(w.A,{}),"أداة الإدخال الذكي للفيزا"]})}),(0,r.jsxs)(ee.AM,{open:el,onOpenChange:en,children:[(0,r.jsx)(ee.Wv,{asChild:!0,children:(0,r.jsx)(p.$,{variant:"ghost",size:"icon",className:"text-white hover:bg-white/20 h-8 w-8",children:(0,r.jsx)(T.A,{className:"h-5 w-5"})})}),(0,r.jsx)(ee.hl,{className:"w-80",align:"end",children:(0,r.jsxs)("div",{className:"grid gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h4",{className:"font-medium leading-none",children:"أبعاد النافذة"}),(0,r.jsxs)(j.Lt,{children:[(0,r.jsx)(j.tv,{asChild:!0,children:(0,r.jsxs)(p.$,{type:"button",variant:"ghost",size:"sm",className:"h-auto px-2 py-1 text-xs",children:[(0,r.jsx)($.A,{className:"me-1 h-3 w-3"})," إعادة للوضع الافتراضي"]})}),(0,r.jsxs)(j.EO,{children:[(0,r.jsxs)(j.wd,{children:[(0,r.jsx)(j.r7,{children:"هل أنت متأكد؟"}),(0,r.jsx)(j.$v,{children:"سيتم إعادة أبعاد النافذة إلى الحجم الافتراضي."})]}),(0,r.jsxs)(j.ck,{children:[(0,r.jsx)(j.Zr,{children:"إلغاء"}),(0,r.jsx)(j.Rx,{onClick:()=>{let e={width:"1400px",height:"90vh"};et(e),localStorage.setItem(er,JSON.stringify(e)),C({title:"تمت إعادة تعيين الأبعاد"})},className:(0,f.cn)((0,p.r)({variant:"destructive"})),children:"نعم، قم بالإعادة"})]})]})]})]}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"تحكم في حجم النافذة لتناسب شاشتك."})]}),(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsxs)("div",{className:"grid grid-cols-3 items-center gap-4",children:[(0,r.jsx)(q.J,{htmlFor:"width",children:"العرض (px)"}),(0,r.jsx)(K.O,{id:"width",value:ep(V.width),onValueChange:e=>et(s=>({...s,width:"".concat(e||0,"px")})),className:"col-span-2 h-8"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-3 items-center gap-4",children:[(0,r.jsx)(q.J,{htmlFor:"height",children:"الارتفاع (vh)"}),(0,r.jsx)(K.O,{id:"height",value:ep(V.height),onValueChange:e=>et(s=>({...s,height:"".concat(e||0,"vh")})),className:"col-span-2 h-8"})]}),(0,r.jsx)(p.$,{onClick:()=>{try{localStorage.setItem(er,JSON.stringify(V)),C({title:"تم حفظ أبعاد النافذة"}),en(!1)}catch(e){C({title:"خطأ",description:"لم يتم حفظ الإعدادات",variant:"destructive"})}},size:"sm",className:"mt-2",children:"حفظ الأبعاد"})]})]})})]})]}),(0,r.jsx)("div",{className:"flex-grow overflow-y-auto px-6 py-4 space-y-4",children:R&&A?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4 items-end px-4 py-3 border rounded-lg bg-muted/30",children:[(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)(q.J,{className:"font-bold",children:"المورد"}),(0,r.jsx)(X.j,{searchAction:"suppliers",placeholder:"المورد الافتراضي...",value:F.supplierId,onValueChange:e=>M(s=>({...s,supplierId:e}))})]}),(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)(q.J,{className:"font-bold",children:"العميل"}),(0,r.jsx)(X.j,{searchAction:"clients",placeholder:"العميل الافتراضي...",value:F.clientId,onValueChange:e=>M(s=>({...s,clientId:e}))})]}),(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)(q.J,{className:"font-bold",children:"العملة"}),(0,r.jsxs)(k.l6,{value:F.currency,onValueChange:e=>M(s=>({...s,currency:e})),children:[(0,r.jsx)(k.bq,{className:"font-bold",children:(0,r.jsx)(k.yv,{})}),(0,r.jsxs)(k.gC,{children:[(0,r.jsx)(k.eb,{className:"font-bold",value:"USD",children:"USD"}),(0,r.jsx)(k.eb,{className:"font-bold",value:"IQD",children:"IQD"})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(p.$,{className:"w-full font-bold bg-[#5b21b6] hover:bg-[#5b21b6]/90",onClick:()=>{if(!F.supplierId&&!F.clientId)return void C({title:"لا توجد بيانات للتطبيق",description:"الرجاء اختيار مورد وعميل.",variant:"destructive"});I(e=>e.map(e=>{let s={supplierId:F.supplierId||e.financialData.supplierId,clientId:F.clientId||e.financialData.clientId,currency:F.currency||e.financialData.currency};return{...e,financialData:s}})),C({title:"تم تطبيق البيانات الموحدة",description:"تم تحديث ".concat(y.length," طلب.")})},children:"تطبيق على الكل"}),(0,r.jsxs)("div",{...ec(),className:"cursor-pointer",children:[(0,r.jsx)("input",{...ed()}),(0,r.jsx)(p.$,{variant:"outline",size:"icon",disabled:o,children:(0,r.jsx)(_.A,{className:"h-5 w-5"})})]})]})]}),(0,r.jsx)("div",{className:"flex-grow overflow-hidden",children:(0,r.jsx)(G.F,{className:"h-[calc(100vh-450px)]",children:(0,r.jsxs)("div",{className:"space-y-4 min-h-full",children:[0===y.length&&!o&&(0,r.jsx)("div",{className:"flex items-center justify-center h-full text-muted-foreground pt-10",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(O.A,{className:"mx-auto h-24 w-24"}),(0,r.jsx)("p",{className:"mt-4 text-lg font-bold",children:"قائمة انتظار طلبات الفيزا"}),(0,r.jsx)("p",{className:"text-sm",children:"ابدأ برفع ملفات PDF من الأيقونة في الأعلى."})]})}),o&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("p",{className:"text-sm text-center font-bold text-muted-foreground mb-1",children:["جاري التحليل... (",Math.round(N),"%)"]}),(0,r.jsx)(W.k,{value:N,className:"h-2 rounded-full"})]}),y.map(e=>(0,r.jsxs)(l.Zp,{className:"relative group shadow-sm hover:shadow-md transition-shadow",children:[(0,r.jsx)(l.aR,{className:"p-3 bg-muted/30",children:(0,r.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,r.jsx)("div",{className:"flex items-center gap-3",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(ea.E,{variant:"secondary",className:"font-mono text-base",children:e.applicationNumber||"N/A"}),(0,r.jsx)(D.p,{value:e.destination,onChange:s=>ex(e.id,"destination",s.target.value),className:"h-8 font-bold",placeholder:"وجهة السفر"}),(0,r.jsx)(D.p,{value:e.visaType,onChange:s=>ex(e.id,"visaType",s.target.value),className:"h-8 font-bold",placeholder:"نوع الفيزا"})]})}),(0,r.jsx)(p.$,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",onClick:()=>{var s;return s=e.id,void I(e=>e.filter(e=>e.id!==s))},children:(0,r.jsx)(m.A,{className:"h-4 w-4"})})]})}),(0,r.jsx)(l.Wu,{className:"p-0",children:(0,r.jsxs)(u.XI,{dir:"rtl",children:[(0,r.jsx)(u.A0,{children:(0,r.jsxs)(u.Hj,{children:[(0,r.jsx)(u.nd,{className:"font-bold text-right",children:"المسافر"}),(0,r.jsx)(u.nd,{className:"font-bold text-right",children:"رقم الجواز"}),(0,r.jsx)(u.nd,{className:"font-bold text-right",children:"شراء"}),(0,r.jsx)(u.nd,{className:"font-bold text-right",children:"بيع"}),(0,r.jsx)(u.nd,{className:"font-bold text-right",children:"الربح"})]})}),(0,r.jsx)(u.BF,{children:e.passengers.map((s,a)=>{let t=(s.salePrice||0)-(s.purchasePrice||0);return(0,r.jsxs)(u.Hj,{children:[(0,r.jsx)(u.nA,{className:"p-2",children:(0,r.jsx)(D.p,{value:s.name,onChange:s=>eu(e.id,a,"name",s.target.value),className:"h-8"})}),(0,r.jsx)(u.nA,{className:"p-2",children:(0,r.jsx)(D.p,{value:s.passportNumber,onChange:s=>eu(e.id,a,"passportNumber",s.target.value),className:"h-8"})}),(0,r.jsx)(u.nA,{className:"p-2",children:(0,r.jsx)(K.O,{currency:e.financialData.currency,currencyClassName:(0,f.cn)("USD"===e.financialData.currency?"bg-accent text-accent-foreground":"bg-primary text-primary-foreground"),value:s.purchasePrice,onValueChange:s=>eu(e.id,a,"purchasePrice",s||0),className:"h-8"})}),(0,r.jsx)(u.nA,{className:"p-2",children:(0,r.jsx)(K.O,{currency:e.financialData.currency,currencyClassName:(0,f.cn)("USD"===e.financialData.currency?"bg-accent text-accent-foreground":"bg-primary text-primary-foreground"),value:s.salePrice,onValueChange:s=>eu(e.id,a,"salePrice",s||0),className:"h-8"})}),(0,r.jsx)(u.nA,{className:"p-2",children:(0,r.jsx)("div",{className:(0,f.cn)("font-mono text-center font-bold",t>=0?"text-green-600":"text-destructive"),children:t.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})})]},"".concat(e.id,"-").concat(a))})})]})}),(0,r.jsx)(l.wL,{className:"p-3 bg-muted/30 border-t",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 w-full",children:[(0,r.jsx)(X.j,{searchAction:"suppliers",placeholder:"المورد...",value:e.financialData.supplierId,onValueChange:s=>ex(e.id,"supplierId",s)}),(0,r.jsx)(X.j,{searchAction:"clients",placeholder:"العميل...",value:e.financialData.clientId,onValueChange:s=>ex(e.id,"clientId",s)}),(0,r.jsxs)(k.l6,{value:e.financialData.currency,onValueChange:s=>ex(e.id,"currency",s),children:[(0,r.jsx)(k.bq,{className:"h-9 text-xs px-2 font-bold",children:(0,r.jsx)(k.yv,{})}),(0,r.jsxs)(k.gC,{children:[(0,r.jsx)(k.eb,{value:"USD",className:"font-bold",children:"USD"}),(0,r.jsx)(k.eb,{value:"IQD",className:"font-bold",children:"IQD"})]})]})]})})]},e.id))]})})})]}):(0,r.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,r.jsx)(z.A,{className:"h-8 w-8 animate-spin"})})}),(0,r.jsxs)(P.Es,{className:"border-t p-2 bg-background shrink-0 flex-row items-center justify-between",children:[(0,r.jsx)("div",{className:"flex-1"}),(0,r.jsxs)("div",{className:"flex-1 flex items-center justify-center gap-4 text-xs text-muted-foreground",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)(E.A,{className:"h-4 w-4 text-primary"})," ",(0,r.jsxs)("span",{children:["المستخدم: ",(null==L?void 0:L.name)||"..."]})]}),(null==L?void 0:L.boxId)&&(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)(H.A,{className:"h-4 w-4 text-primary"})," ",(0,r.jsxs)("span",{children:["الصندوق: ",(null==A||null==(a=A.boxes)||null==(s=a.find(e=>e.id===L.boxId))?void 0:s.name)||"غير محدد"]})]})]}),(0,r.jsx)("div",{className:"flex-1 flex justify-end",children:y.length>0&&(0,r.jsxs)(p.$,{size:"lg",disabled:g||o,onClick:em,className:"w-full sm:w-auto font-bold bg-accent text-accent-foreground hover:bg-accent/90",children:[g?(0,r.jsx)(z.A,{className:"me-2 h-4 w-4 animate-spin"}):(0,r.jsx)(Y.A,{className:"me-2 h-4 w-4"}),"حفظ كل الطلبات المعلقة (",y.length,")"]})})]})]})]})}function el(e){let{initialData:s}=e,[a,n]=t.useState(s),i=(0,V.useRouter)(),{data:c}=(0,B.Z)(),[d,o]=t.useState(""),u=(0,L.d)(d,300),[x,m]=t.useState({searchField:"all",currencyFilter:"all"}),[h,j]=t.useState(x);t.useEffect(()=>{n(s)},[s]);let f=t.useMemo(()=>a.filter(e=>{var s,a;if("all"!==h.currencyFilter&&e.currency!==h.currencyFilter)return!1;let r=(null==c||null==(s=c.suppliers.find(s=>s.id===e.supplierId))?void 0:s.name)||"",t=(null==c||null==(a=c.clients.find(s=>s.id===e.clientId))?void 0:a.name)||"",l=h.searchField;if("all"!==l){let s=u.toLowerCase();if(!s)return!0;switch(l){case"applicationNumber":return e.passengers.some(e=>(e.applicationNumber||"").toLowerCase().includes(s));case"passenger":return e.passengers.some(e=>(e.name||"").toLowerCase().includes(s));case"passport":return e.passengers.some(e=>(e.passportNumber||"").toLowerCase().includes(s));case"supplier":return r.toLowerCase().includes(s);case"client":return t.toLowerCase().includes(s);default:return!0}}if(u&&"all"===l){let s=u.toLowerCase();return(e.notes||"").toLowerCase().includes(s)||(e.invoiceNumber||"").toLowerCase().includes(s)||r.toLowerCase().includes(s)||t.toLowerCase().includes(s)||e.passengers.some(e=>(e.name||"").toLowerCase().includes(s)||(e.applicationNumber||"").toLowerCase().includes(s)||(e.passportNumber||"").toLowerCase().includes(s))}return!0}),[u,a,c,h]);return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[(0,r.jsxs)("div",{className:"flex w-full sm:w-auto items-center gap-2",children:[(0,r.jsx)(A.A,{onBookingAdded:e=>{n((0,S.jM)(s=>{s.unshift(e)}))},children:(0,r.jsxs)(p.$,{children:[(0,r.jsx)(y.A,{className:"me-2 h-4 w-4"})," إضافة طلب جديد"]})}),(0,r.jsx)(et,{onMultipleBookingsAdded:e=>{i.refresh()},children:(0,r.jsxs)(p.$,{variant:"outline",children:[(0,r.jsx)(w.A,{className:"me-2 h-4 w-4"})," الإدخال الذكي (AI)"]})}),(0,r.jsx)(p.$,{asChild:!0,variant:"outline",children:(0,r.jsxs)(M(),{href:"/visas/deleted-visas",children:[(0,r.jsx)(I.A,{className:"me-2 h-4 w-4"}),"سجل المحذوفات"]})})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 w-full flex-wrap sm:w-auto sm:flex-nowrap justify-end",children:[(0,r.jsxs)("div",{className:"relative w-full sm:w-64",children:[(0,r.jsx)(R.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,r.jsx)(D.p,{placeholder:"بحث...",className:"ps-10",value:d,onChange:e=>o(e.target.value)})]}),(0,r.jsxs)(k.l6,{value:x.searchField,onValueChange:e=>m(s=>({...s,searchField:e})),children:[(0,r.jsx)(k.bq,{className:"w-full sm:w-[140px]",children:(0,r.jsx)(k.yv,{})}),(0,r.jsxs)(k.gC,{children:[(0,r.jsx)(k.eb,{value:"all",children:"بحث عام"}),(0,r.jsx)(k.eb,{value:"applicationNumber",children:"رقم الطلب"}),(0,r.jsx)(k.eb,{value:"passenger",children:"اسم المسافر"}),(0,r.jsx)(k.eb,{value:"passport",children:"رقم الجواز"}),(0,r.jsx)(k.eb,{value:"supplier",children:"المورد"}),(0,r.jsx)(k.eb,{value:"client",children:"العميل"})]})]}),(0,r.jsxs)(k.l6,{value:x.currencyFilter,onValueChange:e=>m(s=>({...s,currencyFilter:e})),children:[(0,r.jsx)(k.bq,{className:"w-full sm:w-[120px]",children:(0,r.jsx)(k.yv,{})}),(0,r.jsxs)(k.gC,{children:[(0,r.jsx)(k.eb,{value:"all",children:"كل العملات"}),(0,r.jsx)(k.eb,{value:"USD",children:"USD"}),(0,r.jsx)(k.eb,{value:"IQD",children:"IQD"})]})]}),(0,r.jsxs)(p.$,{onClick:()=>{j(x)},className:"w-full sm:w-auto",children:[(0,r.jsx)(C.A,{className:"me-2 h-4 w-4"}),"تطبيق"]})]})]}),(0,r.jsx)(l.Zp,{children:(0,r.jsx)(l.Wu,{className:"p-0",children:(0,r.jsx)(b,{bookings:f,clients:(null==c?void 0:c.clients)||[],suppliers:(null==c?void 0:c.suppliers)||[],boxes:(null==c?void 0:c.boxes)||[],onBookingDeleted:e=>{n(s=>s.filter(s=>s.id!==e))},onBookingUpdated:e=>{n((0,S.jM)(s=>{let a=s.findIndex(s=>s.id===e.id);-1!==a&&(s[a]=e)})),i.refresh()}})})})]})}function en(){let[e,s]=(0,t.useState)([]),[a,l]=(0,t.useState)(!0),[i,u]=(0,t.useState)(null),x=(0,t.useCallback)(async()=>{l(!0);try{let e=await c();s(e)}catch(e){u(e.message||"فشل تحميل البيانات الضرورية لهذه الصفحة.")}finally{l(!1)}},[]);return((0,t.useEffect)(()=>{x()},[x]),a)?(0,r.jsx)(o.E,{className:"h-96 w-full"}):i?(0,r.jsxs)(d.Fc,{variant:"destructive",children:[(0,r.jsx)(n.A,{className:"h-4 w-4"}),(0,r.jsx)(d.XL,{children:"حدث خطأ!"}),(0,r.jsx)(d.TN,{children:i})]}):(0,r.jsx)(el,{initialData:e})}function ei(){return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)(l.aR,{className:"px-0 sm:px-6",children:[(0,r.jsx)(l.ZB,{children:"إدارة طلبات الفيزا"}),(0,r.jsx)(l.BT,{children:"نظام متكامل لتسجيل ومتابعة جميع طلبات الفيزا وحالاتها."})]}),(0,r.jsx)(t.Suspense,{fallback:(0,r.jsx)(o.E,{className:"h-96 w-full"}),children:(0,r.jsx)(en,{})})]})}},93685:(e,s,a)=>{"use strict";a.d(s,{A:()=>V});var r=a(95155),t=a(12115),l=a(22544),n=a(66942),i=a(54879),c=a(3998),d=a(65142),o=a(76444),u=a(11186),x=a(87270),m=a(13630),p=a(22452),h=a(27314),j=a(94972),f=a(44381),g=a(92033),v=a(73180),N=a(30926);let b=(0,N.createServerReference)("60562fa6e2acf835f7f484086ad9e3f76c9be2ca55",N.callServer,void 0,N.findSourceMapURL,"updateVisaBooking"),y=(0,N.createServerReference)("409ab5f3a1d5afb4b4634875b66bd6864afda3323f",N.callServer,void 0,N.findSourceMapURL,"addVisaBooking");var w=a(23639),I=a(64269),C=a(15894),A=a(31120),S=a(27432),D=a(5470),k=a(23451),R=a(51834),L=a(97916);let F=i.Ik({id:i.Yj().optional(),name:i.Yj().min(1,"الاسم الكامل مطلوب"),passportNumber:i.Yj().optional(),applicationNumber:i.Yj().min(1,"رقم الطلب مطلوب"),visaType:i.Yj().min(1,"نوع الفيزا مطلوب"),bk:i.Yj().optional(),purchasePrice:i.Yj().or(i.ai()).transform(e=>Number(String(e).replace(/,/g,""))).refine(e=>e>=0,{message:"سعر الشراء يجب أن يكون 0 أو أكثر."}),salePrice:i.Yj().or(i.ai()).transform(e=>Number(String(e).replace(/,/g,""))).refine(e=>e>=0,{message:"سعر البيع يجب أن يكون 0 أو أكثر."})}),M=i.Ik({id:i.Yj().optional(),supplierId:i.Yj().min(1,"المورد مطلوب"),clientId:i.Yj().min(1,"العميل مطلوب"),submissionDate:i.p6({required_error:"تاريخ التقديم مطلوب"}),boxId:i.Yj().min(1,"الصندوق مطلوب"),currency:i.k5(["USD","IQD"]),notes:i.Yj().optional(),passengers:i.YO(F).min(1,"يجب إضافة مسافر واحد على الأقل")});function V(e){let{isEditing:s=!1,initialData:a,onBookingAdded:i,onBookingUpdated:N}=e,{toast:F}=(0,C.dj)(),{data:V}=(0,D.Z)(),{user:B}=(0,k.A)(),P=t.useMemo(()=>((null==V?void 0:V.clients)||[]).map(e=>({value:e.id,label:e.name})),[null==V?void 0:V.clients]),U=t.useMemo(()=>((null==V?void 0:V.suppliers)||[]).map(e=>({value:e.id,label:e.name})),[null==V?void 0:V.suppliers]),T=(0,l.mN)({resolver:(0,n.u)(M),defaultValues:s?a:{supplierId:"",clientId:"",submissionDate:new Date,boxId:"",currency:"USD",notes:"",passengers:[{name:"",passportNumber:"",applicationNumber:"",visaType:"",bk:"",purchasePrice:0,salePrice:0}]}});t.useEffect(()=>{B&&"role"in B&&B.boxId&&!s&&T.setValue("boxId",B.boxId)},[B,s,T]);let{control:$,handleSubmit:z,formState:{errors:_,isSubmitting:O},setValue:E,watch:H}=T,{fields:Y,append:J,remove:Z}=(0,l.jz)({control:$,name:"passengers"}),Q=t.useMemo(()=>{var e,s;let a=T.watch("boxId");return(null==V||null==(s=V.boxes)||null==(e=s.find(e=>e.id===a))?void 0:e.name)||"غير محدد"},[T,null==V?void 0:V.boxes]),q=async e=>{var a,r;let t=null==V||null==(a=V.clients)?void 0:a.find(s=>s.id===e.clientId),l=null==V||null==(r=V.suppliers)?void 0:r.find(s=>s.id===e.supplierId),n={supplierId:e.supplierId,clientId:e.clientId,supplierName:(null==l?void 0:l.name)||e.supplierId,clientName:(null==t?void 0:t.name)||e.clientId,boxId:e.boxId,currency:e.currency,submissionDate:e.submissionDate.toISOString(),notes:e.notes||"",passengers:e.passengers.map(e=>({id:e.id||"temp-".concat(Math.random()),name:e.name,passportNumber:e.passportNumber||"",applicationNumber:e.applicationNumber,visaType:e.visaType,bk:e.bk||"",purchasePrice:e.purchasePrice,salePrice:e.salePrice}))};if(s&&e.id){let s=await b(e.id,n);s.success&&s.updatedBooking?(F({title:"تم تحديث الطلب بنجاح"}),N&&N(s.updatedBooking)):F({title:"خطأ في التحديث",description:s.error,variant:"destructive"})}else{let e=await y(n);e.success&&e.newBooking?(F({title:"تمت إضافة طلب الفيزا بنجاح"}),T.reset(),i&&i(e.newBooking)):F({title:"خطأ في الإضافة",description:e.error,variant:"destructive"})}};return(0,r.jsxs)("form",{onSubmit:z(q),className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 items-start p-4 border rounded-lg bg-muted/30",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(o.J,{htmlFor:"supplierId",children:"المورد"}),(0,r.jsx)(l.xI,{name:"supplierId",control:$,render:e=>{let{field:s}=e;return(0,r.jsx)(w.j,{options:U,value:s.value,onValueChange:s.onChange,placeholder:"اختر موردًا..."})}}),_.supplierId&&(0,r.jsx)("p",{className:"text-sm text-destructive h-4",children:_.supplierId.message})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(o.J,{htmlFor:"clientId",children:"العميل"}),(0,r.jsx)(l.xI,{name:"clientId",control:$,render:e=>{let{field:s}=e;return(0,r.jsx)(w.j,{options:P,value:s.value,onValueChange:s.onChange,placeholder:"اختر عميلاً..."})}}),_.clientId&&(0,r.jsx)("p",{className:"text-sm text-destructive h-4",children:_.clientId.message})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(o.J,{htmlFor:"submissionDate",children:"تاريخ التقديم"}),(0,r.jsx)(l.xI,{name:"submissionDate",control:$,render:e=>{let{field:s}=e;return(0,r.jsx)(S.K,{date:s.value,setDate:s.onChange})}}),_.submissionDate&&(0,r.jsx)("p",{className:"text-sm text-destructive h-4",children:_.submissionDate.message})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(o.J,{htmlFor:"currency",children:"العملة"}),(0,r.jsx)(l.xI,{name:"currency",control:$,render:e=>{let{field:s}=e;return(0,r.jsxs)(u.l6,{onValueChange:s.onChange,value:s.value,children:[(0,r.jsx)(u.bq,{children:(0,r.jsx)(u.yv,{})}),(0,r.jsxs)(u.gC,{children:[(0,r.jsx)(u.eb,{value:"USD",children:"USD"}),(0,r.jsx)(u.eb,{value:"IQD",children:"IQD"})]})]})}})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(o.J,{htmlFor:"boxId",children:"الصندوق"}),(0,r.jsx)(l.xI,{name:"boxId",control:$,render:e=>{let{field:s}=e;return(0,r.jsxs)(u.l6,{onValueChange:s.onChange,value:s.value,children:[(0,r.jsx)(u.bq,{children:(0,r.jsx)(u.yv,{placeholder:"اختر صندوق..."})}),(0,r.jsx)(u.gC,{children:((null==V?void 0:V.boxes)||[]).map(e=>(0,r.jsx)(u.eb,{value:e.id,children:e.name},e.id))})]})}}),_.boxId&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:_.boxId.message})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(o.J,{htmlFor:"notes",children:"ملاحظات"}),(0,r.jsx)(l.xI,{name:"notes",control:$,render:e=>{let{field:s}=e;return(0,r.jsx)(A.T,{...s})}})]})]}),(0,r.jsxs)("div",{className:"overflow-x-auto border rounded-lg",children:[(0,r.jsxs)(x.XI,{children:[(0,r.jsx)(x.A0,{children:(0,r.jsxs)(x.Hj,{className:"bg-muted/50",children:[(0,r.jsx)(x.nd,{className:"p-2",children:"الاسم الكامل"}),(0,r.jsx)(x.nd,{className:"p-2",children:"رقم الجواز"}),(0,r.jsx)(x.nd,{className:"p-2",children:"رقم الطلب"}),(0,r.jsx)(x.nd,{className:"p-2",children:"نوع الفيزا"}),(0,r.jsx)(x.nd,{className:"p-2",children:"BK"}),(0,r.jsx)(x.nd,{className:"p-2",children:"سعر الشراء"}),(0,r.jsx)(x.nd,{className:"p-2",children:"سعر البيع"}),(0,r.jsx)(x.nd,{className:"p-2 w-[50px]"})]})}),(0,r.jsx)(x.BF,{children:Y.map((e,s)=>{let a=H("currency");return(0,r.jsxs)(x.Hj,{children:[(0,r.jsx)(x.nA,{className:"p-1",children:(0,r.jsx)(d.p,{...T.register("passengers.".concat(s,".name"))})}),(0,r.jsx)(x.nA,{className:"p-1",children:(0,r.jsx)(d.p,{...T.register("passengers.".concat(s,".passportNumber"))})}),(0,r.jsx)(x.nA,{className:"p-1",children:(0,r.jsx)(d.p,{...T.register("passengers.".concat(s,".applicationNumber"))})}),(0,r.jsx)(x.nA,{className:"p-1",children:(0,r.jsx)(d.p,{...T.register("passengers.".concat(s,".visaType"))})}),(0,r.jsx)(x.nA,{className:"p-1",children:(0,r.jsx)(d.p,{...T.register("passengers.".concat(s,".bk"))})}),(0,r.jsx)(x.nA,{className:"p-1",children:(0,r.jsx)(l.xI,{name:"passengers.".concat(s,".purchasePrice"),control:$,render:e=>{let{field:s}=e;return(0,r.jsx)(L.O,{currency:a,currencyClassName:(0,I.cn)("USD"===a?"bg-accent text-accent-foreground":"bg-primary text-primary-foreground"),...s,onValueChange:s.onChange})}})}),(0,r.jsx)(x.nA,{className:"p-1",children:(0,r.jsx)(l.xI,{name:"passengers.".concat(s,".salePrice"),control:$,render:e=>{let{field:s}=e;return(0,r.jsx)(L.O,{currency:a,currencyClassName:(0,I.cn)("USD"===a?"bg-accent text-accent-foreground":"bg-primary text-primary-foreground"),...s,onValueChange:s.onChange})}})}),(0,r.jsx)(x.nA,{className:"p-1",children:(0,r.jsx)(c.$,{variant:"ghost",size:"icon",onClick:()=>Z(s),disabled:Y.length<=1,children:(0,r.jsx)(m.A,{className:"h-4 w-4 text-destructive"})})})]},e.id)})})]}),_.passengers&&"object"==typeof _.passengers&&"message"in _.passengers&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-2 p-2",children:_.passengers.message})]}),(0,r.jsx)("div",{className:"flex justify-between items-center mt-4",children:(0,r.jsxs)(c.$,{type:"button",variant:"outline",onClick:()=>J({name:"",passportNumber:"",applicationNumber:"",visaType:"",bk:"",purchasePrice:0,salePrice:0}),children:[(0,r.jsx)(p.A,{className:"me-2 h-4 w-4"})," إضافة مسافر"]})}),(0,r.jsxs)(R.Es,{className:"flex-row items-center justify-between sticky bottom-0 bg-background border-t p-2 -mx-6 -mb-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)(h.A,{className:"h-4 w-4 text-primary"})," ",(0,r.jsx)("span",{children:(null==B?void 0:B.name)||"..."})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)(j.A,{className:"h-4 w-4 text-primary"})," ",(0,r.jsx)("span",{children:Q})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)(f.A,{className:"h-4 w-4 text-primary"})," ",(0,r.jsx)("span",{children:"رقم الفاتورة: (تلقائي)"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(c.$,{type:"button",variant:"ghost",onClick:()=>T.reset(),children:"إلغاء"}),(0,r.jsxs)(c.$,{type:"submit",disabled:O,children:[O&&(0,r.jsx)(g.A,{className:"me-2 h-4 w-4 animate-spin"}),(0,r.jsx)(v.A,{className:"me-2 h-4 w-4"}),s?"حفظ التعديلات":"حفظ الطلب"]})]})]})]})}},97916:(e,s,a)=>{"use strict";a.d(s,{O:()=>c});var r=a(95155),t=a(12115),l=a(65142),n=a(64269);let i=e=>{if("string"!=typeof e||""===e.trim())return;let s=parseFloat(e.replace(/,/g,""));return isNaN(s)?void 0:s},c=t.forwardRef((e,s)=>{let{value:a,onValueChange:c,className:d,allowNegative:o=!1,currency:u,currencyClassName:x,direction:m="rtl",...p}=e,h=e=>{if(null==e||""===e)return"";let s="string"==typeof e?i(e):e;return void 0===s?String(e):new Intl.NumberFormat("en-US").format(s)},[j,f]=t.useState(h(a));t.useEffect(()=>{f(h(a))},[a]);let g={...p,ref:s,type:"text",inputMode:"decimal",placeholder:"0.00",value:j||"",onChange:e=>{let s=e.target.value.replace(/,/g,"");if((o?/^-?\d*\.?\d*$/:/^\d*\.?\d*$/).test(s)||""===s){let e=i(s);f(void 0!==e?h(e):s),c&&c(e)}}};return u?(0,r.jsxs)("div",{className:(0,n.cn)("relative flex items-center w-full",d),children:[(0,r.jsx)(l.p,{...g,className:(0,n.cn)("z-10 text-right w-full","rtl"===m?"rounded-l-none rounded-r-lg border-l-0":"rounded-r-none rounded-l-lg border-r-0")}),(0,r.jsx)("div",{className:(0,n.cn)("p-2 bg-muted border h-full flex items-center",x,"rtl"===m?"rounded-l-lg":"rounded-r-lg"),children:(0,r.jsx)("span",{className:"text-xs font-semibold",children:u})})]}):(0,r.jsx)(l.p,{...g,className:(0,n.cn)("text-right",d)})});c.displayName="NumericInput"},98053:(e,s,a)=>{"use strict";a.d(s,{$v:()=>j,EO:()=>x,Lt:()=>c,Rx:()=>f,Zr:()=>g,ck:()=>p,r7:()=>h,tv:()=>d,wd:()=>m});var r=a(95155),t=a(12115),l=a(35646),n=a(64269),i=a(3998);let c=l.bL,d=l.l9,o=l.ZL,u=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(l.hJ,{className:(0,n.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...t,ref:s})});u.displayName=l.hJ.displayName;let x=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsxs)(o,{children:[(0,r.jsx)(u,{}),(0,r.jsx)(l.UC,{ref:s,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...t})]})});x.displayName=l.UC.displayName;let m=e=>{let{className:s,...a}=e;return(0,r.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-2 text-center sm:text-left",s),...a})};m.displayName="AlertDialogHeader";let p=e=>{let{className:s,...a}=e;return(0,r.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...a})};p.displayName="AlertDialogFooter";let h=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(l.hE,{ref:s,className:(0,n.cn)("text-lg font-semibold",a),...t})});h.displayName=l.hE.displayName;let j=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(l.VY,{ref:s,className:(0,n.cn)("text-sm text-muted-foreground",a),...t})});j.displayName=l.VY.displayName;let f=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(l.rc,{ref:s,className:(0,n.cn)((0,i.r)(),a),...t})});f.displayName=l.rc.displayName;let g=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(l.ZD,{ref:s,className:(0,n.cn)((0,i.r)({variant:"outline"}),"mt-2 sm:mt-0",a),...t})});g.displayName=l.ZD.displayName}},e=>{e.O(0,[9135,7210,4909,9625,315,5111,4127,9967,1374,783,4223,8994,2619,43,13,2612,5672,1636,9034,1319,4762,2500,8441,1255,7358],()=>e(e.s=24458)),_N_E=e.O()}]);