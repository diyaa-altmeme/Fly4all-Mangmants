"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4608],{18332:(e,t,s)=>{s.d(t,{Fc:()=>d,TN:()=>o,XL:()=>i});var a=s(95155),r=s(12115),l=s(83101),n=s(64269);let c=(0,l.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),d=r.forwardRef((e,t)=>{let{className:s,variant:r,...l}=e;return(0,a.jsx)("div",{ref:t,role:"alert",className:(0,n.cn)(c({variant:r}),s),...l})});d.displayName="Alert";let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("h5",{ref:t,className:(0,n.cn)("mb-1 font-medium leading-none tracking-tight",s),...r})});i.displayName="AlertTitle";let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("text-sm [&_p]:leading-relaxed",s),...r})});o.displayName="AlertDescription"},20243:(e,t,s)=>{s.d(t,{E:()=>l});var a=s(95155),r=s(64269);function l(e){let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,r.cn)("animate-pulse rounded-md bg-muted",t),...s})}},21161:(e,t,s)=>{s.d(t,{A:()=>M});var a=s(95155),r=s(12115),l=s(3998),n=s(76444),c=s(31120),d=s(22452),i=s(13630),o=s(88397),m=s(27314),x=s(44381),u=s(76251),h=s(92033),p=s(73180),j=s(54879),v=s(22544),f=s(66942),g=s(15894),b=s(27432),y=s(64269),N=s(51834),w=s(23451),I=s(23639),C=s(30926);let S=(0,C.createServerReference)("400c84b00cbc18181ec896b17d3329ab44688122ee",C.callServer,void 0,C.findSourceMapURL,"createJournalVoucher");var A=s(86366),R=s(97916),k=s(5470);let F=j.Ik({accountId:j.Yj().min(1,"الحساب مطلوب"),debit:j.au.number().min(0).default(0),credit:j.au.number().min(0).default(0)}),D=j.Ik({date:j.p6({required_error:"التاريخ مطلوب"}),currency:j.k5(["USD","IQD"]),notes:j.Yj().min(1,"بيان القيد مطلوب"),exchangeRate:j.au.number().optional(),entries:j.YO(F).min(2,"يجب وجود حركتين على الأقل (مدين ودائن).")}),V=e=>{let{...t}=e;return(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)(R.O,{placeholder:"0.00",...t})})};function M(e){var t,s;let{onVoucherAdded:j,onVoucherUpdated:C,isEditing:F,initialData:M,selectedCurrency:J}=e,{toast:_}=(0,g.dj)(),{user:E}=(0,w.A)(),{data:Y}=(0,k.Z)(),T=r.useMemo(()=>Y?[...(Y.clients||[]).map(e=>({value:e.id,label:"عميل: ".concat(e.name)})),...(Y.suppliers||[]).map(e=>({value:e.id,label:"مورد: ".concat(e.name)})),...(Y.boxes||[]).map(e=>({value:e.id,label:"صندوق: ".concat(e.name)})),...(Y.exchanges||[]).map(e=>({value:e.id,label:"بورصة: ".concat(e.name)}))]:[],[Y]),{control:O,handleSubmit:U,setValue:$,watch:B,register:q,formState:{errors:L,isSubmitting:z},reset:Q}=(0,v.mN)({resolver:(0,f.u)(D),defaultValues:F?M:{date:new Date,currency:J,notes:"",entries:[{accountId:"",debit:0,credit:0},{accountId:"",debit:0,credit:0}]}}),{fields:H,append:P,remove:Z}=(0,v.jz)({control:O,name:"entries"}),G=B("entries"),K=G.reduce((e,t)=>e+(Number(t.debit)||0),0),W=G.reduce((e,t)=>e+(Number(t.credit)||0),0),X=K-W;(0,r.useEffect)(()=>{F||($("currency",J),$("entries",[{accountId:"",debit:void 0,credit:void 0},{accountId:"",debit:void 0,credit:void 0}]))},[J,$,F]);let ee=async e=>{if(Math.abs(X)>.01)return void _({title:"القيد غير متوازن",description:"مجموع المدين يجب أن يساوي مجموع الدائن.",variant:"destructive"});try{if(F&&(null==M?void 0:M.id)){let t=await (0,A.o)(M.id,{...e,date:e.date.toISOString()});t.success?(_({title:"تم تحديث السند بنجاح"}),C&&C({})):_({title:"خطأ في التحديث",description:t.error,variant:"destructive"})}else{let t=await S({date:e.date.toISOString(),currency:e.currency,notes:e.notes,exchangeRate:e.exchangeRate,entries:e.entries});if(t.success)_({title:"تم إنشاء القيد المحاسبي بنجاح"}),j&&j({}),Q();else throw Error(t.error)}}catch(e){_({title:"حدث خطأ",description:e.message,variant:"destructive"})}};return(0,a.jsxs)("form",{onSubmit:U(ee),className:"space-y-4",children:[(0,a.jsxs)("div",{className:"p-6 space-y-6 flex-grow",children:[(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6 items-start",children:[(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)(n.J,{htmlFor:"date",children:"التاريخ"}),(0,a.jsx)(v.xI,{control:O,name:"date",render:e=>{let{field:t}=e;return(0,a.jsx)(b.K,{date:t.value,setDate:t.onChange})}}),L.date&&(0,a.jsx)("p",{className:"text-sm text-destructive h-4",children:L.date.message})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)(n.J,{htmlFor:"notes",children:"البيان / السبب"}),(0,a.jsx)(c.T,{id:"notes",placeholder:"أضف شرحًا لسبب القيد...",...q("notes")}),L.notes&&(0,a.jsx)("p",{className:"text-sm text-destructive h-4",children:L.notes.message})]}),"USD"===J&&(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)(n.J,{htmlFor:"exchangeRate",children:"سعر الصرف (مقابل الدينار)"}),(0,a.jsx)(v.xI,{name:"exchangeRate",control:O,render:e=>{let{field:t}=e;return(0,a.jsx)(R.O,{placeholder:"0.00",...t,onValueChange:t.onChange})}})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h4",{className:"font-semibold",children:"حركات القيد"}),(0,a.jsxs)(l.$,{type:"button",variant:"outline",size:"sm",onClick:()=>P({accountId:"",debit:void 0,credit:void 0}),children:[(0,a.jsx)(d.A,{className:"me-2 h-4 w-4"})," إضافة حركة"]})]}),H.map((e,t)=>(0,a.jsxs)("div",{className:"grid grid-cols-[1fr,auto,auto,auto] gap-2 items-center border p-2 rounded-lg",children:[(0,a.jsx)(v.xI,{name:"entries.".concat(t,".accountId"),control:O,render:e=>{let{field:t}=e;return(0,a.jsx)(I.j,{searchAction:"all",options:T,value:t.value,onValueChange:t.onChange,placeholder:"ابحث عن حساب..."})}}),(0,a.jsx)(v.xI,{name:"entries.".concat(t,".debit"),control:O,render:e=>{let{field:t}=e;return(0,a.jsx)(V,{placeholder:"المدين",className:"w-28",...t,onValueChange:t.onChange})}}),(0,a.jsx)(v.xI,{name:"entries.".concat(t,".credit"),control:O,render:e=>{let{field:t}=e;return(0,a.jsx)(V,{placeholder:"الدائن",className:"w-28",...t,onValueChange:t.onChange})}}),(0,a.jsx)(l.$,{variant:"ghost",size:"icon",className:"text-destructive h-8 w-8",onClick:()=>Z(t),disabled:H.length<=2,children:(0,a.jsx)(i.A,{className:"h-4 w-4"})})]},e.id)),L.entries&&(0,a.jsx)("p",{className:"text-sm text-destructive",children:L.entries.message||(null==(s=L.entries)||null==(t=s.root)?void 0:t.message)})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4 p-4 border rounded-lg bg-muted/50",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(n.J,{children:"إجمالي المدين"}),(0,a.jsx)("p",{className:"font-bold text-lg text-green-600",children:K.toFixed(2)})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(n.J,{children:"إجمالي الدائن"}),(0,a.jsx)("p",{className:"font-bold text-lg text-red-600",children:W.toFixed(2)})]}),(0,a.jsxs)("div",{className:(0,y.cn)("text-center transition-colors",0!==X?"text-destructive":"text-muted-foreground"),children:[(0,a.jsx)(n.J,{children:"الفرق (التوازن)"}),(0,a.jsxs)("p",{className:"font-bold text-lg flex items-center justify-center gap-2",children:[(0,a.jsx)(o.A,{className:"h-5 w-5"}),X.toFixed(2)]})]})]})]}),(0,a.jsx)(N.Es,{className:"p-4 border-t bg-background sticky bottom-0",children:(0,a.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)(m.A,{className:"h-4 w-4"})," ",(0,a.jsxs)("span",{children:["المستخدم: ",(null==E?void 0:E.name)||"..."]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)(x.A,{className:"h-4 w-4"})," ",(0,a.jsx)("span",{children:"رقم القيد: (تلقائي)"})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(l.$,{type:"button",onClick:()=>{},variant:"outline",disabled:z,children:[(0,a.jsx)(u.A,{className:"me-2 h-4 w-4"}),"حفظ وطباعة"]}),(0,a.jsxs)(l.$,{type:"submit",disabled:z,children:[z&&(0,a.jsx)(h.A,{className:"me-2 h-4 w-4 animate-spin"}),(0,a.jsx)(p.A,{className:"me-2 h-4 w-4"}),F?"حفظ التعديلات":"حفظ القيد"]})]})]})})]})}},27432:(e,t,s)=>{s.d(t,{K:()=>x});var a=s(95155);s(12115);var r=s(14223),l=s(28127),n=s(64269),c=s(3998),d=s(50276),i=s(26333),o=s(65142);function m(e){let{date:t,setDate:s}=e,r=t?"".concat(String(t.getHours()).padStart(2,"0"),":").concat(String(t.getMinutes()).padStart(2,"0")):"";return(0,a.jsx)(o.p,{type:"time",value:r,onChange:e=>{let a=e.target.value;if(!a||!t)return;let[r,l]=a.split(":").map(Number),n=new Date(t);n.setHours(r),n.setMinutes(l),s(n)},className:"text-center"})}function x(e){let{date:t,setDate:s}=e;return(0,a.jsxs)(i.AM,{children:[(0,a.jsx)(i.Wv,{asChild:!0,children:(0,a.jsxs)(c.$,{variant:"outline",className:(0,n.cn)("w-full justify-start text-left font-normal",!t&&"text-muted-foreground"),children:[(0,a.jsx)(l.A,{className:"mr-2 h-4 w-4"}),t?(0,r.GP)(t,"yyyy-MM-dd hh:mm a"):(0,a.jsx)("span",{children:"اختر تاريخ ووقت"})]})}),(0,a.jsxs)(i.hl,{className:"w-auto p-0",children:[(0,a.jsx)(d.V,{mode:"single",selected:t,onSelect:e=>{if(!e)return void s(void 0);let a=new Date(e);t&&(a.setHours(t.getHours()),a.setMinutes(t.getMinutes()),a.setSeconds(t.getSeconds())),s(a)},initialFocus:!0}),(0,a.jsx)("div",{className:"p-3 border-t border-border",children:(0,a.jsx)(m,{date:t,setDate:s})})]})]})}},31120:(e,t,s)=>{s.d(t,{T:()=>n});var a=s(95155),r=s(12115),l=s(64269);let n=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...r})});n.displayName="Textarea"},50276:(e,t,s)=>{s.d(t,{V:()=>m});var a=s(95155);s(12115);var r=s(51190),l=s(63263),n=s(66984),c=s(76422),d=s(64269),i=s(3998),o=s(14223);function m(e){let{className:t,classNames:s,showOutsideDays:m=!0,...x}=e;return(0,a.jsx)(n.hv,{showOutsideDays:m,className:(0,d.cn)("p-3",t),locale:c.ar,formatters:{formatCaption:(e,t)=>{var s;let{year:a,month:r}=(0,n.cq)(),l=e.getFullYear(),c=e.getMonth(),d=null!=(s=null==a?void 0:a.getFullYear())?s:l,i=(0,o.GP)(new Date(d,c),"MMMM",{locale:null==t?void 0:t.locale});return"".concat(i," ").concat(d)}},classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,d.cn)((0,i.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected])]:bg-accent/50 first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,d.cn)((0,i.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"text-muted-foreground opacity-50",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...s},components:{IconLeft:e=>{let{...t}=e;return(0,a.jsx)(r.A,{className:"h-4 w-4"})},IconRight:e=>{let{...t}=e;return(0,a.jsx)(l.A,{className:"h-4 w-4"})}},...x})}m.displayName="Calendar"},77679:(e,t,s)=>{s.d(t,{A:()=>F});var a=s(95155),r=s(12115),l=s(3998),n=s(76444),c=s(31120),d=s(11186),i=s(27314),o=s(44381),m=s(76251),x=s(92033),u=s(73180),h=s(54879),p=s(22544),j=s(66942),v=s(15894),f=s(27432),g=s(64269),b=s(51834),y=s(23451),N=s(23639),w=s(30926);let I=(0,w.createServerReference)("40341251e8d632597ecf83a7ab87f3793a83f06b51",w.callServer,void 0,w.findSourceMapURL,"createPaymentVoucher");var C=s(86366),S=s(97916),A=s(5470);let R=h.Ik({date:h.p6({required_error:"التاريخ مطلوب"}),payeeId:h.Yj().min(1,"اسم المستفيد مطلوب"),phoneNumber:h.Yj().optional(),fund:h.Yj().min(1,"الصندوق مطلوب"),details:h.Yj().optional(),currency:h.k5(["USD","IQD"]),totalAmount:h.Yj().or(h.ai()).transform(e=>Number(String(e).replace(/,/g,""))).refine(e=>e>0,{message:"المبلغ يجب أن يكون أكبر من صفر"}),exchangeRate:h.au.number().optional(),purpose:h.k5(["tickets","services"])}),k=e=>{let{currency:t,className:s,...r}=e;return(0,a.jsx)(S.O,{currency:t,className:(0,g.cn)("text-right",s),currencyClassName:(0,g.cn)("USD"===t?"bg-accent text-accent-foreground":"bg-primary text-primary-foreground"),...r})};function F(e){let{onVoucherAdded:t,selectedCurrency:s,onVoucherUpdated:h,isEditing:g,initialData:w}=e,{data:S}=(0,A.Z)(),{user:F}=(0,y.A)(),{toast:D}=(0,v.dj)(),V=(0,p.mN)({resolver:(0,j.u)(R),defaultValues:g?w:{date:new Date,currency:s,totalAmount:void 0,details:"",payeeId:"",phoneNumber:"",exchangeRate:1405,purpose:"tickets",fund:F&&"role"in F?F.boxId:""}}),{control:M,handleSubmit:J,setValue:_,register:E,formState:{errors:Y,isSubmitting:T},reset:O}=V;(0,r.useEffect)(()=>{F&&"role"in F&&F.boxId&&!g&&V.setValue("fund",F.boxId)},[F,g,V]),(0,r.useEffect)(()=>{g||(_("currency",s),_("totalAmount",void 0))},[s,_,g]);let U=(0,r.useMemo)(()=>S?[...(S.clients||[]).map(e=>({value:e.id,label:"عميل: ".concat(e.name)})),...(S.suppliers||[]).map(e=>({value:e.id,label:"مورد: ".concat(e.name)}))]:[],[S]),$=async e=>{let s=D({title:"جاري ".concat(g?"تحديث":"إضافة"," السند...")});try{if(g&&(null==w?void 0:w.id)){let t=await (0,C.o)(w.id,{originalData:e,date:e.date.toISOString()});if(!t.success)throw Error(t.error);h&&h(e)}else{let s=await I({date:e.date.toISOString(),toSupplierId:e.payeeId,amount:e.totalAmount,currency:e.currency,boxId:e.fund,purpose:e.purpose,details:e.details,exchangeRate:e.exchangeRate});if(!s.success)throw Error(s.error);t&&t(e),O()}s.update({id:s.id,title:"تم ".concat(g?"تحديث":"إنشاء"," السند بنجاح")})}catch(e){s.update({id:s.id,title:"حدث خطأ",description:e.message,variant:"destructive"})}};return(0,a.jsxs)("form",{onSubmit:J($),className:"flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"p-6 space-y-6 flex-grow",children:[(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6 items-start",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)(n.J,{htmlFor:"payeeId",children:"اسم المستفيد"}),(0,a.jsx)(p.xI,{name:"payeeId",control:M,render:e=>{let{field:t}=e;return(0,a.jsx)(N.j,{options:U,value:t.value,onValueChange:t.onChange,placeholder:"ابحث عن مورد..."})}}),Y.payeeId&&(0,a.jsx)("p",{className:"text-sm text-destructive mt-1",children:Y.payeeId.message})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)(n.J,{htmlFor:"fund",children:"الصندوق"}),(0,a.jsx)(p.xI,{control:M,name:"fund",render:e=>{let{field:t}=e;return(0,a.jsxs)(d.l6,{value:t.value,onValueChange:t.onChange,children:[(0,a.jsx)(d.bq,{children:(0,a.jsx)(d.yv,{placeholder:"اختر الصندوق..."})}),(0,a.jsx)(d.gC,{children:((null==S?void 0:S.boxes)||[]).map(e=>(0,a.jsx)(d.eb,{value:e.id,children:e.name},e.id))})]})}}),Y.fund&&(0,a.jsx)("p",{className:"text-sm text-destructive mt-1",children:Y.fund.message})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)(n.J,{htmlFor:"purpose",children:"الغرض من الدفع"}),(0,a.jsx)(p.xI,{control:M,name:"purpose",render:e=>{let{field:t}=e;return(0,a.jsxs)(d.l6,{value:t.value,onValueChange:t.onChange,children:[(0,a.jsx)(d.bq,{children:(0,a.jsx)(d.yv,{})}),(0,a.jsxs)(d.gC,{children:[(0,a.jsx)(d.eb,{value:"tickets",children:"تذاكر"}),(0,a.jsx)(d.eb,{value:"services",children:"خدمات"})]})]})}})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)(n.J,{htmlFor:"date",children:"التاريخ"}),(0,a.jsx)(p.xI,{control:M,name:"date",render:e=>{let{field:t}=e;return(0,a.jsx)(f.K,{date:t.value,setDate:t.onChange})}}),Y.date&&(0,a.jsx)("p",{className:"text-sm text-destructive mt-1",children:Y.date.message})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)(n.J,{htmlFor:"totalAmount",children:"المبلغ المدفوع"}),(0,a.jsx)(p.xI,{name:"totalAmount",control:M,render:e=>{let{field:t}=e;return(0,a.jsx)(k,{currency:s,...t,onValueChange:t.onChange})}}),Y.totalAmount&&(0,a.jsx)("p",{className:"text-sm text-destructive mt-1",children:Y.totalAmount.message})]}),"USD"===s&&(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)(n.J,{htmlFor:"exchangeRate",children:"سعر الصرف (مقابل الدينار)"}),(0,a.jsx)(p.xI,{name:"exchangeRate",control:M,render:e=>{let{field:t}=e;return(0,a.jsx)(k,{currency:"IQD",...t,onValueChange:t.onChange})}})]})]})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)(n.J,{htmlFor:"details",children:"تفاصيل إضافية / البيان"}),(0,a.jsx)(c.T,{id:"details",...E("details")}),Y.details&&(0,a.jsx)("p",{className:"text-sm text-destructive mt-1",children:Y.details.message})]})]}),(0,a.jsx)(b.Es,{className:"p-4 border-t bg-background sticky bottom-0",children:(0,a.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)(i.A,{className:"h-4 w-4"})," ",(0,a.jsxs)("span",{children:["المستخدم: ",(null==F?void 0:F.name)||"..."]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)(o.A,{className:"h-4 w-4"})," ",(0,a.jsx)("span",{children:"رقم الفاتورة: (تلقائي)"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(l.$,{type:"button",onClick:()=>{},variant:"outline",disabled:T,children:[(0,a.jsx)(m.A,{className:"me-2 h-4 w-4"}),"حفظ وطباعة"]}),(0,a.jsxs)(l.$,{type:"submit",disabled:T,variant:"destructive",children:[T&&(0,a.jsx)(x.A,{className:"me-2 h-4 w-4 animate-spin"}),(0,a.jsx)(u.A,{className:"me-2 h-4 w-4"}),g?"حفظ التعديلات":"حفظ سند الدفع"]})]})]})})]})}},86366:(e,t,s)=>{s.d(t,{o:()=>r});var a=s(30926);let r=(0,a.createServerReference)("6052254d233f0ea6b36992b2b81ce07178dee95ad7",a.callServer,void 0,a.findSourceMapURL,"updateVoucher")},86948:(e,t,s)=>{s.d(t,{BT:()=>i,Wu:()=>o,ZB:()=>d,Zp:()=>n,aR:()=>c,wL:()=>m});var a=s(95155),r=s(12115),l=s(64269);let n=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("rounded-xl border bg-card text-card-foreground shadow-sm",s),...r})});n.displayName="Card";let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-4 sm:p-6 text-right",s),...r})});c.displayName="CardHeader";let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("h3",{ref:t,className:(0,l.cn)("text-lg sm:text-xl font-bold leading-none tracking-tight",s),...r})});d.displayName="CardTitle";let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("p",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",s),...r})});i.displayName="CardDescription";let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("p-4 sm:p-6 pt-0",s),...r})});o.displayName="CardContent";let m=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-4 sm:p-6 pt-0",s),...r})});m.displayName="CardFooter"},96346:(e,t,s)=>{s.d(t,{A:()=>D});var a=s(95155),r=s(12115),l=s(3998),n=s(76444),c=s(31120),d=s(11186),i=s(27314),o=s(94972),m=s(44381),x=s(76251),u=s(92033),h=s(73180),p=s(54879),j=s(22544),v=s(66942),f=s(15894),g=s(27432),b=s(64269),y=s(51834),N=s(23639),w=s(30926);let I=(0,w.createServerReference)("405181b3416ca6fb6435ab9096a0a68342e5255501",w.callServer,void 0,w.findSourceMapURL,"createStandardReceipt");var C=s(86366),S=s(97916),A=s(5470),R=s(23451);let k=p.Ik({date:p.p6({required_error:"التاريخ مطلوب"}),from:p.Yj().min(1,"اسم الدافع مطلوب"),toBox:p.Yj().min(1,"الصندوق مطلوب"),amount:p.Yj().or(p.ai()).transform(e=>Number(String(e).replace(/,/g,""))).refine(e=>e>0,{message:"المبلغ يجب أن يكون أكبر من صفر"}),currency:p.k5(["USD","IQD"]),details:p.Yj().optional()}),F=e=>{let{currency:t,className:s,...r}=e;return(0,a.jsx)(S.O,{currency:t,className:(0,b.cn)("text-right",s),currencyClassName:(0,b.cn)("USD"===t?"bg-accent text-accent-foreground":"bg-primary text-primary-foreground"),...r})};function D(e){let{onVoucherAdded:t,selectedCurrency:s,isEditing:p,initialData:b,onVoucherUpdated:w}=e,{data:S}=(0,A.Z)(),{user:D}=(0,R.A)(),{toast:V}=(0,f.dj)(),M=(0,j.mN)({resolver:(0,v.u)(k),defaultValues:p?b:{date:new Date,currency:s,amount:void 0,details:"",from:"",toBox:D&&"role"in D?D.boxId:""}});(0,r.useEffect)(()=>{D&&"role"in D&&D.boxId&&!p&&M.setValue("toBox",D.boxId)},[D,p,M]);let{control:J,handleSubmit:_,setValue:E,register:Y,formState:{errors:T,isSubmitting:O},reset:U}=M;(0,r.useEffect)(()=>{p||(E("currency",s),E("amount",void 0))},[s,E,p]);let $=(0,r.useMemo)(()=>{var e,t;let s=M.watch("toBox");return(null==S||null==(t=S.boxes)||null==(e=t.find(e=>e.id===s))?void 0:e.name)||"غير محدد"},[M,null==S?void 0:S.boxes]),B=async e=>{let s=V({title:"جاري ".concat(p?"تحديث":"إضافة"," السند...")});try{if(p&&(null==b?void 0:b.id)){let t=await (0,C.o)(b.id,{originalData:e,date:e.date.toISOString()});if(!t.success)throw Error(t.error);w&&w(e)}else{let s=await I({date:e.date.toISOString(),from:e.from,toBox:e.toBox,amount:e.amount,currency:e.currency,details:e.details});if(!s.success)throw Error(s.error);t&&t(e),U()}s.update({id:s.id,title:"تم ".concat(p?"تحديث":"إنشاء"," السند بنجاح")})}catch(e){s.update({id:s.id,title:"حدث خطأ",description:e.message,variant:"destructive"})}};return(0,a.jsxs)("form",{onSubmit:_(B),className:"flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"p-6 space-y-6 flex-grow",children:[(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6 items-start",children:[(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)(n.J,{htmlFor:"date",children:"التاريخ"}),(0,a.jsx)(j.xI,{control:J,name:"date",render:e=>{let{field:t}=e;return(0,a.jsx)(g.K,{date:t.value,setDate:t.onChange})}}),T.date&&(0,a.jsx)("p",{className:"text-sm text-destructive mt-1",children:T.date.message})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)(n.J,{htmlFor:"from",children:"استلام من"}),(0,a.jsx)(j.xI,{name:"from",control:J,render:e=>{let{field:t}=e;return(0,a.jsx)(N.j,{searchAction:"all",value:t.value,onValueChange:t.onChange,placeholder:"ابحث عن عميل أو مورد..."})}}),T.from&&(0,a.jsx)("p",{className:"text-destructive text-sm mt-1",children:T.from.message})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)(n.J,{htmlFor:"toBox",children:"إيداع في صندوق"}),(0,a.jsx)(j.xI,{name:"toBox",control:J,render:e=>{let{field:t}=e;return(0,a.jsxs)(d.l6,{onValueChange:t.onChange,value:t.value,children:[(0,a.jsx)(d.bq,{children:(0,a.jsx)(d.yv,{placeholder:"اختر صندوق..."})}),(0,a.jsx)(d.gC,{children:((null==S?void 0:S.boxes)||[]).map(e=>(0,a.jsx)(d.eb,{value:e.id,children:e.name},e.id))})]})}}),T.toBox&&(0,a.jsx)("p",{className:"text-destructive text-sm mt-1",children:T.toBox.message})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)(n.J,{htmlFor:"amount",children:"المبلغ المستلم"}),(0,a.jsx)(j.xI,{name:"amount",control:J,render:e=>{let{field:t}=e;return(0,a.jsx)(F,{currency:s,...t,onValueChange:t.onChange})}}),T.amount&&(0,a.jsx)("p",{className:"text-destructive text-sm mt-1",children:T.amount.message})]})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)(n.J,{htmlFor:"details",children:"تفاصيل إضافية / البيان"}),(0,a.jsx)(c.T,{id:"details",...Y("details")}),T.details&&(0,a.jsx)("p",{className:"text-destructive text-sm mt-1",children:T.details.message})]})]}),(0,a.jsx)(y.Es,{className:"p-4 border-t bg-background sticky bottom-0",children:(0,a.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)(i.A,{className:"h-4 w-4"})," ",(0,a.jsxs)("span",{children:["المستخدم: ",(null==D?void 0:D.name)||"..."]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)(o.A,{className:"h-4 w-4"})," ",(0,a.jsxs)("span",{children:["الصندوق: ",$]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)(m.A,{className:"h-4 w-4"})," ",(0,a.jsx)("span",{children:"رقم الفاتورة: (تلقائي)"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(l.$,{type:"button",onClick:()=>{},variant:"outline",disabled:O,children:[(0,a.jsx)(x.A,{className:"me-2 h-4 w-4"}),"حفظ وطباعة"]}),(0,a.jsxs)(l.$,{type:"submit",disabled:O,children:[O&&(0,a.jsx)(u.A,{className:"me-2 h-4 w-4 animate-spin"}),(0,a.jsx)(h.A,{className:"me-2 h-4 w-4"}),p?"حفظ التعديلات":"حفظ السند"]})]})]})})]})}},97916:(e,t,s)=>{s.d(t,{O:()=>d});var a=s(95155),r=s(12115),l=s(65142),n=s(64269);let c=e=>{if("string"!=typeof e||""===e.trim())return;let t=parseFloat(e.replace(/,/g,""));return isNaN(t)?void 0:t},d=r.forwardRef((e,t)=>{let{value:s,onValueChange:d,className:i,allowNegative:o=!1,currency:m,currencyClassName:x,direction:u="rtl",...h}=e,p=e=>{if(null==e||""===e)return"";let t="string"==typeof e?c(e):e;return void 0===t?String(e):new Intl.NumberFormat("en-US").format(t)},[j,v]=r.useState(p(s));r.useEffect(()=>{v(p(s))},[s]);let f={...h,ref:t,type:"text",inputMode:"decimal",placeholder:"0.00",value:j||"",onChange:e=>{let t=e.target.value.replace(/,/g,"");if((o?/^-?\d*\.?\d*$/:/^\d*\.?\d*$/).test(t)||""===t){let e=c(t);v(void 0!==e?p(e):t),d&&d(e)}}};return m?(0,a.jsxs)("div",{className:(0,n.cn)("relative flex items-center w-full",i),children:[(0,a.jsx)(l.p,{...f,className:(0,n.cn)("z-10 text-right w-full","rtl"===u?"rounded-l-none rounded-r-lg border-l-0":"rounded-r-none rounded-l-lg border-r-0")}),(0,a.jsx)("div",{className:(0,n.cn)("p-2 bg-muted border h-full flex items-center",x,"rtl"===u?"rounded-l-lg":"rounded-r-lg"),children:(0,a.jsx)("span",{className:"text-xs font-semibold",children:m})})]}):(0,a.jsx)(l.p,{...f,className:(0,n.cn)("text-right",i)})});d.displayName="NumericInput"},98389:(e,t,s)=>{s.d(t,{A:()=>V});var a=s(95155),r=s(12115),l=s(3998),n=s(76444),c=s(31120),d=s(11186),i=s(28127),o=s(27314),m=s(44381),x=s(76251),u=s(92033),h=s(73180),p=s(54879),j=s(22544),v=s(66942),f=s(15894),g=s(26333),b=s(50276),y=s(14223),N=s(64269),w=s(51834),I=s(23451),C=s(30926);let S=(0,C.createServerReference)("4013135d45b93942093eced825516b1e20941831b7",C.callServer,void 0,C.findSourceMapURL,"createExpenseVoucher");var A=s(86366),R=s(97916),k=s(65142);let F=p.Ik({date:p.p6({required_error:"التاريخ مطلوب"}),expenseType:p.Yj().min(1,"نوع المصروف مطلوب"),amount:p.Yj().or(p.ai()).transform(e=>Number(String(e).replace(/,/g,""))).refine(e=>e>0,{message:"المبلغ يجب أن يكون أكبر من صفر"}),currency:p.k5(["USD","IQD"]),payee:p.Yj().optional(),boxId:p.Yj().min(1,"الصندوق مطلوب"),notes:p.Yj().optional(),exchangeRate:p.au.number().optional(),attachments:p.bz().optional()}),D=e=>{let{currency:t,className:s,...r}=e;return(0,a.jsx)(R.O,{currency:t,className:(0,N.cn)("text-right",s),currencyClassName:(0,N.cn)("USD"===t?"bg-accent text-accent-foreground":"bg-primary text-primary-foreground"),...r})};function V(e){let{boxes:t,onVoucherAdded:s,selectedCurrency:p,onVoucherUpdated:C,isEditing:R,initialData:V}=e,{toast:M}=(0,f.dj)(),[J,_]=(0,r.useState)(!1),{user:E}=(0,I.A)(),Y=(0,j.mN)({resolver:(0,v.u)(F),defaultValues:R?V:{date:new Date,currency:p,amount:0,notes:"",payee:"",boxId:E&&"role"in E?E.boxId:""}});(0,r.useEffect)(()=>{E&&"role"in E&&E.boxId&&!R&&Y.setValue("boxId",E.boxId)},[E,R,Y]);let{control:T,handleSubmit:O,setValue:U,register:$,formState:{errors:B,isSubmitting:q},reset:L}=Y;(0,r.useEffect)(()=>{R||(U("currency",p),U("amount",0))},[p,U,R]);let z=async e=>{try{if(R&&(null==V?void 0:V.id)){let t=await (0,A.o)(V.id,{...e,date:e.date.toISOString()});t.success?(M({title:"تم تحديث السند بنجاح"}),C&&C({})):M({title:"خطأ في التحديث",description:t.error,variant:"destructive"})}else{let t=await S({date:(0,y.GP)(e.date,"yyyy-MM-dd"),expenseType:e.expenseType,amount:e.amount,currency:e.currency,boxId:e.boxId,notes:e.notes,payee:e.payee,exchangeRate:e.exchangeRate});if(t.success)M({title:"تم تسجيل المصروف بنجاح"}),s&&s({}),L();else throw Error(t.error)}}catch(e){M({title:"حدث خطأ",description:e.message,variant:"destructive"})}};return(0,a.jsxs)("form",{onSubmit:O(z),className:"space-y-4",children:[(0,a.jsx)("div",{className:"p-6 space-y-6 flex-grow",children:(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6 items-start",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)(n.J,{htmlFor:"date",children:"التاريخ"}),(0,a.jsx)(j.xI,{control:T,name:"date",render:e=>{let{field:t}=e;return(0,a.jsxs)(g.AM,{open:J,onOpenChange:_,children:[(0,a.jsx)(g.Wv,{asChild:!0,children:(0,a.jsxs)(l.$,{variant:"outline",className:(0,N.cn)("w-full justify-start text-left font-normal",!t.value&&"text-muted-foreground"),children:[t.value?(0,y.GP)(t.value,"yyyy-MM-dd"):(0,a.jsx)("span",{children:"اختر تاريخ"}),(0,a.jsx)(i.A,{className:"ms-auto h-4 w-4 opacity-50"})]})}),(0,a.jsx)(g.hl,{className:"w-auto p-0",children:(0,a.jsx)(b.V,{mode:"single",selected:t.value,onSelect:e=>{e&&t.onChange(e),_(!1)}})})]})}}),B.date&&(0,a.jsx)("p",{className:"text-sm text-destructive h-4",children:B.date.message})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)(n.J,{htmlFor:"payee",children:"الجهة المستفيدة (اختياري)"}),(0,a.jsx)(k.p,{id:"payee",placeholder:"مثال: موظف، شركة الكهرباء...",...$("payee")})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)(n.J,{htmlFor:"notes",children:"التفاصيل / الملاحظات"}),(0,a.jsx)(c.T,{id:"notes",placeholder:"أضف تفاصيل إضافية هنا...",...$("notes")})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)(n.J,{htmlFor:"expenseType",children:"نوع المصروف"}),(0,a.jsx)(j.xI,{name:"expenseType",control:T,render:e=>{let{field:t}=e;return(0,a.jsxs)(d.l6,{onValueChange:t.onChange,value:t.value,children:[(0,a.jsx)(d.bq,{id:"expenseType",children:(0,a.jsx)(d.yv,{placeholder:"اختر نوع المصروف..."})}),(0,a.jsxs)(d.gC,{children:[(0,a.jsx)(d.eb,{value:"salaries",children:"رواتب"}),(0,a.jsx)(d.eb,{value:"rent",children:"إيجار"}),(0,a.jsx)(d.eb,{value:"utilities",children:"فواتير وخدمات"}),(0,a.jsx)(d.eb,{value:"supplies",children:"قرطاسية ومستلزمات"})]})]})}}),B.expenseType&&(0,a.jsx)("p",{className:"text-sm text-destructive",children:B.expenseType.message})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)(n.J,{htmlFor:"boxId",children:"الصندوق"}),(0,a.jsx)(j.xI,{name:"boxId",control:T,render:e=>{let{field:s}=e;return(0,a.jsxs)(d.l6,{onValueChange:s.onChange,value:s.value,children:[(0,a.jsx)(d.bq,{id:"boxId",children:(0,a.jsx)(d.yv,{placeholder:"اختر الصندوق..."})}),(0,a.jsx)(d.gC,{children:t.map(e=>(0,a.jsx)(d.eb,{value:e.id,children:e.name},e.id))})]})}}),B.boxId&&(0,a.jsx)("p",{className:"text-sm text-destructive",children:B.boxId.message})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)(n.J,{htmlFor:"amount",children:"المبلغ"}),(0,a.jsx)(j.xI,{name:"amount",control:T,render:e=>{let{field:t}=e;return(0,a.jsx)(D,{currency:p,...t,onValueChange:t.onChange})}}),B.amount&&(0,a.jsx)("p",{className:"text-sm text-destructive",children:B.amount.message})]}),"USD"===p&&(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)(n.J,{htmlFor:"exchangeRate",children:"سعر الصرف (مقابل الدينار)"}),(0,a.jsx)(j.xI,{name:"exchangeRate",control:T,render:e=>{let{field:t}=e;return(0,a.jsx)(D,{currency:"IQD",...t,onValueChange:t.onChange})}})]})]})]})}),(0,a.jsx)(w.Es,{className:"p-4 border-t bg-background sticky bottom-0",children:(0,a.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)(o.A,{className:"h-4 w-4"})," ",(0,a.jsxs)("span",{children:["المستخدم: ",(null==E?void 0:E.name)||"..."]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)(m.A,{className:"h-4 w-4"})," ",(0,a.jsx)("span",{children:"رقم الفاتورة: (تلقائي)"})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(l.$,{type:"button",onClick:()=>{},variant:"outline",disabled:q,children:[(0,a.jsx)(x.A,{className:"me-2 h-4 w-4"}),"حفظ وطباعة"]}),(0,a.jsxs)(l.$,{type:"submit",disabled:q,children:[q&&(0,a.jsx)(u.A,{className:"me-2 h-4 w-4 animate-spin"}),(0,a.jsx)(h.A,{className:"me-2 h-4 w-4"}),R?"حفظ التعديلات":"حفظ سند المصاريف"]})]})]})})]})}}}]);