"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4762],{3998:(e,r,t)=>{t.d(r,{$:()=>c,r:()=>d});var a=t(95155),s=t(12115),i=t(32467),n=t(83101),o=t(64269);let d=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-bold ring-offset-background transition-transform transform-gpu hover:-translate-y-0.5 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-md hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",accent:"bg-accent text-accent-foreground shadow-md hover:bg-accent/90"},size:{default:"h-10 px-4 py-2 [&_svg]:size-4",sm:"h-9 rounded-md px-3 [&_svg]:size-4",lg:"h-11 rounded-lg px-8 [&_svg]:size-5",icon:"h-10 w-10 [&_svg]:size-5"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,r)=>{let{className:t,variant:s,size:n,asChild:c=!1,...l}=e,u=c?i.DX:"button";return(0,a.jsx)(u,{className:(0,o.cn)(d({variant:s,size:n,className:t})),ref:r,...l})});c.displayName="Button"},14585:(e,r,t)=>{let a,s,i;t.d(r,{db:()=>i,j:()=>s,y:()=>a});var n=t(52078),o=t(19708),d=t(81328);a=(0,n.Dk)().length?(0,n.Dk)()[0]:(0,n.Wp)({apiKey:"AIzaSyCtlF3onBhtwg0Hh3iOOEjygi9mj81wxrA",authDomain:"fly4all-78277122-3cbd0.firebaseapp.com",projectId:"fly4all-78277122-3cbd0",storageBucket:"fly4all-78277122-3cbd0.firebasestorage.app",messagingSenderId:"108505683067",appId:"1:108505683067:web:3ab7755349630154e77ede"}),s=(0,d.xI)(a),i=(0,o.aU)(a)},15894:(e,r,t)=>{t.d(r,{dj:()=>u});var a=t(12115);let s=0,i=new Map,n=e=>{if(i.has(e))return;let r=setTimeout(()=>{i.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);i.set(e,r)},o=[],d={toasts:[]};function c(e){d=((e,r)=>{switch(r.type){case"ADD_TOAST":return{...e,toasts:[r.toast,...e.toasts].slice(0,3)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===r.toast.id?{...e,...r.toast}:e)};case"DISMISS_TOAST":{let{toastId:t}=r;return t?n(t):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===t||void 0===t?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===r.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==r.toastId)}}})(d,e),o.forEach(e=>{e(d)})}function l(e){let{...r}=e,t=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>c({type:"DISMISS_TOAST",toastId:t});return r.variant||(r.variant="default"),c({type:"ADD_TOAST",toast:{...r,id:t,open:!0,onOpenChange:e=>{e||a()}}}),{id:t,dismiss:a,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function u(){let[e,r]=a.useState(d);return a.useEffect(()=>(o.push(r),()=>{let e=o.indexOf(r);e>-1&&o.splice(e,1)}),[e]),{...e,toast:l,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},23451:(e,r,t)=>{t.d(r,{O:()=>h,A:()=>b});var a=t(95155),s=t(12115),i=t(81328),n=t(19708),o=t(14585),d=t(30926);let c=(0,d.createServerReference)("7faf63d9d8686c0ff053833c82fd60b3e9c6fa0bff",d.callServer,void 0,d.findSourceMapURL,"getCurrentUserFromSession");var l=t(25990);let u=(0,d.createServerReference)("4085aac590f12a4a641b5bc7fff47d5353af49510e",d.callServer,void 0,d.findSourceMapURL,"signInAsUser"),m=(0,d.createServerReference)("00454095f373f8afcf3cd8b88a3e9643ba6181edb6",d.callServer,void 0,d.findSourceMapURL,"logoutUser");var f=t(20063),p=t(38220),v=t(15894);let g=(0,s.createContext)(void 0);function h(e){let{children:r}=e,[t,d]=(0,s.useState)(null),[h,b]=(0,s.useState)(!0),[y,S]=(0,s.useState)("");(0,f.useRouter)(),(0,f.usePathname)();let[w,_]=(0,s.useState)(0),{toast:A}=(0,v.dj)(),E=s.useRef(Date.now()),T=(0,s.useCallback)(async()=>{try{let e=await c();d(e)}catch(e){console.error("Failed to revalidate user session:",e),d(null)}},[]);(0,s.useEffect)(()=>{(async()=>{try{let e=await c();e&&d(e)}catch(e){console.error("Auth initialization error:",e),d(null)}finally{b(!1)}})()},[]),(0,s.useEffect)(()=>{if(!t||!("uid"in t))return void _(0);let e=(0,n.P)((0,n.rJ)(o.db,"userChats/".concat(t.uid,"/summaries"))),r=(0,n.aQ)(e,e=>{let r=0,a=Date.now();e.docChanges().forEach(e=>{if("modified"===e.type){let r=e.doc.data();r.lastMessage&&r.lastMessage.senderId!==t.uid&&a-E.current>3e3&&(A({title:"رسالة جديدة من ".concat(r.otherMemberName),description:r.lastMessage.text}),E.current=a)}}),e.forEach(e=>{r+=e.data().unreadCount||0}),_(r)});return()=>r()},[t,A]);let k=async(e,r)=>{b(!0),S("");try{let t=await (0,i.x9)(o.j,e,r),a=await (0,i.p9)(t.user,!0),s=await (0,l.L)(a);if(s.error||!s.success||!s.user)throw Error(s.error||"Failed to create session or retrieve user data.");return d(s.user),{success:!0}}catch(r){console.error("Sign in failed:",r);let e="An unexpected error occurred.";if(r.code)switch(r.code){case"auth/user-not-found":case"auth/wrong-password":case"auth/invalid-credential":e="البريد الإلكتروني أو كلمة المرور غير صحيحة.";break;case"auth/invalid-email":e="صيغة البريد الإلكتروني غير صحيحة.";break;default:e=r.message}else e=r.message;return S(e),{success:!1,error:e}}finally{b(!1)}},x=async e=>{try{let{success:r,customToken:t,error:a}=await u(e);if(r&&t){await (0,i.p)(o.j,t);let e=await (0,i.p9)(o.j.currentUser,!0),r=await (0,l.L)(e);if(r.error||!r.user)throw Error(r.error||"Failed to establish session for user.");d(r.user)}else throw Error(a||"Failed to get custom token.")}catch(r){console.error("Sign in as user ".concat(e," failed:"),r)}},C=async()=>{b(!0),await (0,i.CI)(o.j),await m(),d(null),window.location.href="/"};return(0,a.jsx)(g.Provider,{value:{user:t,loading:h,signIn:k,signOut:C,hasPermission:e=>!!t&&(!("isClient"in t)||!t.isClient)&&(0,p._m)(t,e),signInAsUser:x,revalidateUser:T,unreadChatCount:w,error:y},children:r})}function b(){let e=(0,s.useContext)(g);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},25990:(e,r,t)=>{t.d(r,{L:()=>s});var a=t(30926);let s=(0,a.createServerReference)("40fc6757a7ed8ba6cf86a7bf30e6bf0934f153f439",a.callServer,void 0,a.findSourceMapURL,"loginUser")},38220:(e,r,t)=>{t.d(r,{Mh:()=>a,_m:()=>s});let a=[{id:"dashboard",name:"لوحة التحكم",permissions:[{id:"dashboard:read",name:"عرض"}]},{id:"bookings",name:"حجوزات الطيران",permissions:[{id:"bookings:read",name:"عرض"},{id:"bookings:create",name:"إنشاء"},{id:"bookings:update",name:"تعديل"},{id:"bookings:delete",name:"حذف"},{id:"bookings:operations",name:"عمليات"}]},{id:"visas",name:"طلبات الفيزا",permissions:[{id:"visas:read",name:"عرض"},{id:"visas:create",name:"إنشاء"},{id:"visas:update",name:"تعديل"},{id:"visas:delete",name:"حذف"}]},{id:"subscriptions",name:"الاشتراكات",permissions:[{id:"subscriptions:read",name:"عرض"},{id:"subscriptions:create",name:"إنشاء"},{id:"subscriptions:update",name:"تعديل"},{id:"subscriptions:delete",name:"حذف"},{id:"subscriptions:payments",name:"دفع الأقساط"}]},{id:"vouchers",name:"السندات والقيود",permissions:[{id:"vouchers:read",name:"عرض"},{id:"vouchers:create",name:"إنشاء"},{id:"vouchers:update",name:"تعديل"},{id:"vouchers:delete",name:"حذف"}]},{id:"remittances",name:"الحوالات",permissions:[{id:"remittances:read",name:"عرض"},{id:"remittances:create",name:"إنشاء"},{id:"remittances:audit",name:"تدقيق"},{id:"remittances:receive",name:"استلام"}]},{id:"relations",name:"العلاقات (العملاء والموردين)",permissions:[{id:"relations:read",name:"عرض"},{id:"relations:create",name:"إنشاء"},{id:"relations:update",name:"تعديل"},{id:"relations:delete",name:"حذف"},{id:"relations:credentials",name:"إدارة الدخول"}]},{id:"users",name:"المستخدمون والأدوار",permissions:[{id:"users:read",name:"عرض"},{id:"users:create",name:"إنشاء"},{id:"users:update",name:"تعديل"},{id:"users:delete",name:"حذف"},{id:"users:permissions",name:"إدارة الصلاحيات"}]},{id:"reports",name:"التقارير",permissions:[{id:"reports:read:all",name:"عرض الكل"},{id:"reports:account_statement",name:"كشف حساب"},{id:"reports:debts",name:"الأرصدة"},{id:"reports:profits",name:"الأرباح"},{id:"reports:flight_analysis",name:"تحليل الرحلات"}]},{id:"settings",name:"الإعدادات العامة",permissions:[{id:"settings:read",name:"عرض"},{id:"settings:update",name:"تعديل"}]},{id:"system",name:"أدوات النظام",permissions:[{id:"system:audit_log:read",name:"سجل النشاطات"},{id:"system:error_log:read",name:"سجل الأخطاء"},{id:"system:data_audit:run",name:"تشغيل فحص البيانات"}]}],s=(e,r)=>!!e&&("public"===r||(!("isClient"in e)||!e.isClient)&&("role"in e&&"admin"===e.role||!!(e.permissions&&Array.isArray(e.permissions))&&(!!(r.startsWith("reports:")&&e.permissions.includes("reports:read:all"))||e.permissions.includes(r))))},64269:(e,r,t)=>{t.d(r,{cn:()=>i,pY:()=>n});var a=t(2821),s=t(75889);function i(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,s.QP)((0,a.$)(r))}let n=(e,r,t,a)=>{let s={};return Object.keys(e).map(e=>e.toLowerCase().trim()),t.forEach(r=>{let t,i=null==a?void 0:a[r.id],n=(r.aliases||(null==i?void 0:i.aliases)||[r.label]).map(e=>e.toLowerCase().trim()),o=Array.from(new Set([r.id,r.label,...n].map(e=>e.toLowerCase().trim()))),d=Object.keys(e).find(e=>o.includes(e.toLowerCase().trim()));d&&(t=e[d]),null==t||""===String(t).trim()?s[r.id]=void 0!==r.defaultValue?r.defaultValue:"number"===r.dataType?0:"":"number"===r.dataType?s[r.id]=parseFloat(String(t).trim().replace(/,/g,""))||0:s[r.id]=String(t).trim()}),s}}}]);