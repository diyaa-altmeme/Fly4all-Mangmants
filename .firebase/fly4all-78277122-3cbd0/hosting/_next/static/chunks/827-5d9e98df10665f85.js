"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[827],{3730:(e,t,a)=>{a.d(t,{Ke:()=>n,Nt:()=>r,R6:()=>l});var s=a(57259);let r=s.bL,l=s.R6,n=s.Ke},6259:(e,t,a)=>{a.d(t,{M5:()=>f,SQ:()=>p,_2:()=>h,lv:()=>u,mB:()=>j,nV:()=>x,rI:()=>o,ty:()=>m});var s=a(95155),r=a(12115),l=a(47971),n=a(63263),d=a(72251),c=a(75797),i=a(64269);let o=l.bL,m=l.l9;l.YJ,l.ZL;let u=l.Pb;l.z6;let x=r.forwardRef((e,t)=>{let{className:a,inset:r,children:d,...c}=e;return(0,s.jsxs)(l.ZP,{ref:t,className:(0,i.cn)("flex cursor-default gap-2 select-none items-center rounded-md px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",a),...c,children:[(0,s.jsx)(n.A,{className:"mr-auto h-4 w-4"}),d]})});x.displayName=l.ZP.displayName;let f=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.G5,{ref:t,className:(0,i.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})});f.displayName=l.G5.displayName;let p=r.forwardRef((e,t)=>{let{className:a,sideOffset:r=4,...n}=e;return(0,s.jsx)(l.ZL,{children:(0,s.jsx)(l.UC,{ref:t,sideOffset:r,className:(0,i.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...n})})});p.displayName=l.UC.displayName;let h=r.forwardRef((e,t)=>{let{className:a,inset:r,...n}=e;return(0,s.jsx)(l.q7,{ref:t,className:(0,i.cn)("relative flex cursor-default select-none items-center gap-2 rounded-md px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",a),...n})});h.displayName=l.q7.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,checked:n,...c}=e;return(0,s.jsxs)(l.H_,{ref:t,className:(0,i.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pr-8 pl-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:n,...c,children:[(0,s.jsx)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(l.VF,{children:(0,s.jsx)(d.A,{className:"h-4 w-4"})})}),r]})}).displayName=l.H_.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,...n}=e;return(0,s.jsxs)(l.hN,{ref:t,className:(0,i.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pr-8 pl-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...n,children:[(0,s.jsx)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(l.VF,{children:(0,s.jsx)(c.A,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=l.hN.displayName,r.forwardRef((e,t)=>{let{className:a,inset:r,...n}=e;return(0,s.jsx)(l.JU,{ref:t,className:(0,i.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pr-8",a),...n})}).displayName=l.JU.displayName;let j=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.wv,{ref:t,className:(0,i.cn)("-mx-1 my-1 h-px bg-muted",a),...r})});j.displayName=l.wv.displayName},18332:(e,t,a)=>{a.d(t,{Fc:()=>c,TN:()=>o,XL:()=>i});var s=a(95155),r=a(12115),l=a(83101),n=a(64269);let d=(0,l.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),c=r.forwardRef((e,t)=>{let{className:a,variant:r,...l}=e;return(0,s.jsx)("div",{ref:t,role:"alert",className:(0,n.cn)(d({variant:r}),a),...l})});c.displayName="Alert";let i=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("h5",{ref:t,className:(0,n.cn)("mb-1 font-medium leading-none tracking-tight",a),...r})});i.displayName="AlertTitle";let o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("text-sm [&_p]:leading-relaxed",a),...r})});o.displayName="AlertDescription"},20243:(e,t,a)=>{a.d(t,{E:()=>l});var s=a(95155),r=a(64269);function l(e){let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,r.cn)("animate-pulse rounded-md bg-muted",t),...a})}},24896:(e,t,a)=>{a.d(t,{A:()=>n});var s=a(95155),r=a(93037),l=a(34486);function n(){return(0,s.jsx)("div",{className:"flex h-screen w-full items-center justify-center bg-background",children:(0,s.jsx)(l.P.div,{animate:{y:[0,-10,0],rotate:[0,5,0,-5,0]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"},children:(0,s.jsx)(r.A,{className:"h-16 w-16 text-primary"})})})}},31120:(e,t,a)=>{a.d(t,{T:()=>n});var s=a(95155),r=a(12115),l=a(64269);let n=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...r})});n.displayName="Textarea"},31868:(e,t,a)=>{a.d(t,{default:()=>o});var s=a(95155),r=a(12115),l=a(20063),n=a(18332),d=a(7545),c=a(23451),i=a(24896);function o(e){let{children:t,requiredPermission:a}=e,{user:o,loading:m,hasPermission:u}=(0,c.A)(),x=(0,l.useRouter)(),[f,p]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{if(!m){if(!o)return void x.replace("/auth/login");a&&!u(a)?p(!1):p(!0)}},[o,m,a,u,x]),m||!f)?m||f||!o?(0,s.jsx)(i.A,{}):(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,s.jsxs)(n.Fc,{variant:"destructive",className:"max-w-md",children:[(0,s.jsx)(d.A,{className:"h-4 w-4"}),(0,s.jsx)(n.XL,{children:"وصول مرفوض!"}),(0,s.jsx)(n.TN,{children:"ليس لديك الصلاحية المطلوبة للوصول إلى هذه الصفحة. يرجى التواصل مع مدير النظام."})]})}):(0,s.jsx)(s.Fragment,{children:t})}},37030:(e,t,a)=>{a.d(t,{S:()=>r});var s=a(30926);let r=(0,s.createServerReference)("7f4587568c1e868c07486b8dc08163d3dd703caa89",s.callServer,void 0,s.findSourceMapURL,"getChartOfAccounts")},41052:(e,t,a)=>{a.d(t,{C5:()=>v,MJ:()=>h,Rr:()=>j,eI:()=>f,lR:()=>p,lV:()=>i,zB:()=>m});var s=a(95155),r=a(12115),l=a(32467),n=a(22544),d=a(64269),c=a(76444);let i=n.Op,o=r.createContext({}),m=e=>{let{...t}=e;return(0,s.jsx)(o.Provider,{value:{name:t.name},children:(0,s.jsx)(n.xI,{...t})})},u=()=>{let e=r.useContext(o),t=r.useContext(x),{getFieldState:a,formState:s}=(0,n.xW)(),l=a(e.name,s);if(!e)throw Error("useFormField should be used within <FormField>");let{id:d}=t;return{id:d,name:e.name,formItemId:"".concat(d,"-form-item"),formDescriptionId:"".concat(d,"-form-item-description"),formMessageId:"".concat(d,"-form-item-message"),...l}},x=r.createContext({}),f=r.forwardRef((e,t)=>{let{className:a,...l}=e,n=r.useId();return(0,s.jsx)(x.Provider,{value:{id:n},children:(0,s.jsx)("div",{ref:t,className:(0,d.cn)("space-y-2",a),...l})})});f.displayName="FormItem";let p=r.forwardRef((e,t)=>{let{className:a,...r}=e,{error:l,formItemId:n}=u();return(0,s.jsx)(c.J,{ref:t,className:(0,d.cn)(l&&"text-destructive",a),htmlFor:n,...r})});p.displayName="FormLabel";let h=r.forwardRef((e,t)=>{let{...a}=e,{error:r,formItemId:n,formDescriptionId:d,formMessageId:c}=u();return(0,s.jsx)(l.DX,{ref:t,id:n,"aria-describedby":r?"".concat(d," ").concat(c):"".concat(d),"aria-invalid":!!r,...a})});h.displayName="FormControl";let j=r.forwardRef((e,t)=>{let{className:a,...r}=e,{formDescriptionId:l}=u();return(0,s.jsx)("p",{ref:t,id:l,className:(0,d.cn)("text-sm text-muted-foreground",a),...r})});j.displayName="FormDescription";let v=r.forwardRef((e,t)=>{var a;let{className:r,children:l,...n}=e,{error:c,formMessageId:i}=u(),o=c?String(null!=(a=null==c?void 0:c.message)?a:""):l;return o?(0,s.jsx)("p",{ref:t,id:i,className:(0,d.cn)("text-sm font-medium text-destructive",r),...n,children:o}):null});v.displayName="FormMessage"},41898:(e,t,a)=>{a.d(t,{default:()=>X});var s=a(95155),r=a(12115),l=a(86948),n=a(20243),d=a(15894),c=a(3998),i=a(22452),o=a(13381),m=a(50705),u=a(94374),x=a(82863),f=a(27314),p=a(63830),h=a(94972),j=a(59729),v=a(63263),g=a(64269),N=a(6259),b=a(28263),y=a(88964),w=a(13630),A=a(30926);let R=(0,A.createServerReference)("40242c751622e84910e790a1742420d90078e94a9c",A.callServer,void 0,A.findSourceMapURL,"deleteAccount");var C=a(98053),S=a(51834),I=a(92033),k=a(73180),z=a(22544),E=a(54879),L=a(66942),F=a(41052),M=a(65142);let _=(0,A.createServerReference)("406fd1b263f26f83be7d1611e64b70584dc60ef87e",A.callServer,void 0,A.findSourceMapURL,"generateAccountCode"),Z=(0,A.createServerReference)("601ddb4a17d4e0bdb19f2a232ffc3a6c9ea6194cac",A.callServer,void 0,A.findSourceMapURL,"updateAccount"),B=(0,A.createServerReference)("4018add885423f0f5eb9894fc318abfad4e8b1fada",A.callServer,void 0,A.findSourceMapURL,"createAccount");var D=a(11186),J=a(31120);let V=E.Ik({name:E.Yj().min(2,"اسم الحساب مطلوب."),type:E.Yj().min(1,"نوع الحساب مطلوب."),parentId:E.Yj().nullable(),code:E.Yj().min(1,"الكود مطلوب."),description:E.Yj().optional()});function U(e){let{allAccounts:t,onAccountAdded:a,children:l,isEditing:n=!1,account:i,parentId:o}=e,[m,u]=(0,r.useState)(!1),[x,f]=(0,r.useState)(!1),{toast:p}=(0,d.dj)(),h=(0,z.mN)({resolver:(0,L.u)(V)}),j=h.watch("parentId"),v=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=[];return e.forEach(e=>{let s="—".repeat(t);a.push({label:"".concat(s," ").concat(e.code," - ").concat(e.name),value:e.id}),e.children&&(a=a.concat(v(e.children,t+1)))}),a},g=[{label:"رئيسي (بدون أب)",value:"root"},...v(t)],N=async()=>{f(!0);try{let e=h.getValues("parentId"),t=await _("root"===e?null:e);h.setValue("code",t)}catch(e){p({title:"خطأ",description:"فشل إنشاء الكود: ".concat(e.message),variant:"destructive"})}finally{f(!1)}};(0,r.useEffect)(()=>{if(m)if(n&&i)h.reset({name:i.name,type:i.type,parentId:i.parentId,code:i.code,description:i.description});else{let e=o?t.find(e=>e.id===o):null;h.reset({name:"",type:e?e.type:"asset",parentId:o||null,code:"",description:""}),N()}},[m,n,i,o,t,h]),(0,r.useEffect)(()=>{j&&N()},[j]);let b=async e=>{try{n&&i?await Z(i.id,e):await B(e),p({title:"تم ".concat(n?"تحديث":"إضافة"," الحساب بنجاح")}),a(),u(!1)}catch(e){p({title:"خطأ",description:e.message,variant:"destructive"})}};return(0,s.jsxs)(S.lG,{open:m,onOpenChange:u,children:[(0,s.jsx)(S.zM,{asChild:!0,children:l}),(0,s.jsx)(S.Cf,{className:"sm:max-w-md",children:(0,s.jsx)(F.lV,{...h,children:(0,s.jsxs)("form",{onSubmit:h.handleSubmit(b),children:[(0,s.jsxs)(S.c7,{children:[(0,s.jsx)(S.L3,{children:n?"تعديل حساب: ".concat(null==i?void 0:i.name):"إضافة حساب جديد"}),(0,s.jsx)(S.rr,{children:"أدخل تفاصيل الحساب الجديد في شجرة الحسابات."})]}),(0,s.jsxs)("div",{className:"py-4 grid gap-4",children:[(0,s.jsx)(F.zB,{control:h.control,name:"parentId",render:e=>{let{field:t}=e;return(0,s.jsxs)(F.eI,{children:[(0,s.jsx)(F.lR,{children:"الحساب الأب"}),(0,s.jsxs)(D.l6,{onValueChange:e=>t.onChange("root"===e?null:e),value:t.value||void 0,children:[(0,s.jsx)(F.MJ,{children:(0,s.jsx)(D.bq,{children:(0,s.jsx)(D.yv,{placeholder:"اختر الحساب الأب..."})})}),(0,s.jsxs)(D.gC,{children:[(0,s.jsx)(D.eb,{value:"root",children:"رئيسي (بدون أب)"}),g.map(e=>(0,s.jsx)(D.eb,{value:e.value,children:e.label},e.value))]})]}),(0,s.jsx)(F.C5,{})]})}}),(0,s.jsxs)("div",{className:"grid grid-cols-[1fr,auto] gap-2",children:[(0,s.jsx)(F.zB,{control:h.control,name:"code",render:e=>{let{field:t}=e;return(0,s.jsxs)(F.eI,{children:[(0,s.jsx)(F.lR,{children:"كود الحساب"}),(0,s.jsx)(F.MJ,{children:(0,s.jsx)(M.p,{...t})}),(0,s.jsx)(F.C5,{})]})}}),(0,s.jsx)(c.$,{type:"button",onClick:N,className:"self-end",variant:"outline",disabled:x,children:x?(0,s.jsx)(I.A,{className:"animate-spin h-4 w-4"}):"توليد"})]}),(0,s.jsx)(F.zB,{control:h.control,name:"name",render:e=>{let{field:t}=e;return(0,s.jsxs)(F.eI,{children:[(0,s.jsx)(F.lR,{children:"اسم الحساب"}),(0,s.jsx)(F.MJ,{children:(0,s.jsx)(M.p,{...t})}),(0,s.jsx)(F.C5,{})]})}}),(0,s.jsx)(F.zB,{control:h.control,name:"type",render:e=>{let{field:t}=e;return(0,s.jsxs)(F.eI,{children:[(0,s.jsx)(F.lR,{children:"نوع الحساب"}),(0,s.jsxs)(D.l6,{onValueChange:t.onChange,value:t.value,children:[(0,s.jsx)(F.MJ,{children:(0,s.jsx)(D.bq,{children:(0,s.jsx)(D.yv,{})})}),(0,s.jsxs)(D.gC,{children:[(0,s.jsx)(D.eb,{value:"asset",children:"أصول"}),(0,s.jsx)(D.eb,{value:"liability",children:"التزامات"}),(0,s.jsx)(D.eb,{value:"equity",children:"حقوق الملكية"}),(0,s.jsx)(D.eb,{value:"revenue",children:"إيرادات"}),(0,s.jsx)(D.eb,{value:"expense",children:"مصروفات"})]})]}),(0,s.jsx)(F.C5,{})]})}}),(0,s.jsx)(F.zB,{control:h.control,name:"description",render:e=>{let{field:t}=e;return(0,s.jsxs)(F.eI,{children:[(0,s.jsx)(F.lR,{children:"الوصف (اختياري)"}),(0,s.jsx)(F.MJ,{children:(0,s.jsx)(J.T,{...t})}),(0,s.jsx)(F.C5,{})]})}})]}),(0,s.jsx)(S.Es,{children:(0,s.jsxs)(c.$,{type:"submit",disabled:h.formState.isSubmitting,children:[h.formState.isSubmitting&&(0,s.jsx)(I.A,{className:"me-2 h-4 w-4 animate-spin"}),(0,s.jsx)(k.A,{className:"me-2 h-4 w-4"})," ",n?"حفظ التعديلات":"إضافة الحساب"]})})]})})})]})}function T(e){let{node:t,onActionSuccess:a,allAccounts:r}=e,{toast:l}=(0,d.dj)(),n=async()=>{try{await R(t.id),l({title:"تم حذف الحساب بنجاح"}),a()}catch(e){l({title:"خطأ",description:e.message,variant:"destructive"})}};return(0,s.jsxs)(N.rI,{children:[(0,s.jsx)(N.ty,{asChild:!0,children:(0,s.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-7 w-7 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,s.jsx)(b.A,{className:"h-4 w-4"})})}),(0,s.jsxs)(N.SQ,{align:"end",children:[(0,s.jsx)(U,{allAccounts:r,parentId:t.id,onAccountAdded:a,children:(0,s.jsxs)(N._2,{onSelect:e=>e.preventDefault(),className:"flex justify-between",children:[(0,s.jsx)("span",{children:"إضافة فرع"}),(0,s.jsx)(i.A,{className:"h-4 w-4"})]})}),(0,s.jsx)(U,{allAccounts:r,isEditing:!0,account:t,onAccountAdded:a,children:(0,s.jsxs)(N._2,{onSelect:e=>e.preventDefault(),className:"flex justify-between",children:[(0,s.jsx)("span",{children:"تعديل"}),(0,s.jsx)(y.A,{className:"h-4 w-4"})]})}),(0,s.jsx)(N.mB,{}),(0,s.jsxs)(C.Lt,{children:[(0,s.jsx)(C.tv,{asChild:!0,children:(0,s.jsxs)(N._2,{onSelect:e=>e.preventDefault(),className:"text-destructive focus:text-destructive flex justify-between",children:[(0,s.jsx)("span",{children:"حذف"}),(0,s.jsx)(w.A,{className:"h-4 w-4"})]})}),(0,s.jsxs)(C.EO,{children:[(0,s.jsxs)(C.wd,{children:[(0,s.jsx)(C.r7,{children:"هل أنت متأكد؟"}),(0,s.jsxs)(C.$v,{children:['سيتم حذف الحساب "',t.name,'" بشكل نهائي. لا يمكن حذف حساب رئيسي يحتوي على حسابات فرعية.']})]}),(0,s.jsxs)(C.ck,{children:[(0,s.jsx)(C.Zr,{children:"إلغاء"}),(0,s.jsx)(C.Rx,{onClick:n,variant:"destructive",children:"نعم، قم بالحذف"})]})]})]})]})]})}var O=a(3730),Y=a(11647);let $={asset:{label:"أصل",icon:m.A,color:"text-green-600"},liability:{label:"التزام",icon:m.A,color:"text-red-600"},equity:{label:"حقوق ملكية",icon:m.A,color:"text-blue-600"},revenue:{label:"إيراد",icon:u.A,color:"text-emerald-600"},expense:{label:"مصروف",icon:x.A,color:"text-purple-600"},client:{label:"عميل",icon:f.A,color:"text-green-600"},supplier:{label:"مورد",icon:p.A,color:"text-red-600"},box:{label:"صندوق",icon:h.A,color:"text-green-600"},exchange:{label:"بورصة",icon:j.A,color:"text-green-600"}};function q(e){let{node:t,depth:a,onActionSuccess:l,allAccounts:n}=e,[d,c]=(0,r.useState)(a<2),i=t.children&&t.children.length>0;t.debit,t.credit;let o=t.type?$[t.type]:null;return(0,s.jsxs)(O.Nt,{open:d,onOpenChange:c,className:"w-full",children:[(0,s.jsxs)("div",{className:"flex items-center group/node hover:bg-muted/50 rounded-md",children:[(0,s.jsx)(O.R6,{asChild:!0,children:(0,s.jsxs)("div",{className:"flex items-center gap-1 cursor-pointer select-none py-1.5 flex-grow",style:{paddingRight:"".concat(1.25*a,"rem")},children:[i?(0,s.jsx)(v.A,{className:(0,g.cn)("h-4 w-4 transition-transform",d&&"rotate-90")}):(0,s.jsx)("div",{className:"w-4"}),(0,s.jsx)("span",{className:"font-mono text-xs text-muted-foreground w-28 text-right truncate",children:t.code}),(0,s.jsx)("span",{className:"font-semibold",children:t.name}),o&&(0,s.jsxs)(Y.E,{variant:"outline",className:"text-xs",children:[(0,s.jsx)(o.icon,{className:(0,g.cn)("h-3 w-3 me-1",o.color)}),o.label]})]})}),(0,s.jsx)("div",{className:"pe-2",children:(0,s.jsx)(T,{node:t,onActionSuccess:l,allAccounts:n})})]}),i&&(0,s.jsx)(O.Ke,{children:(0,s.jsx)("div",{className:"pr-4 border-r-2 border-primary/10 mr-5 space-y-1",children:t.children.map(e=>(0,s.jsx)(q,{node:e,depth:a+1,onActionSuccess:l,allAccounts:n},e.id))})})]})}var H=a(90109),P=a(91303);let G=(e,t)=>{if(!t)return e;let a=t.toLowerCase();return e.reduce((e,s)=>{let r=s.children?G(s.children,t):[];return(s.name.toLowerCase().includes(a)||s.code.includes(a)||r.length>0)&&e.push({...s,children:r}),e},[])};function K(e){let{accounts:t,onActionSuccess:a}=e,[l,n]=(0,r.useState)(""),d=(0,r.useMemo)(()=>(0,P.H)(t),[t]),o=(0,r.useMemo)(()=>G(d,l),[d,l]);return(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("div",{className:"relative flex-grow",children:[(0,s.jsx)(H.A,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,s.jsx)(M.p,{placeholder:"بحث عن حساب بالاسم أو الكود...",value:l,onChange:e=>n(e.target.value),className:"w-full pr-10"})]}),(0,s.jsx)(U,{allAccounts:t,onAccountAdded:a,children:(0,s.jsxs)(c.$,{children:[(0,s.jsx)(i.A,{className:"w-4 h-4 ml-2"}),"إضافة حساب رئيسي"]})})]}),(0,s.jsx)("div",{className:"border rounded-md p-3 bg-card min-h-[400px]",children:0===o.length?(0,s.jsx)("div",{className:"text-center text-muted-foreground p-8",children:"لا توجد حسابات تطابق البحث."}):o.map(e=>(0,s.jsx)(q,{node:e,depth:0,onActionSuccess:a,allAccounts:t},e.id))})]})}var W=a(37030);function X(e){let{initialAccounts:t,onAccountsUpdated:a}=e,[m,u]=(0,r.useState)(t),[x,f]=(0,r.useState)(!1),{toast:p}=(0,d.dj)();(0,r.useEffect)(()=>{u(t)},[t]);let h=(0,r.useCallback)(async()=>{f(!0);try{let e=await (0,W.S)();u(e),null==a||a(e),p({title:"تم تحديث شجرة الحسابات"})}catch(e){p({title:"خطأ",description:e.message,variant:"destructive"})}finally{f(!1)}},[p,a]);return(0,s.jsxs)(l.Zp,{children:[(0,s.jsxs)(l.aR,{className:"flex flex-row items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(l.ZB,{children:"الدليل المحاسبي"}),(0,s.jsx)(l.BT,{children:"عرض وتعديل هيكل الدليل المحاسبي."})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(U,{allAccounts:m,onAccountAdded:h,children:(0,s.jsxs)(c.$,{variant:"outline",size:"sm",disabled:x,children:[(0,s.jsx)(i.A,{className:"me-2 h-4 w-4"}),"إضافة حساب"]})}),(0,s.jsxs)(c.$,{variant:"outline",size:"sm",onClick:h,disabled:x,children:[(0,s.jsx)(o.A,{className:"me-2 h-4 w-4"}),"تحديث"]})]})]}),(0,s.jsx)(l.Wu,{children:x?(0,s.jsx)(n.E,{className:"h-[400px]"}):(0,s.jsx)(K,{accounts:m,onActionSuccess:h})})]})}},86948:(e,t,a)=>{a.d(t,{BT:()=>i,Wu:()=>o,ZB:()=>c,Zp:()=>n,aR:()=>d,wL:()=>m});var s=a(95155),r=a(12115),l=a(64269);let n=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("rounded-xl border bg-card text-card-foreground shadow-sm",a),...r})});n.displayName="Card";let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-4 sm:p-6 text-right",a),...r})});d.displayName="CardHeader";let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("h3",{ref:t,className:(0,l.cn)("text-lg sm:text-xl font-bold leading-none tracking-tight",a),...r})});c.displayName="CardTitle";let i=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("p",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",a),...r})});i.displayName="CardDescription";let o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("p-4 sm:p-6 pt-0",a),...r})});o.displayName="CardContent";let m=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-4 sm:p-6 pt-0",a),...r})});m.displayName="CardFooter"},91303:(e,t,a)=>{a.d(t,{H:()=>s});function s(e){if(!e||0===e.length)return[];let t={},a=[];e.forEach(e=>{t[e.id]={...e,children:[]}}),e.forEach(e=>{e.parentId&&t[e.parentId]?t[e.parentId].children.some(t=>t.id===e.id)||t[e.parentId].children.push(t[e.id]):a.some(t=>t.id===e.id)||a.push(t[e.id])});let s=e=>{e.forEach(e=>{e.children&&e.children.length>0&&(e.children.sort((e,t)=>e.code.localeCompare(t.code,void 0,{numeric:!0})),s(e.children))})};return a.sort((e,t)=>e.code.localeCompare(t.code,void 0,{numeric:!0})),s(a),a}},98053:(e,t,a)=>{a.d(t,{$v:()=>h,EO:()=>u,Lt:()=>c,Rx:()=>j,Zr:()=>v,ck:()=>f,r7:()=>p,tv:()=>i,wd:()=>x});var s=a(95155),r=a(12115),l=a(35646),n=a(64269),d=a(3998);let c=l.bL,i=l.l9,o=l.ZL,m=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.hJ,{className:(0,n.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r,ref:t})});m.displayName=l.hJ.displayName;let u=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsxs)(o,{children:[(0,s.jsx)(m,{}),(0,s.jsx)(l.UC,{ref:t,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...r})]})});u.displayName=l.UC.displayName;let x=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...a})};x.displayName="AlertDialogHeader";let f=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};f.displayName="AlertDialogFooter";let p=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.hE,{ref:t,className:(0,n.cn)("text-lg font-semibold",a),...r})});p.displayName=l.hE.displayName;let h=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.VY,{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...r})});h.displayName=l.VY.displayName;let j=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.rc,{ref:t,className:(0,n.cn)((0,d.r)(),a),...r})});j.displayName=l.rc.displayName;let v=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.ZD,{ref:t,className:(0,n.cn)((0,d.r)({variant:"outline"}),"mt-2 sm:mt-0",a),...r})});v.displayName=l.ZD.displayName}}]);