(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1532],{11186:(e,t,s)=>{"use strict";s.d(t,{bq:()=>p,eb:()=>x,gC:()=>h,l6:()=>c,yv:()=>u});var a=s(95155),l=s(12115),i=s(47887),r=s(59007),n=s(42614),d=s(72251),o=s(64269);let c=i.bL;i.YJ;let u=i.WT,p=l.forwardRef((e,t)=>{let{className:s,children:l,...n}=e;return(0,a.jsxs)(i.l9,{ref:t,className:(0,o.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...n,children:[l,(0,a.jsx)(i.In,{asChild:!0,children:(0,a.jsx)(r.A,{className:"h-4 w-4 opacity-50"})})]})});p.displayName=i.l9.displayName;let m=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(i.PP,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",s),...l,children:(0,a.jsx)(n.A,{className:"h-4 w-4"})})});m.displayName=i.PP.displayName;let f=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(i.wn,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",s),...l,children:(0,a.jsx)(r.A,{className:"h-4 w-4"})})});f.displayName=i.wn.displayName;let h=l.forwardRef((e,t)=>{let{className:s,children:l,position:r="popper",...n}=e;return(0,a.jsx)(i.ZL,{children:(0,a.jsxs)(i.UC,{ref:t,className:(0,o.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:r,...n,children:[(0,a.jsx)(m,{}),(0,a.jsx)(i.LM,{className:(0,o.cn)("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:l}),(0,a.jsx)(f,{})]})})});h.displayName=i.UC.displayName,l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(i.JU,{ref:t,className:(0,o.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...l})}).displayName=i.JU.displayName;let x=l.forwardRef((e,t)=>{let{className:s,children:l,...r}=e;return(0,a.jsxs)(i.q7,{ref:t,className:(0,o.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...r,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(i.VF,{children:(0,a.jsx)(d.A,{className:"h-4 w-4"})})}),(0,a.jsx)(i.p4,{children:l})]})});x.displayName=i.q7.displayName,l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(i.wv,{ref:t,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",s),...l})}).displayName=i.wv.displayName},13406:(e,t,s)=>{"use strict";s.d(t,{Xi:()=>o,av:()=>c,j7:()=>d,tU:()=>n});var a=s(95155),l=s(12115),i=s(25667),r=s(64269);let n=i.bL,d=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(i.B8,{ref:t,className:(0,r.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...l})});d.displayName=i.B8.displayName;let o=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(i.l9,{ref:t,className:(0,r.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...l})});o.displayName=i.l9.displayName;let c=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(i.UC,{ref:t,className:(0,r.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...l})});c.displayName=i.UC.displayName},13713:(e,t,s)=>{"use strict";s.d(t,{C1:()=>n,LB:()=>d,lE:()=>o});var a=s(95155),l=s(12115),i=s(72251),r=s(64269);let n=l.forwardRef((e,t)=>{let{className:s,children:l,initialStep:i,steps:n,activeStep:d,...o}=e;return(0,a.jsx)("div",{ref:t,className:(0,r.cn)("flex w-full flex-row justify-between gap-x-2",s),...o,children:l})});n.displayName="Stepper";let d=l.forwardRef((e,t)=>{let{className:s,label:l,isCompleted:n,isActive:d,isOptional:o,icon:c,isLast:u,...p}=e;return(0,a.jsxs)("div",{ref:t,className:(0,r.cn)("flex flex-1 items-center gap-x-2",s),...p,children:[(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)("div",{className:(0,r.cn)("flex h-8 w-8 items-center justify-center rounded-full text-lg font-bold ring-2 transition-colors",d?"bg-primary text-primary-foreground ring-primary":n?"bg-secondary text-secondary-foreground ring-secondary":"bg-muted text-muted-foreground ring-muted"),children:n?(0,a.jsx)(i.A,{}):c})}),(0,a.jsx)("div",{className:"hidden md:flex flex-col",children:(0,a.jsx)("h3",{className:(0,r.cn)("font-medium transition-colors",d?"text-primary":"text-muted-foreground"),children:l})}),!u&&(0,a.jsx)("div",{className:"h-px w-full flex-1 bg-border transition-colors","aria-hidden":"true"})]})});d.displayName="StepperItem";let o=e=>{let{initialStep:t=0,steps:s}=e,[a,i]=l.useState(t),r=l.useCallback(()=>{i(e=>e<s.length-1?e+1:e)},[s.length]),n=l.useCallback(()=>{i(e=>e>0?e-1:e)},[]),d=l.useCallback(()=>{i(t)},[t]),o=a===s.length-1;return{activeStep:a,setActiveStep:i,goToNextStep:r,goToPreviousStep:n,resetSteps:d,isDisabledStep:0===a,isLastStep:o}}},32383:()=>{},48182:(e,t,s)=>{"use strict";s.d(t,{rN:()=>o,uJ:()=>d});let a=e=>(null!=e?e:"").trim(),l=(e,t)=>Array.from(new Set([...t,...Object.keys(e||{})])).reduce((t,s)=>(t[s]=a(null==e?void 0:e[s]),t),{}),i=e=>Object.values(e).find(e=>e.length>0)||"",r=["tickets","visas","subscriptions","segments","profit_distribution","other"],n=["tickets","visas","subscriptions","partners","operating","cost_tickets","cost_visas","operating_salaries","operating_rent","operating_utilities","marketing"];function d(e){let t={...(null==e?void 0:e.revenueMap)||{},...(null==e?void 0:e.customRevenues)||{}},s={...(null==e?void 0:e.expenseMap)||{},...(null==e?void 0:e.customExpenses)||{}},d=l(t,r),o=l(s,n),c=a((null==e?void 0:e.receivableAccountId)||(null==e?void 0:e.arAccountId)),u=a((null==e?void 0:e.payableAccountId)||(null==e?void 0:e.apAccountId)),p=a(null==e?void 0:e.generalRevenueId)||i(d),m=a(null==e?void 0:e.generalExpenseId)||i(o);return{receivableAccountId:c,payableAccountId:u,hybridRelationAccountId:a(null==e?void 0:e.hybridRelationAccountId),clearingAccountId:a(null==e?void 0:e.clearingAccountId),defaultCashId:a(null==e?void 0:e.defaultCashId),defaultBankId:a(null==e?void 0:e.defaultBankId),arAccountId:c,apAccountId:u,generalRevenueId:p,generalExpenseId:m,preventDirectCashRevenue:!!(null==e?void 0:e.preventDirectCashRevenue),revenueMap:d,expenseMap:o}}function o(e){let t=l(e.revenueMap||{},r),s=l(e.expenseMap||{},n),d=a(e.receivableAccountId),o=a(e.payableAccountId),c=a(e.generalRevenueId)||i(t),u=a(e.generalExpenseId)||i(s);return{receivableAccountId:d,payableAccountId:o,hybridRelationAccountId:a(e.hybridRelationAccountId),clearingAccountId:a(e.clearingAccountId),defaultCashId:a(e.defaultCashId),defaultBankId:a(e.defaultBankId),preventDirectCashRevenue:!!e.preventDirectCashRevenue,generalRevenueId:c,generalExpenseId:u,arAccountId:d,apAccountId:o,revenueMap:t,customRevenues:t,expenseMap:s,customExpenses:s}}},51111:(e,t,s)=>{"use strict";s.d(t,{A:()=>E});var a=s(95155),l=s(12115),i=s(3998),r=s(15894),n=s(4246),d=s(11636),o=s(18527),c=s(26615),u=s(97776),p=s(64269);function m(e){let{onDataReady:t}=e,[s,m]=(0,l.useState)(null),{toast:f}=(0,r.dj)(),h=(0,l.useCallback)(e=>{m(e);let s=new FileReader;s.onload=e=>{try{var s;let a=new Uint8Array(null==(s=e.target)?void 0:s.result),l=n.LF(a,{type:"array"}),i=l.Sheets[l.SheetNames[0]],r=n.Wp.sheet_to_json(i,{defval:""});t(r),f({title:"تم تحميل ".concat(r.length," سجل بنجاح"),description:"انتقِل للخطوة التالية لربط الحقول."})}catch(e){f({title:"خطأ في قراءة الملف",description:"تعذر تحليل ملف Excel. الرجاء التأكد من أنه بالتنسيق الصحيح.",variant:"destructive"})}},s.readAsArrayBuffer(e)},[t,f]),x=(0,l.useCallback)(e=>{e&&e.length>0&&h(e[0])},[h]),{getRootProps:v,getInputProps:b,isDragActive:g}=(0,d.VB)({onDrop:x,accept:{"application/vnd.ms-excel":[".xls"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"]},maxFiles:1});return(0,a.jsxs)("div",{...v(),className:(0,p.cn)("border-2 border-dashed rounded-lg p-10 text-center cursor-pointer relative flex flex-col justify-center items-center h-64 hover:border-primary transition-colors",g&&"border-primary bg-primary/10"),children:[(0,a.jsx)("input",{...b(),id:"excel-upload"}),s?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full",children:[(0,a.jsx)(o.A,{className:"h-12 w-12 text-green-500"}),(0,a.jsxs)("p",{className:"mt-4 font-semibold text-lg",children:["تم تحميل الملف: ",s.name]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"جاهز للانتقال للخطوة التالية."}),(0,a.jsxs)(i.$,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),m(null),t([])},className:"mt-2 text-destructive hover:text-destructive",children:[(0,a.jsx)(c.A,{className:"me-1 h-4 w-4"}),"إزالة الملف"]})]}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-muted-foreground",children:[(0,a.jsx)(u.A,{className:"h-12 w-12"}),(0,a.jsx)("h3",{className:"mt-4 font-semibold text-lg",children:"اسحب وأفلت ملف Excel هنا"}),(0,a.jsx)("p",{className:"mt-2 text-sm",children:"أو انقر لاختيار ملف من جهازك"})]})]})}var f=s(11186),h=s(22452);function x(e){let{headers:t,relationFields:s,importFieldsSettings:n,onMappingDone:d}=e,[o,c]=(0,l.useState)({}),[u,p]=(0,l.useState)([]),{toast:m}=(0,r.dj)(),x=(0,l.useMemo)(()=>s?[...s,...u]:u,[s,u]),v=(0,l.useCallback)(()=>{if(!s)return;let e={};s.forEach(s=>{let a=n[s.id],l=Array.from(new Set([s.label.toLowerCase().trim(),s.id.toLowerCase().trim(),...((null==a?void 0:a.aliases)||[]).map(e=>e.toLowerCase().trim())])),i=t.find(e=>l.includes(e.toLowerCase().trim()));i&&!Object.values(e).includes(s.id)&&(e[i]=s.id)}),c(e),m({title:"تم الربط التلقائي",description:"تم ربط ".concat(Object.keys(e).length," حقلاً تلقائيًا. الرجاء مراجعة النتائج.")})},[t,s,m,n]);return l.useEffect(()=>{v()},[]),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(i.$,{onClick:v,variant:"outline",children:"إعادة الربط التلقائي"})}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(e=>(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("label",{className:"block font-medium text-sm",children:e}),(0,a.jsxs)(f.l6,{onValueChange:t=>((e,t)=>{if("__create_new__"===t){let t="custom_".concat(e.toLowerCase().replace(/\s+/g,"_"));if(x.some(e=>e.id===t))return void m({title:"الحقل موجود بالفعل",description:"يوجد حقل مخصص بنفس الاسم.",variant:"destructive"});let s={id:t,label:e,type:"text",required:!1,visible:!0,deletable:!0,aliases:[e.toLowerCase()],appliesTo:["individual","company"]};p(e=>[...e,s]),c(s=>({...s,[e]:t}))}else c(s=>({...s,[e]:t}))})(e,t),value:o[e]||"__ignore__",children:[(0,a.jsx)(f.bq,{children:(0,a.jsx)(f.yv,{placeholder:"-- اختر الحقل المناسب --"})}),(0,a.jsxs)(f.gC,{children:[(0,a.jsx)(f.eb,{value:"__ignore__",children:"-- تجاهل هذا الحقل --"}),(0,a.jsx)(f.eb,{value:"__create_new__",className:"text-green-600 font-bold",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(h.A,{className:"h-4 w-4"}),(0,a.jsxs)("span",{children:['إنشاء حقل جديد باسم "',e,'"']})]})}),x.map(e=>(0,a.jsx)(f.eb,{value:e.id,className:u.some(t=>t.id===e.id)?"text-green-600":"",children:e.label},e.id))]})]})]},e))}),(0,a.jsx)("div",{className:"flex justify-center pt-4",children:(0,a.jsx)(i.$,{onClick:()=>{if(!Object.values(o).includes("name")&&s.some(e=>"name"===e.id))return void m({title:"حقل الاسم مطلوب",description:"الرجاء ربط أحد أعمدة ملف Excel مع حقل 'الاسم الكامل' للمتابعة.",variant:"destructive"});d(o,u)},size:"lg",children:"معالجة البيانات والانتقال للمعاينة"})})]})}var v=s(87270),b=s(65142),g=s(13630);function y(e){let{rows:t,onRowUpdate:s,onDeleteRow:r,fieldMap:n,relationFields:d}=e;if(0===t.length)return(0,a.jsx)("p",{className:"text-center text-muted-foreground p-8",children:"لا توجد بيانات لعرضها."});let o=l.useMemo(()=>Object.values(n).filter(e=>"__ignore__"!==e),[n]);return(0,a.jsx)("div",{className:"overflow-auto max-h-[500px] border rounded-lg",children:(0,a.jsxs)(v.XI,{children:[(0,a.jsx)(v.A0,{className:"sticky top-0 bg-muted/80",children:(0,a.jsxs)(v.Hj,{children:[o.map(e=>{var t;return(0,a.jsx)(v.nd,{children:(null==(t=d.find(t=>t.id===e))?void 0:t.label)||e},e)}),(0,a.jsx)(v.nd,{className:"text-center",children:"حذف"})]})}),(0,a.jsx)(v.BF,{children:t.map((e,t)=>(0,a.jsxs)(v.Hj,{children:[o.map(l=>(0,a.jsx)(v.nA,{className:"p-1",children:(0,a.jsx)(b.p,{value:e[l]||"",onChange:a=>s(t,{...e,[l]:a.target.value}),className:"h-8"})},l)),(0,a.jsx)(v.nA,{className:"text-center p-1",children:(0,a.jsx)(i.$,{variant:"ghost",size:"icon",className:"text-destructive h-8 w-8",onClick:()=>r(t),children:(0,a.jsx)(g.A,{className:"h-4 w-4"})})})]},t))})]})})}var j=s(86948),w=s(92033),N=s(30926);let A=(0,N.createServerReference)("40d0448bacb32a373d23394258f9e7de4aa7fd38a9",N.callServer,void 0,N.findSourceMapURL,"addMultipleClients");var C=s(20063);function S(e){let{data:t,onSaveComplete:s}=e,{toast:n}=(0,r.dj)(),d=(0,C.useRouter)(),[c,u]=(0,l.useState)(!1),p=async()=>{u(!0);try{let e=await A(t);if(e.success)n({title:"تم حفظ ".concat(e.count," سجل بنجاح!"),description:"سيتم تحديث قائمة العلاقات."}),await s(),d.refresh();else throw Error(e.error)}catch(e){n({title:"فشل الحفظ",description:e.message||"حدث خطأ أثناء الحفظ",variant:"destructive"})}finally{u(!1)}};return(0,a.jsxs)(j.Zp,{className:"max-w-md mx-auto",children:[(0,a.jsxs)(j.aR,{children:[(0,a.jsxs)(j.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(o.A,{className:"h-6 w-6 text-green-500"}),"جاهز للحفظ"]}),(0,a.jsx)(j.BT,{children:"تمت معالجة البيانات وهي جاهزة للحفظ في النظام."})]}),(0,a.jsxs)(j.Wu,{className:"text-center",children:[(0,a.jsx)("p",{className:"text-4xl font-bold",children:t.length}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"سجلًا سيتم استيراده."})]}),(0,a.jsx)(j.wL,{children:(0,a.jsx)(i.$,{className:"w-full",size:"lg",onClick:p,disabled:c,children:c?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w.A,{className:"me-2 h-4 w-4 animate-spin"}),"جاري الحفظ..."]}):"تأكيد وحفظ البيانات"})})]})}var k=s(13713),I=s(58772),R=s(26541),_=s(55253),T=s(73180),q=s(33173),L=s(36204),B=s(30940),M=s(60013);let U=[{label:"رفع الملف",icon:(0,a.jsx)(I.A,{})},{label:"ربط الحقول",icon:(0,a.jsx)(R.A,{})},{label:"معاينة وتعديل",icon:(0,a.jsx)(_.A,{})},{label:"الحفظ",icon:(0,a.jsx)(T.A,{})}];function E(e){let{settings:t}=e,[s,n]=(0,l.useState)([]),[d,o]=(0,l.useState)([]),[c,u]=(0,l.useState)([]),[p,f]=(0,l.useState)({}),[h,v]=(0,l.useState)([]),{toast:b}=(0,r.dj)(),{activeStep:g,goToNextStep:j,goToPreviousStep:w,isLastStep:N}=(0,k.lE)({initialStep:0,steps:U}),A=e=>{if(0===e.length)return void b({title:"الملف فارغ أو غير صالح",variant:"destructive"});n(e),o(Object.keys(e[0])),j()},C=(e,a)=>{if(!(null==t?void 0:t.importLogicSettings)||!(null==t?void 0:t.relationSections))return void b({title:"خطأ",description:"لم يتم تحميل إعدادات النظام بشكل صحيح.",variant:"destructive"});f(e),v(a);let l=[...t.relationSections.flatMap(e=>e.fields),...a];u(s.map(s=>((e,t,s,a)=>{let l={};for(let s in a.forEach(e=>{l[e.id]=e.defaultValue||""}),t){let i,r=t[s];if("__ignore__"===r)continue;let n=e[s],d=a.find(e=>e.id===r);i=null==n||""===String(n).trim()?(null==d?void 0:d.defaultValue)||"":"string"==typeof n?n.trim():n,l[r]=i}let i=String(l.paymentType).toLowerCase();s.creditKeywords.map(e=>e.toLowerCase()).includes(i)?l.paymentType="credit":(s.cashKeywords.map(e=>e.toLowerCase()).includes(i),l.paymentType="cash");let r=String(l.type).toLowerCase();"company"===r||"شركة"===r?l.type="company":l.type="individual";let n=String(l.relationType).toLowerCase();return["supplier","مورد"].includes(n)?l.relationType="supplier":["both","كلاهما","عميل ومورد"].includes(n)?l.relationType="both":l.relationType="client",l.status=["active","نشط"].includes(String(l.status).toLowerCase())?"active":"inactive",l})(s,e,t.importLogicSettings,l))),j()},I=(e,t)=>{let s=[...c];s[e]=t,u(s)},R=e=>{u(c.filter((t,s)=>s!==e))},_=async()=>{if(!t.relationSections)return;let e=(0,M.jM)(t.relationSections,e=>{let t=e.flatMap(e=>e.fields).filter(e=>"select"===e.type);c.forEach(e=>{t.forEach(t=>{var s;let a=e[t.id];!a||(null==(s=t.options)?void 0:s.some(e=>e.label===a||e.value===a))||(t.options||(t.options=[]),t.options.push({value:a,label:a}))})})}),s=(0,M.jM)(e,e=>{let t=e.find(e=>"sec_other"===e.id);if(t&&h.length>0){let e=new Set(t.fields.map(e=>e.id)),s=h.filter(t=>!e.has(t.id));t.fields.push(...s)}else!t&&h.length>0&&e.push({id:"sec_other",title:"تفاصيل أخرى",description:"حقول إضافية وتفاصيل.",deletable:!0,fields:h})});JSON.stringify(s)!==JSON.stringify(t.relationSections)&&(await (0,B.X)({relationSections:s}),b({title:"تم تحديث إعدادات الحقول",description:"تمت إضافة الخيارات والحقول الجديدة من بياناتك المستوردة."}))};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mb-8",children:(0,a.jsx)(k.C1,{activeStep:g,children:U.map((e,t)=>(0,a.jsx)(k.LB,{label:e.label,icon:e.icon,isCompleted:g>t,isActive:g===t,isLast:t===U.length-1},e.label))})}),(0,a.jsx)("div",{children:(()=>{switch(g){case 0:return(0,a.jsx)(m,{onDataReady:A});case 1:return(0,a.jsx)(x,{headers:d,onMappingDone:C,relationFields:t.relationSections.flatMap(e=>e.fields),importFieldsSettings:t.importFieldsSettings||{}});case 2:return(0,a.jsx)(y,{rows:c,onRowUpdate:I,onDeleteRow:R,fieldMap:p,relationFields:[...t.relationSections.flatMap(e=>e.fields),...h]});case 3:return(0,a.jsx)(S,{data:c,onSaveComplete:_});default:return null}})()}),(0,a.jsxs)("div",{className:"flex justify-between mt-8",children:[(0,a.jsxs)(i.$,{variant:"outline",onClick:w,disabled:0===g,children:[(0,a.jsx)(q.A,{className:"me-2 h-4 w-4"}),"السابق"]}),(0,a.jsxs)(i.$,{onClick:j,disabled:!!N||0===g&&0===s.length||1===g||2===g&&0===c.length,children:[N?"إنهاء":"التالي",(0,a.jsx)(L.A,{className:"ms-2 h-4 w-4"})]})]})]})}},83686:()=>{},87270:(e,t,s)=>{"use strict";s.d(t,{A0:()=>n,BF:()=>d,Gg:()=>o,Hj:()=>c,XI:()=>r,nA:()=>p,nd:()=>u});var a=s(95155),l=s(12115),i=s(64269);let r=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:t,className:(0,i.cn)("w-full caption-bottom text-sm",s),...l})})});r.displayName="Table";let n=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("thead",{ref:t,className:(0,i.cn)("[&_tr]:border-b",s),...l})});n.displayName="TableHeader";let d=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("tbody",{ref:t,className:(0,i.cn)("[&_tr:last-child]:border-0",s),...l})});d.displayName="TableBody";let o=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("tfoot",{ref:t,className:(0,i.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...l})});o.displayName="TableFooter";let c=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("tr",{ref:t,className:(0,i.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...l})});c.displayName="TableRow";let u=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("th",{ref:t,className:(0,i.cn)("h-12 px-4 text-right align-middle font-bold text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...l})});u.displayName="TableHead";let p=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("td",{ref:t,className:(0,i.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...l})});p.displayName="TableCell",l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("caption",{ref:t,className:(0,i.cn)("mt-4 text-sm text-muted-foreground",s),...l})}).displayName="TableCaption"},89274:(e,t,s)=>{"use strict";s.d(t,{xd:()=>l});var a=s(48182);let l={currencySettings:{defaultCurrency:"USD",exchangeRates:{USD_IQD:1480},currencies:[{code:"USD",name:"US Dollar",symbol:"$"},{code:"IQD",name:"Iraqi Dinar",symbol:"ع.د"}]},exchangeRateTemplate:"*تحديث سعر الصرف*\\n\\n 1 دولار أمريكي = *{rate}* دينار عراقي\\n\\nتاريخ التحديث: {date}",remittanceSettings:{offices:["الريان","الطيف","ماستر","عطاء الغري"],methods:["زين كاش","ماستر كارد","حوالة مصرفية","نقدي"],distributionColumnsUsd:[{id:"externalAmount",label:"خارجي"}],distributionColumnsIqd:[{id:"flyAmount",label:"فلاي"},{id:"internalAmount",label:"داخلي"}],headerColorUsd:"#1e40af",headerColorIqd:"#166534"},voucherSettings:{receiptInvoiceCounter:1e3,paymentInvoiceCounter:1e3,receiptTableColumns:[],paymentTableColumns:[],expenseAccounts:[{id:"expense_salaries",name:"رواتب"},{id:"expense_rent",name:"إيجار"}]},invoiceSequenceSettings:{ticketBookingCounter:0,visaBookingCounter:0,groupBookingCounter:0},creditPolicySettings:{defaultCreditLimit:1e4,defaultGracePeriodDays:30},databaseStatus:{isDatabaseConnected:!0},theme:{landingPage:{heroTitle:"لشركات السياحة والسفر",heroSubtitle:"حلول متكاملة لإدارة الحسابات المالية، تذاكر الطيران، الفيزا، والفواتير بكل ذكاء وسهولة.",heroSubtitleColor:"#52525b",heroTitleColor:"#1e293b",heroFontFamily:"",smartTickets:{title:"إدخال ذكي للتذاكر والفواتير",description:"وداعًا للإدخال اليدوي. نظامنا يقرأ ملفات PDF ويستخرج البيانات تلقائيًا، مما يوفر وقتك ويزيد من دقة بياناتك.",imageUrl:"https://images.unsplash.com/photo-1517999348311-5bc38e05b1c6?q=80&w=2070&auto=format&fit=crop"},sourceAuditing:{title:"مطابقة الكشوفات بذكاء",description:"أداة مبتكرة لمقارنة كشف حسابك مع كشف حساب الموردين، وتحديد الفروقات والاختلافات تلقائيًا بدقة تصل إلى 99%.",imageUrl:"https://images.unsplash.com/photo-1554224155-1696413565d3?q=80&w=2070&auto=format&fit=crop"},financialManagement:{title:"إدارة مالية شاملة",description:"من سندات القبض والصرف إلى شجرة الحسابات والتقارير المتقدمة، كل ما تحتاجه لإدارة مالية شركتك في مكان واحد.",imageUrl:"https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?q=80&w=2070&auto=format&fit=crop"},servicesSection:{title:"خدماتنا المحاسبية",description:"نظام متكامل يغطي جميع احتياجات شركات السياحة والسفر، مصمم خصيصًا ليتوافق مع طبيعة عملكم."},partnersSection:{title:"شركاء النجاح",description:"نفخر بالتعاون مع نخبة من شركات السياحة والسفر الرائدة التي وثقت في نظامنا لتحقيق أهدافها.",partners:[{name:"FlyBaghdad",logoUrl:"https://assets.duffel.com/img/airlines/for-light-background/full-color-logo/FQ.svg"},{name:"UR Airlines",logoUrl:"https://assets.duffel.com/img/airlines/for-light-background/full-color-logo/UD.svg"},{name:"Iraqi Airways",logoUrl:"https://assets.duffel.com/img/airlines/for-light-background/full-color-logo/IA.svg"},{name:"Anadolujet",logoUrl:"https://assets.duffel.com/img/airlines/for-light-background/full-color-logo/TK.svg"},{name:"Turkish Airlines",logoUrl:"https://assets.duffel.com/img/airlines/for-light-background/full-color-logo/TK.svg"}]},faqSection:{title:"الأسئلة الشائعة",description:"هل لديك سؤال؟ قد تجد إجابتك هنا.",faqs:[{question:"ما هو نظام Mudarib؟",answer:"هو نظام محاسبي متكامل مصمم خصيصًا لشركات السياحة والسفر."},{question:"هل يدعم النظام اللغة العربية؟",answer:"نعم، النظام يدعم اللغة العربية بشكل كامل مع واجهات RTL."},{question:"هل يمكن تخصيص مظهر النظام؟",answer:"بالتأكيد، يمكنك تخصيص الألوان والخطوط والشعارات من صفحة الإعدادات."}]},accountStatements:{title:"إدارة ومتابعة الديون بسهولة",description:"نظام متكامل لمتابعة ديون العملاء والموردين، مع كشوفات حسابات تفصيلية وتنبيهات آلية للمدفوعات المستحقة.",imageUrl:"https://images.unsplash.com/photo-1556742502-ec7c0e9f34b1?q=80&w=1974&auto=format&fit=crop"},financialAnalysis:{title:"تحليلات مالية دقيقة لاتخاذ القرارات",description:"احصل على رؤية عميقة لأداء شركتك المالي. تتبع الأرباح، حلل التكاليف، وادرس هيكل حساباتك بسهولة عبر شجرة الحسابات التفاعلية.",imageUrl:"https://images.unsplash.com/photo-1551288049-bebda4e38f71?q=80&w=2070&auto=format&fit=crop"},footerImageUrl:"https://images.unsplash.com/photo-1549492423-400259a5e5a4?q=80&w=2148&auto=format&fit=crop"},invoice:{companyName:"Mudarib",companyAddress:"Iraq - Holy Karbala - Silo St.",companyPhone:"+964 781 000 3377",companyWeb:"codescope.dev",headerColor:"#e0f2f1",titleColor:"#663399",footerText:"شكرًا لتعاملكم معنا!"}},importFieldsSettings:{name:{label:"الاسم الكامل",aliases:["name","الاسم","اسم العميل","اسم الشركة","company name","supplier name","اسم المورد"]},phone:{label:"رقم الهاتف",aliases:["phone","الهاتف","رقم الهاتف","mobile","رقم الجوال"]},email:{label:"البريد الإلكتروني",aliases:["email","البريد الالكتروني","بريد الكتروني"]},type:{label:"نوع الجهة",aliases:["type","النوع","entity type"]},relationType:{label:"نوع العلاقة",aliases:["relationtype","relation type","نوع العلاقة"]},status:{label:"الحالة",aliases:["status","الحالة"]},code:{label:"معرف الشركة (يوزر فلاي)",aliases:["code","companyid","company id","معرف الشركة","يوزر فلاي"]},paymentType:{label:"نوع التعامل",aliases:["paymenttype","payment type","نوع التعامل","التعامل","نوع الدفع"]},details:{label:"التفاصيل",aliases:["details","notes","ملاحظات","تفاصيل"]},country:{label:"الدولة",aliases:["country","البلد","دولة"]},province:{label:"المحافظة",aliases:["province","state","المحافظة","الولاية"]},streetAddress:{label:"تفاصيل العنوان",aliases:["address","العنوان","streetaddress","street address"]}},importLogicSettings:{creditKeywords:["credit","آجل","debit","دبت"],cashKeywords:["cash","كاش","نقد","نقدي"]},relationSections:[{id:"sec_basic",title:"المعلومات الأساسية",deletable:!1,description:"الحقول الأساسية لتعريف العميل أو المورد.",fields:[{id:"name",label:"الاسم الكامل",type:"text",required:!0,visible:!0,deletable:!1,placeholder:"اسم العميل أو المورد",appliesTo:["individual","company"],aliases:["name","الاسم","اسم العميل","اسم الشركة","company name","supplier name","اسم المورد"]},{id:"type",label:"نوع الجهة",type:"select",required:!0,visible:!0,deletable:!1,options:[{value:"individual",label:"فرد"},{value:"company",label:"شركة"}],appliesTo:["individual","company"],aliases:["type","النوع","entity type"]},{id:"relationType",label:"نوع العلاقة",type:"select",required:!0,visible:!0,deletable:!1,options:[{value:"client",label:"عميل"},{value:"supplier",label:"مورد"},{value:"both",label:"كلاهما"}],appliesTo:["individual","company"],aliases:["relationtype","relation type","نوع العلاقة","العميل او المورد","client or supplier"]},{id:"status",label:"الحالة",type:"select",required:!0,visible:!0,deletable:!1,options:[{value:"active",label:"نشط"},{value:"inactive",label:"غير نشط"}],appliesTo:["individual","company"],aliases:["status","الحالة"]}]},{id:"sec_contact",title:"معلومات الاتصال والعنوان",deletable:!1,description:"بيانات الاتصال والتواصل والتفاصيل الجغرافية.",fields:[{id:"phone",label:"رقم الهاتف",type:"text",required:!1,visible:!0,deletable:!1,placeholder:"07700000000",appliesTo:["individual","company"],aliases:["phone","الهاتف","رقم الهاتف","mobile","رقم الجوال"]},{id:"email",label:"البريد الإلكتروني",type:"email",required:!1,visible:!0,deletable:!0,placeholder:"example@mail.com",appliesTo:["individual","company"],aliases:["email","البريد الالكتروني","بريد الكتروني"]},{id:"country",label:"الدولة",type:"select",required:!1,visible:!0,deletable:!1,appliesTo:["individual","company"],aliases:["country","البلد","دولة"]},{id:"province",label:"المحافظة/الولاية",type:"select",required:!1,visible:!0,deletable:!1,appliesTo:["individual","company"],aliases:["province","state","المحافظة","الولاية"]},{id:"streetAddress",label:"تفاصيل العنوان",type:"text",required:!1,visible:!0,deletable:!1,placeholder:"المنطقة، الشارع، رقم المبنى...",appliesTo:["individual","company"],aliases:["address","العنوان","streetaddress","street address"]}]},{id:"sec_company",title:"تفاصيل الشركة وتسجيل الدخول",deletable:!1,description:"الحقول الخاصة بالشركات وإدارة الوصول للنظام.",fields:[{id:"code",label:"معرف الشركة (يوزر فلاي)",type:"text",required:!1,visible:!0,deletable:!0,appliesTo:["company"],aliases:["code","companyid","company id","معرف الشركة","يوزر فلاي"]},{id:"paymentType",label:"نوع التعامل",type:"select",required:!0,visible:!0,deletable:!0,options:[{value:"cash",label:"نقدي"},{value:"credit",label:"آجل"}],appliesTo:["company","individual"],aliases:["paymenttype","payment type","نوع التعامل","التعامل","نوع الدفع"]}]},{id:"sec_login",title:"إدارة تسجيل الدخول",deletable:!1,description:"إدارة الوصول للنظام لهذه العلاقة.",fields:[{id:"loginIdentifier",label:"معرف تسجيل الدخول",type:"text",required:!1,visible:!0,deletable:!1,placeholder:"اختر معرفًا فريدًا لتسجيل الدخول",appliesTo:["individual","company"],aliases:["login id","login identifier","username","معرف الدخول","اسم المستخدم"]},{id:"password",label:"كلمة المرور",type:"password",required:!1,visible:!0,deletable:!1,placeholder:"اتركه فارغًا لعدم التغيير",appliesTo:["individual","company"],aliases:["password","كلمة المرور"]}]},{id:"sec_other",title:"تفاصيل أخرى",deletable:!0,description:"حقول إضافية وتفاصيل.",fields:[{id:"details",label:"التفاصيل",type:"textarea",required:!1,visible:!0,deletable:!0,appliesTo:["individual","company"],aliases:["details","notes","ملاحظات","تفاصيل"]}]}],financeAccounts:(0,a.rN)({preventDirectCashRevenue:!1}),customRevenueAccounts:{ticketsRevenueAccountId:"",visaRevenueAccountId:"",subscriptionsRevenueAccountId:"",segmentsRevenueAccountId:""},preventDirectProfitToCash:!0}},96595:(e,t,s)=>{"use strict";s.d(t,{A:()=>C});var a=s(95155),l=s(12115),i=s(13406),r=s(86948),n=s(5468),d=s(85584),o=s(3998),c=s(65142),u=s(13630),p=s(22452),m=s(76140),f=s(66065),h=s(92033),x=s(73180),v=s(30940),b=s(15894),g=s(60013),y=s(98053),j=s(89274);let w=e=>{let{title:t,keywords:s,onKeywordsChange:l}=e;return(0,a.jsxs)(r.Zp,{children:[(0,a.jsx)(r.aR,{children:(0,a.jsx)(r.ZB,{className:"text-base",children:t})}),(0,a.jsxs)(r.Wu,{className:"flex flex-wrap gap-2",children:[s.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center gap-1 p-1 pl-2 rounded-md bg-muted border",children:[(0,a.jsx)(c.p,{value:e,onChange:e=>l((0,g.jM)(s,s=>{s[t]=e.target.value})),className:"h-7 text-sm border-none shadow-none focus-visible:ring-1 bg-transparent"}),(0,a.jsx)(o.$,{variant:"ghost",size:"icon",className:"h-6 w-6 text-destructive",onClick:()=>l(s.filter((e,s)=>s!==t)),children:(0,a.jsx)(u.A,{className:"h-4 w-4"})})]},t)),(0,a.jsx)(o.$,{type:"button",variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>l([...s.filter(Boolean),""]),children:(0,a.jsx)(p.A,{className:"h-4 w-4"})})]})]})};function N(e){let{settings:t,onSettingsChanged:s}=e,[i,n]=(0,l.useState)({}),[d,N]=(0,l.useState)({creditKeywords:[],cashKeywords:[]}),[A,C]=(0,l.useState)(!1),{toast:S}=(0,b.dj)(),k=l.useMemo(()=>{var e;return(null==(e=t.relationSections)?void 0:e.flatMap(e=>e.fields))||[]},[t.relationSections]);(0,l.useEffect)(()=>{let e=t.importFieldsSettings||{};n((0,g.jM)(e,e=>{k.forEach(t=>{e[t.id]?e[t.id].label=t.label:e[t.id]={label:t.label,aliases:t.aliases||[t.label.toLowerCase()]}})})),N(t.importLogicSettings||{cashKeywords:["cash","كاش","نقد","نقدي"],creditKeywords:["credit","آجل","debit","دبت"]})},[t,k]);let I=async()=>{let e=(0,g.jM)(i,e=>{for(let t in e)e[t].aliases=e[t].aliases.filter(Boolean)}),t=(0,g.jM)(d,e=>{e.creditKeywords=e.creditKeywords.filter(Boolean),e.cashKeywords=e.cashKeywords.filter(Boolean)});C(!0),(await (0,v.X)({importFieldsSettings:e,importLogicSettings:t})).success?(S({title:"تم حفظ المرادفات بنجاح"}),s()):S({title:"خطأ",description:"لم يتم حفظ المرادفات",variant:"destructive"}),C(!1)},R=(e,t)=>{N((0,g.jM)(s=>{s&&(s[e]=t)}))},_=async()=>{C(!0),(await (0,v.X)({importFieldsSettings:j.xd.importFieldsSettings,importLogicSettings:j.xd.importLogicSettings})).success?(s(),S({title:"تمت إعادة التعيين للإعدادات الافتراضية"})):S({title:"خطأ",description:"لم يتم إعادة التعيين.",variant:"destructive"}),C(!1)};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold",children:"مرادفات حقول الاستيراد"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"إدارة الكلمات التي يتعرف عليها النظام لربط الأعمدة وتفسير قيمها عند استيراد ملف Excel."})]}),(0,a.jsxs)(y.Lt,{children:[(0,a.jsx)(y.tv,{asChild:!0,children:(0,a.jsxs)(o.$,{variant:"ghost",children:[(0,a.jsx)(m.A,{className:"me-2 h-4 w-4"}),"إعادة للوضع الافتراضي"]})}),(0,a.jsxs)(y.EO,{children:[(0,a.jsxs)(y.wd,{children:[(0,a.jsx)(y.r7,{children:"هل أنت متأكد؟"}),(0,a.jsx)(y.$v,{children:"سيؤدي هذا إلى حذف جميع المرادفات المخصصة والعودة إلى القائمة الافتراضية."})]}),(0,a.jsxs)(y.ck,{children:[(0,a.jsx)(y.Zr,{children:"إلغاء"}),(0,a.jsx)(y.Rx,{onClick:_,children:"نعم، قم بإعادة التعيين"})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)(r.Zp,{children:[(0,a.jsxs)(r.aR,{children:[(0,a.jsxs)(r.ZB,{className:"flex items-center gap-2 text-base",children:[(0,a.jsx)(f.A,{className:"h-5 w-5"}),'إعدادات منطق "نوع التعامل"']}),(0,a.jsx)(r.BT,{children:'هنا يمكنك تحديد الكلمات التي سيتم تفسيرها على أنها "نقدي" أو "آجل" عند استيراد البيانات.'})]}),(0,a.jsxs)(r.Wu,{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,a.jsx)(w,{title:"كلمات تعني (نقدي)",keywords:d.cashKeywords,onKeywordsChange:e=>R("cashKeywords",e)}),(0,a.jsx)(w,{title:"كلمات تعني (آجل)",keywords:d.creditKeywords,onKeywordsChange:e=>R("creditKeywords",e)})]})]}),k.map(e=>{var t;return(0,a.jsxs)(r.Zp,{children:[(0,a.jsxs)(r.aR,{children:[(0,a.jsxs)(r.ZB,{children:["مرادفات حقل: ",e.label]}),(0,a.jsx)(r.BT,{children:"هذه المرادفات تستخدم لمساعدة النظام في العثور على عنوان العمود الصحيح في ملفك."})]}),(0,a.jsxs)(r.Wu,{className:"flex flex-wrap gap-2",children:[((null==(t=i[e.id])?void 0:t.aliases)||[]).map((t,s)=>(0,a.jsxs)("div",{className:"flex items-center gap-1 p-1 pl-2 rounded-md bg-muted border",children:[(0,a.jsx)(c.p,{value:t,onChange:t=>{var a,l;return a=e.id,l=t.target.value,void n((0,g.jM)(e=>{(null==e?void 0:e[a])&&(e[a].aliases[s]=l)}))},className:"h-7 text-sm border-none shadow-none focus-visible:ring-1 bg-transparent"}),(0,a.jsx)(o.$,{variant:"ghost",size:"icon",className:"h-6 w-6 text-destructive",onClick:()=>{var t;return t=e.id,void n((0,g.jM)(e=>{(null==e?void 0:e[t])&&e[t].aliases.splice(s,1)}))},children:(0,a.jsx)(u.A,{className:"h-4 w-4"})})]},s)),(0,a.jsx)(o.$,{type:"button",variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>{var t;return t=e.id,void n((0,g.jM)(e=>{if(null==e?void 0:e[t]){let s=e[t].aliases.filter(Boolean);e[t].aliases=[...s,""]}}))},children:(0,a.jsx)(p.A,{className:"h-4 w-4"})})]})]},e.id)})]}),(0,a.jsx)("div",{className:"flex justify-end mt-6",children:(0,a.jsxs)(o.$,{onClick:I,disabled:A,children:[A&&(0,a.jsx)(h.A,{className:"me-2 h-4 w-4 animate-spin"}),(0,a.jsx)(x.A,{className:"me-2 h-4 w-4"}),"حفظ كل التغييرات"]})})]})}var A=s(51111);function C(e){let{settings:t,onSettingsChanged:s}=e;return(0,a.jsxs)(i.tU,{defaultValue:"fields",children:[(0,a.jsxs)(i.j7,{className:"grid w-full grid-cols-2",children:[(0,a.jsxs)(i.Xi,{value:"fields",children:[(0,a.jsx)(n.A,{className:"me-2 h-4 w-4"}),"إدارة الحقول"]}),(0,a.jsxs)(i.Xi,{value:"import",children:[(0,a.jsx)(d.A,{className:"me-2 h-4 w-4"}),"استيراد Excel"]})]}),(0,a.jsx)(i.av,{value:"fields",className:"mt-4",children:(0,a.jsx)(r.Zp,{children:(0,a.jsx)(r.Wu,{className:"pt-6",children:(0,a.jsx)(N,{settings:t,onSettingsChanged:s})})})}),(0,a.jsx)(i.av,{value:"import",className:"mt-4",children:(0,a.jsxs)(r.Zp,{children:[(0,a.jsxs)(r.aR,{children:[(0,a.jsx)(r.ZB,{children:"أداة استيراد Excel"}),(0,a.jsx)(r.BT,{children:"اتبع الخطوات لاستيراد بيانات العملاء أو الموردين من ملف."})]}),(0,a.jsx)(r.Wu,{children:(0,a.jsx)(A.A,{settings:t})})]})})]})}}}]);