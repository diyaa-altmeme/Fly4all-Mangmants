(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9618],{30940:(e,s,a)=>{"use strict";a.d(s,{X:()=>t});var n=a(30926);let t=(0,n.createServerReference)("40bd3493b6cd183a3f75aa7b2dffe9f325b07a2b9d",n.callServer,void 0,n.findSourceMapURL,"updateSettings")},32251:(e,s,a)=>{Promise.resolve().then(a.bind(a,88888)),Promise.resolve().then(a.bind(a,31868))},44846:(e,s,a)=>{"use strict";a.d(s,{d:()=>r});var n=a(95155),t=a(12115),l=a(27599),i=a(64269);let r=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,n.jsx)(l.bL,{className:(0,i.cn)("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",a),...t,ref:s,children:(0,n.jsx)(l.zi,{className:(0,i.cn)("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0 rtl:data-[state=checked]:-translate-x-4 rtl:data-[state=unchecked]:-translate-x-0")})})});r.displayName=l.bL.displayName},48182:(e,s,a)=>{"use strict";a.d(s,{rN:()=>d,uJ:()=>c});let n=e=>(null!=e?e:"").trim(),t=(e,s)=>Array.from(new Set([...s,...Object.keys(e||{})])).reduce((s,a)=>(s[a]=n(null==e?void 0:e[a]),s),{}),l=e=>Object.values(e).find(e=>e.length>0)||"",i=["tickets","visas","subscriptions","segments","profit_distribution","other"],r=["tickets","visas","subscriptions","partners","operating","cost_tickets","cost_visas","operating_salaries","operating_rent","operating_utilities","marketing"];function c(e){let s={...(null==e?void 0:e.revenueMap)||{},...(null==e?void 0:e.customRevenues)||{}},a={...(null==e?void 0:e.expenseMap)||{},...(null==e?void 0:e.customExpenses)||{}},c=t(s,i),d=t(a,r),o=n((null==e?void 0:e.receivableAccountId)||(null==e?void 0:e.arAccountId)),u=n((null==e?void 0:e.payableAccountId)||(null==e?void 0:e.apAccountId)),p=n(null==e?void 0:e.generalRevenueId)||l(c),v=n(null==e?void 0:e.generalExpenseId)||l(d);return{receivableAccountId:o,payableAccountId:u,hybridRelationAccountId:n(null==e?void 0:e.hybridRelationAccountId),clearingAccountId:n(null==e?void 0:e.clearingAccountId),defaultCashId:n(null==e?void 0:e.defaultCashId),defaultBankId:n(null==e?void 0:e.defaultBankId),arAccountId:o,apAccountId:u,generalRevenueId:p,generalExpenseId:v,preventDirectCashRevenue:!!(null==e?void 0:e.preventDirectCashRevenue),revenueMap:c,expenseMap:d}}function d(e){let s=t(e.revenueMap||{},i),a=t(e.expenseMap||{},r),c=n(e.receivableAccountId),d=n(e.payableAccountId),o=n(e.generalRevenueId)||l(s),u=n(e.generalExpenseId)||l(a);return{receivableAccountId:c,payableAccountId:d,hybridRelationAccountId:n(e.hybridRelationAccountId),clearingAccountId:n(e.clearingAccountId),defaultCashId:n(e.defaultCashId),defaultBankId:n(e.defaultBankId),preventDirectCashRevenue:!!e.preventDirectCashRevenue,generalRevenueId:o,generalExpenseId:u,arAccountId:c,apAccountId:d,revenueMap:s,customRevenues:s,expenseMap:a,customExpenses:a}}},86259:(e,s,a)=>{"use strict";a.d(s,{Separator:()=>r});var n=a(95155),t=a(12115),l=a(57268),i=a(64269);let r=t.forwardRef((e,s)=>{let{className:a,orientation:t="horizontal",decorative:r=!0,...c}=e;return(0,n.jsx)(l.b,{ref:s,decorative:r,orientation:t,className:(0,i.cn)("shrink-0 bg-border","horizontal"===t?"h-[1px] w-full":"h-full w-[1px]",a),...c})});r.displayName=l.b.displayName},88888:(e,s,a)=>{"use strict";a.d(s,{default:()=>M});var n=a(95155),t=a(12115),l=a(30940),i=a(3998),r=a(86259),c=a(92033),d=a(73180),o=a(78770),u=a(15894),p=a(22544),v=a(66942),x=a(54879),h=a(41052),m=a(20243),b=a(23639),j=a(44846),g=a(91303),f=a(48182);let I=x.Ik({receivableAccountId:x.Yj().optional(),payableAccountId:x.Yj().optional(),hybridRelationAccountId:x.Yj().optional(),clearingAccountId:x.Yj().optional(),defaultCashId:x.Yj().optional(),defaultBankId:x.Yj().optional(),preventDirectCashRevenue:x.zM().default(!1),generalRevenueId:x.Yj().optional(),generalExpenseId:x.Yj().optional(),rev_tickets:x.Yj().optional(),rev_visas:x.Yj().optional(),rev_subscriptions:x.Yj().optional(),rev_segments:x.Yj().optional(),rev_other:x.Yj().optional(),exp_tickets:x.Yj().optional(),exp_visas:x.Yj().optional(),exp_subscriptions:x.Yj().optional(),exp_partners:x.Yj().optional(),exp_operating:x.Yj().optional()}),A=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=s>0?"".concat("—".repeat(s)," "):"";return e.flatMap(e=>[{value:e.id,label:"".concat(a).concat(e.code," — ").concat(e.name),type:e.type},...e.children&&e.children.length>0?A(e.children,s+1):[]])};function N(e){var s;let{initialFinanceMap:a,chartOfAccounts:x,onSaveSuccess:N}=e,{toast:k}=(0,u.dj)(),[y,_]=(0,t.useState)(!0),R=(0,p.mN)({resolver:(0,v.u)(I),defaultValues:{preventDirectCashRevenue:null!=(s=null==a?void 0:a.preventDirectCashRevenue)&&s}});(0,t.useEffect)(()=>{var e,s,n,t,l,i,r,c,d,o;_(!0);let u=(0,f.uJ)(a);R.reset({receivableAccountId:u.receivableAccountId||"",payableAccountId:u.payableAccountId||"",hybridRelationAccountId:u.hybridRelationAccountId||"",clearingAccountId:u.clearingAccountId||"",defaultCashId:u.defaultCashId||"",defaultBankId:u.defaultBankId||"",generalRevenueId:u.generalRevenueId||"",generalExpenseId:u.generalExpenseId||"",preventDirectCashRevenue:u.preventDirectCashRevenue||!1,rev_tickets:(null==(e=u.revenueMap)?void 0:e.tickets)||"",rev_visas:(null==(s=u.revenueMap)?void 0:s.visas)||"",rev_subscriptions:(null==(n=u.revenueMap)?void 0:n.subscriptions)||"",rev_segments:(null==(t=u.revenueMap)?void 0:t.segments)||"",rev_other:(null==(l=u.revenueMap)?void 0:l.other)||"",exp_tickets:(null==(i=u.expenseMap)?void 0:i.tickets)||"",exp_visas:(null==(r=u.expenseMap)?void 0:r.visas)||"",exp_subscriptions:(null==(c=u.expenseMap)?void 0:c.subscriptions)||"",exp_partners:(null==(d=u.expenseMap)?void 0:d.partners)||"",exp_operating:(null==(o=u.expenseMap)?void 0:o.operating)||""}),_(!1)},[a,R]);let C=(0,t.useMemo)(()=>A((0,g.H)(x)),[x]),w=async e=>{try{let s=(0,f.rN)({receivableAccountId:e.receivableAccountId,payableAccountId:e.payableAccountId,hybridRelationAccountId:e.hybridRelationAccountId,clearingAccountId:e.clearingAccountId,defaultCashId:e.defaultCashId,defaultBankId:e.defaultBankId,generalRevenueId:e.generalRevenueId,generalExpenseId:e.generalExpenseId,preventDirectCashRevenue:e.preventDirectCashRevenue,revenueMap:{tickets:e.rev_tickets,visas:e.rev_visas,subscriptions:e.rev_subscriptions,segments:e.rev_segments,other:e.rev_other},expenseMap:{tickets:e.exp_tickets,visas:e.exp_visas,subscriptions:e.exp_subscriptions,partners:e.exp_partners,operating:e.exp_operating}}),a=await (0,l.X)({financeAccounts:s});a.success?(k({title:"تم الحفظ بنجاح"}),N()):k({title:"خطأ",description:a.error||"فشل حفظ البيانات.",variant:"destructive"})}catch(e){k({title:"خطأ",description:e.message||"تعذر حفظ البيانات.",variant:"destructive"})}},S=e=>{let{name:s,label:a,options:t}=e;return(0,n.jsxs)("div",{className:"grid grid-cols-3 gap-3 items-center",children:[(0,n.jsx)("div",{className:"font-semibold",children:a}),(0,n.jsx)("div",{className:"col-span-2",children:(0,n.jsx)(h.zB,{control:R.control,name:s,render:e=>{let{field:s}=e;return(0,n.jsx)(h.eI,{children:(0,n.jsx)(b.j,{options:t,value:s.value||"",onValueChange:s.onChange,placeholder:"اختر حسابًا..."})})}})})]})};return y?(0,n.jsx)("div",{className:"space-y-6",children:[void 0,void 0,void 0].map((e,s)=>(0,n.jsxs)("div",{children:[(0,n.jsx)(m.E,{className:"h-6 w-1/4 mb-4"}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)(m.E,{className:"h-10 w-full"}),(0,n.jsx)(m.E,{className:"h-10 w-full"})]})]},s))}):(0,n.jsx)(h.lV,{...R,children:(0,n.jsxs)("form",{onSubmit:R.handleSubmit(w),className:"space-y-6",children:[(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("div",{className:"text-sm font-bold text-muted-foreground",children:"الذمم"}),(0,n.jsx)(S,{name:"receivableAccountId",label:"الذمم المدينة (العملاء)",options:C}),(0,n.jsx)(S,{name:"payableAccountId",label:"الذمم الدائنة (الموردين)",options:C}),(0,n.jsx)(S,{name:"hybridRelationAccountId",label:"العلاقات المزدوجة (هجينة)",options:C})]}),(0,n.jsx)(r.Separator,{}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("div",{className:"text-sm font-bold text-muted-foreground",children:"النقدية والتسوية"}),(0,n.jsx)(S,{name:"defaultCashId",label:"الصندوق الافتراضي",options:C}),(0,n.jsx)(S,{name:"defaultBankId",label:"الحساب البنكي الافتراضي",options:C}),(0,n.jsx)(S,{name:"clearingAccountId",label:"حساب التسوية (Clearing)",options:C})]}),(0,n.jsx)(r.Separator,{}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("div",{className:"text-sm font-bold text-muted-foreground",children:"حسابات رئيسية"}),(0,n.jsx)(S,{name:"generalRevenueId",label:"الإيرادات العامة",options:C}),(0,n.jsx)(S,{name:"generalExpenseId",label:"المصروفات العامة",options:C})]}),(0,n.jsx)(r.Separator,{}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("div",{className:"text-sm font-bold text-muted-foreground",children:"السياسات"}),(0,n.jsx)(h.zB,{control:R.control,name:"preventDirectCashRevenue",render:e=>{var s;let{field:a}=e;return(0,n.jsxs)(h.eI,{className:"flex items-center justify-between rounded-md border p-3",children:[(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)(h.lR,{className:"text-base",children:"منع ترحيل الإيرادات مباشرة للصندوق"}),(0,n.jsx)(h.Rr,{children:"عند التفعيل سيتم إجبار النظام على استخدام حسابات الإيراد المحددة بدلاً من الصندوق النقدي في قيود الإيراد."})]}),(0,n.jsx)(h.MJ,{children:(0,n.jsx)(j.d,{checked:null!=(s=a.value)&&s,onCheckedChange:a.onChange})})]})}})]}),(0,n.jsx)(r.Separator,{}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("div",{className:"text-sm font-bold text-muted-foreground",children:"خريطة الإيرادات"}),(0,n.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,n.jsx)(S,{name:"rev_tickets",label:"إيرادات التذاكر",options:C}),(0,n.jsx)(S,{name:"rev_visas",label:"إيرادات الفيزا",options:C}),(0,n.jsx)(S,{name:"rev_subscriptions",label:"إيرادات الاشتراكات",options:C}),(0,n.jsx)(S,{name:"rev_segments",label:"إيرادات السكمنت",options:C}),(0,n.jsx)(S,{name:"rev_other",label:"إيرادات أخرى",options:C})]})]}),(0,n.jsx)(r.Separator,{}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("div",{className:"text-sm font-bold text-muted-foreground",children:"خريطة المصروفات"}),(0,n.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,n.jsx)(S,{name:"exp_tickets",label:"تكلفة التذاكر",options:C}),(0,n.jsx)(S,{name:"exp_visas",label:"تكلفة الفيزا",options:C}),(0,n.jsx)(S,{name:"exp_subscriptions",label:"تكلفة الاشتراكات",options:C}),(0,n.jsx)(S,{name:"exp_partners",label:"مصروفات الشركاء",options:C}),(0,n.jsx)(S,{name:"exp_operating",label:"مصروفات تشغيلية",options:C})]})]}),(0,n.jsxs)("div",{className:"pt-4 flex items-center gap-2",children:[(0,n.jsxs)(i.$,{type:"submit",className:"font-bold",disabled:R.formState.isSubmitting,children:[R.formState.isSubmitting?(0,n.jsx)(c.A,{className:"animate-spin me-2"}):(0,n.jsx)(d.A,{className:"ml-2 h-4 w-4"}),"حفظ الربط"]}),(0,n.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,n.jsx)(o.A,{className:"h-4 w-4"}),"سيؤثر هذا الربط على القيود الجديدة فورًا."]})]})]})})}var k=a(80358),y=a(91658),_=a(13381),R=a(86948),C=a(37030),w=a(41898);let S=e=>{let{active:s,onClick:a,children:t}=e;return(0,n.jsx)(i.$,{variant:s?"secondary":"ghost",className:"w-full justify-start gap-2 font-semibold",onClick:a,children:t})};function M(e){let[s,a]=(0,t.useState)(e.initialChartData),[l,r]=(0,t.useState)(!1),[c,d]=(0,t.useState)("chart"),{toast:o}=(0,u.dj)(),p=(0,t.useCallback)(async()=>{r(!0);try{let e=await (0,C.S)();a(e),o({title:"تم تحديث شجرة الحسابات"})}catch(e){o({title:"خطأ",description:e.message,variant:"destructive"})}finally{r(!1)}},[o]);return(0,n.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-[250px,1fr] gap-6 items-start",children:[(0,n.jsx)("aside",{className:"lg:sticky top-20",children:(0,n.jsxs)(R.Zp,{children:[(0,n.jsx)(R.aR,{children:(0,n.jsx)(R.ZB,{className:"text-base",children:"أقسام المحاسبة"})}),(0,n.jsxs)(R.Wu,{className:"space-y-1 p-2",children:[(0,n.jsxs)(S,{active:"chart"===c,onClick:()=>d("chart"),children:[(0,n.jsx)(k.A,{className:"h-5 w-5"}),"الدليل المحاسبي"]}),(0,n.jsxs)(S,{active:"linking"===c,onClick:()=>d("linking"),children:[(0,n.jsx)(y.A,{className:"h-5 w-5"}),"ربط الحسابات"]}),(0,n.jsxs)(i.$,{variant:"ghost",size:"sm",className:"w-full justify-start gap-2",onClick:p,disabled:l,children:[(0,n.jsx)(_.A,{className:"h-4 w-4"}),"تحديث البيانات"]})]})]})}),(0,n.jsxs)("main",{children:["chart"===c&&(0,n.jsx)(w.default,{initialAccounts:s,onAccountsUpdated:a}),"linking"===c&&(0,n.jsxs)(R.Zp,{children:[(0,n.jsxs)(R.aR,{children:[(0,n.jsx)(R.ZB,{children:"ربط الحسابات المالية"}),(0,n.jsx)(R.BT,{children:"اربط حسابات النظام الرئيسية بالحسابات الفعلية في شجرة الحسابات لضمان التوجيه المحاسبي الصحيح."})]}),(0,n.jsx)(R.Wu,{children:(0,n.jsx)(N,{initialFinanceMap:e.initialFinanceMap,chartOfAccounts:s,onSaveSuccess:()=>{o({title:"تم حفظ إعدادات الربط بنجاح"})}})})]})]})]})}}},e=>{e.O(0,[9135,7210,4909,9625,315,5111,4127,9967,1374,8994,43,84,5672,4486,8255,880,4762,2500,827,8441,1255,7358],()=>e(e.s=32251)),_N_E=e.O()}]);