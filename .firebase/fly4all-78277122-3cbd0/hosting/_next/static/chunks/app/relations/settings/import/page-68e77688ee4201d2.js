(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9600],{3998:(e,t,a)=>{"use strict";a.d(t,{$:()=>o,r:()=>d});var r=a(95155),s=a(12115),l=a(32467),i=a(83101),n=a(64269);let d=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-bold ring-offset-background transition-transform transform-gpu hover:-translate-y-0.5 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-md hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",accent:"bg-accent text-accent-foreground shadow-md hover:bg-accent/90"},size:{default:"h-10 px-4 py-2 [&_svg]:size-4",sm:"h-9 rounded-md px-3 [&_svg]:size-4",lg:"h-11 rounded-lg px-8 [&_svg]:size-5",icon:"h-10 w-10 [&_svg]:size-5"}},defaultVariants:{variant:"default",size:"default"}}),o=s.forwardRef((e,t)=>{let{className:a,variant:s,size:i,asChild:o=!1,...c}=e,u=o?l.DX:"button";return(0,r.jsx)(u,{className:(0,n.cn)(d({variant:s,size:i,className:a})),ref:t,...c})});o.displayName="Button"},7545:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(14294).A)("Terminal",[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]])},11186:(e,t,a)=>{"use strict";a.d(t,{bq:()=>f,eb:()=>h,gC:()=>x,l6:()=>c,yv:()=>u});var r=a(95155),s=a(12115),l=a(47887),i=a(59007),n=a(42614),d=a(72251),o=a(64269);let c=l.bL;l.YJ;let u=l.WT,f=s.forwardRef((e,t)=>{let{className:a,children:s,...n}=e;return(0,r.jsxs)(l.l9,{ref:t,className:(0,o.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...n,children:[s,(0,r.jsx)(l.In,{asChild:!0,children:(0,r.jsx)(i.A,{className:"h-4 w-4 opacity-50"})})]})});f.displayName=l.l9.displayName;let m=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.PP,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",a),...s,children:(0,r.jsx)(n.A,{className:"h-4 w-4"})})});m.displayName=l.PP.displayName;let p=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.wn,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",a),...s,children:(0,r.jsx)(i.A,{className:"h-4 w-4"})})});p.displayName=l.wn.displayName;let x=s.forwardRef((e,t)=>{let{className:a,children:s,position:i="popper",...n}=e;return(0,r.jsx)(l.ZL,{children:(0,r.jsxs)(l.UC,{ref:t,className:(0,o.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:i,...n,children:[(0,r.jsx)(m,{}),(0,r.jsx)(l.LM,{className:(0,o.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),(0,r.jsx)(p,{})]})})});x.displayName=l.UC.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.JU,{ref:t,className:(0,o.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...s})}).displayName=l.JU.displayName;let h=s.forwardRef((e,t)=>{let{className:a,children:s,...i}=e;return(0,r.jsxs)(l.q7,{ref:t,className:(0,o.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...i,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(l.VF,{children:(0,r.jsx)(d.A,{className:"h-4 w-4"})})}),(0,r.jsx)(l.p4,{children:s})]})});h.displayName=l.q7.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.wv,{ref:t,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",a),...s})}).displayName=l.wv.displayName},13630:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(14294).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},13713:(e,t,a)=>{"use strict";a.d(t,{C1:()=>n,LB:()=>d,lE:()=>o});var r=a(95155),s=a(12115),l=a(72251),i=a(64269);let n=s.forwardRef((e,t)=>{let{className:a,children:s,initialStep:l,steps:n,activeStep:d,...o}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("flex w-full flex-row justify-between gap-x-2",a),...o,children:s})});n.displayName="Stepper";let d=s.forwardRef((e,t)=>{let{className:a,label:s,isCompleted:n,isActive:d,isOptional:o,icon:c,isLast:u,...f}=e;return(0,r.jsxs)("div",{ref:t,className:(0,i.cn)("flex flex-1 items-center gap-x-2",a),...f,children:[(0,r.jsx)("div",{className:"flex items-center",children:(0,r.jsx)("div",{className:(0,i.cn)("flex h-8 w-8 items-center justify-center rounded-full text-lg font-bold ring-2 transition-colors",d?"bg-primary text-primary-foreground ring-primary":n?"bg-secondary text-secondary-foreground ring-secondary":"bg-muted text-muted-foreground ring-muted"),children:n?(0,r.jsx)(l.A,{}):c})}),(0,r.jsx)("div",{className:"hidden md:flex flex-col",children:(0,r.jsx)("h3",{className:(0,i.cn)("font-medium transition-colors",d?"text-primary":"text-muted-foreground"),children:s})}),!u&&(0,r.jsx)("div",{className:"h-px w-full flex-1 bg-border transition-colors","aria-hidden":"true"})]})});d.displayName="StepperItem";let o=e=>{let{initialStep:t=0,steps:a}=e,[r,l]=s.useState(t),i=s.useCallback(()=>{l(e=>e<a.length-1?e+1:e)},[a.length]),n=s.useCallback(()=>{l(e=>e>0?e-1:e)},[]),d=s.useCallback(()=>{l(t)},[t]),o=r===a.length-1;return{activeStep:r,setActiveStep:l,goToNextStep:i,goToPreviousStep:n,resetSteps:d,isDisabledStep:0===r,isLastStep:o}}},15894:(e,t,a)=>{"use strict";a.d(t,{dj:()=>u});var r=a(12115);let s=0,l=new Map,i=e=>{if(l.has(e))return;let t=setTimeout(()=>{l.delete(e),o({type:"REMOVE_TOAST",toastId:e})},1e6);l.set(e,t)},n=[],d={toasts:[]};function o(e){d=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,3)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?i(a):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(d,e),n.forEach(e=>{e(d)})}function c(e){let{...t}=e,a=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>o({type:"DISMISS_TOAST",toastId:a});return t.variant||(t.variant="default"),o({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||r()}}}),{id:a,dismiss:r,update:e=>o({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function u(){let[e,t]=r.useState(d);return r.useEffect(()=>(n.push(t),()=>{let e=n.indexOf(t);e>-1&&n.splice(e,1)}),[e]),{...e,toast:c,dismiss:e=>o({type:"DISMISS_TOAST",toastId:e})}}},18332:(e,t,a)=>{"use strict";a.d(t,{Fc:()=>d,TN:()=>c,XL:()=>o});var r=a(95155),s=a(12115),l=a(83101),i=a(64269);let n=(0,l.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),d=s.forwardRef((e,t)=>{let{className:a,variant:s,...l}=e;return(0,r.jsx)("div",{ref:t,role:"alert",className:(0,i.cn)(n({variant:s}),a),...l})});d.displayName="Alert";let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("h5",{ref:t,className:(0,i.cn)("mb-1 font-medium leading-none tracking-tight",a),...s})});o.displayName="AlertTitle";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("text-sm [&_p]:leading-relaxed",a),...s})});c.displayName="AlertDescription"},18527:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(14294).A)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},20063:(e,t,a)=>{"use strict";var r=a(47260);a.o(r,"notFound")&&a.d(t,{notFound:function(){return r.notFound}}),a.o(r,"redirect")&&a.d(t,{redirect:function(){return r.redirect}}),a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},20243:(e,t,a)=>{"use strict";a.d(t,{E:()=>l});var r=a(95155),s=a(64269);function l(e){let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,s.cn)("animate-pulse rounded-md bg-muted",t),...a})}},22452:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(14294).A)("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]])},26541:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(14294).A)("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]])},26615:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(14294).A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},30926:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{callServer:function(){return r.callServer},createServerReference:function(){return l.createServerReference},findSourceMapURL:function(){return s.findSourceMapURL}});let r=a(41209),s=a(85153),l=a(77197)},30940:(e,t,a)=>{"use strict";a.d(t,{X:()=>s});var r=a(30926);let s=(0,r.createServerReference)("40bd3493b6cd183a3f75aa7b2dffe9f325b07a2b9d",r.callServer,void 0,r.findSourceMapURL,"updateSettings")},32383:()=>{},33173:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(14294).A)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]])},34367:(e,t,a)=>{Promise.resolve().then(a.bind(a,82125))},36204:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(14294).A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},51111:(e,t,a)=>{"use strict";a.d(t,{A:()=>P});var r=a(95155),s=a(12115),l=a(3998),i=a(15894),n=a(4246),d=a(11636),o=a(18527),c=a(26615),u=a(97776),f=a(64269);function m(e){let{onDataReady:t}=e,[a,m]=(0,s.useState)(null),{toast:p}=(0,i.dj)(),x=(0,s.useCallback)(e=>{m(e);let a=new FileReader;a.onload=e=>{try{var a;let r=new Uint8Array(null==(a=e.target)?void 0:a.result),s=n.LF(r,{type:"array"}),l=s.Sheets[s.SheetNames[0]],i=n.Wp.sheet_to_json(l,{defval:""});t(i),p({title:"تم تحميل ".concat(i.length," سجل بنجاح"),description:"انتقِل للخطوة التالية لربط الحقول."})}catch(e){p({title:"خطأ في قراءة الملف",description:"تعذر تحليل ملف Excel. الرجاء التأكد من أنه بالتنسيق الصحيح.",variant:"destructive"})}},a.readAsArrayBuffer(e)},[t,p]),h=(0,s.useCallback)(e=>{e&&e.length>0&&x(e[0])},[x]),{getRootProps:v,getInputProps:g,isDragActive:y}=(0,d.VB)({onDrop:h,accept:{"application/vnd.ms-excel":[".xls"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"]},maxFiles:1});return(0,r.jsxs)("div",{...v(),className:(0,f.cn)("border-2 border-dashed rounded-lg p-10 text-center cursor-pointer relative flex flex-col justify-center items-center h-64 hover:border-primary transition-colors",y&&"border-primary bg-primary/10"),children:[(0,r.jsx)("input",{...g(),id:"excel-upload"}),a?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-full",children:[(0,r.jsx)(o.A,{className:"h-12 w-12 text-green-500"}),(0,r.jsxs)("p",{className:"mt-4 font-semibold text-lg",children:["تم تحميل الملف: ",a.name]}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"جاهز للانتقال للخطوة التالية."}),(0,r.jsxs)(l.$,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),m(null),t([])},className:"mt-2 text-destructive hover:text-destructive",children:[(0,r.jsx)(c.A,{className:"me-1 h-4 w-4"}),"إزالة الملف"]})]}):(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-muted-foreground",children:[(0,r.jsx)(u.A,{className:"h-12 w-12"}),(0,r.jsx)("h3",{className:"mt-4 font-semibold text-lg",children:"اسحب وأفلت ملف Excel هنا"}),(0,r.jsx)("p",{className:"mt-2 text-sm",children:"أو انقر لاختيار ملف من جهازك"})]})]})}var p=a(11186),x=a(22452);function h(e){let{headers:t,relationFields:a,importFieldsSettings:n,onMappingDone:d}=e,[o,c]=(0,s.useState)({}),[u,f]=(0,s.useState)([]),{toast:m}=(0,i.dj)(),h=(0,s.useMemo)(()=>a?[...a,...u]:u,[a,u]),v=(0,s.useCallback)(()=>{if(!a)return;let e={};a.forEach(a=>{let r=n[a.id],s=Array.from(new Set([a.label.toLowerCase().trim(),a.id.toLowerCase().trim(),...((null==r?void 0:r.aliases)||[]).map(e=>e.toLowerCase().trim())])),l=t.find(e=>s.includes(e.toLowerCase().trim()));l&&!Object.values(e).includes(a.id)&&(e[l]=a.id)}),c(e),m({title:"تم الربط التلقائي",description:"تم ربط ".concat(Object.keys(e).length," حقلاً تلقائيًا. الرجاء مراجعة النتائج.")})},[t,a,m,n]);return s.useEffect(()=>{v()},[]),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)(l.$,{onClick:v,variant:"outline",children:"إعادة الربط التلقائي"})}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(e=>(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"block font-medium text-sm",children:e}),(0,r.jsxs)(p.l6,{onValueChange:t=>((e,t)=>{if("__create_new__"===t){let t="custom_".concat(e.toLowerCase().replace(/\s+/g,"_"));if(h.some(e=>e.id===t))return void m({title:"الحقل موجود بالفعل",description:"يوجد حقل مخصص بنفس الاسم.",variant:"destructive"});let a={id:t,label:e,type:"text",required:!1,visible:!0,deletable:!0,aliases:[e.toLowerCase()],appliesTo:["individual","company"]};f(e=>[...e,a]),c(a=>({...a,[e]:t}))}else c(a=>({...a,[e]:t}))})(e,t),value:o[e]||"__ignore__",children:[(0,r.jsx)(p.bq,{children:(0,r.jsx)(p.yv,{placeholder:"-- اختر الحقل المناسب --"})}),(0,r.jsxs)(p.gC,{children:[(0,r.jsx)(p.eb,{value:"__ignore__",children:"-- تجاهل هذا الحقل --"}),(0,r.jsx)(p.eb,{value:"__create_new__",className:"text-green-600 font-bold",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(x.A,{className:"h-4 w-4"}),(0,r.jsxs)("span",{children:['إنشاء حقل جديد باسم "',e,'"']})]})}),h.map(e=>(0,r.jsx)(p.eb,{value:e.id,className:u.some(t=>t.id===e.id)?"text-green-600":"",children:e.label},e.id))]})]})]},e))}),(0,r.jsx)("div",{className:"flex justify-center pt-4",children:(0,r.jsx)(l.$,{onClick:()=>{if(!Object.values(o).includes("name")&&a.some(e=>"name"===e.id))return void m({title:"حقل الاسم مطلوب",description:"الرجاء ربط أحد أعمدة ملف Excel مع حقل 'الاسم الكامل' للمتابعة.",variant:"destructive"});d(o,u)},size:"lg",children:"معالجة البيانات والانتقال للمعاينة"})})]})}var v=a(87270),g=a(65142),y=a(13630);function b(e){let{rows:t,onRowUpdate:a,onDeleteRow:i,fieldMap:n,relationFields:d}=e;if(0===t.length)return(0,r.jsx)("p",{className:"text-center text-muted-foreground p-8",children:"لا توجد بيانات لعرضها."});let o=s.useMemo(()=>Object.values(n).filter(e=>"__ignore__"!==e),[n]);return(0,r.jsx)("div",{className:"overflow-auto max-h-[500px] border rounded-lg",children:(0,r.jsxs)(v.XI,{children:[(0,r.jsx)(v.A0,{className:"sticky top-0 bg-muted/80",children:(0,r.jsxs)(v.Hj,{children:[o.map(e=>{var t;return(0,r.jsx)(v.nd,{children:(null==(t=d.find(t=>t.id===e))?void 0:t.label)||e},e)}),(0,r.jsx)(v.nd,{className:"text-center",children:"حذف"})]})}),(0,r.jsx)(v.BF,{children:t.map((e,t)=>(0,r.jsxs)(v.Hj,{children:[o.map(s=>(0,r.jsx)(v.nA,{className:"p-1",children:(0,r.jsx)(g.p,{value:e[s]||"",onChange:r=>a(t,{...e,[s]:r.target.value}),className:"h-8"})},s)),(0,r.jsx)(v.nA,{className:"text-center p-1",children:(0,r.jsx)(l.$,{variant:"ghost",size:"icon",className:"text-destructive h-8 w-8",onClick:()=>i(t),children:(0,r.jsx)(y.A,{className:"h-4 w-4"})})})]},t))})]})})}var j=a(86948),N=a(92033),w=a(30926);let S=(0,w.createServerReference)("40d0448bacb32a373d23394258f9e7de4aa7fd38a9",w.callServer,void 0,w.findSourceMapURL,"addMultipleClients");var k=a(20063);function A(e){let{data:t,onSaveComplete:a}=e,{toast:n}=(0,i.dj)(),d=(0,k.useRouter)(),[c,u]=(0,s.useState)(!1),f=async()=>{u(!0);try{let e=await S(t);if(e.success)n({title:"تم حفظ ".concat(e.count," سجل بنجاح!"),description:"سيتم تحديث قائمة العلاقات."}),await a(),d.refresh();else throw Error(e.error)}catch(e){n({title:"فشل الحفظ",description:e.message||"حدث خطأ أثناء الحفظ",variant:"destructive"})}finally{u(!1)}};return(0,r.jsxs)(j.Zp,{className:"max-w-md mx-auto",children:[(0,r.jsxs)(j.aR,{children:[(0,r.jsxs)(j.ZB,{className:"flex items-center gap-2",children:[(0,r.jsx)(o.A,{className:"h-6 w-6 text-green-500"}),"جاهز للحفظ"]}),(0,r.jsx)(j.BT,{children:"تمت معالجة البيانات وهي جاهزة للحفظ في النظام."})]}),(0,r.jsxs)(j.Wu,{className:"text-center",children:[(0,r.jsx)("p",{className:"text-4xl font-bold",children:t.length}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"سجلًا سيتم استيراده."})]}),(0,r.jsx)(j.wL,{children:(0,r.jsx)(l.$,{className:"w-full",size:"lg",onClick:f,disabled:c,children:c?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(N.A,{className:"me-2 h-4 w-4 animate-spin"}),"جاري الحفظ..."]}):"تأكيد وحفظ البيانات"})})]})}var _=a(13713),C=a(58772),R=a(26541),M=a(55253),T=a(73180),L=a(33173),E=a(36204),O=a(30940),F=a(60013);let z=[{label:"رفع الملف",icon:(0,r.jsx)(C.A,{})},{label:"ربط الحقول",icon:(0,r.jsx)(R.A,{})},{label:"معاينة وتعديل",icon:(0,r.jsx)(M.A,{})},{label:"الحفظ",icon:(0,r.jsx)(T.A,{})}];function P(e){let{settings:t}=e,[a,n]=(0,s.useState)([]),[d,o]=(0,s.useState)([]),[c,u]=(0,s.useState)([]),[f,p]=(0,s.useState)({}),[x,v]=(0,s.useState)([]),{toast:g}=(0,i.dj)(),{activeStep:y,goToNextStep:j,goToPreviousStep:N,isLastStep:w}=(0,_.lE)({initialStep:0,steps:z}),S=e=>{if(0===e.length)return void g({title:"الملف فارغ أو غير صالح",variant:"destructive"});n(e),o(Object.keys(e[0])),j()},k=(e,r)=>{if(!(null==t?void 0:t.importLogicSettings)||!(null==t?void 0:t.relationSections))return void g({title:"خطأ",description:"لم يتم تحميل إعدادات النظام بشكل صحيح.",variant:"destructive"});p(e),v(r);let s=[...t.relationSections.flatMap(e=>e.fields),...r];u(a.map(a=>((e,t,a,r)=>{let s={};for(let a in r.forEach(e=>{s[e.id]=e.defaultValue||""}),t){let l,i=t[a];if("__ignore__"===i)continue;let n=e[a],d=r.find(e=>e.id===i);l=null==n||""===String(n).trim()?(null==d?void 0:d.defaultValue)||"":"string"==typeof n?n.trim():n,s[i]=l}let l=String(s.paymentType).toLowerCase();a.creditKeywords.map(e=>e.toLowerCase()).includes(l)?s.paymentType="credit":(a.cashKeywords.map(e=>e.toLowerCase()).includes(l),s.paymentType="cash");let i=String(s.type).toLowerCase();"company"===i||"شركة"===i?s.type="company":s.type="individual";let n=String(s.relationType).toLowerCase();return["supplier","مورد"].includes(n)?s.relationType="supplier":["both","كلاهما","عميل ومورد"].includes(n)?s.relationType="both":s.relationType="client",s.status=["active","نشط"].includes(String(s.status).toLowerCase())?"active":"inactive",s})(a,e,t.importLogicSettings,s))),j()},C=(e,t)=>{let a=[...c];a[e]=t,u(a)},R=e=>{u(c.filter((t,a)=>a!==e))},M=async()=>{if(!t.relationSections)return;let e=(0,F.jM)(t.relationSections,e=>{let t=e.flatMap(e=>e.fields).filter(e=>"select"===e.type);c.forEach(e=>{t.forEach(t=>{var a;let r=e[t.id];!r||(null==(a=t.options)?void 0:a.some(e=>e.label===r||e.value===r))||(t.options||(t.options=[]),t.options.push({value:r,label:r}))})})}),a=(0,F.jM)(e,e=>{let t=e.find(e=>"sec_other"===e.id);if(t&&x.length>0){let e=new Set(t.fields.map(e=>e.id)),a=x.filter(t=>!e.has(t.id));t.fields.push(...a)}else!t&&x.length>0&&e.push({id:"sec_other",title:"تفاصيل أخرى",description:"حقول إضافية وتفاصيل.",deletable:!0,fields:x})});JSON.stringify(a)!==JSON.stringify(t.relationSections)&&(await (0,O.X)({relationSections:a}),g({title:"تم تحديث إعدادات الحقول",description:"تمت إضافة الخيارات والحقول الجديدة من بياناتك المستوردة."}))};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"mb-8",children:(0,r.jsx)(_.C1,{activeStep:y,children:z.map((e,t)=>(0,r.jsx)(_.LB,{label:e.label,icon:e.icon,isCompleted:y>t,isActive:y===t,isLast:t===z.length-1},e.label))})}),(0,r.jsx)("div",{children:(()=>{switch(y){case 0:return(0,r.jsx)(m,{onDataReady:S});case 1:return(0,r.jsx)(h,{headers:d,onMappingDone:k,relationFields:t.relationSections.flatMap(e=>e.fields),importFieldsSettings:t.importFieldsSettings||{}});case 2:return(0,r.jsx)(b,{rows:c,onRowUpdate:C,onDeleteRow:R,fieldMap:f,relationFields:[...t.relationSections.flatMap(e=>e.fields),...x]});case 3:return(0,r.jsx)(A,{data:c,onSaveComplete:M});default:return null}})()}),(0,r.jsxs)("div",{className:"flex justify-between mt-8",children:[(0,r.jsxs)(l.$,{variant:"outline",onClick:N,disabled:0===y,children:[(0,r.jsx)(L.A,{className:"me-2 h-4 w-4"}),"السابق"]}),(0,r.jsxs)(l.$,{onClick:j,disabled:!!w||0===y&&0===a.length||1===y||2===y&&0===c.length,children:[w?"إنهاء":"التالي",(0,r.jsx)(E.A,{className:"ms-2 h-4 w-4"})]})]})]})}},55253:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(14294).A)("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]])},58772:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(14294).A)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},64269:(e,t,a)=>{"use strict";a.d(t,{cn:()=>l,pY:()=>i});var r=a(2821),s=a(75889);function l(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.QP)((0,r.$)(t))}let i=(e,t,a,r)=>{let s={};return Object.keys(e).map(e=>e.toLowerCase().trim()),a.forEach(t=>{let a,l=null==r?void 0:r[t.id],i=(t.aliases||(null==l?void 0:l.aliases)||[t.label]).map(e=>e.toLowerCase().trim()),n=Array.from(new Set([t.id,t.label,...i].map(e=>e.toLowerCase().trim()))),d=Object.keys(e).find(e=>n.includes(e.toLowerCase().trim()));d&&(a=e[d]),null==a||""===String(a).trim()?s[t.id]=void 0!==t.defaultValue?t.defaultValue:"number"===t.dataType?0:"":"number"===t.dataType?s[t.id]=parseFloat(String(a).trim().replace(/,/g,""))||0:s[t.id]=String(a).trim()}),s}},65142:(e,t,a)=>{"use strict";a.d(t,{p:()=>i});var r=a(95155),s=a(12115),l=a(64269);let i=s.forwardRef((e,t)=>{let{className:a,type:s,...i}=e;return(0,r.jsx)("input",{type:s,className:(0,l.cn)("flex h-10 w-full rounded-lg border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...i})});i.displayName="Input"},73180:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(14294).A)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},82125:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>u});var r=a(95155),s=a(12115),l=a(86948),i=a(96133),n=a(20243),d=a(18332),o=a(7545),c=a(51111);function u(){let[e,t]=s.useState(null),[a,u]=s.useState(!0),[f,m]=s.useState(null),p=s.useCallback(async()=>{u(!0);try{let e=await (0,i.m)();t(e)}catch(e){m(e.message||"Failed to load settings.")}finally{u(!1)}},[]);return(s.useEffect(()=>{p()},[p]),a||!e)?(0,r.jsx)(n.E,{className:"h-[600px] w-full"}):f?(0,r.jsxs)(d.Fc,{variant:"destructive",children:[(0,r.jsx)(o.A,{className:"h-4 w-4"}),(0,r.jsx)(d.XL,{children:"حدث خطأ!"}),(0,r.jsx)(d.TN,{children:f||"فشل تحميل الإعدادات."})]}):(0,r.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,r.jsx)("div",{className:"flex items-center justify-between",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold tracking-tight",children:"أداة استيراد Excel"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"اتبع الخطوات لاستيراد بيانات العملاء أو الموردين من ملف."})]})}),(0,r.jsx)(l.Zp,{children:(0,r.jsx)(l.Wu,{className:"pt-6",children:(0,r.jsx)(c.A,{settings:e})})})]})}},83686:()=>{},86948:(e,t,a)=>{"use strict";a.d(t,{BT:()=>o,Wu:()=>c,ZB:()=>d,Zp:()=>i,aR:()=>n,wL:()=>u});var r=a(95155),s=a(12115),l=a(64269);let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("rounded-xl border bg-card text-card-foreground shadow-sm",a),...s})});i.displayName="Card";let n=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-4 sm:p-6 text-right",a),...s})});n.displayName="CardHeader";let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("h3",{ref:t,className:(0,l.cn)("text-lg sm:text-xl font-bold leading-none tracking-tight",a),...s})});d.displayName="CardTitle";let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("p",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",a),...s})});o.displayName="CardDescription";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("p-4 sm:p-6 pt-0",a),...s})});c.displayName="CardContent";let u=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-4 sm:p-6 pt-0",a),...s})});u.displayName="CardFooter"},87270:(e,t,a)=>{"use strict";a.d(t,{A0:()=>n,BF:()=>d,Gg:()=>o,Hj:()=>c,XI:()=>i,nA:()=>f,nd:()=>u});var r=a(95155),s=a(12115),l=a(64269);let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{className:"relative w-full overflow-auto",children:(0,r.jsx)("table",{ref:t,className:(0,l.cn)("w-full caption-bottom text-sm",a),...s})})});i.displayName="Table";let n=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("thead",{ref:t,className:(0,l.cn)("[&_tr]:border-b",a),...s})});n.displayName="TableHeader";let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("tbody",{ref:t,className:(0,l.cn)("[&_tr:last-child]:border-0",a),...s})});d.displayName="TableBody";let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("tfoot",{ref:t,className:(0,l.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...s})});o.displayName="TableFooter";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("tr",{ref:t,className:(0,l.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...s})});c.displayName="TableRow";let u=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("th",{ref:t,className:(0,l.cn)("h-12 px-4 text-right align-middle font-bold text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...s})});u.displayName="TableHead";let f=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("td",{ref:t,className:(0,l.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...s})});f.displayName="TableCell",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("caption",{ref:t,className:(0,l.cn)("mt-4 text-sm text-muted-foreground",a),...s})}).displayName="TableCaption"},92033:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(14294).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},96133:(e,t,a)=>{"use strict";a.d(t,{m:()=>s});var r=a(30926);let s=(0,r.createServerReference)("7fe3cedf8b5b39f6ca6561f08402f1ad7a82ecff97",r.callServer,void 0,r.findSourceMapURL,"getSettings")},97776:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(14294).A)("CloudUpload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]])}},e=>{e.O(0,[3524,4909,9625,315,4127,9967,8994,13,1636,8441,1255,7358],()=>e(e.s=34367)),_N_E=e.O()}]);