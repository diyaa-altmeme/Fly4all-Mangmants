(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5629],{11926:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>R});var a=s(95155),r=s(12115),l=s(86948),n=s(3998),c=s(59915),i=s(22452),d=s(92033),o=s(13381),x=s(30024),h=s(76385),m=s(28984),j=s(15894),p=s(20243),u=s(87270),f=s(14223),N=s(19056),v=s(64269),b=s(5470),g=s(52619),A=s.n(g),w=s(3730),y=s(59007),S=s(20146),k=s(74640),C=s(13630),P=s(96847),D=s(98053),M=s(6259),T=s(31868);let O=e=>{let{title:t,value:s,currency:r,className:l,arrow:n}=e;return(0,a.jsxs)("div",{className:(0,v.cn)("text-center p-3 rounded-lg bg-background border",l),children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground font-bold",children:t}),(0,a.jsxs)("p",{className:"font-bold font-mono text-xl",children:[s.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})," ",r]})]})},_=e=>{var t,s,l;let{period:i,index:d,onDataChange:o,clients:h,suppliers:p}=e,[b,g]=(0,r.useState)(!1),{toast:A}=(0,j.dj)(),T=(null==(t=i.entries[0])?void 0:t.enteredBy)||"غير معروف";(null==(s=i.entries[0])?void 0:s.createdAt)&&(0,f.GP)((0,N.H)(i.entries[0].createdAt),"yyyy-MM-dd hh:mm a");let O=i.invoiceNumber||"N/A",_=(null==(l=i.entries[0])?void 0:l.notes)||"-",L=async()=>{let{count:e,error:t}=await (0,x.O)(i.periodId);e>0&&!t?(A({title:"تم نقل الفترة إلى المحذوفات"}),o()):A({title:"لم يتم العثور على الفترة أو حدث خطأ",description:t,variant:"destructive"})};return(0,a.jsx)(w.Nt,{asChild:!0,open:b,onOpenChange:g,children:(0,a.jsxs)("tbody",{className:(0,v.cn)("border-t font-bold",i.isConfirmed&&"bg-green-500/10"),children:[(0,a.jsxs)(u.Hj,{className:"cursor-pointer",onClick:()=>g(!b),children:[(0,a.jsx)(u.nA,{className:"p-1 text-center",children:(0,a.jsx)(w.R6,{asChild:!0,children:(0,a.jsx)(n.$,{variant:"ghost",size:"icon",className:"h-8 w-8",children:(0,a.jsx)(y.A,{className:(0,v.cn)("h-4 w-4 transition-transform",b&&"rotate-180")})})})}),(0,a.jsx)(u.nA,{className:"p-2 text-center",children:O}),(0,a.jsx)(u.nA,{className:"p-2 text-center",children:i.entries.length>0?i.entries.length:"0"}),(0,a.jsx)(u.nA,{className:"font-mono text-center text-xs p-2",children:i.fromDate}),(0,a.jsx)(u.nA,{className:"font-mono text-center text-xs p-2",children:i.toDate}),(0,a.jsx)(u.nA,{className:"p-2 text-xs text-center",children:_}),(0,a.jsx)(u.nA,{className:"font-mono text-center p-2",children:i.totalTickets.toFixed(2)}),(0,a.jsx)(u.nA,{className:"font-mono text-center p-2",children:i.totalOther.toFixed(2)}),(0,a.jsx)(u.nA,{className:"font-mono text-center text-green-600 p-2",children:i.totalAlrawdatainShare.toFixed(2)}),(0,a.jsx)(u.nA,{className:"font-mono text-center text-blue-600 p-2",children:i.totalPartnerShare.toFixed(2)}),(0,a.jsx)(u.nA,{className:"text-center text-xs p-2",children:T}),(0,a.jsx)(u.nA,{className:"p-1 text-center",children:(0,a.jsxs)(M.rI,{children:[(0,a.jsx)(M.ty,{asChild:!0,children:(0,a.jsx)(n.$,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:e=>e.stopPropagation(),children:(0,a.jsx)(S.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(M.SQ,{children:[(0,a.jsx)(m.A,{existingPeriod:i,clients:h,suppliers:p,onSuccess:o,children:(0,a.jsxs)(M._2,{onSelect:e=>e.preventDefault(),children:[(0,a.jsx)(k.A,{className:"me-2 h-4 w-4"})," تعديل"]})}),(0,a.jsxs)(M._2,{disabled:!0,children:[(0,a.jsx)(c.A,{className:"me-2 h-4 w-4"})," سجل التعديلات"]}),(0,a.jsxs)(D.Lt,{children:[(0,a.jsx)(D.tv,{asChild:!0,children:(0,a.jsxs)(M._2,{onSelect:e=>e.preventDefault(),className:"text-destructive focus:text-destructive",children:[(0,a.jsx)(C.A,{className:"me-2 h-4 w-4"})," حذف"]})}),(0,a.jsxs)(D.EO,{children:[(0,a.jsxs)(D.wd,{children:[(0,a.jsx)(D.r7,{children:"تأكيد الحذف"}),(0,a.jsx)(D.$v,{children:"هل أنت متأكد من حذف هذه الفترة؟ سيتم نقلها إلى سجل المحذوفات ويمكن استعادتها لاحقًا."})]}),(0,a.jsxs)(D.ck,{children:[(0,a.jsx)(D.Zr,{children:"إلغاء"}),(0,a.jsx)(D.Rx,{onClick:e=>{e.stopPropagation(),L()},className:(0,v.cn)((0,n.r)({variant:"destructive"})),children:"نعم، حذف"})]})]})]})]})]})})]}),(0,a.jsx)(w.Ke,{asChild:!0,children:(0,a.jsx)(u.Hj,{children:(0,a.jsx)(u.nA,{colSpan:13,className:"p-0",children:(0,a.jsxs)("div",{className:"p-4 bg-muted/50",children:[(0,a.jsx)("h4",{className:"font-bold mb-2",children:"تفاصيل شركات الفترة:"}),(0,a.jsx)(P.A,{period:i})]})})})})]})},i.periodId)};function L(){let[e,t]=(0,r.useState)([]),{data:s,loaded:x,fetchData:f}=(0,b.Z)(),[N,v]=(0,r.useState)(!0),{toast:g}=(0,j.dj)(),[w,y]=(0,r.useState)(""),[S,k]=(0,r.useState)("all"),C=(null==s?void 0:s.clients)||[],P=(null==s?void 0:s.suppliers)||[],D=(0,r.useCallback)(async()=>{v(!0);try{let e=await (0,h.L)();t(e)}catch(e){g({title:"خطأ في تحميل البيانات",description:e.message,variant:"destructive"})}finally{v(!1)}},[g]);(0,r.useEffect)(()=>{x||f(),x&&D()},[x,f,D]);let M=(0,r.useCallback)(async()=>{await D()},[D]),T=(0,r.useMemo)(()=>e?e.reduce((e,t)=>{let s=t.periodId||"".concat(t.fromDate,"_").concat(t.toDate);return e[s]||(e[s]={periodId:s,fromDate:t.fromDate,toDate:t.toDate,entries:[],invoiceNumber:t.invoiceNumber.split("-")[0]+"-"+t.invoiceNumber.split("-")[1],totalProfit:0,totalAlrawdatainShare:0,totalPartnerShare:0,totalTickets:0,totalOther:0,isConfirmed:t.isConfirmed,type:"transaction"}),e[s].entries.push(t),e[s].totalProfit+=t.total||0,e[s].totalAlrawdatainShare+=t.alrawdatainShare||0,e[s].totalPartnerShare+=t.partnerShare||0,e[s].totalTickets+=t.ticketProfits||0,e[s].totalOther+=t.otherProfits||0,e},{}):{},[e]),L=(0,r.useMemo)(()=>{let e=Object.values(T).sort((e,t)=>new Date(t.toDate).getTime()-new Date(e.toDate).getTime());return"all"!==S&&(e=e.filter(e=>e.periodId===S)),e},[T,S]),{grandTotalProfit:R,grandTotalAlrawdatainShare:E,grandTotalPartnerShare:I}=(0,r.useMemo)(()=>L.reduce((e,t)=>(e.grandTotalProfit+=t.totalProfit,e.grandTotalAlrawdatainShare+=t.totalAlrawdatainShare,e.grandTotalPartnerShare+=t.totalPartnerShare,e),{grandTotalProfit:0,grandTotalAlrawdatainShare:0,grandTotalPartnerShare:0}),[L]);return N||!x?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(p.E,{className:"h-40 w-full"}),(0,a.jsx)(p.E,{className:"h-64 w-full"})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(l.Zp,{children:(0,a.jsxs)(l.aR,{children:[(0,a.jsx)("div",{className:"flex w-full flex-col items-start gap-4",children:(0,a.jsxs)("div",{className:"w-full flex flex-col sm:flex-row items-center justify-between gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(l.ZB,{children:"سجل حسابات السكمنت"}),(0,a.jsx)(l.BT,{children:"إدارة وتتبع أرباح وحصص الشركات الشريكة في نظام السكمنت."})]}),(0,a.jsxs)("div",{className:"flex gap-2 w-full sm:w-auto",children:[(0,a.jsx)(m.A,{clients:C,suppliers:P,onSuccess:M,children:(0,a.jsxs)(n.$,{children:[(0,a.jsx)(i.A,{className:"me-2 h-4 w-4"})," إضافة سجل جديد"]})}),(0,a.jsxs)(n.$,{onClick:M,variant:"outline",disabled:N,children:[N?(0,a.jsx)(d.A,{className:"h-4 w-4 me-2 animate-spin"}):(0,a.jsx)(o.A,{className:"h-4 w-4 me-2"})," تحديث"]}),(0,a.jsx)(n.$,{asChild:!0,variant:"outline",children:(0,a.jsxs)(A(),{href:"/segments/deleted-segments",children:[(0,a.jsx)(c.A,{className:"me-2 h-4 w-4"}),"سجل المحذوفات"]})})]})]})}),(0,a.jsxs)("div",{className:"pt-4 grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,a.jsx)(O,{title:"إجمالي أرباح السكمنت",value:R,currency:"USD",className:"border-blue-500/50 bg-blue-50 dark:bg-blue-950/30"}),(0,a.jsx)(O,{title:"حصة الروضتين",value:E,currency:"USD",className:"border-green-500/50 bg-green-50 dark:bg-green-950/30"}),(0,a.jsx)(O,{title:"حصة الشريك",value:I,currency:"USD",className:"border-purple-500/50 bg-purple-50 dark:bg-purple-950/30"})]})]})}),(0,a.jsxs)(l.Zp,{children:[(0,a.jsx)(l.aR,{children:(0,a.jsx)(l.ZB,{children:"ملخص الفترات المحاسبية"})}),(0,a.jsx)(l.Wu,{children:(0,a.jsx)("div",{className:"border rounded-lg overflow-x-auto",children:(0,a.jsxs)(u.XI,{children:[(0,a.jsx)(u.A0,{children:(0,a.jsxs)(u.Hj,{children:[(0,a.jsx)(u.nd,{className:"w-[50px] p-1"}),(0,a.jsx)(u.nd,{className:"font-bold text-center p-2",children:"رقم الفاتورة"}),(0,a.jsx)(u.nd,{className:"font-bold text-center p-2",children:"الشركات"}),(0,a.jsx)(u.nd,{className:"font-bold text-center p-2",children:"من"}),(0,a.jsx)(u.nd,{className:"font-bold text-center p-2",children:"إلى"}),(0,a.jsx)(u.nd,{className:"font-bold text-center p-2",children:"الملاحظات"}),(0,a.jsx)(u.nd,{className:"text-center font-bold p-2",children:"أرباح التذاكر"}),(0,a.jsx)(u.nd,{className:"text-center font-bold p-2",children:"أرباح أخرى"}),(0,a.jsx)(u.nd,{className:"text-center font-bold p-2",children:"حصة الروضتين"}),(0,a.jsx)(u.nd,{className:"text-center font-bold p-2",children:"حصة الشريك"}),(0,a.jsx)(u.nd,{className:"font-bold text-center p-2",children:"الموظف"}),(0,a.jsx)(u.nd,{className:"text-center p-2",children:"الإجراءات"})]})}),0===L.length?(0,a.jsx)(u.BF,{children:(0,a.jsx)(u.Hj,{children:(0,a.jsx)(u.nA,{colSpan:13,className:"text-center h-24",children:"لا توجد بيانات للفترة المحددة."})})}):L.map((e,t)=>(0,a.jsx)(_,{period:e,index:t,clients:C,suppliers:P,onDataChange:M},e.periodId))]})})})]})]})}function R(){return(0,a.jsx)(T.default,{requiredPermission:"segments:read",children:(0,a.jsx)(L,{})})}},13381:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(14294).A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},20146:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(14294).A)("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]])},22452:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(14294).A)("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]])},30024:(e,t,s)=>{"use strict";s.d(t,{O:()=>r});var a=s(30926);let r=(0,a.createServerReference)("607e850594ea411b5e11f09fc4d3f42888c31e8a99",a.callServer,void 0,a.findSourceMapURL,"deleteSegmentPeriod")},59915:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(14294).A)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]])},70502:(e,t,s)=>{Promise.resolve().then(s.bind(s,11926))},76385:(e,t,s)=>{"use strict";s.d(t,{L:()=>r});var a=s(30926);let r=(0,a.createServerReference)("403ab84bcb8381bf290b99f5595e7f53fbfe6fdc2c",a.callServer,void 0,a.findSourceMapURL,"getSegments")}},e=>{e.O(0,[9135,7210,4909,9625,315,5111,4127,9967,1374,783,4223,8994,2619,43,84,2612,5672,4486,877,5073,4762,2500,1424,221,8441,1255,7358],()=>e(e.s=70502)),_N_E=e.O()}]);