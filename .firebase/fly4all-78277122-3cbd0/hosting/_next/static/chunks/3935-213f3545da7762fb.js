"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3935],{5273:(e,r,a)=>{a.d(r,{A:()=>E});var t=a(95155),n=a(12115),s=a(3998),l=a(51834),i=a(15894),c=a(30926);let d=(0,c.createServerReference)("60f9db623aad45da0d17997927476e2546d7abaf38",c.callServer,void 0,c.findSourceMapURL,"updateManualProfitDistribution"),o=(0,c.createServerReference)("4083526305c1d3a15b3807660974edd0049aa8620e",c.callServer,void 0,c.findSourceMapURL,"saveManualProfitDistribution");var x=a(28127),m=a(92634),u=a(73180),h=a(22452),j=a(6943),p=a(94972),f=a(50705),v=a(88964),g=a(13630),N=a(27314),b=a(44381),w=a(92033),S=a(22544),y=a(54879),A=a(66942),I=a(41052),M=a(23639),D=a(26333),C=a(50276),k=a(19056),P=a(14223),R=a(64269),F=a(87270),L=a(11186),z=a(76444),_=a(5470),V=a(23451),J=a(97916),U=a(86259);let $=y.Ik({id:y.Yj(),partnerId:y.Yj().min(1,"اختر شريكاً."),partnerName:y.Yj(),percentage:y.au.number().min(0,"النسبة يجب أن تكون موجبة.").max(100,"النسبة لا تتجاوز 100."),amount:y.au.number()}),B=y.Ik({fromDate:y.p6({required_error:"تاريخ البدء مطلوب"}),toDate:y.p6({required_error:"تاريخ الانتهاء مطلوب"}),sourceAccountId:y.Yj().min(1,{message:"مصدر الأرباح مطلوب."}),profit:y.au.number().positive("الربح يجب أن يكون أكبر من صفر"),currency:y.k5(["USD","IQD"]),alrawdatainSharePercentage:y.au.number().min(0).max(100).default(50),partners:y.YO($).optional()}),H=e=>{let{title:r,value:a,currency:n,className:s}=e;return(0,t.jsxs)("div",{className:(0,R.cn)("p-2 rounded-lg text-center border",s),children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-muted-foreground",children:r}),(0,t.jsxs)("p",{className:"font-mono font-bold text-lg",children:[a.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," ",n]})]})};function E(e){let{partners:r,onSuccess:a,isEditing:c=!1,period:y,children:$}=e,[E,G]=(0,n.useState)(!1),{toast:O}=(0,i.dj)(),{user:Y}=(0,V.A)(),{data:q}=(0,_.Z)(),[Q,T]=(0,n.useState)(null),[W,X]=(0,n.useState)(""),[Z,K]=(0,n.useState)(""),ee=(0,S.mN)({resolver:(0,A.u)(B)}),{control:er,handleSubmit:ea,watch:et,setValue:en,formState:{isSubmitting:es,errors:el},trigger:ei,reset:ec,getValues:ed}=ee,{fields:eo,append:ex,remove:em,update:eu}=(0,S.jz)({control:er,name:"partners"}),eh=(0,n.useMemo)(()=>q?[...(q.clients||[]).map(e=>({value:e.id,label:"عميل: ".concat(e.name)})),...(q.suppliers||[]).map(e=>({value:e.id,label:"مورد: ".concat(e.name)}))]:[],[q]),ej=et("partners"),ep=et("profit"),ef=et("currency"),ev=et("alrawdatainSharePercentage");(0,n.useEffect)(()=>{if(E){if(c&&y){var e;let r=null==(e=y.partners)?void 0:e.find(e=>"alrawdatain_share"===e.partnerId);ec({fromDate:y.fromDate?(0,k.H)(y.fromDate):new Date,toDate:y.toDate?(0,k.H)(y.toDate):new Date,profit:y.totalProfit,currency:y.currency||"USD",sourceAccountId:y.sourceAccountId||"",alrawdatainSharePercentage:(null==r?void 0:r.percentage)||50,partners:(y.partners||[]).filter(e=>"alrawdatain_share"!==e.partnerId).map(e=>({id:e.id,partnerId:e.partnerId,partnerName:e.partnerName,percentage:e.percentage,amount:e.amount}))})}else ec({fromDate:new Date,toDate:new Date,profit:0,currency:"USD",partners:[],alrawdatainSharePercentage:50});X(""),K(""),T(null)}},[E,c,y,ec]);let eg=(0,n.useMemo)(()=>{var e,r;return Y&&"role"in Y&&(null==q||null==(r=q.boxes)||null==(e=r.find(e=>e.id===Y.boxId))?void 0:e.name)||"غير محدد"},[Y,null==q?void 0:q.boxes]),{totalPartnerPercentage:eN,amountForPartners:eb,alrawdatainShareAmount:ew,distributedToPartners:eS,remainderForPartners:ey}=(0,n.useMemo)(()=>{let e=Number(ep)||0,r=e*(Number(ev)||0)/100,a=e-r,t=(ej||[]).reduce((e,r)=>e+(Number(r.percentage)||0),0),n=(ej||[]).reduce((e,r)=>e+a*(r.percentage||0)/100,0);return{totalPartnerPercentage:t,amountForPartners:a,alrawdatainShareAmount:r,distributedToPartners:n,remainderForPartners:a-n}},[ep,ev,ej]),eA=(0,n.useMemo)(()=>{let e=(ej||[]).map(e=>({...e,amount:eb*(e.percentage||0)/100}));return e.push({id:"alrawdatain_share",partnerId:"alrawdatain_share",partnerName:"حصة الروضتين",percentage:ev,amount:ew}),e},[ej,eb,ev,ew]),eI=async e=>{if(Math.abs(eN-100)>.01)return void O({title:"خطأ في التوزيع",description:"مجموع نسب الشركاء يجب أن يكون 100% تمامًا من المبلغ المتاح لهم.",variant:"destructive"});let r={fromDate:(0,P.GP)(e.fromDate,"yyyy-MM-dd"),toDate:(0,P.GP)(e.toDate,"yyyy-MM-dd"),sourceAccountId:e.sourceAccountId,profit:e.profit,currency:e.currency,partners:eA.map(e=>{let{partnerId:r,partnerName:a,percentage:t,amount:n}=e;return{partnerId:r,partnerName:a,percentage:t,amount:n}})},t=c&&y?await d(y.id,r):await o(r);t.success?(O({title:"تم ".concat(c?"تحديث":"حفظ"," توزيع الأرباح بنجاح")}),ec(),a(),G(!1)):O({title:"خطأ",description:t.error,variant:"destructive"})},eM=(0,n.useMemo)(()=>(Number(Z)||0)/100*eb,[Z,eb]);return(0,t.jsxs)(l.lG,{open:E,onOpenChange:G,children:[(0,t.jsx)(l.zM,{asChild:!0,children:$}),(0,t.jsxs)(l.Cf,{className:"max-w-4xl max-h-[90vh] flex flex-col",children:[(0,t.jsxs)(l.c7,{children:[(0,t.jsx)(l.L3,{children:c?"تعديل فترة توزيع أرباح":"إضافة توزيع أرباح يدوي"}),(0,t.jsx)(l.rr,{children:"أدخل تفاصيل الفترة وصافي الربح ثم وزع الحصص على الشركاء."})]}),(0,t.jsx)(I.lV,{...ee,children:(0,t.jsxs)("form",{onSubmit:ea(eI),className:"flex-grow overflow-y-auto -mx-6 px-6 space-y-6",children:[(0,t.jsxs)("div",{className:"p-4 border rounded-lg grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)(I.zB,{control:er,name:"fromDate",render:e=>{let{field:r}=e;return(0,t.jsxs)(I.eI,{children:[(0,t.jsx)(I.lR,{children:"من تاريخ"}),(0,t.jsxs)(D.AM,{children:[(0,t.jsx)(D.Wv,{asChild:!0,children:(0,t.jsx)(I.MJ,{children:(0,t.jsxs)(s.$,{variant:"outline",className:(0,R.cn)("w-full justify-start text-left font-normal",!r.value&&"text-muted-foreground"),children:[r.value?(0,P.GP)(r.value,"yyyy-MM-dd"):(0,t.jsx)("span",{children:"اختر تاريخاً"}),(0,t.jsx)(x.A,{className:"ms-auto h-4 w-4 opacity-50"})]})})}),(0,t.jsx)(D.hl,{className:"w-auto p-0",children:(0,t.jsx)(C.V,{mode:"single",selected:r.value,onSelect:r.onChange})})]}),(0,t.jsx)(I.C5,{})]})}}),(0,t.jsx)(I.zB,{control:er,name:"toDate",render:e=>{let{field:r}=e;return(0,t.jsxs)(I.eI,{children:[(0,t.jsx)(I.lR,{children:"إلى تاريخ"}),(0,t.jsxs)(D.AM,{children:[(0,t.jsx)(D.Wv,{asChild:!0,children:(0,t.jsx)(I.MJ,{children:(0,t.jsxs)(s.$,{variant:"outline",className:(0,R.cn)("w-full justify-start text-left font-normal",!r.value&&"text-muted-foreground"),children:[r.value?(0,P.GP)(r.value,"yyyy-MM-dd"):(0,t.jsx)("span",{children:"اختر تاريخاً"}),(0,t.jsx)(x.A,{className:"ms-auto h-4 w-4 opacity-50"})]})})}),(0,t.jsx)(D.hl,{className:"w-auto p-0",children:(0,t.jsx)(C.V,{mode:"single",selected:r.value,onSelect:r.onChange})})]}),(0,t.jsx)(I.C5,{})]})}}),(0,t.jsx)(I.zB,{control:er,name:"profit",render:e=>{let{field:r}=e;return(0,t.jsxs)(I.eI,{children:[(0,t.jsx)(I.lR,{children:"صافي الربح للفترة"}),(0,t.jsx)(I.MJ,{children:(0,t.jsx)(J.O,{currency:ef,...r,onValueChange:e=>r.onChange(e||0)})}),(0,t.jsx)(I.C5,{})]})}}),(0,t.jsx)(I.zB,{control:er,name:"currency",render:e=>{var r;let{field:a}=e;return(0,t.jsxs)(I.eI,{children:[(0,t.jsx)(I.lR,{children:"العملة"}),(0,t.jsxs)(L.l6,{onValueChange:a.onChange,value:a.value,children:[(0,t.jsx)(I.MJ,{children:(0,t.jsx)(L.bq,{children:(0,t.jsx)(L.yv,{})})}),(0,t.jsx)(L.gC,{children:((null==q||null==(r=q.settings.currencySettings)?void 0:r.currencies)||[]).map(e=>(0,t.jsxs)(L.eb,{value:e.code,children:[e.name," (",e.symbol,")"]},e.code))})]}),(0,t.jsx)(I.C5,{})]})}}),(0,t.jsx)("div",{className:"md:col-span-2",children:(0,t.jsx)(I.zB,{control:er,name:"sourceAccountId",render:e=>{let{field:r}=e;return(0,t.jsxs)(I.eI,{children:[(0,t.jsx)(I.lR,{children:"مصدر الأرباح"}),(0,t.jsx)(I.MJ,{children:(0,t.jsx)(M.j,{options:eh,value:r.value,onValueChange:r.onChange,placeholder:"اختر حساب المصدر..."})}),(0,t.jsx)(I.C5,{})]})}})})]}),(0,t.jsxs)("div",{className:"p-4 border rounded-lg",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-2 mb-4",children:[(0,t.jsx)(H,{title:"صافي الربح",value:ep||0,currency:ef}),(0,t.jsx)(H,{title:"حصة الروضتين",value:ew,currency:ef,className:"bg-green-50 dark:bg-green-950/30 border-green-500/30 text-green-700 dark:text-green-300"}),(0,t.jsx)(H,{title:"المتاح للشركاء",value:eb,currency:ef,className:"bg-purple-50 dark:bg-purple-950/30 border-purple-500/30 text-purple-700 dark:text-purple-300"}),(0,t.jsx)(H,{title:"الموزع للشركاء",value:eS,currency:ef}),(0,t.jsx)(H,{title:"المتبقي للتوزيع",value:ey,currency:ef,className:(0,R.cn)(Math.abs(ey)>.01&&"bg-destructive/10 text-destructive")})]}),(0,t.jsx)(U.Separator,{}),(0,t.jsx)("h3",{className:"font-semibold text-lg my-2",children:"إضافة شريك وتحديد حصته"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 items-end p-2 rounded-lg bg-muted/50",children:[(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(z.J,{className:"text-xs",children:"الشريك"}),(0,t.jsx)(M.j,{options:r.map(e=>({value:e.id,label:e.name})),value:W,onValueChange:X,placeholder:"اختر شريكًا..."})]}),(0,t.jsxs)("div",{className:"w-40 space-y-1.5",children:[(0,t.jsx)(z.J,{className:"text-xs",children:"النسبة (%)"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(J.O,{value:Z,onValueChange:K,className:"h-9 pe-7"}),(0,t.jsx)(m.A,{className:"absolute left-2 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"})]})]}),(0,t.jsxs)("div",{className:"flex items-end gap-2",children:[(0,t.jsxs)("div",{className:"flex-grow",children:[(0,t.jsx)(z.J,{className:"text-xs",children:"الحصة المستلمة"}),(0,t.jsx)("div",{className:"h-9 flex items-center justify-center font-bold text-blue-600 font-mono p-2 bg-blue-50 rounded-md",children:eM.toFixed(2)})]}),(0,t.jsx)(s.$,{type:"button",size:"icon",className:"shrink-0 h-9 w-9",onClick:()=>{var e;if(!W||!Z)return void O({title:"الرجاء تحديد الشريك والنسبة",variant:"destructive"});let a=Number(Z);if(isNaN(a)||a<=0)return void O({title:"النسبة يجب أن تكون رقمًا موجبًا",variant:"destructive"});let t=ed("partners")||[],n=null!==Q&&(null==(e=t[Q])?void 0:e.percentage)||0,s=t.reduce((e,r)=>e+r.percentage,0)-n;if(s+a>100.01)return void O({title:"لا يمكن تجاوز 100%",description:"إجمالي النسب الحالية: ".concat(s.toFixed(2),"%"),variant:"destructive"});let l=r.find(e=>e.id===W);if(!l)return void O({title:"الشريك المختار غير صالح",variant:"destructive"});let i={id:null!==Q?eo[Q].id:"new-".concat(Date.now()),partnerId:l.id,partnerName:l.label,percentage:a,amount:eb*a/100};null!==Q?(eu(Q,i),T(null)):ex(i),X(""),K("")},disabled:eb<=0||!W||!Z,children:null!==Q?(0,t.jsx)(u.A,{className:"h-5 w-5"}):(0,t.jsx)(h.A,{className:"h-5 w-5"})})]})]})]}),(0,t.jsxs)("div",{className:"p-4 border rounded-lg",children:[(0,t.jsx)("h3",{className:"font-semibold text-lg mb-2",children:"ملخص التوزيع"}),(0,t.jsxs)(F.XI,{children:[(0,t.jsx)(F.A0,{children:(0,t.jsxs)(F.Hj,{children:[(0,t.jsxs)(F.nd,{children:[(0,t.jsx)(j.A,{className:"inline-block me-2 h-4 w-4"}),"الشريك"]}),(0,t.jsxs)(F.nd,{className:"text-center",children:[(0,t.jsx)(m.A,{className:"inline-block me-2 h-4 w-4"}),"النسبة"]}),(0,t.jsxs)(F.nd,{className:"text-right",children:[(0,t.jsx)(p.A,{className:"inline-block me-2 h-4 w-4"}),"المبلغ"]}),(0,t.jsx)(F.nd,{className:"w-24 text-center",children:"الإجراءات"})]})}),(0,t.jsxs)(F.BF,{children:[(0,t.jsxs)(F.Hj,{className:"bg-green-50 dark:bg-green-900/20",children:[(0,t.jsxs)(F.nA,{className:"font-semibold flex items-center gap-2",children:[(0,t.jsx)(f.A,{className:"h-4 w-4 text-green-600"}),"حصة الروضتين"]}),(0,t.jsx)(F.nA,{className:"text-center",children:(0,t.jsxs)("div",{className:"relative w-24 mx-auto",children:[(0,t.jsx)(S.xI,{control:er,name:"alrawdatainSharePercentage",render:e=>{let{field:r}=e;return(0,t.jsx)(J.O,{...r,onValueChange:e=>r.onChange(e||0),className:"pe-7 text-center h-8"})}}),(0,t.jsx)(m.A,{className:"absolute left-2 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"})]})}),(0,t.jsxs)(F.nA,{className:"text-right font-mono font-bold",children:[ew.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," ",ef]}),(0,t.jsx)(F.nA,{})]}),eo.map((e,r)=>{let a=eb*(e.percentage||0)/100;return(0,t.jsxs)(F.Hj,{children:[(0,t.jsx)(F.nA,{className:"font-semibold",children:e.partnerName}),(0,t.jsxs)(F.nA,{className:"text-center font-mono",children:[Number(e.percentage).toFixed(2),"%"]}),(0,t.jsxs)(F.nA,{className:"text-right font-mono font-bold",children:[a.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," ",ef]}),(0,t.jsxs)(F.nA,{className:"text-center",children:[(0,t.jsx)(s.$,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-blue-600",onClick:()=>(e=>{let r=eo[e];T(e),X(r.partnerId),K(r.percentage),em(e)})(r),children:(0,t.jsx)(v.A,{className:"h-4 w-4"})}),(0,t.jsx)(s.$,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",onClick:()=>em(r),children:(0,t.jsx)(g.A,{className:"h-4 w-4"})})]})]},e.id)})]})]})]})]})}),(0,t.jsx)(l.Es,{className:"pt-4 border-t",children:(0,t.jsxs)("div",{className:"flex justify-between w-full",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)(N.A,{className:"h-4 w-4"})," ",(0,t.jsx)("span",{children:(null==Y?void 0:Y.name)||"..."})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)(p.A,{className:"h-4 w-4"})," ",(0,t.jsx)("span",{children:eg})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)(b.A,{className:"h-4 w-4"})," ",(0,t.jsx)("span",{children:"رقم الفاتورة: (تلقائي)"})]})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsxs)(s.$,{onClick:ea(eI),disabled:es||Math.abs(eN-100)>.01,children:[es&&(0,t.jsx)(w.A,{className:"me-2 h-4 w-4 animate-spin"}),c?"حفظ التعديلات":"حفظ بيانات الفترة"]})})]})})]})]})}},14271:(e,r,a)=>{a.d(r,{A:()=>F});var t=a(95155),n=a(87270),s=a(3998),l=a(50705),i=a(28263),c=a(88964),d=a(13630),o=a(6259),x=a(12115),m=a(51834),u=a(15894),h=a(30926);let j=(0,h.createServerReference)("604fb3a1ef837e6a7a065873d775be374a0f72a2db",h.callServer,void 0,h.findSourceMapURL,"updateProfitShare"),p=(0,h.createServerReference)("40f181e9098475e67731ac48410c45825fc0109dc4",h.callServer,void 0,h.findSourceMapURL,"saveProfitShare");var f=a(92634),v=a(92033),g=a(22544),N=a(54879),b=a(66942),w=a(41052),S=a(65142),y=a(31120),A=a(23639);let I=N.Ik({partnerId:N.Yj().min(1,"اسم الشريك مطلوب."),percentage:N.au.number().min(0,"النسبة يجب أن تكون موجبة.").max(100,"النسبة لا يمكن أن تتجاوز 100."),notes:N.Yj().optional()});function M(e){let{isEditing:r=!1,share:a,monthId:n,totalProfit:l,partners:i,onSuccess:c,children:d,disabled:o}=e,[h,N]=(0,x.useState)(!1),{toast:M}=(0,u.dj)(),D=i.map(e=>({value:e.id,label:e.name})),C=(0,g.mN)({resolver:(0,b.u)(I),defaultValues:r?{partnerId:null==a?void 0:a.partnerId,percentage:null==a?void 0:a.percentage,notes:null==a?void 0:a.notes}:{partnerId:"",percentage:0,notes:""}}),{isSubmitting:k}=C.formState;(0,x.useEffect)(()=>{h&&C.reset(r?{partnerId:null==a?void 0:a.partnerId,percentage:null==a?void 0:a.percentage,notes:null==a?void 0:a.notes}:{partnerId:"",percentage:0,notes:""})},[h,C,r,a]);let P=async e=>{let t=l*e.percentage/100,s=i.find(r=>r.id===e.partnerId);if(!s)return void M({title:"خطأ",description:"الشريك المختار غير صحيح.",variant:"destructive"});let d={profitMonthId:n,partnerId:s.id,partnerName:s.name,percentage:e.percentage,amount:t,notes:e.notes},o=r&&a?await j(a.id,d):await p(d);o.success?(M({title:"تم ".concat(r?"تحديث":"إضافة"," الحصة بنجاح")}),c(),N(!1)):M({title:"خطأ",description:o.error,variant:"destructive"})};return(0,t.jsxs)(m.lG,{open:h,onOpenChange:N,children:[(0,t.jsx)(m.zM,{asChild:!0,disabled:o,children:d}),(0,t.jsx)(m.Cf,{className:"sm:max-w-md",children:(0,t.jsx)(w.lV,{...C,children:(0,t.jsxs)("form",{onSubmit:C.handleSubmit(P),children:[(0,t.jsx)(m.c7,{children:(0,t.jsx)(m.L3,{children:r?"تعديل حصة الشريك":"إضافة توزيع جديد"})}),(0,t.jsxs)("div",{className:"py-4 grid gap-4",children:[(0,t.jsx)(w.zB,{control:C.control,name:"partnerId",render:e=>{let{field:r}=e;return(0,t.jsxs)(w.eI,{children:[(0,t.jsx)(w.lR,{children:"الشريك"}),(0,t.jsx)(w.MJ,{children:(0,t.jsx)(A.j,{options:D,value:r.value,onValueChange:r.onChange,placeholder:"اختر شريكًا..."})}),(0,t.jsx)(w.C5,{})]})}}),(0,t.jsx)(w.zB,{control:C.control,name:"percentage",render:e=>{let{field:r}=e;return(0,t.jsxs)(w.eI,{children:[(0,t.jsx)(w.lR,{children:"النسبة المئوية"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(w.MJ,{children:(0,t.jsx)(S.p,{type:"text",inputMode:"decimal",...r,className:"pe-7"})}),(0,t.jsx)(f.A,{className:"absolute right-2 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"})]}),(0,t.jsx)(w.C5,{})]})}}),(0,t.jsx)(w.zB,{control:C.control,name:"notes",render:e=>{let{field:r}=e;return(0,t.jsxs)(w.eI,{children:[(0,t.jsx)(w.lR,{children:"ملاحظات (اختياري)"}),(0,t.jsx)(w.MJ,{children:(0,t.jsx)(y.T,{...r})}),(0,t.jsx)(w.C5,{})]})}})]}),(0,t.jsx)(m.Es,{children:(0,t.jsxs)(s.$,{type:"submit",disabled:k,children:[k&&(0,t.jsx)(v.A,{className:"me-2 h-4 w-4 animate-spin"}),r?"حفظ التعديلات":"إضافة الحصة"]})})]})})})]})}let D=(0,h.createServerReference)("405e6c6834ade94ce373dbb51567a4895d801220df",h.callServer,void 0,h.findSourceMapURL,"deleteProfitShare");var C=a(98053),k=a(64269),P=a(52619),R=a.n(P);function F(e){let{shares:r,partners:a,totalProfit:m,onDataChange:h,currency:j,isManual:p,monthId:f}=e,{toast:v}=(0,u.dj)(),g=async e=>{let r=await D(e);r.success?(v({title:"تم حذف الحصة بنجاح"}),h()):v({title:"خطأ",description:r.error,variant:"destructive"})},{partnerShares:N,companyShare:b}=x.useMemo(()=>{var e;let t=0,n=r.map(e=>{t+=e.percentage;let r=a.find(r=>r.id===e.partnerId);return{...e,partnerName:(null==r?void 0:r.name)||e.partnerName}}),s=100-t,l=s/100*m;return{partnerShares:n,companyShare:{id:"company-share",profitMonthId:f,partnerId:"alrawdatain",partnerName:"حصالة الشركة",percentage:s>.001?s:0,amount:l>.001?l:0,notes:"الحصة المتبقية للشركة",invoiceNumber:null==(e=r.find(e=>"alrawdatain_share"===e.partnerId))?void 0:e.invoiceNumber}}},[r,a,m,f]),w=[b,...N].filter(e=>e.percentage>.001);return w.reduce((e,r)=>e+r.amount,0),(0,t.jsx)("div",{className:"border rounded-lg overflow-x-auto bg-background text-xs",children:(0,t.jsxs)(n.XI,{children:[(0,t.jsx)(n.A0,{children:(0,t.jsxs)(n.Hj,{children:[(0,t.jsx)(n.nd,{className:"font-bold p-2 text-right",children:"الشريك"}),(0,t.jsx)(n.nd,{className:"font-bold p-2 text-right",children:"رقم الفاتورة"}),(0,t.jsx)(n.nd,{className:"text-center font-bold p-2",children:"النسبة"}),(0,t.jsx)(n.nd,{className:"text-right font-bold p-2",children:"المبلغ"}),(0,t.jsx)(n.nd,{className:"font-bold text-right p-2",children:"ملاحظات"}),(0,t.jsx)(n.nd,{className:"text-center font-bold p-2",children:(0,t.jsx)(M,{monthId:f,totalProfit:m,partners:a,onSuccess:h,disabled:!p,children:(0,t.jsx)(s.$,{variant:"ghost",size:"sm",disabled:!p,children:"إضافة"})})})]})}),(0,t.jsx)(n.BF,{children:0===w.length?(0,t.jsxs)(n.Hj,{children:[(0,t.jsxs)(n.nA,{className:"font-semibold p-2 text-right flex items-center gap-2",children:[(0,t.jsx)(l.A,{className:"h-4 w-4 text-green-600"}),"حصالة الشركة"]}),(0,t.jsx)(n.nA,{className:"text-center font-mono p-2",children:"-"}),(0,t.jsx)(n.nA,{className:"text-center font-mono p-2",children:"100.00%"}),(0,t.jsxs)(n.nA,{className:"text-right font-mono font-bold p-2",children:[m.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," ",j]}),(0,t.jsx)(n.nA,{className:"text-right p-2",children:" كامل الربح للشركة "}),(0,t.jsx)(n.nA,{className:"text-center p-2"})]}):w.map((e,r)=>(0,t.jsxs)(n.Hj,{className:"company-share"===e.id?"bg-green-50 dark:bg-green-900/20":"",children:[(0,t.jsxs)(n.nA,{className:"font-semibold p-2 text-right flex items-center gap-2",children:["company-share"===e.id&&(0,t.jsx)(l.A,{className:"h-4 w-4 text-green-600"}),e.partnerName]}),(0,t.jsx)(n.nA,{className:"text-center font-mono p-2 text-xs",children:e.invoiceNumber?(0,t.jsx)(s.$,{asChild:!0,variant:"link",className:"p-0 h-auto text-xs",children:(0,t.jsx)(R(),{href:"/accounts/vouchers/list",children:e.invoiceNumber})}):"-"}),(0,t.jsxs)(n.nA,{className:"text-center font-mono p-2",children:[e.percentage.toFixed(2),"%"]}),(0,t.jsxs)(n.nA,{className:"text-right font-mono font-bold p-2",children:[e.amount.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," ",j]}),(0,t.jsx)(n.nA,{className:"text-right p-2",children:e.notes||"-"}),(0,t.jsx)(n.nA,{className:"text-center p-2",children:"company-share"!==e.id&&(0,t.jsxs)(o.rI,{children:[(0,t.jsx)(o.ty,{asChild:!0,children:(0,t.jsx)(s.$,{variant:"ghost",size:"icon",disabled:!p,children:(0,t.jsx)(i.A,{className:"h-4 w-4"})})}),(0,t.jsxs)(o.SQ,{children:[(0,t.jsx)(M,{isEditing:!0,share:e,monthId:e.profitMonthId,totalProfit:m,partners:a,onSuccess:h,disabled:!p,children:(0,t.jsxs)(o._2,{onSelect:e=>e.preventDefault(),disabled:!p,children:[(0,t.jsx)(c.A,{className:"me-2 h-4 w-4"})," تعديل"]})}),(0,t.jsxs)(C.Lt,{children:[(0,t.jsx)(C.tv,{asChild:!0,children:(0,t.jsxs)(o._2,{onSelect:e=>e.preventDefault(),className:"text-destructive focus:text-destructive",disabled:!p,children:[(0,t.jsx)(d.A,{className:"me-2 h-4 w-4"})," حذف"]})}),(0,t.jsxs)(C.EO,{children:[(0,t.jsxs)(C.wd,{children:[(0,t.jsx)(C.r7,{children:"هل أنت متأكد؟"}),(0,t.jsx)(C.$v,{children:"هذا الإجراء سيحذف الحصة بشكل دائم."})]}),(0,t.jsxs)(C.ck,{children:[(0,t.jsx)(C.Zr,{children:"إلغاء"}),(0,t.jsx)(C.Rx,{onClick:()=>g(e.id),className:(0,k.cn)((0,s.r)({variant:"destructive"})),children:"حذف"})]})]})]})]})]})})]},e.id))}),(0,t.jsx)(n.Gg,{children:(0,t.jsxs)(n.Hj,{children:[(0,t.jsx)(n.nA,{colSpan:2,className:"font-bold",children:"المجموع"}),(0,t.jsx)(n.nA,{className:"text-center font-bold font-mono",children:"100.00%"}),(0,t.jsxs)(n.nA,{className:"text-right font-bold font-mono",children:[m.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," ",j]}),(0,t.jsx)(n.nA,{colSpan:2})]})})]})})}},35700:(e,r,a)=>{a.d(r,{D:()=>n});var t=a(30926);let n=(0,t.createServerReference)("4069a40cc94c9c768076ac567a47af44840a78e5d3",t.callServer,void 0,t.findSourceMapURL,"deleteManualProfitPeriod")},36715:(e,r,a)=>{a.d(r,{k:()=>n});var t=a(30926);let n=(0,t.createServerReference)("4046cdf80f265cc319f18857ca91015363a6f55f47",t.callServer,void 0,t.findSourceMapURL,"getProfitSharesForMonth")},58236:(e,r,a)=>{a.d(r,{r:()=>n});var t=a(30926);let n=(0,t.createServerReference)("00beab53bcd9d8a0cef48ee7d49a696a6b49c5158c",t.callServer,void 0,t.findSourceMapURL,"getMonthlyProfits")}}]);