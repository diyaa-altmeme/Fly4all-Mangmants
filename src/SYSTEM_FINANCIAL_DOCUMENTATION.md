# ๐ ุงููุณุชูุฏ ุงูููู ุงูุดุงูู ูููุธุงู ุงููุงูู

## 1. ูุธุฑุฉ ุนุงูุฉ

ูุฐุง ุงููุณุชูุฏ ููุฏู ุชุญูููุงู ุดุงููุงู ูุนููููุง ููุจููุฉ ุงููุงููุฉ ุงููุงููุฉ ูููุธุงูุ ุจูุฏู ุชูุญูุฏ ุงูููุงููู ูุชุฌููุฒ ุงูุจููุฉ ุงูุชุญุชูุฉ ูุชุทููุฑ ููุฒุงุช ูุญุงุณุจูุฉ ูุชูุฏูุฉ ูุซู **ูุดู ุงูุญุณุงุจ ุงูููุญุฏ**ุ **ุดุฌุฑุฉ ุงูุญุณุงุจุงุช ุงูุฏููุงููููุฉ**ุ ู **ูุธุงู ุงูุฃุณุชุงุฐ ุงูุนุงู (Ledger)**.

**ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุณุชุฎุฏูุฉ:** `Cloud Firestore` (ูุงุนุฏุฉ ุจูุงูุงุช NoSQL).

---

## 2. ๐งฑ ุงููููู ุงูุนุงู ููุนูููุงุช ุงููุงููุฉ

ุฌููุน ุงูุนูููุงุช ุงููุงููุฉ ูู ุงููุธุงูุ ุจุบุถ ุงููุธุฑ ุนู ูุตุฏุฑูุง (ุชุฐูุฑุฉุ ููุฒุงุ ุณูุฏุ ุงุดุชุฑุงู)ุ ูุชู ุชูุญูุฏูุง ูุชุณุฌูููุง ูู **ููุฏ ูุญุงุณุจู ูุฒุฏูุฌ (Double-entry bookkeeping)** ูู ุฌุฏูู ูุฑูุฒู ูุงุญุฏ ูู:

*   **ุงูุฌุฏูู ุงููุญูุฑู:** `journal-vouchers`

ูุฐุง ูุนูู ุฃู ูู ุนูููุฉ ูุงููุฉ ููุง ุทุฑู **ูุฏูู (Debit)** ูุทุฑู **ุฏุงุฆู (Credit)**ุ ููุฌููุน ุงููุจุงูุบ ุงููุฏููุฉ ูุฌุจ ุฃู ูุณุงูู ุฏุงุฆููุง ูุฌููุน ุงููุจุงูุบ ุงูุฏุงุฆูุฉ.

### ูููู ุงูุณุฌู ุงููุญุงุณุจู (`JournalVoucher`)

ูุฐุง ูู ุงููููุฐุฌ ุงูุฃุณุงุณู ุงูุฐู ููุซู ุฃู ุญุฑูุฉ ูุงููุฉ ูู ุงููุธุงู.

```typescript
// File: src/lib/types.ts

export interface JournalEntry {
    accountId: string; // ูุนุฑู ุงูุญุณุงุจ (ูู ุดุฌุฑุฉ ุงูุญุณุงุจุงุช)
    amount: number;    // ุงููุจูุบ
    description: string; // ูุตู ููุญุฑูุฉ
}

export interface JournalVoucher {
    id: string;
    invoiceNumber: string; // ุฑูู ุชุณูุณูู ูุฑูุฏ (ูุซุงู: JV-00123)
    date: string;          // ุชุงุฑูุฎ ุงูุนูููุฉ (ISO String)
    currency: Currency;
    exchangeRate: number | null;
    notes: string;         // ูุตู ุนุงู ููุณูุฏ
    createdBy: string;     // UID ูููุณุชุฎุฏู ุงูุฐู ุฃูุดุฃ ุงูุณูุฏ
    officer: string;       // ุงุณู ุงููุณุชุฎุฏู
    voucherType: string;   // ููุน ุงูุณูุฏ ุงููุตุฏุฑ (booking, visa, payment, etc.)
    debitEntries: JournalEntry[];  // ุงูุญุณุงุจุงุช ุงููุฏููุฉ
    creditEntries: JournalEntry[]; // ุงูุญุณุงุจุงุช ุงูุฏุงุฆูุฉ
    isAudited: boolean;    // ูู ุชู ุชุฏููู ุงูุณูุฏุ
    isConfirmed: boolean;  // ูู ุชู ุชุฃููุฏ ุงูุนูููุฉุ
    originalData?: any;   // ุงูุจูุงูุงุช ุงูุฃุตููุฉ ูู ุงููููุฐุฌ ุงููุตุฏุฑ
}
```

---

## 3. ๐งพ ุงูุณูุฏุงุช ูุงูุญุฑูุงุช ุงููุงููุฉ

ูู ุณูุฏ ูุชู ุฅูุดุงุคู ูู ูุงุฌูุงุช ุงููุณุชุฎุฏู ุงููุฎุชููุฉ (ุณูุฏ ูุจุถุ ุฏูุนุ ูุตุงุฑูู) ูุชู ุชุญูููู ุฅูู ููุฏ ูุญุงุณุจู ูุฒุฏูุฌ ูุญูุธู ูู ุฌุฏูู `journal-vouchers`.

### ุฃ. ุขููุฉ ุนูู ุงูุณูุฏุงุช (ูููุงุช `actions`)

ุงูููุฏ ุงููุณุคูู ุนู ุฅูุดุงุก ูุฐู ุงููููุฏ ููุฌูุฏ ูู ุงููููุงุช ุงูุชุงููุฉ:

*   **ุณูุฏ ุงููุจุถ ุงูุนุงุฏู:** `src/app/accounts/vouchers/standard/actions.ts`
*   **ุณูุฏ ุงูุฏูุน:** `src/app/accounts/vouchers/payment/actions.ts`
*   **ุณูุฏ ุงููุตุงุฑูู:** `src/app/accounts/vouchers/expense/actions.ts`
*   **ุงูููุฏ ุงููุญุงุณุจู ุงููุฏูู:** `src/app/accounts/vouchers/journal/actions.ts`
*   **ุณูุฏ ุงููุจุถ ุงููุฎุตุต (ุงูููุฒุน):** `src/app/accounts/vouchers/distributed/actions.ts`
*   **ุงูุทุจูุฉ ุงูููุญุฏุฉ ูููููุฏ:** `src/lib/finance/financial-transactions.ts`

ุจุฏูุงู ูู ุชูุฑุงุฑ ููุทู ุฅูุดุงุก ุงููููุฏ ูู ูู ููู `action` ุฃุตุจุญ ุจุงูุฅููุงู ุงูุงุนุชูุงุฏ ุนูู ูุงุฌูุฉ ููุญุฏุฉ `FinancialTransaction` ูุฏุงูุฉ `recordFinancialTransaction` ูุชูููุฏ ุงููููุฏ ูุงูุชุญูู ูู ุชูุงุฒููุง ูุชูุซูููุง ุชููุงุฆูุงู. ุงููุงุฌูุฉ ุงูููุญุฏุฉ ุชุนุฑูู ูู `src/lib/types.ts` ุจุงูุดูู ุงูุชุงูู:

```typescript
export type FinancialTransaction = {
  sourceType: 'standard_receipt' | 'payment' | 'manualExpense' | ...;
  sourceId?: string;
  date?: string | Date;
  currency: Currency;
  debitAccountId: string;
  creditAccountId: string;
  amount: number;
  description?: string;
  reference?: string;
  companyId?: string;
};
```

ูุฏุงูุฉ ุงูุชูููุฐ:

```typescript
// File: src/lib/finance/financial-transactions.ts
export async function recordFinancialTransaction(tx: FinancialTransaction, options?: RecordFinancialTransactionOptions) {
  const { voucherId } = await postJournalEntry({
    sourceType: tx.sourceType,
    sourceId: tx.sourceId ?? `txn-${Date.now()}`,
    date: tx.date,
    description: tx.description,
    entries: [
      { accountId: tx.debitAccountId, debit: tx.amount, credit: 0, currency: tx.currency },
      { accountId: tx.creditAccountId, debit: 0, credit: tx.amount, currency: tx.currency },
    ],
    meta: { reference: tx.reference, companyId: tx.companyId }
  });

  // ูุชู ุชุณุฌูู ุงูุญุฏุซ ูู ุณุฌู ุงูุชุฏููู ุชููุงุฆูุงู ุฏุงุฎู ุงูุฏุงูุฉ
  return { voucherId };
}
```

**ูุซุงู: ุขููุฉ ุนูู ุณูุฏ ุงููุจุถ ุงูุนุงุฏู**

ุนูุฏ ุฅูุดุงุก ุณูุฏ ูุจุถ ูู ุนููู ูุฅูุฏุงุนู ูู ุตูุฏูู "ุงูุตูุฏูู ุงูุฑุฆูุณู"ุ ุชููู ุฏุงูุฉ `createStandardReceipt` ุจุชูููุฐ ุงูุขุชู:

1.  ุชูุดุฆ ููุฏูุง ูุญุงุณุจููุง ุฌุฏูุฏูุง ูู `journal-vouchers`.
2.  **ุงูุทุฑู ุงููุฏูู (Debit):** ูููู ุญุณุงุจ "ุงูุตูุฏูู ุงูุฑุฆูุณู" (ูุฃูู ุงุณุชูู ุงูุฃููุงู).
3.  **ุงูุทุฑู ุงูุฏุงุฆู (Credit):** ูููู ุญุณุงุจ "ุงูุนููู" (ูุฃู ุฑุตูุฏู ุงูุฏุงุฆู ูุฏููุง ุงูุฎูุถ).

```typescript
// ููุชุทู ูุจุณุท ูู: src/app/accounts/vouchers/standard/actions.ts
const { voucherId } = await recordFinancialTransaction({
  sourceType: 'standard_receipt',
  sourceId: `receipt-${Date.now()}`,
  date: data.date,
  currency: data.currency,
  debitAccountId: data.toBox, // ุงูุตูุฏูู (ูุฏูู)
  creditAccountId: data.from, // ุงูุนููู (ุฏุงุฆู)
  amount: data.amount,
  description: `ุณูุฏ ูุจุถ: ${data.details || 'ุฏูุนุฉ'}`,
  reference: data.details,
  companyId: data.from,
});
```

**ููุงุญุธุฉ ูููุฉ:** **ูุนูุ ูู ุณูุฏ ูุชู ุชุณุฌููู ูู ุฏูุชุฑ ุงูุฃุณุชุงุฐ** (ุฌุฏูู `journal-vouchers`) ุจุฏูู ุงุณุชุซูุงุก.

---

## 4. ๐ช ุงูุดุฌุฑุฉ ุงููุญุงุณุจูุฉ (Chart of Accounts)

ุญุงูููุงุ ูุง ููุฌุฏ ุฌุฏูู ูุฎุตุต ููููุตู ููุดุฌุฑุฉ ุงููุญุงุณุจูุฉ. ูุชู ุจูุงุคูุง ุจุดูู **ุถููู (Implicit)** ูู ุนุฏุฉ ุฌุฏุงูู ูุฎุชููุฉ.

### ุฃ. ูููุฐุฌ ุงูุญุณุงุจ (Account)

ูุง ููุฌุฏ `interface Account` ุตุฑูุญ ูููุญุฏ. ุจุฏูุงู ูู ุฐููุ ูู ููุน ูู ุงูุญุณุงุจุงุช ูู `interface` ุฎุงุต ุจู:

*   **ุงูุนููุงุก ูุงูููุฑุฏูู:** `Client` / `Supplier` (ูู ุฌุฏูู `clients`)
*   **ุงูุตูุงุฏูู:** `Box` (ูู ุฌุฏูู `boxes`)
*   **ุงูุจูุฑุตุงุช:** `Exchange` (ูู ุฌุฏูู `exchanges`)
*   **ุญุณุงุจุงุช ุงูุฅูุฑุงุฏุงุช ูุงููุตุฑููุงุช:** ูุชู ุชุนุฑูููุง ููุตูุต ุซุงุจุชุฉ (Hardcoded Strings) ูุซู `revenue_tickets`, `expense_visa`.

**ููุชุฑุญ ููุชุทููุฑ:** ูุฌุจ ุฅูุดุงุก ุฌุฏูู ูุฑูุฒู `accounts` ูุญุชูู ุนูู ุฌููุน ุงูุญุณุงุจุงุช ูุฅูุดุงุก ุดุฌุฑุฉ ูุญุงุณุจูุฉ ุฏููุงููููุฉ. ุงููููุฐุฌ ุงูููุชุฑุญ ููุชุงุฒ:

```typescript
// ูููุฐุฌ ููุชุฑุญ ููุซุงูู ูููุณุชูุจู
interface Account {
  id: string;      // ex: '1201001'
  name: string;    // ex: 'ุตูุฏูู ุจุบุฏุงุฏ'
  code: string;    // ex: '1201001'
  parentId?: string; // ex: '1201' (ุญุณุงุจ ุงูุตูุงุฏูู)
  type: "ุงูุฃุตูู" | "ุงูุฎุตูู" | "ุงูุฅูุฑุงุฏุงุช" | "ุงููุตุฑููุงุช" | "ุญููู ุงูููููุฉ";
  currency: Currency;
  hasSubAccounts: boolean;
}
```

### ุจ. ุฏุงูุฉ ุงุณุชุฑุฌุงุน ุงูุญุณุงุจุงุช

ุญุงูููุงุ ูุชู ุฌูุจ ูู ููุน ูู ุงูุญุณุงุจุงุช ูู ุฌุฏููู ุงูุฎุงุต ุนุจุฑ ุฏูุงู ูููุตูุฉ ุซู ุชุฌููุนูุง ูู ุงููุงุฌูุฉ.

*   `getClients()` ูู `src/app/relations/actions.ts`
*   `getSuppliers()` ูู `src/app/suppliers/actions.ts`
*   `getBoxes()` ูู `src/app/boxes/actions.ts`
*   `getExchanges()` ูู `src/app/exchanges/actions.ts`

**ููุงุญุธุฉ ูููุฉ:** **ูุนูุ ูู ุนูููุฉ ูุงููุฉ (ูู `JournalEntry`) ูุฑุจูุทุฉ ุจู `accountId`**. ูุฐุง ูู ุงูููุชุงุญ ูุฑุจุท ุงูุญุฑูุงุช ุงููุงููุฉ ุจุงูุดุฌุฑุฉ ุงููุญุงุณุจูุฉ.

---

## 5. ๐ ูุดู ุงูุญุณุงุจ

### ุฃ. ุงูููุฏ ุงููุงูู ูุตูุญุฉ ูุดู ุงูุญุณุงุจ

ุงูููุฏ ููุฌูุฏ ูู ููู `src/app/reports/account-statement/components/report-generator.tsx`. ูุฐุง ุงููููู ูุณุคูู ุนู ุนุฑุถ ุงูููุงุชุฑ ูุฌูุจ ุงูุจูุงูุงุช ูุนุฑุถ ุงูุฌุฏูู ูุงูููุฎุต.

### ุจ. ุงูุฏุงูุฉ ุงูุชู ุชุฌูุจ ุงูุนูููุงุช

ุงูุฏุงูุฉ ุงูุฑุฆูุณูุฉ ูู `getAccountStatement` ุงูููุฌูุฏุฉ ูู ููู `src/app/reports/actions.ts`.

ุชููู ูุฐู ุงูุฏุงูุฉ ุจุงูุฎุทูุงุช ุงูุชุงููุฉ:
1.  ุชุญุฏูุฏ ููุน ุงูุญุณุงุจ ุงููุทููุจ (ุนูููุ ููุฑุฏุ ุตูุฏููุ ุจูุฑุตุฉ...).
2.  ุฌูุจ **ุฌููุน** ุงูุณุฌูุงุช ูู `journal-vouchers`.
3.  ููุชุฑุฉ ุงูุณุฌูุงุช ููุนุซูุฑ ููุท ุนูู ุงูุญุฑูุงุช ุงูุชู ูููู ูููุง ุงูุญุณุงุจ ุงููุทููุจ ุทุฑููุง ูุฏูููุง ุฃู ุฏุงุฆููุง.
4.  ููุชุฑุฉ ุงููุชุงุฆุฌ ุญุณุจ ูุทุงู ุงูุชุงุฑูุฎ ุงููุญุฏุฏ.
5.  ุญุณุงุจ ุงูุฑุตูุฏ ุงูุงูุชุชุงุญู ูุงูุฑุตูุฏ ุงูุฎุชุงูู.
6.  ุฅุฑุฌุงุน ูุงุฆูุฉ ุจุงูุนูููุงุช ูุน ุงูุฑุตูุฏ ุงููุชุฑุงูู.

### ุฌ. ุงูุฃุนูุฏุฉ ุงูุญุงููุฉ ูู ุงููุดู

*   ุงูุชุงุฑูุฎ (`date`)
*   ุงูููุน (`type` - ูุซู: ุณูุฏ ูุจุถุ ูุงุชูุฑุฉ ุญุฌุฒ)
*   ุงูุจูุงู (`description`)
*   ูุฏูู (`debit`)
*   ุฏุงุฆู (`credit`)
*   ุงูุฑุตูุฏ (`balance`)
*   ุงูุนููุฉ (`currency`)
*   ุงูููุธู (`officer`)
*   ุงูุฅุฌุฑุงุกุงุช (ุชุนุฏููุ ุญุฐู)

---

## 6. ๐ฆ ุงูุตูุงุฏูู ูุงูุนููุงุช

*   **ููู ุงูุตูุงุฏูู:** ุงูููุฏ ููุฌูุฏ ูู `src/app/boxes/actions.ts`. ูุชู ุชุฎุฒูู ุงูุตูุงุฏูู ูู ุฌุฏูู `boxes`.
*   **ููู ุงูุนููุงุช:** ูุง ููุฌุฏ ุฌุฏูู ูููุตู ููุนููุงุช. ูุชู ุชุนุฑูููุง ูุฅุฏุงุฑุชูุง ุถูู ููู ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ `AppSettings`.
*   **ูุธุงู ุณุนุฑ ุงูุตุฑู:** ููุฌุฏ ุณุนุฑ ุตุฑู ุซุงุจุช (ุญุงููุงู `USD` ุฅูู `IQD`) ูุชู ุชุฎุฒููู ุฃูุถูุง ูู ููู ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ ููููู ุชุนุฏููู ูู ูุงุฌูุฉ ุงูุฅุนุฏุงุฏุงุช.

---

## 7. โ๏ธ ูููุงุช ุนุงูุฉ

### ุฃ. ููู `types.ts`

ูุฐุง ูู ุงููุญุชูู ุงููุงูู ููููู `src/lib/types.ts`ุ ููู ูุญุชูู ุนูู ุฌููุน ููุงุฐุฌ ุงูุจูุงูุงุช ูู ุงููุธุงู.

```typescript
// ุงููุญุชูู ุงููุงูู ูููู src/lib/types.ts ููุฌูุฏ ููุง
// ... (ุชู ุฅุฑูุงู ุงููุญุชูู ุงููุงูู ูู ุงูุงุณุชุฌุงุจุฉ ุงูุณุงุจูุฉ) ...
import type { ReconciliationResult, ReconciliationSettings, FilterRule } from './reconciliation';
import type { ThemeConfig } from './themes';
import { COUNTRIES_DATA } from './countries-data';
import { parseISO } from 'date-fns';

export type Currency = "USD" | "IQD" | string;

export type Box = {
  id: string;
  name: string;
  openingBalanceUSD: number;
  openingBalanceIQD: number;
};

// ... (ุจุงูู ุงูุฃููุงุน ููุง ูู ููุฌูุฏุฉ ูู ุงูููู) ...

export type JournalEntry = {
    accountId: string;
    amount: number;
    description: string;
}

export type JournalVoucher = {
    id: string;
    invoiceNumber: string;
    date: string; // ISO string
    currency: Currency;
    exchangeRate: number | null;
    notes: string;
    createdBy: string;
    officer: string;
    createdAt: string; // ISO string
    updatedAt: string; // ISO string
    voucherType: string;
    voucherTypeLabel?: string;
    debitEntries: JournalEntry[];
    creditEntries: JournalEntry[];
    isAudited: boolean;
    isConfirmed: boolean;
    isDeleted?: boolean;
    deletedAt?: string;
    originalData?: any; // To store original form data if needed for display
};

// ... ูููุฐุง ูุน ุจุงูู ุงูุฃููุงุน ...
```

### ุจ. ููู ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ (`AppSettings`)

ูุนูุ ููู ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ ูุญุชูู ุนูู ุฅุนุฏุงุฏุงุช ูุงููุฉ ูุงูุฉ. ูุชู ุฌูุจูุง ุนุจุฑ ุฏุงูุฉ `getSettings` ูู ููู `src/app/settings/actions.ts`. ุฃูู ุงูุฅุนุฏุงุฏุงุช ุงููุงููุฉ ููู ูู:

*   `currencySettings`: ูุฅุฏุงุฑุฉ ุงูุนููุงุช ูุฃุณุนุงุฑ ุงูุตุฑู.
*   `voucherSettings`: ูุฅุฏุงุฑุฉ ุฅุนุฏุงุฏุงุช ุงูุณูุฏุงุช ุงููุฎุชููุฉ.
*   `invoiceSequenceSettings`: ูุฅุฏุงุฑุฉ ุชุณูุณู ุฃุฑูุงู ุงูููุงุชูุฑ.

---

## 8. ๐ ุดุฑุญ ุงูุตูุญุงุช ูุขููุฉ ุนูููุง

### ุฃ. ุงูุณูุฏุงุช ุจุฃููุงุนูุง (ูุจุถุ ุฏูุนุ ูุตุงุฑููุ ููุฏ)
*   **ุขููุฉ ุงูุนูู:** ูู ุณูุฏ ูู ูููุฐุฌ ุฎุงุต ุจู. ุนูุฏ ุงูุญูุธุ ูุชู ุงุณุชุฏุนุงุก ุฏุงูุฉ `action` ุฎุงุตุฉ ุจู (ูุซุงู: `createStandardReceipt`) ุชููู ุจุฅูุดุงุก ููุฏ ูุญุงุณุจู ูุฒุฏูุฌ ูุชูุงุฒู ูู ุฌุฏูู `journal-vouchers`.
*   **ูุซุงู (ุณูุฏ ุฏูุน):** ุงูุทุฑู ุงููุฏูู ูู ุญุณุงุจ ุงูููุฑุฏ (ูุฃู ุฏููู ูุฏููุง ูู)ุ ูุงูุทุฑู ุงูุฏุงุฆู ูู ุญุณุงุจ ุงูุตูุฏูู (ูุฃู ุฃููุงูู ููุตุช).

### ุจ. ุชุฐุงูุฑ ุงูุทูุฑุงู (`bookings`)
*   **ุขููุฉ ุงูุนูู:** ุนูุฏ ุฅูุดุงุก ุญุฌุฒุ ูุชู ุฅูุดุงุก ููุฏ ูุฑูุจ ูู 4 ุญุฑูุงุช:
    1.  **ูุฏูู:** ุญุณุงุจ ุงูุนููู (ุจูุงูู ูููุฉ ุงูุชุฐูุฑุฉ).
    2.  **ูุฏูู:** ุญุณุงุจ "ูุตุฑููุงุช ุงูุชุฐุงูุฑ" (ุจุชูููุฉ ุงูุชุฐูุฑุฉ).
    3.  **ุฏุงุฆู:** ุญุณุงุจ ุงูููุฑุฏ (ุจุชูููุฉ ุงูุชุฐูุฑุฉ).
    4.  **ุฏุงุฆู:** ุญุณุงุจ "ุฅูุฑุงุฏุงุช ุงูุชุฐุงูุฑ" (ุจูุงูู ูููุฉ ุงูุชุฐูุฑุฉ).

### ุฌ. ุทูุจุงุช ุงูููุฒุง (`visas`)
*   **ุขููุฉ ุงูุนูู:** ููุณ ุขููุฉ ุชุฐุงูุฑ ุงูุทูุฑุงู ุชูุงููุงุ ูููู ุจุงุณุชุฎุฏุงู ุญุณุงุจุงุช "ูุตุฑููุงุช ุงูููุฒุง" ู "ุฅูุฑุงุฏุงุช ุงูููุฒุง".

### ุฏ. ุงูุงุดุชุฑุงูุงุช (`subscriptions`)
*   **ุขููุฉ ุงูุนูู:** ุนูุฏ ุฅูุดุงุก ุงุดุชุฑุงูุ ูุชู ุฅูุดุงุก ููุฏ ููุงุซู ููุชุฐุงูุฑ ูุฅุซุจุงุช ุงููุฏููููุฉ ุนูู ุงูุนููู ูุงูุฅูุฑุงุฏ ููุดุฑูุฉ. ุนูุฏ ุฏูุน ูู ูุณุทุ ูุชู ุฅูุดุงุก **ุณูุฏ ูุจุถ** ูููุตู ูุชุณููุฉ ุฌุฒุก ูู ุฏูู ุงูุนููู.

### ูู. ุงูุญูุงูุงุช (`remittances`)
*   **ุขููุฉ ุงูุนูู:** ุนูุฏ "ุงุณุชูุงู" ุงูุญูุงูุฉุ ูุชู ุฅูุดุงุก ุณูุฏ ูุจุถ ุชููุงุฆููุงุ ุญูุซ ูููู ุงูุทุฑู ุงููุฏูู ูู ุงูุตูุฏูู ุงููุญุฏุฏุ ูุงูุทุฑู ุงูุฏุงุฆู ูู ุญุณุงุจ ูุคูุช ููุซู "ูุตุฏุฑ ุงูุญูุงูุฉ".

### ู. ุงูุณูููุช (`segments`)
*   **ุขููุฉ ุงูุนูู:** ุนูุฏ ุฅูุดุงุก ุณุฌู ุณูููุชุ ูุชู ุฅูุดุงุก **3 ูููุฏ ูุญุงุณุจูุฉ** ุชููุงุฆููุง:
    1.  ููุฏ ูุฅุซุจุงุช **ูุงูู ุงูุฑุจุญ ูุฏูู ุนูู ุงูุนููู**.
    2.  ููุฏ **ุตุฑู ุญุตุต ุงูุดุฑูุงุก** ูู ุงูุตูุฏูู ุฅูู ุญุณุงุจุงุชูู.
    3.  ููุฏ ุฏุงุฎูู **ูุฅุซุจุงุช ุญุตุฉ ุงูุดุฑูุฉ** ูุฅูุฑุงุฏ ูุนูู.

### ุฒ. ุชูุฒูุน ุงูุญุตุต (`profit-sharing`)
*   **ุขููุฉ ุงูุนูู:** ุนูุฏ ุชูุฒูุน ุฃุฑุจุงุญ ูุชุฑุฉ ูุฏููุฉุ ูุชู ุฅูุดุงุก ูููุฏ ุตุฑู ูู ุงูุตูุฏูู ุงููุญุฏุฏ ุฅูู ุญุณุงุจุงุช ุงูุดุฑูุงุกุ ุจุงูุฅุถุงูุฉ ุฅูู ููุฏ ุฅุซุจุงุช ุญุตุฉ ุงูุดุฑูุฉ.

### ุญ. ุงูุจูุฑุตุงุช (`exchanges`)
*   **ุขููุฉ ุงูุนูู:** ูู ูุนุงููุฉ (ุฏูู ุฃู ุชุณุฏูุฏ) ูุชู ุชุณุฌูููุง ูุฏูุนุฉ (`batch`) ูู ุฌุฏุงูู ุฎุงุตุฉ (`exchange_transaction_batches`, `exchange_payment_batches`). ูุชู ุนุฑุถูุง ูู ูุดู ุญุณุงุจ ุงูุจูุฑุตุฉ ุงูููุญุฏ.

### ุท. ุชุญููู ุจูุงูุงุช ุงูุทูุฑุงู (`flight-analysis`)
*   **ุขููุฉ ุงูุนูู:** ูุฐู ุงูุฃุฏุงุฉ ูุง ุชูุดุฆ ูููุฏูุง ูุญุงุณุจูุฉ ูุจุงุดุฑุฉ. ูู ุฃุฏุงุฉ ุชุญููููุฉ ููุท ุชููู ุจูุนุงูุฌุฉ ูููุงุช Excel ูุชุฎุฒูู ุงููุชุงุฆุฌ ูู ุฌุฏูู `flight_reports` ูุฃุบุฑุงุถ ุงูุชุฏููู ูุงูููุงุฑูุฉ.

---

ุจูุฐุง ุงููุณุชูุฏุ ูุฏูู ุงูุขู ุฎุฑูุทุฉ ุทุฑูู ูุงุถุญุฉ ููุงููุฉ ูููุธุงู ุงููุงููุ ููุง ูููููุง ูู ุงูุงูุทูุงู ูู ุชุทููุฑ ุงูููุฒุงุช ุงููุญุงุณุจูุฉ ุงููุชูุฏูุฉ ุจุซูุฉ ูุฏูุฉ.

---

## ๐ ููุญู: ุชูุงุตูู ุฅุถุงููุฉ ูููุธุงู ุงููุญุงุณุจู

ูุฐุง ุงูููุญู ูุญุชูู ุนูู ุงูุฅุถุงูุงุช ุงูุชู ุทูุจุชูุง ูุถูุงู ูุถูุญ ูุงูู ูุจู ุงูุจุฏุก ุจุงูุชุทููุฑ.

### 1. ุฌุฏูู ุงููููุฏ ุงููุญุงุณุจูุฉ ููู ุนูููุฉ

| ููุน ุงูุนูููุฉ (voucherType) | ุงูุญุณุงุจ ุงููุฏูู (Debit) | ุงูุญุณุงุจ ุงูุฏุงุฆู (Credit) | ููุงุญุธุงุช |
| :--- | :--- | :--- | :--- |
| `journal_from_standard_receipt` | ุงูุตูุฏูู (toBox) | ุงูุนููู (from) | ูุชู ุฅูุดุงุคู ูู ุณูุฏ ุงููุจุถ ุงูุนุงุฏู. |
| `journal_from_payment` | ุงูููุฑุฏ (toSupplierId) | ุงูุตูุฏูู (boxId) | ูุชู ุฅูุดุงุคู ูู ุณูุฏ ุงูุฏูุน. |
| `journal_from_expense` | ุญุณุงุจ ุงููุตุฑูู (expense_xyz) | ุงูุตูุฏูู (boxId) | ูุชู ุฅูุดุงุคู ูู ุณูุฏ ุงููุตุงุฑูู. |
| `journal_voucher` | ุญุณุงุจุงุช ูุชุนุฏุฏุฉ | ุญุณุงุจุงุช ูุชุนุฏุฏุฉ | ูุชู ุฅูุดุงุคู ูู ุณูุฏ ุงูููุฏ ุงููุฏูู. |
| `booking` (ุชุฐูุฑุฉ) | ุงูุนููู (clientId)ุ ูุตุฑูู ุงูุชุฐุงูุฑ | ุงูููุฑุฏ (supplierId)ุ ุฅูุฑุงุฏ ุงูุชุฐุงูุฑ | ููุฏ ูุฑูุจ ูู ุฃุฑุจุนุฉ ุฃุทุฑุงู. |
| `visa` (ููุฒุง) | ุงูุนููู (clientId)ุ ูุตุฑูู ุงูููุฒุง | ุงูููุฑุฏ (supplierId)ุ ุฅูุฑุงุฏ ุงูููุฒุง | ููุฏ ูุฑูุจ ูู ุฃุฑุจุนุฉ ุฃุทุฑุงู. |
| `subscription` (ุงุดุชุฑุงู) | ุงูุนููู (clientId) | ุฅูุฑุงุฏ ุงูุงุดุชุฑุงูุงุช | ููุฏ ูุฅุซุจุงุช ุงูุฏูู ูุงูุฅูุฑุงุฏ ุนูุฏ ุงูุฅูุดุงุก. |
| `journal_from_installment` | ุงูุตูุฏูู (boxId) | ุงูุนููู (clientId) | ููุฏ ุณูุฏ ูุจุถ ุนูุฏ ุชุณุฏูุฏ ูู ูุณุท. |
| `journal_from_remittance` | ุงูุตูุฏูู (boxId) | ุญุณุงุจ ูุตุฏุฑ ุงูุญูุงูุฉ | ูุชู ุฅูุดุงุคู ุนูุฏ ุงุณุชูุงู ุงูุญูุงูุฉ. |
| `segment` (ุณูููุช) | ุงูุนููู (clientId) | ุฅูุฑุงุฏ ุงูุณูููุช | ููุฏ ูุฅุซุจุงุช ุฅุฌูุงูู ุฑุจุญ ุงูุณูููุช ูุฏูู. |
| `profit-sharing` (ุชูุฒูุน ุญุตุต) | ุญุณุงุจ ุงูุดุฑูู (partnerId) | ุงูุตูุฏูู (boxId) | ููุฏ ุตุฑู ุญุตุฉ ูู ุดุฑูู. |

---

### 2. ูููู ุงูุดุฌุฑุฉ ุงููุญุงุณุจูุฉ ุงูููุชุฑุญ

ูุฐุง ูู ุงููููู ุงูููุชุฑุญ ุงูุฐู ุณูุนุชูุฏู. ุณูุชู ุฅูุดุงุก ุฌุฏูู ูุฑูุฒู `accounts` ูุชุฎุฒูู ูุฐู ุงูุดุฌุฑุฉ ุจุดูู ุฏููุงูููู.

```json
{
  "1": { "name": "ุงูุฃุตูู", "code": "1", "type": "main", "children": {
    "10": { "name": "ุงูุฃุตูู ุงููุชุฏุงููุฉ", "code": "10", "type": "group", "children": {
      "100": { "name": "ุงูุตูุงุฏูู ูุงูุจููู", "code": "100", "type": "group" },
      "101": { "name": "ุงูุฐูู ุงููุฏููุฉ (ุงูุนููุงุก)", "code": "101", "type": "group" },
      "102": { "name": "ุงูุจูุฑุตุงุช", "code": "102", "type": "group" }
    }}
  }},
  "2": { "name": "ุงูุฎุตูู", "code": "2", "type": "main", "children": {
    "20": { "name": "ุงูุฎุตูู ุงููุชุฏุงููุฉ", "code": "20", "type": "group", "children": {
      "200": { "name": "ุงูุฐูู ุงูุฏุงุฆูุฉ (ุงูููุฑุฏูู)", "code": "200", "type": "group" }
    }}
  }},
  "3": { "name": "ุญููู ุงูููููุฉ", "code": "3", "type": "main" },
  "4": { "name": "ุงูุฅูุฑุงุฏุงุช", "code": "4", "type": "main", "children": {
    "400": { "name": "ุฅูุฑุงุฏุงุช ุงููุดุงุท ุงูุฑุฆูุณู", "code": "400", "type": "group", "children": {
      "4000": { "name": "ุฅูุฑุงุฏุงุช ุชุฐุงูุฑ ุงูุทูุฑุงู", "id": "revenue_tickets", "code": "4000", "type": "account" },
      "4001": { "name": "ุฅูุฑุงุฏุงุช ุงูููุฒุง", "id": "revenue_visa", "code": "4001", "type": "account" },
      "4002": { "name": "ุฅูุฑุงุฏุงุช ุงูุงุดุชุฑุงูุงุช", "id": "revenue_subscriptions", "code": "4002", "type": "account" },
      "4003": { "name": "ุฅูุฑุงุฏุงุช ุงูุณูููุช", "id": "revenue_segments", "code": "4003", "type": "account" },
      "4004": { "name": "ุฅูุฑุงุฏุงุช ุชูุฒูุน ุงูุฃุฑุจุงุญ", "id": "revenue_profit_distribution", "code": "4004", "type": "account" },
      "4005": { "name": "ุฅูุฑุงุฏุงุช ุฑุณูู ุงูุงุณุชุฑุฌุงุน ูุงูุชุบููุฑ", "id": "revenue_fees", "code": "4005", "type": "account" }
    }}
  }},
  "5": { "name": "ุงููุตุฑููุงุช", "code": "5", "type": "main", "children": {
    "500": { "name": "ุชูุงููู ุงููุดุงุท ุงูุฑุฆูุณู", "code": "500", "type": "group", "children": {
      "5000": { "name": "ุชูููุฉ ุชุฐุงูุฑ ุงูุทูุฑุงู", "id": "expense_tickets", "code": "5000", "type": "account" },
      "5001": { "name": "ุชูููุฉ ุงูููุฒุง", "id": "expense_visa", "code": "5001", "type": "account" },
      "5002": { "name": "ุชูููุฉ ุงูุงุดุชุฑุงูุงุช", "id": "expense_subscriptions", "code": "5002", "type": "account" }
    }},
    "501": { "name": "ุงููุตุฑููุงุช ุงูุชุดุบูููุฉ", "code": "501", "type": "group" }
  }}
}
```

---

### 3. ูุซุงู ูุณุฌู `journal-vouchers` ูู Firestore

ูุฐุง ูุซุงู ูุณุฌู ูุญุงุณุจู ูุงุชุฌ ุนู ุฅูุดุงุก **ุณูุฏ ูุจุถ ุนุงุฏู**.

```json
{
  "id": "abc123xyz456",
  "invoiceNumber": "RC-000101",
  "date": "2024-05-20T10:00:00.000Z",
  "currency": "USD",
  "exchangeRate": null,
  "notes": "ุฏูุนุฉ ูู ุญุณุงุจ ุดูุฑ 5",
  "createdBy": "uid_of_user_1",
  "officer": "Ali Ahmed",
  "createdAt": "2024-05-20T10:00:05.123Z",
  "updatedAt": "2024-05-20T10:00:05.123Z",
  "voucherType": "journal_from_standard_receipt",
  "isAudited": true,
  "isConfirmed": true,
  "debitEntries": [
    {
      "accountId": "box_main_id",
      "amount": 500,
      "description": "ุฅูุฏุงุน ูู ุงูุตูุฏูู"
    }
  ],
  "creditEntries": [
    {
      "accountId": "client_id_456",
      "amount": 500,
      "description": "ุณุฏุงุฏ ุฏูุนุฉ"
    }
  ],
  "originalData": {
    "date": "2024-05-20T10:00:00.000Z",
    "from": "client_id_456",
    "toBox": "box_main_id",
    "amount": 500,
    "currency": "USD",
    "details": "ุฏูุนุฉ ูู ุญุณุงุจ ุดูุฑ 5"
  }
}
```

---

ุจูุฐู ุงูุฅุถุงูุงุชุ ุฃุตุจุญ ุงููุณุชูุฏ ุงูุขู ุฌุงูุฒูุง ุชูุงููุง ููุงูุทูุงู ูู ุจูุงุก ุงูููุฒุงุช ุงููุญุงุณุจูุฉ ุงููุชูุฏูุฉ.
